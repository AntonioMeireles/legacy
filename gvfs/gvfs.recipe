#
# Copyright (c) 2008 rPath, Inc.
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

loadSuperClass('gnomepackage')
loadSuperClass('rpmpackage')

class Gvfs(RPMPackageRecipe,GnomePackageRecipe):
    buildRequires = [ 'fuse:devel', 'openssh-client:runtime', 'glib:devel',
                      'gtk-doc:runtime', 'hal:devel', 'libsoup:devel',
                      'libxml2:devel', 'samba:devel', 'GConf:devel', 'ORBit2:devel',
                      'avahi-glib:devel', 'avahi:devel', 'gnome-keyring:devel',
                      'libexif:devel', 'libgphoto2:devel', 'libusb:devel',
                      'bluez:devel', 'samba-client:lib',
                      'automake:runtime', 'autoconf:runtime', 'libtool:runtime',
                      ]

    name = 'gvfs'
    version = '1.2.3'
    rpmRelease = '10.fc11'
    rpmPatches = [ # http://bugzilla.gnome.org/show_bug.cgi?id=567235
        'gvfs-0.99.2-archive-integration.patch',
        # http://bugzilla.gnome.org/show_bug.cgi?id=573826
        'gvfs-1.1.7-gdu-computer-expose-devices.patch',
        # https://bugzilla.redhat.com/show_bug.cgi?id=497631
        'gvfs-1.2.2-dnssd-deadlock.patch',
        # Unable to Play Audio CDs 
        # https://bugzilla.redhat.com/show_bug.cgi?id=499266 
        'gvfs-1.2.3-cdda-allow-query-well-formed-filenames-only.patch',
        # SFTP timeout too short
        # https://bugzilla.redhat.com/show_bug.cgi?id=504339
        'gvfs-1.2.3-sftp-40sec-timeout.patch',
        # smb url don't work in the run application dialog 
        # http://bugzilla.gnome.org/show_bug.cgi?id=573994 
        'gvfs-1.3.4-smb-browse-fake-content-type.patch',
        # Bad mount prefix stripping in g_daemon_file_get_path()
        # http://bugzilla.gnome.org/show_bug.cgi?id=590862
        'gvfs-1.3.4-dont-strip-mount-prefix-for-local-paths.patch',

        # http://bugzilla.gnome.org/show_bug.cgi?id=582373
        'webdav-username.patch',
        'gvfs-1.2.4-fix-gphoto2-for-canon-5d.patch',
        ]


    extraConfig = ' --enable-samba --with-bash-completion-dir=%(sysconfdir)s/bash_completion.d/'
    
    def unpack(r):
        RPMPackageRecipe.unpack(r)
        r.Run('libtoolize --force; aclocal; autoheader; automake; autoconf')

    def policy(r):
        r.SetModes('%(sysconfdir)s/bash_completion.d/gvfs-bash-completion.sh', 0644)
        r.NonBinariesInBindirs(exceptions='%(sysconfdir)s/bash_completion.d/gvfs-bash-completion.sh')
