#
# Copyright (c) 2008 rPath, Inc.
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

class MozLdap(CPackageRecipe):
    name = 'mozldap'
    version = '6.0.5'

    buildRequires = ['cyrus-sasl:devel', 'libstdc++:devel', 'mozilla-svrcore:devel', 'nspr:devel', 'nss:devel', 'pkgconfig:devel', 'perl:runtime']


    def setup(r):
        r.macros.major = r.version.split('.')[0]
        r.macros.minor = r.version.split('.')[1]
        r.macros.submin = r.version.split('.')[2]
        r.macros.libsuffix = '%(major)s0'
        r.addArchive('ftp://ftp.mozilla.org/pub/mozilla.org/directory/c-sdk/releases/v%(version)s/src/%(name)s-%(version)s.tar.gz')
        r.addSource('mozldap.pc.in', macros=True)
        extraConfig = ' --enable-clu --with-sasl --with-system-svrcore  --enable-optimize --disable-debug '
        extraMake = ''
        if Arch.x86_64:
            extraConfig += '--enable-64bit'
            extraMake += 'USE_64=1'
        r.Configure(extraConfig, dir='mozilla/directory/c-sdk')
        r.Make(extraMake, dir='mozilla/directory/c-sdk')
        r.Install('mozilla/dist/lib/*.so', '%(libdir)s/')
        r.Install('mozilla/dist/bin/ldap*', '%(libdir)s/%(name)s/')
        r.Install('mozilla/dist/public/ldap/*.h', '%(includedir)s/%(name)s/')
        r.Install('mozldap.pc.in', '%(libdir)s/pkgconfig/mozldap.pc')
        r.Install('mozilla/directory/c-sdk/ldap/examples', '%(datadir)s/%(name)s/')
        r.Install('mozilla/directory/c-sdk/ldap/examples/xmplflt.conf', '%(datadir)s/%(name)s/etc/')
        r.Install('mozilla/directory/c-sdk/ldap/libraries/libldap/*.conf', '%(datadir)s/%(name)s/etc/')
