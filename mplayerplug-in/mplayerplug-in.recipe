#
# Copyright (c) 2004-2007 rPath, Inc.
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

class MplayerPlugin(CPackageRecipe):
    name = 'mplayerplug-in'
    version = '3.31'

    buildRequires = [ 'pkgconfig:devel','xulrunner:devel', 'atk:devel',
        'cairo:devel', 'fontconfig:devel', 'freetype:devel', 'glib:devel',
        'glibc:devel', 'gtk:devel', 'libgcc:devellib', 'libpng:devel',
        'libstdc++:devel', 'nspr:devel', 'pango:devel', 'gcc-c++:runtime',
        'zlib:devel', 'gawk:runtime', 'file:runtime', 'gettext:runtime',
        'libICE:devel', 'libSM:devel', 'libXext:devel', 'libXpm:devel',
        'libXt:devel', 'libX11:devel', 'firefox:devellib',
        'libXrender:devel', ]

    def setup(r):
        r.mainDir('mplayerplug-in')
        r.addArchive('mirror://sourceforge/%(name)s/')
        r.Configure()
        r.Make()

        # install for firefox
        r.Install('%(name)s*.so', '%(libdir)s/firefox/plugins/')
        r.Install('%(name)s*.xpt', '%(libdir)s/firefox/components/')
        r.TagSpec("firefox-xpt-component", '%(libdir)s/firefox/components/.*')
        # install for mozilla
        r.Symlink('%(libdir)s/firefox/plugins/*', '%(libdir)s/mozilla/plugins/')
        r.Symlink('%(libdir)s/firefox/components/*', '%(libdir)s/mozilla/components/')
        # sample config file
        r.Install('%(name)s.conf', '%(sysconfdir)s/%(name)s.conf')

        r.ComponentSpec("runtime", "%(libdir)s/firefox.*")
        r.ComponentSpec("runtime", "%(libdir)s/mozilla.*")

        # each browser will have its own XPCOM already loaded, so this
        # dependency becomes superfluous - we shouldn't pick up a
        # dependency for the one from mozilla or firefox if the end
        # user is not using it...
        r.Requires(exceptDeps='soname: ELF32/libxpcom.so.*')
