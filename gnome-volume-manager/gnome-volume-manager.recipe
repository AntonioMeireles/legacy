loadRecipe('gnomepackage.recipe')
class Gvm(GnomePackageRecipe):

    buildRequires = GnomePackageRecipe.buildRequires
    buildRequires.extend([ 'hal:devel', 'dbus:devel', 'GConf:devel', 
		'ORBit2:devel', 'atk:devel', 'glib:devel', 'glibc:devel', 
		'gnome-vfs:devel', 'libart_lgpl:devel', 'libbonobo:devel', 
		'libbonoboui:devel', 'libglade:devel', 'libgnome:devel', 
		'libgnomecanvas:devel', 'libgnomeui:devel', 'libxml2:devel', 
		'pango:devel', 'popt:devel' ])

    name = 'gnome-volume-manager'
    version = '1.5.7'

    #externalArchive = 'http://primates.ximian.com/~fejj/gvm/%(name)s-%(version)s.tar.gz'
        
    def unpack(r):
	GnomePackageRecipe.unpack(r)
	r.extraConfig += ' --with-mount-command="/usr/bin/pmount-hal %%h; /usr/bin/pmount %%d" --with-unmount-command="/usr/bin/pumount %%d"'
        r.macros.optflags = '-g -Os'

	r.addPatch('defaults.patch')
        r.addPatch('gnome-volume-manager-0.9.10.add-to-base.patch', level=1)
	#r.addPatch('multiseat.patch')
	#r.addPatch('01_fix_nonmountable_media.patch')
	#r.addPatch('03_kernel_hint.patch')

        #Removed by Gil - any alternative available? :
	#r.addPatch('04_reconnect_on_dbus_exit.patch')

	r.addPatch('05_mount_at_start.patch')
	#r.addPatch('06_pmount_crypt.patch')
	#r.addPatch('07_automount_enabled_hint.patch')
	#r.addPatch('99_autotools.patch')
        r.addPatch('gnome-volume-manager-1.5.7-array-pointer-fix.patch', level=1)
        

    def install(r):
	GnomePackageRecipe.install(r)
	r.Requires('pmount:runtime','%(bindir)s/gnome-volume-manager')
