
class AtiFglrx(PackageRecipe):

    buildRequires = [ 'glibc:devel', 'gtk:runtime', 'libX11:devel', 
                      'libXext:devel', 'libXrandr:devel', 
                      'libXrender:devel', 'libgcc:devellib', 
                      'libstdc++:devel', 'chkconfig:runtime', 'Mesa[ati]' ]
    name = 'ati-fglrx'
    version = '8.28.8'

    def setup(r):
        r.addSource('http://www2.ati.com/drivers/linux/ati-driver-installer-%(version)s.run')
        r.Run('sh ./ati-driver-installer-%(version)s.run --extract archive_files')
        r.Copy('archive_files/arch/x86/*', 'src/')
        r.Copy('archive_files/common/*', 'src/')
        r.Copy('archive_files/x710/*', 'src/')
        r.Move('src/usr/X11R6/bin/*','src/usr/bin/')
        r.Move('src/usr/X11R6/lib/modules','src/usr/lib/xorg/')
        r.Move('src/usr/X11R6/lib/*','src/usr/lib/')
        r.Move('src/usr/X11R6/include/X11','src/usr/include/')

        del r.AutoDoc

        r.Install('src/usr', '%(destdir)s')
        r.Install('src/etc', '%(destdir)s')
        r.Symlink('%(libdir)s/libGL.so.1.2','%(libdir)s/libGL.so')
        r.Symlink('%(libdir)s/libGL.so.1.2','%(libdir)s/libGL.so.1')
        r.Symlink('%(libdir)s/libfglrx_pp.so.1.0','%(libdir)s/libfglrx_pp.so.1')
        r.Symlink('%(libdir)s/libfglrx_gamma.so.1.0','%(libdir)s/libfglrx_gamma.so.1')


        r.addSource('fglrx.sh')
        r.Install('fglrx.sh', '%(sysconfdir)s/profile.d/')
        r.addSource('atieventsd.init')
        r.Install('atieventsd.init', '%(initdir)s/atieventsd')
