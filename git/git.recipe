#
# Copyright (c) 2005-2008 rPath, Inc.
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

class Git(CPackageRecipe):
    name = 'git'
    version = '1.5.3.8'

    buildRequires = [ 'asciidoc:runtime', 'curl:devel', 'expat:devel',
        'openssl:devel', 'perl:lib', 'perl:runtime', 'perl-DBD-MySQL:perl',
        'perl-DBD-Pg:perl', 'perl-DBI:perl', 'perl-URI:perl',
        'perl-libwww-perl:perl', 'perl-DBD-SQLite:perl', 'zlib:devel',
        'xmlto:runtime' ]

    def setup(r):
        r.addArchive('http://www.kernel.org/pub/software/scm/git/')
        r.Make('prefix=%(prefix)s all doc')
        r.MakeInstall('prefix=%(prefix)s mandir=%(mandir)s install install-doc')

        r.Copy('gitweb/git*', '%(servicedir)s/www/cgi-bin/')
        r.PackageSpec('gitweb', '%(servicedir)s/www/cgi-bin/.*')

        # explicitly put git-repo-config into :runtime, so it isn't put in :devel
        r.ComponentSpec('runtime', '%(bindir)s/git-repo-config',
                                   '%(bindir)s/git-config')
