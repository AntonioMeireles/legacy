#
# Copyright (c) 2009 Foresight Linux
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#
class Git(CPackageRecipe):
    name = 'git'
    version = '1.7.0'

    buildRequires = [ 'asciidoc:runtime', 'curl:devel', 'expat:devel',
        'openssl:devel', 'perl:devel', 'perl:runtime', 'perl-DBD-MySQL:perl',
        'perl-DBD-Pg:perl', 'perl-DBI:perl', 'perl-URI:perl',
        'perl-DBD-SQLite:perl', 'zlib:devel',
        'xmlto:runtime', 'gettext:runtime', 'perl-Compress-Zlib:perl', 'perl-HTTP-Cookies:perl', 'subversion:perl', 'perl-Term-ReadKey:perl']

    def setup(r):
        r.addArchive('http://www.kernel.org/pub/software/scm/git/', keyid='517D0F0E')
        r.addArchive('http://www.kernel.org/pub/software/scm/git/git-htmldocs-%(version)s.tar.bz2',
            keyid='517D0F0E', dir='html')
        r.Make('prefix=%(prefix)s all doc')
        r.MakeInstall('prefix=%(prefix)s mandir=%(mandir)s install install-doc')
        r.Doc('html/*')

        r.Copy('gitweb/git*', '%(servicedir)s/www/cgi-bin/')
        r.PackageSpec('gitweb', '%(servicedir)s/www/cgi-bin/.*')

        # explicitly put git-repo-config into :runtime, so it isn't put in :devel
        r.ComponentSpec('runtime', '%(bindir)s/git-repo-config',
                                   '%(bindir)s/git-config')

	r.LinkCount(exceptions=('%(bindir)s', '/usr/libexec/git-core/'))

