#
# Copyright (c) 2005-2007 rPath, Inc.
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

class M2CryptoPackage(CPackageRecipe):
    name = 'm2crypto'
    version = '0.18'

    buildRequires = [ 'krb5:devel', 'openssl:devel', 'python:devel',
        'swig:runtime', ]

    def setup(r):
        r.addArchive('http://wiki.osafoundation.org/pub/Projects/MeTooCrypto/')
        r.Replace(', opensslIncludeDir\\),',
            ", opensslIncludeDir), '%(krbprefix)s/include',", 'setup.py')
        # This is the "new way" to write PrivateKey, according to pem(3)
        r.Replace(
            "PEM_write_bio_PrivateKey", "PEM_write_bio_PKCS8PrivateKey",
            "SWIG/_evp.i")
        r.Run('python setup.py install --root=%(destdir)s')

        r.RemoveNonPackageFiles("TwistedProtocolWrapper.*")

        r.Doc('doc/*.html')
        r.Doc('LICENCE')
