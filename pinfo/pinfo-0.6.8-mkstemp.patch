--- src/manual.c.mkstemp	2003-08-19 15:21:12.000000000 -0400
+++ src/manual.c	2004-12-23 13:28:44.000000000 -0500
@@ -212,13 +212,18 @@
   size_t macroline_size;
   int ignored_items = 0, i = 0;
   char zipped = 0;
+  char tempbuf[PATH_MAX] = "/tmp/pinfoXXXXXX";
+  int fd;
 
   if (tmpfilename1)
     {
       unlink (tmpfilename1);
       xfree (tmpfilename1);
     }
-  tmpfilename1 = tempnam ("/tmp", NULL);
+  fd = mkstemp(tempbuf);
+  fchmod(fd, S_IRUSR | S_IWUSR);
+  close(fd);
+  tmpfilename1 = strdup(tempbuf);
 
 #ifdef getmaxyx
   init_curses ();
@@ -248,6 +253,8 @@
   if (ignoredmacros)		/* if the pointer is non-null */
     if (*ignoredmacros && strlen (ignoredmacros))	/* if there are some macros */
       {				/* that should be ignored   */
+        char tempbuf[PATH_MAX] = "/tmp/pinfoXXXXXX";
+        int fd;
 	*location = '\0';
 	snprintf (cmd, 255, "man -W %s %s",	/* we need to know the path */
 		  ManOptions,
@@ -318,9 +325,11 @@
 	  }
 	else
 	  source = fopen (location, "r");	/* from cmd output  */
-	name = tempnam ("/tmp", NULL);
+	fd = mkstemp(tempbuf);
+        fchmod(fd, S_IRUSR | S_IWUSR);
+	name = strdup(tempbuf);
 	raw_tempfilename = name;
-	id = fopen (name, "w");
+	id = fdopen (fd, "w");
 
 	while (!feof (source))	/* we read until eof */
 	  {
@@ -396,7 +405,10 @@
       if (use_apropos)
 	{
 	  printf (_ ("Calling apropos \n"));
-	  apropos_tempfilename = tempnam ("/tmp", NULL);
+	  fd = mkstemp(tempbuf);
+	  fchmod(fd, S_IRUSR | S_IWUSR);
+	  close(fd);
+	  apropos_tempfilename = strdup(tempbuf);
 	  snprintf (cmd, 255, "apropos %s > %s", name, apropos_tempfilename);
 	  if (system (cmd) != 0)
 	    {
@@ -435,12 +447,17 @@
       manual_aftersearch = 0;
       if (return_value != -1)	/* -1 is quit key */
 	{
+          char tempbuf[PATH_MAX] = "/tmp/pinfoXXXXXX";
+          int fd;
 	  if (tmpfilename2)
 	    {
 	      unlink (tmpfilename2);
 	      xfree (tmpfilename2);
 	    }
-	  tmpfilename2 = tempnam ("/tmp", NULL);
+	  fd = mkstemp(tempbuf);
+	  fchmod(fd, S_IRUSR | S_IWUSR);
+          close(fd);
+	  tmpfilename2 = strdup(tempbuf);
 	  if (return_value != -2)	/* key_back is not pressed;
 					   and return_value is an
 					   offset to manuallinks */
--- src/filehandling_functions.c.mkstemp	2003-08-20 16:25:56.000000000 -0400
+++ src/filehandling_functions.c	2004-12-23 13:30:49.000000000 -0500
@@ -503,12 +503,17 @@
 
   if (number == 0)		/* initialize tmp filename for file 1 */
     {
+      char tmpbuf[PATH_MAX] = "/tmp/pinfoXXXXXX";
+      int fd;
       if (tmpfilename1)
 	{
 	  unlink (tmpfilename1);	/* erase old tmpfile */
 	  free (tmpfilename1);
 	}
-      tmpfilename1 = tempnam ("/tmp", NULL);
+      fd = mkstemp(tmpbuf);
+      fchmod(fd, S_IRUSR | S_IWUSR);
+      close(fd);
+      tmpfilename1 = strdup(tmpbuf);
       tmpfilename = tmpfilename1;	/* later we will refere only to tmp1 */
     }
   for (i = 0; i < infopathcount; i++)	/* go through all paths */
@@ -671,23 +676,33 @@
 
   if (number == 0)		/* initialize tmp filename for file 1 */
     {
+      char tmpbuf[PATH_MAX] = "/tmp/pinfoXXXXXX";
+      int fd;
       if (tmpfilename1)
 	{
 	  unlink (tmpfilename1);	/* erase old tmpfile */
 	  free (tmpfilename1);
 	}
-      tmpfilename1 = tempnam ("/tmp", NULL);
+      fd = mkstemp(tmpbuf);
+      fchmod(fd, S_IRUSR | S_IWUSR);
+      close(fd);
+      tmpfilename1 = strdup(tmpbuf);
       tmpfilename = tmpfilename1;	/* later we will refere only to tmp1 */
     }
   else
     /* initialize tmp filename for file 2 */
     {
+      char tmpbuf[PATH_MAX] = "/tmp/pinfoXXXXXX";
+      int fd;
       if (tmpfilename2)
 	{
 	  unlink (tmpfilename2);	/* erase old tmpfile */
 	  free (tmpfilename2);
 	}
-      tmpfilename2 = tempnam ("/tmp", NULL);
+      fd = mkstemp(tmpbuf);
+      fchmod(fd, S_IRUSR | S_IWUSR);
+      close(fd);
+      tmpfilename2 = strdup(tmpbuf);
       tmpfilename = tmpfilename2;	/* later we will refere only to tmp2 */
     }
 
--- src/common_includes.h.mkstemp	2002-02-06 14:16:23.000000000 -0500
+++ src/common_includes.h	2004-12-23 13:30:49.000000000 -0500
@@ -14,6 +14,7 @@
 #include <stdlib.h>
 #include <signal.h>
 #include <unistd.h>
+#include <limits.h>
 #include <sys/types.h>
 #include <sys/stat.h>
 #include <pwd.h>
