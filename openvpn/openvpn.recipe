#
# Copyright (c) 2005 Specifix, Inc.
# All rights reserved
#

class OpenVPN(CPackageRecipe):
    name = "openvpn"
    version = "2.0.5"

    buildRequires = [
        'chkconfig:runtime',
        'iproute:runtime',
        'krb5:devel',
        'lzo:devel',
        'net-tools:runtime',
        'openssl:devel',
        'pam:devel',
    ]

    def setup(r):
        # http://openvpn.net/
        r.addArchive('http://openvpn.net/release/openvpn-%(version)s.tar.gz')

        r.Configure('--with-ssl-headers=/usr/kerberos/include')
        r.Make()
        r.Make(subDir='plugin/down-root')
        r.Make(subDir='plugin/auth-pam')

        r.MakeInstall()
        r.Install('sample-scripts/openvpn.init', '%(initdir)s/openvpn')
        r.MakeDirs('%(sysconfdir)s/openvpn')
        r.ExcludeDirectories(exceptions='%(sysconfdir)s/openvpn')
        r.Remove('easy-rsa/Windows', recursive=True)
        r.Doc('sample-{scripts,config-files,keys}',
              'easy-rsa')

        r.Provides(exceptions='%(libdir)s/openvpn/plugins/')
        for plugin in ('auth-pam', 'down-root'):
            r.Install('plugin/%s/openvpn-%s.so'%(plugin, plugin),
                      '%(libdir)s/openvpn/plugins/')
