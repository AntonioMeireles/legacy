#
# Copyright (c) 2004-2007 rPath, Inc.
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

class Slocate(CPackageRecipe):
    name = 'slocate'
    version = '3.1'

    def setup(r):
        r.addArchive('http://slocate.trakker.ca/files/')
        r.addSource('slocate.cron')
        r.addSource('updatedb.conf')
        # security fix
        r.addPatch('CVE-2007-0227.patch', extraArgs='--ignore-whitespace')
        r.Replace('PRUNEPATHS="', 'PRUNEPATHS="/sys ', 'updatedb.conf')
        r.Make()
        # make install hardcodes things into /usr/local and other nasty things
        r.MakeDirs('%(localstatedir)s/lib/slocate', mode=0750)
        r.Install('src/slocate', '%(bindir)s/', mode=02755)
        r.Symlink('slocate', '%(bindir)s/locate')
        r.Install('doc/{slocate,updatedb}.1', '%(mandir)s/man1/')
        r.Symlink('slocate.1', '%(mandir)s/man1/locate.1')
        r.Install('slocate.cron', '%(sysconfdir)s/cron.daily/')
        r.Symlink('slocate', '%(bindir)s/updatedb')
        r.Install('updatedb.conf', '%(sysconfdir)s/')
        r.SetModes('%(localstatedir)s/lib/slocate', 0775)

        r.Ownership('root', 'slocate',
                    '%(bindir)s/(slocate|locate|updatedb)')
        r.Ownership('root', 'slocate', '%(localstatedir)s/lib/slocate')
