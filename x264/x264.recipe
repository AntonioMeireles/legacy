class x264(CPackageRecipe):

    name = 'x264'
    version = '0.67.400740ba1a8a'

    buildRequires = [
        'yasm:runtime',
      ]

    def setup(r):
        _, r.macros.soversion, r.macros.commit = r.version.split('.')
        r.addGitSnapshot('git://git.videolan.org/x264.git', tag='%(commit)s')

        r.Configure('--enable-shared --enable-pthread --enable-pic')
        r.Make()
        r.MakeInstall()

        r.Move('%(libdir)s/libx264.so.%(soversion)s', '%(libdir)s/libx264.so.%(soversion)s.%(commit)s')
        r.Symlink('%(libdir)s/libx264.so.%(soversion)s.%(commit)s', '%(libdir)s/libx264.so.%(soversion)s')
        r.Symlink('%(libdir)s/libx264.so.%(soversion)s.%(commit)s', '%(libdir)s/libx264.so')
