#
# Copyright (c) 2007-2008 Foresight Linux
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

class x264(CPackageRecipe):

    name = 'x264'
    version = '0.78.bcba15dbbc0d'

    buildRequires = [
        'yasm:runtime',
      ]

    def setup(r):
        _, r.macros.soversion, r.macros.commit = r.version.split('.')
        r.addGitSnapshot('git://git.videolan.org/x264.git', tag='%(commit)s')

        r.Configure('--enable-shared --enable-pthread --enable-pic')
        r.Make()
        r.MakeInstall()

        r.Move('%(libdir)s/libx264.so.%(soversion)s', '%(libdir)s/libx264.so.%(soversion)s.%(commit)s')
        r.Symlink('%(libdir)s/libx264.so.%(soversion)s.%(commit)s', '%(libdir)s/libx264.so.%(soversion)s')
        r.Symlink('%(libdir)s/libx264.so.%(soversion)s.%(commit)s', '%(libdir)s/libx264.so')

