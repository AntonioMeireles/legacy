#
# Copyright (c) 2008 rPath, Inc.
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

class foo2zjs(AutoPackageRecipe):

    name = 'foo2zjs'
    version = '20080207' # after changing this version, run "cvc refresh"

    buildRequires = [
        'foomatic-filters:runtime', 'ghostscript:runtime', 'glibc:devel',
        'gzip:runtime', 'unzip:runtime'
    ]

    def unpack(r):

        r.addArchive('http://foo2zjs.rkkda.com/%(name)s.tar.gz')

        files = [ 'http://foo2zjs.rkkda.com/firmware/%s.tar.gz' % file
            for file in (
                'sihpP1005', 'sihpP1006', 'sihpP1505',
                'sihp1000', 'sihp1005', 'sihp1018', 'sihp1020',
            )
        ]
        files.extend([ 'ftp://ftp.minolta-qms.com/pub/crc/out_going/%s.exe' % file
            for file in (
                'win2000/m22dlicc', 'win/m23dlicc', 'windows/cpplxp'
            )
        ])
        files.extend([
            'http://foo2hp.rkkda.com/icm/hpclj2600n.tar.gz',
            'http://foo2lava.rkkda.com/icm/km2530.tar.gz',
            'http://foo2qpdl.rkkda.com/icm/samclp300.tar.gz',
            'http://foo2slx.rkkda.com/icm/lexc500.tar.gz',
            'http://foo2zjs.rkkda.com/icm/km2430.tar.gz',
        ])

        for file in files:
            r.addSource(file)

    def configure(r):

        r.Replace('wget ', 'true ', 'getweb.in')
        r.Replace(
            ('^DOCDIR=.*', 'DOCDIR=%(thisdocdir)s'),
            ('^PREFIX=/usr$', 'PREFIX=$(DESTDIR)/%(prefix)s'),
            ('^UDEVBIN=/bin/', 'UDEVBIN=$(DESTDIR)%(essentialbindir)s/'),
            ('/usr/share/', '$(DESTDIR)%(datadir)s/'),
            'Makefile'
        )

    def makeinstall(r):

        r.Run('./getweb all')
        r.MakeDirs('%(essentialbindir)s', '%(bindir)s')
        r.MakeDirs('%(datadir)s/foomatic/db/source/{,opt,printer,driver}')

        r.MakeInstall()

    def policy(r):

        r.AutoDoc(exceptions='.*')
