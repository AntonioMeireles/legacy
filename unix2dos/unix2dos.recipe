#
# Copyright (c) 2004-2005 rPath, Inc.
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

class Unix2Dos(CPackageRecipe):
    name = 'unix2dos'
    version = '2.2'

    def setup(r):
        # every distribution uses version 2.2, but the original appears
        # to have disappeared from the face of the net :(
        r.addArchive('unix2dos-%(version)s.src.tar.gz',
                     rpm='ftp://ftp.redhat.com/pub/redhat/linux/enterprise/3/en/os/i386/SRPMS/unix2dos-2.2-19.src.rpm',
                     dir=r.theMainDir)
        r.addPatch('unix2dos-mkstemp.patch')
        r.addPatch('unix2dos-2.2-segfault.patch')
        r.addPatch('unix2dos-2.2-manpage.patch')
        # C does not allow trailing garbage on #else/#endif
        # Remove junk after #else and #endif lines
        r.Replace('#e(lse|ndif).*', r'#e\1', '*.[ch]')

        r.Make('unix2dos')
        r.Install('unix2dos', '%(bindir)s/', mode=0755)
        r.Install('unix2dos.1', '%(mandir)s/man1/', mode=0644)
