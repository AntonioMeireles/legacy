# Copyright (c) 2010 Foresight Linux
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

loadSuperClass('kernelmodulepackage')
class RTL8192SEKernelModuleRecipe(KernelModulePackageRecipe):
    name = 'rtl8192se-kmod'
#    version =  '2.6.0017.0507.2010'
    version =  '2.6.0015.0127.2010'
    kmodDir = 'HAL/rtl8192/'    

    def unpack(r):
        # r.addArchive('ftp://WebUser:pGL7E6v@152.104.238.19/cn/wlan/rtl8192se_linux_2.6.0015.0127.2010.tar.gz')
        # (2010-05-28 15:16:22) smerp: Ugh, it's a pain in the arse; RealTek makes it hard as hell to get their drivers
        # (2010-05-28 15:20:17) smerp: ftp://WebUser:pGL7E6v@152.104.238.19/cn/wlan/rtl8192se_linux_2.6.0015.0127.2010.tar.gz
        # (2010-05-28 15:20:48) smerp: yes, they have this byzantine thing where you have to click on a link, which does some javascript which redirects you to this ftp site that's password protected
        # http://www.realtek.com.tw/downloads/downloadsView.aspx?Langid=1&PNid=21&PFid=48&Level=5&Conn=4&DownTypeID=3&GetDown=false&Downloads=true#2302

        r.addArchive('rtl8192se_linux_%(version)s.tar.gz')
        r.addPatch('rfkill-2.6.0015.0127.2010.patch')
        r.Environment('KVER', '%(kver)s')
        # Suggested as a possible workaround, here:
        # https://bugzilla.redhat.com/show_bug.cgi?id=562902#c12
        r.Replace('-DENABLE_LPS', '-DENABLE_LPS_NOWAY_HOSEA', 'HAL/rtl8192/Makefile', 'rtllib/Makefile')

    def build(r):
        r.Make('KVER=%(kver)s', dir = r.kmodDir)

    def install(r):
        r.macros.moduledir = r.moduleDir
        r.Install(r.kmodDir + '*.ko', '/lib/modules/%(kver)s/%(moduledir)s/')
