class AbiWord(PackageRecipe):

    buildRequires = [ 'GConf:devel', 'ORBit2:devel', 'aiksaurus:devel', 'atk:devel',
		'bzip2:devel', 'cairo:devel', 'enchant:devel', 'expat:devel',
		'fontconfig:devel', 'freetype:devel', 'fribidi:devel', 'gcc:devel',
		'glib:devel', 'glibc:devel', 'gnome-keyring:devel', 'gnome-vfs:devel',
		'goffice:devel', 'gtk:devel', 'gucharmap:devel', 'libart_lgpl:devel',
		'libbonobo:devel', 'libbonoboui:devel', 'libglade:devel', 'libgnome:devel',
		'libgnomecanvas:devel', 'libgnomeprint:devel', 'libgnomeprintui:devel',
		'libgnomeui:devel', 'libgsf:devel', 'libjpeg:devel', 'libpng:devel',
		'librsvg:devel', 'libtermcap:devel', 'libwmf:devel', 'libxml2:devel',
		'pango:devel', 'poppler:devel', 'popt:devel', 'readline:devel',
		'xorg-x11:devel', 'zlib:devel' ]

    name = 'abiword'
    version = '2.4.4'

    def setup(r):
	r.addArchive('http://www.abisource.org/downloads/%(name)s/%(version)s/source/%(name)s-%(version)s.tar.gz')
	r.Replace('Categories=Application;','Categories=GNOME;Application;','abi/abiword.desktop')
	r.Replace('72, 72, 0', '72, 72, 0, gTrue', 'abiword-plugins/wp/impexp/pdf/xp/ie_imp_PDF.cpp')

	r.Configure('--enable-gnome', subDir='abi')
	r.Make(subDir='abi')
	r.MakeInstall(subDir='abi')
	
	r.Configure('--without-magick --without-abidash --with-abiword=../abi', subDir='abiword-plugins')
	r.Make(subDir='abiword-plugins')
	r.MakeInstall(subDir='abiword-plugins')
	
        r.MakeDirs("%(datadir)s/AbiSuite-2.2/AbiWord")
        r.Run("ABI_DOC_PROG=%(builddir)s/abi/src/wp/main/unix/AbiWord-2.4 ./make-html.sh",
              dir="abiword-docs/")
        r.Move("abiword-docs/help", "%(datadir)s/AbiSuite-2.4/AbiWord/")
        # some of the help directories have bad permissions
        r.Run("find %(destdir)s%(datadir)s/AbiSuite-2.4/AbiWord/help/ -type d -exec chmod -c o+rx {} \;")

	r.ComponentSpec('runtime', '%(libdir)s/AbiWord-2.4/plugins/')
        r.ComponentSpec('doc', '%(datadir)s/AbiSuite-2.4/AbiWord/help/')
