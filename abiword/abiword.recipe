class AbiWord(PackageRecipe):

    buildRequires = [ 'GConf:devel', 'ORBit2:devel', 'aiksaurus:devel', 'atk:devel',
        'bzip2:devel', 'cairo:devel', 'enchant:devel', 'expat:devel',
        'fontconfig:devel', 'freetype:devel', 'fribidi:devel', 'gcc:devel',
        'glib:devel', 'glibc:devel', 'gnome-keyring:devel', 'gnome-vfs:devel',
        'goffice:devel', 'gtk:devel', 'gucharmap:devel', 'libart_lgpl:devel',
        'libbonobo:devel', 'libbonoboui:devel', 'libglade:devel', 'libgnome:devel',
        'libgnomecanvas:devel', 'libgnomeprint:devel', 'libgnomeprintui:devel',
        'libgnomeui:devel', 'libgsf:devel', 'libjpeg:devel', 'libpng:devel',
        'librsvg:devel', 'libtermcap:devel', 'libwmf:devel', 'libxml2:devel',
        'pango:devel', 'poppler:devel', 'popt:devel', 'readline:devel',
        'zlib:devel', 'binutils:runtime', 'desktop-file-utils:runtime',
        'gawk:runtime', 'gtk:runtime', 'libgcc:devellib', 'libstdc++:devel',
        'perl:lib', 'perl:runtime', 'pkgconfig:devel', 'psiconv:devel', 
	'libICE:devel', 'libSM:devel', 'libX11:devel', 'libXau:devel', 
	'libXdmcp:devel', 'libXft:devel', 'libXrender:devel' ] 

    name = 'abiword'
    version = '2.4.5'

    def setup(r):
        r.addArchive('http://www.abisource.org/downloads/%(name)s/%(version)s/source/%(name)s-%(version)s.tar.gz')
        r.Replace('Categories=Application;','Categories=GNOME;Application;','abi/abiword.desktop')
        r.Replace('72, 72, 0', '72, 72, 0, gTrue', 'abiword-plugins/wp/impexp/pdf/xp/ie_imp_PDF.cpp')
        
        r.Configure('--enable-gnome --with-builtin-plugins', subDir='abi')
	r.Make(subDir='wv/libole2')  # needs to be this way. otherwise cook breaks.
	r.Make(subDir='abi')
	
        r.MakeInstall(subDir='abi')
        
        r.MakeDirs("%(datadir)s/AbiSuite-2.2/AbiWord")
        r.Run("ABI_DOC_PROG=%(builddir)s/abi/src/wp/main/unix/AbiWord-2.4 ./make-html.sh",
              dir="abiword-docs/")
        r.Move("abiword-docs/help", "%(datadir)s/AbiSuite-2.4/AbiWord/")
        # some of the help directories have bad permissions
        r.Run("find %(destdir)s%(datadir)s/AbiSuite-2.4/AbiWord/help/ -type d -exec chmod -c o+rx {} \;")

        r.ComponentSpec('runtime', '%(libdir)s/AbiWord-2.4/plugins/')
        r.ComponentSpec('doc', '%(datadir)s/AbiSuite-2.4/AbiWord/help/')
