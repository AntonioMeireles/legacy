class AbiWord(PackageRecipe):

    buildRequires = [ 'gtk:devel', 'libxml2:devel',
			'aspell:devel', 'libpng:devel',
			'libbonobo:devel','libbonoboui:devel',
			'libgnomeprint:devel','libgnomeprintui:devel',
			'libgnomeui:devel','desktop-file-utils:runtime',
			'fribidi:devel', 'libwmf:devel' ]

    name = 'abiword'
    version = '2.2.5'

    def setup(r):
	r.addArchive('http://www.abisource.org/downloads/%(name)s/%(version)s/source/%(name)s-%(version)s.tar.gz')

	r.Configure('--enable-gnome', subDir='abi')
	r.Make(subDir='abi')
	r.MakeInstall(subDir='abi')
	
	r.Configure('--without-magick --without-abidash --with-abiword=../abi', subDir='abiword-plugins')
	r.Make(subDir='abiword-plugins')
	r.MakeInstall(subDir='abiword-plugins')
	
        r.MakeDirs("%(datadir)s/AbiSuite-2.2/AbiWord")
        r.Run("ABI_DOC_PROG=%(builddir)s/abi/src/wp/main/unix/AbiWord-2.2 ./make-html.sh",
              dir="abiword-docs/")
        r.Move("abiword-docs/help", "%(datadir)s/AbiSuite-2.2/AbiWord/")
        # some of the help directories have bad permissions
        r.Run("find %(destdir)s%(datadir)s/AbiSuite-2.2/AbiWord/help/ -type d -exec chmod -c o+rx {} \;")

	r.ComponentSpec('runtime', '%(libdir)s/AbiWord-2.2/plugins/')
        r.ComponentSpec('doc', '%(datadir)s/AbiSuite-2.2/AbiWord/help/')
