#
# Copyright (c) 2009 Foresight Linux
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

class ardour(PackageRecipe):
    buildRequires = ['alsa-lib:devel', 'atk:devel', 'autogen:runtime', 'binutils:runtime', 'cairo:devel', 'curl:devel', 'expat:devel', 'fontconfig:devel', 'freetype:devel', 'gcc-c++:runtime', 'gcc:runtime', 'glib:devel', 'glibc:devel', 'gtk:devel', 'jack:devel', 'libX11:devel', 'libXrender:devel', 'libart_lgpl:devel', 'libgcc:devellib', 'libgnomecanvas:devel', 'liblo:devel', 'liblrdf:devel', 'libpng:devel', 'libsamplerate:devel', 'libstdc++:devel', 'libusb:devel', 'libxcb:devel', 'libxml2:devel', 'libxslt:devel', 'm4:runtime', 'openssl:devel', 'pango:devel', 'pixman:devel', 'pkgconfig:devel', 'raptor:devel', 'xcb-util:devel', 'zlib:devel', 'desktop-file-utils:runtime', 'scons:runtime', 'fftw:devel', 'fftw:devellib', 'aubio:devel']
    name = "ardour"
    version = "2.8.2"

    def setup(r):
        r.addArchive('%(name)s-%(version)s.tar.bz2')
        if Arch.x86:
            archFlags = '-DARCH_X86 -DBUILD_SSE_OPTIMIZATIONS -msse -mfpmath=sse -DUSE_XMMINTRIN'
            targetCpu = 'i386'
        else:
            archFlags = '-DARCH_X86 -DBUILD_SSE_OPTIMIZATIONS -DUSE_X86_64_ASM -msse -mfpmath=sse -DUSE_XMMINTRIN'
            targetCpu = 'x86_64'

        r.Run('scons %(parallelmflags)s PREFIX=%(prefix)s DESTDIR=%(destdir)s '
              'FREESOUND=1 DIST_TARGET=' + targetCpu +''
              'ARCH="%(cflags)s' + archFlags + '" '
              'AUSTATE=1 WIIMOTE=1')

        r.Run('scons install')
        r.addSource('ardour.desktop')
        r.Desktopfile('ardour.desktop', category='AudioVideo')

