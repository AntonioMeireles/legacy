#
# Copyright (c) 2009 Foresight Linux Project
# Copyright (c) 2006-2008 rPath, Inc.
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#
loadInstalled('python')
class Bzr(CPackageRecipe):
    name = 'bzr'
    version = '1.14.1'

    buildRequires = [ 'python-setuptools:python', 'elementtree:python',
        'cElementTree:python', 'ConfigObj:python', 'python:devel',
        'python-ctypes:python', 'python-cssutils:python']

    def setup(r):
        r.addArchive('https://launchpad.net/bzr/1.14/%(version)s/+download/')
        r.Run("""
              sed -i '1{/#![[:space:]]*\/usr\/bin\/\(python\|env\)/d}' bzrlib/_patiencediff_py.py
              sed -i '1{/#![[:space:]]*\/usr\/bin\/\(python\|env\)/d}' bzrlib/weave.py 
              """)
        r.Run("CFLAGS=\"%(cflags)s\" python setup.py install --root=%(destdir)s build_ext --allow-python-fallback")


        r.Install('contrib/bash/bzr.simple', '%(sysconfdir)s/bash_completion.d/bzr', mode = 0644)
        # Use independently packaged python-elementtree instead
        r.macros.pyver = Python.majversion
        r.Remove('%(libdir)s/python%(pyver)s/site-packages/bzrlib/util/elementtree/', recursive = True)

        r.Move('/usr/man/*', '%(mandir)s/')
        r.Remove('/usr/man', recursive = True)

