#
# Copyright (c) 2004-2009 rPath, Inc.
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

class MicrocodeCtl(CPackageRecipe):
    name = 'microcode_ctl'
    version = '1.17'

    def setup(r):
        r.addArchive('http://www.urbanmyth.org/microcode/')
        r.addSource('microcode_ctl.init')
        r.addSource('microcode-20090927.dat',
                    dest='/lib/firmware/microcode.dat',
                    mode=0644)
        # http://cvs.fedoraproject.org/viewvc/devel/microcode_ctl/microcode_ctl.patch?view=co
        r.addPatch('microcode_ctl.patch')

        r.Make(forceFlags=True)
        r.MakeInstall('PREFIX=%(prefix)s INSDIR=%(essentialsbindir)s')
        # Must come after MakeInstall because the local copy of the
        # initscript overrides the installed version
        r.Install('microcode_ctl.init', '%(initdir)s/microcode_ctl', mode=0755)
        r.TagSpec('initscript', '%(initdir)s/')
