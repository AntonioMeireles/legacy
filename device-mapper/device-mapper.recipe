#
# Copyright (c) 2005-2008 rPath, Inc.
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

class DeviceMapper(AutoPackageRecipe):
    name = 'device-mapper'
    version = '1.02.19'

    def unpack(r):
        r.addArchive('ftp://sources.redhat.com/pub/dm/%(name)s.%(version)s.tgz')
        r.mainDir('%(name)s.%(version)s')
        r.macros.exec_prefix = '/'

    def configure(r):
        r.Configure('--enable-static_link --with-user= --with-group= '
                    '--enable-pkgconfig --disable-selinux')

    def policy(r):
        # Policy tries to move /usr/lib/pkgconfig/devmapper.pc to
        # /lib/pkgconfig/, don't let it.
        r.NormalizePkgConfig(exceptions='%(prefix)s/%(lib)s/pkgconfig/devmapper.pc')
        # If on x86_64 move package config to lib64
        if Arch.x86_64:
            r.MakeDirs('%(prefix)s/%(lib)s/pkgconfig')
            r.Move('%(prefix)s/lib/pkgconfig/devmapper.pc',
                   '%(prefix)s/%(lib)s/pkgconfig/devmapper.pc')
        # the makefile installs it to lib even on 64 bit. conary-policy
        # will move it to the correct place
        r.Replace('Libs.private:.*', '',
                  '%(prefix)s/%(lib)s/pkgconfig/devmapper.pc')
        # put oddly named libdevmapper.a.1.00 in the right place
        r.ComponentSpec('devellib', r'%(essentiallibdir)s/lib.*\.a\..*')
        r.ComponentSpec('static', r'%(essentialsbindir)s/.*\.static')
        r.AutoDoc('INTRO', 'VERSION', 'WHATS_NEW')
