#
# Copyright (c) 2004-2006 rPath, Inc.
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

class Gawk(AutoPackageRecipe):
    name = 'gawk'
    version = '3.1.6'

    buildRequires = [ 'byacc:runtime', 'install-info:runtime' ]

    def unpack(r):
        r.addArchive('mirror://gnu/gawk/', keyid='D679F6CF')
        r.addArchive('mirror://gnu/gawk/gawk-%(version)s-ps.tar.gz', keyid='D679F6CF')
        srpm = 'http://download.fedora.redhat.com/pub/fedora/linux/core/development/source/SRPMS/gawk-3.1.5-11.src.rpm'
        # https://bugzilla.redhat.com/bugzilla/show_bug.cgi?id=114246
        r.addPatch('gawk-3.1.3-getpgrp_void.patch', rpm=srpm)

    def makeinstall(r):
        r.MakeInstall('bindir=%(essentialbindir)s '
                      'libexecdir=%(libexecdir)s/awk '
                      'datadir=%(datadir)s/awk')
        r.Symlink('gawk.1.gz', '%(mandir)s/man1/awk.1.gz')
        r.Symlink('%(essentialbindir)s/gawk', '%(bindir)s/awk')
        r.Symlink('%(essentialbindir)s/gawk', '%(bindir)s/gawk')
        r.Remove('%(essentialbindir)s/{,p}gawk-%(version)s')
        #r.Move('%(datadir)s/awk/locale', '%(datadir)s/locale') # fixed in 3.1.6
        r.AutoDoc('POSIX.STD', 'doc/gawk.ps', 'doc/awkcard.ps', 'FUTURES',
                  'LIMITATIONS')
