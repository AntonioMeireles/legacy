#
# Copyright (c) 2004-2006 rPath, Inc.
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

class Jadetex(CPackageRecipe):

    buildRequires = [ 'unzip:runtime', 'tetex:runtime',
                      'tetex-latex:runtime', 'tetex-fonts:data',
                      'openjade:devellib', 'openjade:runtime' ]
    name = 'jadetex'
    version = '3.13'

    def setup(r):
        r.addArchive('http://umn.dl.sourceforge.net/sourceforge/%(name)s/%(name)s-%(version)s.tar.gz')
        r.addSource('jadefmtutil.cnf')

        # jadetex needs to use latex instead of tex with tetex3
        # According to this thread, this had been fixed in jadetex CVS
        # http://sourceforge.net/mailarchive/forum.php?thread_id=7159317&forum_id=3200
        r.Replace('\ttex ', '\tlatex ', 'Makefile')
        r.Make()
        r.MakeInstall()
        r.Install('*.{ini,sty,cnf}', '%(datadir)s/texmf/tex/jadetex/')
        r.Symlink('latex', '%(bindir)s/jadetex')
        r.Symlink('pdftex', '%(bindir)s/pdfjadetex')
        r.InitialContents(r'%(datadir)s/texmf/web2c/.*\.fmt')

        # /usr/bin/virtex and /usr/bin/pdfvirtex provided by tetex
        r.DanglingSymlinks(exceptions='%(bindir)s/(jadetex|pdfjadetex)')
        r.Requires('tetex:runtime', '/usr/bin/.*')
