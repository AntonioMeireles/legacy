#
# Copyright (c) 2004-2007 rPath, Inc.
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

loadSuperClass('rpmpackage')
class XInetd(RPMPackageRecipe, CPackageRecipe):
    name = 'xinetd'
    version = '2.3.14'

    buildRequires = [ 'tcp_wrappers:devel', ]

    rpmRelease = '3.1'
    rpmPatches = [ 'xinetd-2.3.11-pie.patch', 'xinetd-2.3.12-tcp_rpc.patch', ]

    def setup(r):
        # upstream website is gone somewhere
        r.unpack()
        r.addSource('xinetd.init', rpm=r.srpm, dest='%(initdir)s/xinetd', mode=0755)
        r.addSource('xinetd-inetdconvert', rpm=r.srpm, dest='%(sbindir)s/inetdconvert', mode=0755)
        r.addSource('xinetd.sysconf', rpm=r.srpm, dest='%(sysconfdir)s/sysconfig/xinetd', mode=0644)

        r.Configure('--with-loadavg --with-inet6 --with-libwrap')
        r.Make()
        r.MakeInstall('DAEMONDIR=%(destdir)s/%(sbindir)s '
                      'MANDIR=%(destdir)s/%(mandir)s')
        r.Remove('%(mandir)s/man8/itox*')
        r.Remove('%(mandir)s/man8/xconv.pl*')
        r.Remove('%(sbindir)s/itox')
        r.Remove('%(sbindir)s/xconv.pl')
        r.Install('contrib/xinetd.conf', '%(sysconfdir)s/xinetd.conf')
        r.Install('contrib/xinetd.d/*', '%(sysconfdir)s/xinetd.d/')

        r.TagSpec('initscript', '%(initdir)s/')
