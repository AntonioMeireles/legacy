loadSuperClass('kernelmodulepackage')
class ieee80211(KernelModulePackageRecipe):

    name = 'ieee80211'
    version = '1.0.3'
    
    def unpack(r):
        r.addArchive('http://unc.dl.sourceforge.net/sourceforge/%(name)s/%(name)s-%(version)s.tgz')

        # Use the ieee80211.h included with the package instead of the kernel.
        r.addAction("""sed -i 's/<net\/ieee80211.h>/"net\/ieee80211.h"/' *.c""")

        # Remove depmod from the Makefile.
        r.Replace(('/sbin/depmod.*', '@/bin/true'), 'Makefile')

    def build(r):
        r.Make('modules KVER=%(kver)s')
        r.MakeInstall('KVER=%(kver)s'
                      ' IEEE80211_INC=%(destdir)s/lib/modules/%(kver)s/build/include'
                      ' KMISC=%(destdir)s/lib/modules/%(kver)s/build/net/ieee80211/')
        r.AutoDoc('CHANGES')
