#
# Copyright (c) 2006 rPath, Inc.
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

class GphotoSuite(AutoPackageRecipe):
    name = 'gphoto-suite'
    version = '2.3.1'

    buildRequires = [ 'doxygen:runtime', 'flex:runtime', 'libexif:devel', 'libjpeg:devel', 'libtool:devel', 'libusb:devel', 'ncurses:devel', 'pkgconfig:devel', 'popt:devel', 'readline:devel', 'hal:devel', 'dbus:devel' ]

    def unpack(r):
        r.addArchive('mirror://sourceforge/gphoto/')
        r.addSource('usbcam.console', dest="%(sysconfdir)s/hotplug/usb/usbcam", mode=0755)
        r.addSource('udev_generic_ptp_support.rules', dest="%(sysconfdir)s/udev/rules.d/40-ptp.rules")

    def policy(r):
        # generate the usb usermap and hal defs
        r.Run('LD_LIBRARY_PATH=%(destdir)s/%(libdir)s CAMLIBS=%(destdir)s/%(libdir)s/%(name)s/%(version)s '
              '%(destdir)s/%(libdir)s/libgphoto2/print-camera-list usb-usermap '
              '> %(destdir)s/%(sysconfdir)s/hotplug/usb/usbcam.usermap '
              ' < /dev/null')

        # bellow there is a nice way of breaking hal > 0.5.8
        # don't take any action inside of a match..
        #        r.MakeDirs("%(datadir)s/hal/fdi/information/10freedesktop")
        #        r.Run('LD_LIBRARY_PATH=%(destdir)s/%(libdir)s CAMLIBS=%(destdir)s/%(libdir)s/%(name)s/%(version)s '
        #              '%(destdir)s/%(libdir)s/libgphoto2/print-camera-list hal-fdi '
        #              '> %(destdir)s/%(datadir)s/hal/fdi/information/10freedesktop/10-camera-%(name)s.fdi '
        #              ' < /dev/null')
        r.Move('%(libdir)s/udev/check-ptp-camera', '%(sysconfdir)s/udev/scripts/')
        r.ComponentSpec("runtime", "%(datadir)s/hal/")

