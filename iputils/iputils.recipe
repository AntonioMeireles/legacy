#
# Copyright (c) 2004-2006 rPath, Inc.
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

loadSuperClass('rpmpackage')
class Iputils(RPMPackageRecipe, CPackageRecipe):
    name = 'iputils'
    version = '20020927'
    externalArchive = 'http://www.linuxgrill.com/anonymous/iproute2/iputils-ss%s.tar.gz' % version[2:]
    rpmRelease = '39'
    rpmPatches = [ 'iputils-20020927-rh.patch',
        'iputils-20020124-ping_sparcfix.patch',
        'iputils-20020124-rdisc-server.patch',
        'iputils-20020124-countermeasures.patch',
        'iputils-20020927-addrcache.patch',
        'iputils-20020927-ping-subint.patch',
        'iputils-20020927-icmp_seq.patch', 'iputils-glibckernheaders.patch',
        'iputils-20020927-headers.patch', 'iputils-20020927-unaligned.patch',
        'iputils-20020927-inet_pton.patch', 'iputils-retvals.patch',
        'iputils-20020927-ia64_align.patch',
        'iputils-arping_buf_overflow.patch',
        'iputils-20020927-12-arping.patch', 'iputils-getaddrinfo.patch',
        'iputils-flood.patch', 'iputils-ping-168166.patch',
        'iputils-ping_cleanup.patch', 'iputils-20020927-trace_stop.patch', ]

    # adding opensp as a buildreq will create a buildreq loop
    buildRequires = [ 'perl-SGMLS:runtime' ]

    def setup(r):
        r.mainDir('iputils')
        r.unpack()
        r.addArchive('ifenslave.tar.gz', rpm=r.srpm, dir=r.theMainDir)

        r.Make()
        r.Make('ifenslave')
        #r.Make('man', dir='doc')

        r.Install('arping', 'ifenslave', 'rdisc',
                  '%(essentialsbindir)s/', mode=0755)
        r.Install('clockdiff', '%(sbindir)s/', mode=0755)
        r.Symlink('%(essentialsbindir)s/arping', '%(sbindir)s/')
        r.Install('ping{,6}', 'traceroute6',
                  '%(essentialbindir)s/', mode=04755)
        r.Install('tracepath{,6}', '%(essentialbindir)s/', mode=0755)
        r.Symlink('%(essentialbindir)s/{ping6,tracepath{,6},traceroute6}',
                  '%(sbindir)s/')
        #r.Install('doc/{clockdiff,arping,ping,rdisc,tracepath}.8',
        #          '%(mandir)s/man8/')
