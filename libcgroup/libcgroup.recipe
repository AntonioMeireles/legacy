#
# Copyright (c) 2010 Foresight Linux
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

class Libcgroup(AutoPackageRecipe):
    name = 'libcgroup'
    version = '0.36.1'
 
    packageSummary = 'Tools and libraries to control and monitor control groups'

    buildRequires = [
        'bison:runtime',
        'chkconfig:runtime',
        'flex:runtime',
        'gcc-c++:runtime',
        'pam:devel',
        ]
 
    def unpack(r):
        r.addArchive('mirror://sourceforge/libcg/%(name)s/v%(version)s/')

    def makeinstall(r):
        r.MakeInstall()

        # config files are needed for libcgroup to run
        r.Install('samples/cgconfig.sysconfig', '%(sysconfdir)s/sysconfig/')
        r.Install('samples/cgred.conf', '%(sysconfdir)s/sysconfig/')
        r.Install('samples/cgconfig.conf', '%(sysconfdir)s/')
        r.Install('samples/cgrules.conf', '%(sysconfdir)s/')

    def policy(r):
        r.SetModes('%(bindir)s/cgexec', 04755) # explicitly setuid

        # werid that the actuall installed files are /etc/init.d/cgconfig and /etc/init.d/cgred
        r.SetModes('%(sysconfdir)s/rc.d/init.d/cgred', 0755)
        r.SetModes('%(sysconfdir)s/rc.d/init.d/cgconfig', 0755)
