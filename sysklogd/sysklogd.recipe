#
# Copyright (c) 2004-2006 rPath, Inc.
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

class Sysklogd(CPackageRecipe):
    name = 'sysklogd'
    version = '1.4.1'

    def setup(r):
        r.addArchive('http://www.infodrom.org/projects/sysklogd/download/'
                     'sysklogd-%(version)s.tar.gz')
        # partial version of RH mods, particularily for -x and security
        r.addPatch('sysklogd-1.4.1-rh.patch')
        r.addPatch('sysklogd.confdir.patch')
        r.addPatch('remove-syslog-definition-conflict.patch')
        r.addSource('syslog-config.tagdescription',
                    dest='%(tagdescriptiondir)s/syslog-config',
                    macros=True)
        r.addSource('syslog-config.taghandler',
                    dest='%(taghandlerdir)s/syslog-config', mode=0755,
                    macros=True)

        r.macros.cflags = '%(cflags)s -DSYSV -D_GNU_SOURCE'
        r.Make('CFLAGS="%(cflags)s"')
        r.MakeDirs('%(essentialsbindir)s', '%(mandir)s/man{8,5}')
        r.MakePathsInstall('sbindir=%(destdir)s/%(essentialsbindir)s MAN_OWNER=$(id -nu)')
        r.Install('redhat/syslog.init', '%(initdir)s/syslog', mode=0755)
        r.Install('redhat/syslog.conf.rhs',
                  '%(sysconfdir)s/syslog.conf', mode=0644)
        r.Install('redhat/syslog.log',
                  '%(sysconfdir)s/logrotate.d/syslog', mode=0644)
        r.Install('redhat/syslog',
                  '%(sysconfdir)s/sysconfig/syslog', mode=0644)
        r.SetModes('/sbin/{sys,k}logd', 0755)
        # Tag init scripts in case the initscript tag desc. is not installed
        r.TagSpec('initscript', '%(initdir)s/')
