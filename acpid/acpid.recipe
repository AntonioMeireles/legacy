#
# Copyright (c) 2004-2007 rPath, Inc.
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

class Acpid(CPackageRecipe):
    name = 'acpid'
    version = '1.0.4'

    def setup(r):
        r.addArchive('mirror://sourceforge/acpid/')
        r.addSource('acpid.init', dest='%(initdir)s/acpid', mode=0755)
        r.addSource('poweroff.conf', dest='%(sysconfdir)s/acpi/events/',
                    mode=0644, macros=True)
        r.addSource('sleep.conf',  dest='%(sysconfdir)s/acpi/events/',
                    mode=0644, macros=True)
        r.addSource('hibernate.conf',  dest='%(thisdocdir)s/samples/',
                    mode=0644, macros=True)
        # use our cflags. Using -O2 enables some warnings that would
        # cause the build to fail if we left -Werror on
        r.Replace('-Wall -Werror -g', '-Wall ' + r.macros.cflags, 'Makefile')
        r.Make()

        r.MakeDirs('%(bindir)s/')
        r.MakeInstall(rootVar='INSTPREFIX')
        r.MakeDirs('%(sysconfdir)s/acpi/events', mode=0755)
        r.MakeDirs('%(sysconfdir)s/acpi/actions', mode=0755)
        r.Install('samples', '%(thisdocdir)s/')
        r.Create('%(localstatedir)s/log/acpid', mode=0640)
        r.ExcludeDirectories(exceptions='%(sysconfdir)s/acpi/(actions|events)')
        r.TagSpec('initscript', '%(initdir)s/')
        r.Requires('psmisc:runtime', '%(sysconfdir)s/init\.d/acpid')
