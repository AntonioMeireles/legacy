
http://svn.apache.org/viewvc?view=revision&revision=814847

--- httpd-2.2.3/modules/proxy/mod_proxy_ftp.c.cve3095
+++ httpd-2.2.3/modules/proxy/mod_proxy_ftp.c
@@ -905,6 +905,11 @@ static int proxy_ftp_handler(request_rec
     if ((password = apr_table_get(r->headers_in, "Authorization")) != NULL
         && strcasecmp(ap_getword(r->pool, &password, ' '), "Basic") == 0
         && (password = ap_pbase64decode(r->pool, password))[0] != ':') {
+        /* Check the decoded string for special characters. */
+        if (!ftp_check_string(password)) {
+            return ap_proxyerror(r, HTTP_BAD_REQUEST, 
+                                 "user credentials contained invalid character");
+        } 
         /*
          * Note that this allocation has to be made from r->connection->pool
          * because it has the lifetime of the connection.  The other
