#
# Copyright (c) 2004-2006 rPath, Inc.
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

class DistroRelease(PackageRecipe):
    name = 'distro-release'
    version = '0.9.6.dev'
    
    def setup(r):
        release = "Foresight Desktop Linux release %(version)s (Beta)" %r.macros
        issue = release + '\nKernel \\r on an \\m\n'

        r.Create('%(sysconfdir)s/distro-release', contents=release)
        r.Create('%(sysconfdir)s/issue', contents=issue + '\n')
        r.Create('%(sysconfdir)s/issue.net', contents=issue)
        r.addArchive('tags.tgz', dir='/')
        # Distributions can set configuration values for arches
        # and use flags here by defining them below in /etc/conary/distro/arch
        # and /etc/conary/distro/use.  

        # XXX turn off dietlibc for other architectures that x86.
        # XXX Ideally, this would be done in conary's default use flag values
        if not Arch.x86:
            r.Create('/etc/conary/distro/use/dietlibc', 
                     contents='sense disallowed\n')

        # Add a system wide default gtkrc
        r.addSource('gtkrc')
#       r.Install('gtkrc','%(sysconfdir)s/gtk-2.0/gtkrc')
        r.addSource('foresight.conaryrc')
        r.Install('foresight.conaryrc','%(sysconfdir)s/conary/conf.d/foresight')


        r.Create('%(sysconfdir)s/chkconfig.d/xfs', contents = '# chkconfig: 2345 01 10')
        r.TagSpec('chkconfig-override', '%(sysconfdir)s/chkconfig.d/xfs')

        r.Create('%(sysconfdir)s/chkconfig.d/xdm', contents = '# chkconfig: 5 04 82')
        r.TagSpec('chkconfig-override', '%(sysconfdir)s/chkconfig.d/xdm')

