#
# Copyright (c) 2004-2007 rPath, Inc.
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

class Apmd(CPackageRecipe):
    name = 'apmd'
    version = '3.2.2'

    buildRequires = [ 'libtool:runtime', 'libX11:devel', 'libXt:devel',
                      'libXaw:devel', 'libXext:devel', ]

    def setup(r):
        if not Arch.x86:
            return
        # upstream website is out of date and debian seems to function as upstream
        r.addArchive('ftp://ftp.debian.org/debian/pool/main/a/%(name)s/%(name)s_%(version)s.orig.tar.gz')
        r.addSource('apmd.init', dest='%(initdir)s/apmd', mode=0755)
        r.addSource('apmscript', dest='%(sysconfdir)s/sysconfig/apm-scripts/',
                    mode=0755)
        r.addSource('apmd.conf', dest='%(sysconfdir)s/sysconfig/apmd',
                    mode=0644)

        r.macros.extradefs = 'OPT_FLAGS="%(cflags)s"'

        r.Make(r.macros.extradefs)
        r.MakeInstall()
        r.Remove('%(bindir)s/xapm', '%(mandir)s/man1/xapm*',
                 '%(sysconfdir)s/apmd_proxy')

        # on_ac_power conflicts with pm-utils
        # pm-utils provides a more apm/acpi/etc neutral version
        r.Remove('%(bindir)s/on_ac_power')
        r.Requires('pm-utils:runtime', '%(sbindir)s/apmd')

        r.TagSpec('initscript', '%(initdir)s/')
