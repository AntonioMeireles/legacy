#
# Copyright (c) 2004-2006 rPath, Inc.
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

loadSuperClass('gnomepackage.recipe')
class EvolutionDataServer(GnomePackageRecipe):
    name = 'evolution-data-server'
    version = '1.12.3'

    buildRequires = [ 'gnome-vfs:devel', 'GConf:devel', 'openldap:devel',
        'intltool:runtime', 'libsoup:devel', 'ORBit2:devel', 'libgnome:devel',
        'libgnomeui:devel', 'nss:devel', 'nspr:devel',
        'bison:runtime', 'bison:devellib', 'flex:runtime', 'flex:devel',
        'gettext:runtime', 'sendmail:runtime', 'krb5:devel', 'libbonobo:devel',
        'libxml2:devel', 'libglade:devel', 'glib:devel',
        'popt:devel', 'atk:devel', 'gnome-keyring:devel', 'libart_lgpl:devel',
        'libbonoboui:devel', 'libgnomecanvas:devel', 'pango:devel',
        'cairo:devel', 'fontconfig:devel', 'freetype:devel', 'libpng:devel',
        'GConf:runtime', 'docbook-utils:runtime', 'perl:runtime',
        'e2fsprogs:devel', 'gcc-c++:runtime', 'gtk-doc:runtime' ]

    extraConfig = ''

    if Use.krb:
        buildRequires.append('krb5:devel')
    else:
        extraConfig += ' --without-krb5'

    if Use.ldap:
        extraConfig += ' --with-openldap'
        buildRequires.append('openldap:devel')
    else:
        extraConfig += ' --without-openldap'

    def unpack(r):
        GnomePackageRecipe.unpack(r)
        r.addPatch('servicedir.patch', macros=True,
                   use=(r.macros.servicedir != '/var'))

    def build(r):
        r.Run('intltoolize -c -f')
        r.Replace('/var/spool/mail', '%(servicedir)s/spool/mail',
                  'configure{.in}')
        GnomePackageRecipe.build(r)

    def setup(r):
        r.disableParallelMake()
        GnomePackageRecipe.setup(r)
