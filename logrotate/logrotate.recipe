#
# Copyright (c) 2004-2006 rPath, Inc.
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

loadSuperClass('rpmpackage')
class LogRotate(RPMPackageRecipe, CPackageRecipe):
    name = 'logrotate'
    version = '3.7.4'
    rpmRelease = '9'
    isRHEL = True
    distroVersion = '5Server'

    rpmPatches = [ 'logrotate-fdLeak.patch',
                   'logrotate-3.7.4-statuserr.patch',
                   'logrotate-3.7.4-minsize.patch',
                   'logrotate-3.7.4-size.patch',
                   'logrotate-3.7.4-man.patch',
                   'logrotate-3.7.4-logfn.patch',
                   'logrotate-3.7.4-dblfree.patch',
                 ] 

    buildRequires = [ 'popt:devel' ]

    def setup(r):
        # upstream is nowhere to be found and gentoo is too far behind
        r.unpack()
        r.Make()

        r.MakeInstall('MANDIR=%(mandir)s', rootVar='PREFIX')
        r.MakeDirs('%(sysconfdir)s/logrotate.d')
        r.Install('examples/logrotate-default',
                            '%(sysconfdir)s/logrotate.conf', mode=0644)
        r.Install('examples/logrotate.cron',
                  '%(sysconfdir)s/cron.daily/logrotate', mode=0755)
        r.Create('%(localstatedir)s/lib/logrotate.status')
        # RPL-1737
        r.Requires('crontabs:runtime', '%(sysconfdir)s/cron\..*')
