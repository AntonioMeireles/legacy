#
# Copyright (c) 2004-2006 rPath, Inc.
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#


loadSuperClass('gnomepackage.recipe')
class GnomeCupsManager(GnomePackageRecipe):
    buildRequires = [ 'libgnomeui:devel', 'cups:devel', 'desktop-file-utils:runtime', 'libgnomecups:devel',
        'GConf:devel', 'ORBit2:devel', 'atk:devel', 'cairo:devel', 'fontconfig:devel', 'freetype:devel',
        'glib:devel', 'gnome-keyring:devel', 'gnome-vfs:devel', 'libart_lgpl:devel', 'libbonobo:devel',
        'libbonoboui:devel', 'libglade:devel', 'libgnome:devel', 'libgnomecanvas:devel', 'libpng:devel',
        'libstdc++:devel', 'libxml2:devel', 'pango:devel', 'popt:devel', 'samba:devel',
        'gettext:runtime', 'glib:runtime', 'gtk:runtime', 'openssl:devel', 'perl:runtime' ]

    name = 'gnome-cups-manager'
    version = '0.31'

    def unpack(r):
        GnomePackageRecipe.unpack(r)
        # unbrand the test page, leaving the xd2- version for folks
        # who would prefer it
        for testsize in ('a4', 'letter'):
            r.addSource('testpage-%s.ps' %testsize)
        r.addAction("sed -i 's/xd2-//' libgnomecups/gnome-cups-ui-util.c")
        r.addPatch('change-su-command.patch')
        r.addPatch('get-ppds-attrs.patch')
        r.addPatch('ppd-install-dir.patch')
        r.addPatch('select_eintr_crash.patch')
        r.addPatch('ui_serial_port.diff')
        r.addPatch('change_uri_fix.patch')
        r.addPatch('gutenprint_driver_name.patch')
        r.addPatch('printer_properties_name_entry.patch')
        r.addPatch('translations.patch')
        r.addPatch('ui_startbox.diff')
        r.addPatch('check-lpadmin-member.diff')
        r.addPatch('options.patch')
        r.addPatch('properties_on_add.patch')
        r.addPatch('ui_browse_share_ctl.patch')
        r.addPatch('ui_tooltip.diff')
        r.addPatch('desktop-potfiles.patch')
        r.addPatch('password_field_garbage.patch')
        r.addPatch('remove-no-cups-dialog.diff')
        r.addPatch('ui_edit_name_description.patch')


    def install(r):
        GnomePackageRecipe.install(r)
        for testsize in ('a4', 'letter'):
            r.Install('testpage-%s.ps' %testsize,
                      '%(datadir)s/gnome-cups-manager/')
        r.addSource('gnome-cups-manager.desktop')
        r.Desktopfile('gnome-cups-manager.desktop')
        r.addSource('gnome-cups-icon.desktop')
        r.Desktopfile('gnome-cups-icon.desktop')
