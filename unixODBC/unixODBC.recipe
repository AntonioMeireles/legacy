#
# Copyright (c) 2004-2006 rPath, Inc.
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

class UnixODBC(AutoPackageRecipe):
    name = 'unixODBC'
    version = '2.2.12'

    buildRequires = [ 'bison:runtime', 'flex:runtime', 'fontconfig:devel',
                      'freetype:devel', 'libjpeg:devel', 'libpng:devel',
                      'libstdc++:devel', 'ncurses:devel',
                      'qt:devel[bootstrap]', 
                      # FIXME: temporary workaround for rMake dumbiness
                      'qt:config[bootstrap]', 'qt:devellib[bootstrap]', 'qt:lib[bootstrap]', 'qt:data[bootstrap]',
                      # 
                      'readline:devel', 'zlib:devel', 'file:runtime',
                      'libICE:devel', 'libSM:devel', 'libX11:devel',
                      'libXcursor:devel', 'libXext:devel', 'libXft:devel',
                      'libXi:devel', 'libXinerama:devel', 'libXt:devel',
                      'libXrandr:devel', 'libXrender:devel',
                      'Mesa:devel', 'libXmu:devel', ]

    def unpack(r):
        r.addArchive('http://www.unixodbc.org/%(name)s-%(version)s.tar.gz')

    def configure(r):
        r.Configure(' --x-includes=%(includedir)s --x-libraries=%(libdir)s '
                    ' --with-qt-includes=%(includedir)s/qt3/ --with-qt-libraries=%(libdir)s')

    def make(r):
        r.Make('all')

    def policy(r):

        r.AutoDoc(exceptions='/.+/')

        for dir in (
            'AdministratorManual', 'UserManual', 'lst',
            'ProgrammerManual', 'ProgrammerManual/Tutorial'
        ):
            r.Doc('doc/'+dir+'/*.{html,gif,vsd,sql,css}', dir=dir)

        r.ExcludeDirectories(exceptions='%(sysconfdir)s/ODBCDataSources')
