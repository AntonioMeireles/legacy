# Original by Gil Hamlin
# Modified by Cesar Cardoso
# Copyright (c) 2007 by Foresight Linux
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

class libmtp(CPackageRecipe):

    name = "libmtp"
    version = "0.2.2"


    buildRequires = ['doxygen:runtime', 'libusb:devel']

    def setup(r):
        #r.addSource('10-usb-music-players-libmtp.fdi')
        #r.addSource('20-usb-player-libmtp-policy.fdi')
        r.addArchive('mirror://sourceforge/%(name)s/')
        r.Configure()
        r.Make()
        r.MakeInstall()
        # Needed to let user control the music player
        # Copied from SUSE's libmtp package
        #r.Install('10-usb-music-players-libmtp.fdi',
        #          '%(datadir)s/hal/fdi/information/10freedesktop/')
        # Inspired by gphoto's tutorial in http://www.gphoto.org/doc/manual/permissions-usb.html
        #r.Install('20-usb-player-libmtp-policy.fdi', 
        #          '%(datadir)s/hal/fdi/policy/20thirdparty/')
        r.Run('./examples/hotplug -u > 65-libmtp.rules')
        r.Install('65-libmtp.rules', '%(sysconfdir)s/udev/rules.d/')
        r.Install('libmtp.fdi', '%(datadir)s/hal/fdi/information/20thirdparty/10-usb-music-players-libmtp.fdi')
        # Depending on setprocperm so HAL can make its magic and let the user fill their player
        r.Requires('setprocperm:runtime', '%(datadir)s/hal/fdi/policy/20thirdparty/20-usb-player-libmtp-policy.fdi')
