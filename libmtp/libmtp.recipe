# Original by Gil Hamlin
# Modified by Cesar Cardoso
# Copyright (c) 2007-2008 by Foresight Linux
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

class libmtp(CPackageRecipe):

    name = "libmtp"
    version = "0.3.6"


    buildRequires = ['doxygen:runtime', 'libusb:devel']

    def setup(r):
        r.addArchive('mirror://sourceforge/%(name)s/%(name)s-%(version)s.tar.gz')
        r.Configure('--disable-static --program-prefix=mtp-')
        r.Make()
        # Remove permissions from symlink in udev script, we use
        # PAM to fix the permissions instead.
        r.Run(""" examples/hotplug -a"SYMLINK+=\"libmtp-%%k\" " > libmtp.rules  """)
        r.MakeInstall()
        r.Install('libmtp.rules', '%(sysconfdir)s/udev/rules.d/60-libmtp.rules', mode = 0644)
        r.Install('libmtp.fdi', '%(datadir)s/hal/fdi/information/10freedesktop/10-usb-music-players-libmtp.fdi', mode = 0644)
        r.Create('%(sysconfdir)s/security/console.perms.d/60-libmtp.perms', mode = 0644, contents = """
<libmtp>=/dev/libmtp*
<console> 0600 <libmtp> 0600 root
""")
