#
# Copyright (c) 2009 Foresight Linux Project
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

class XorgDriverInputEvtouch( CPackageRecipe):
    name = 'xf86-input-evtouch'
    version = '0.8.8'

    buildRequires = [ 'pkgconfig:devel', 'ghostscript:runtime', 'linuxdoc-tools:runtime', 'xorg-server:devel', 'xproto:devel', 'fontsproto:devel', 'autoconf:runtime', 'automake:runtime', 'makedepend:runtime', 'randrproto:devel', 'inputproto:devel', 'kbproto:devel', 'pixman:devel', 'libtool:runtime', 'libtool:devel', 'pkgconfig:devel' , 'm4:runtime', 'expat:devel', 'xextproto:devel', 'util-macros:devel', 'renderproto:devel', 'sysfsutils:devel', 'xorg-sgml-doctools:data', 'sysfsutils:devel', 'xorg-sgml-doctools:data', 'libpciaccess:devel', 'libxkbfile:devel', 'libXi:devel', 'libX11:devel', 'imake:runtime', 'xorg-cf-files:data', 'gccmakedep:runtime', 'texinfo:runtime', 'which:runtime', 'desktop-file-utils:runtime', 'sharutils:runtime' ]

    def setup(r):
        r.addArchive('http://archive.ubuntu.com/ubuntu/pool/universe/x/xf86-input-evtouch/xf86-input-evtouch_0.8.8.orig.tar.gz')
	r.addPatch('http://archive.ubuntu.com/ubuntu/pool/universe/x/xf86-input-evtouch/xf86-input-evtouch_0.8.8-0ubuntu3.diff.gz')
        patches = [
            '20_fix_calibrate_submission_directions.patch',
            '21_more_calibration_fixups.patch',
            ]

        for patch in patches:
            r.addPatch('http://patches.ubuntu.com/x/xf86-input-evtouch/extracted/'+patch)
        r.Configure(' --enable-evcalibrate')
        r.Make()
        r.MakeInstall()
	r.Install('debian/fdi/*','%(datadir)s/hal/fdi/policy/20thirdparty/')
	r.Desktopfile('debian/calibrate.desktop')
	r.addSource('calibrate.png', dest='%(datadir)s/pixmaps/')
	r.Symlink('%(libdir)s/xf86-input-evtouch/calibrate.sh', '%(bindir)s/calibrate_touchscreen')
