#
# Copyright (c) 2009 Foresight Linux Project
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

class XorgDriverInputEvtouch( CPackageRecipe):
    name = 'xf86-input-evtouch'
    version = '0.8.8'

    buildRequires = [ 'pkgconfig:devel', 'ghostscript:runtime', 'linuxdoc-tools:runtime', 'xorg-server:devel', 'xproto:devel', 'fontsproto:devel', 'autoconf:runtime', 'automake:runtime', 'makedepend:runtime', 'randrproto:devel', 'inputproto:devel', 'kbproto:devel', 'pixman:devel', 'libtool:runtime', 'libtool:devel', 'pkgconfig:devel' , 'm4:runtime', 'expat:devel', 'xextproto:devel', 'util-macros:devel', 'renderproto:devel', 'sysfsutils:devel', 'xorg-sgml-doctools:data', 'sysfsutils:devel', 'xorg-sgml-doctools:data', 'libpciaccess:devel', 'libxkbfile:devel', 'libXi:devel', 'libX11:devel', 'imake:runtime', 'xorg-cf-files:data', 'gccmakedep:runtime', 'texinfo:runtime', 'which:runtime', 'desktop-file-utils:runtime', 'chkconfig:runtime' ]

    def setup(r):
        r.addArchive('http://archive.ubuntu.com/ubuntu/pool/universe/x/xf86-input-evtouch/xf86-input-evtouch_0.8.8.orig.tar.gz')
	r.addPatch('http://archive.ubuntu.com/ubuntu/pool/universe/x/xf86-input-evtouch/xf86-input-evtouch_0.8.8-0ubuntu3.diff.gz')

        ubuntuPatches = [
            '20_fix_calibrate_submission_directions.patch',
            '21_more_calibration_fixups.patch',
            ]
        for patch in ubuntuPatches:
            r.addPatch('http://patches.ubuntu.com/x/xf86-input-evtouch/extracted/'+patch)

	r.addPatch('call_init_script.patch')
	r.Replace('freemono','-b&h-luxi mono-medium-r-normal--0-0-0-0-m-0-iso10646-1','ev_calibrate.c')
        r.Configure(' --enable-evcalibrate --enable-udevinstall')
        r.Make()
        r.MakeInstall()
	r.Install('debian/fdi/*','%(datadir)s/hal/fdi/policy/20thirdparty/')
	r.Replace('gksu', 'gksudo', 'debian/calibrate.desktop')
	r.Desktopfile('debian/calibrate.desktop')
	r.addSource('calibrate.png', dest='%(datadir)s/pixmaps/')
	r.Symlink('%(libdir)s/xf86-input-evtouch/calibrate.sh', '%(bindir)s/calibrate_touchscreen')
	r.addSource('evtouch.init', dest='%(initdir)s/evtouch')
	r.MakeDirs('%(sysconfdir)s/evtouch')
	r.ExcludeDirectories(exceptions='%(sysconfdir)s/evtouch')

        calibrator = [
            '%(datadir)s/applications/net-calibrate.desktop',
            '%(datadir)s/pixmaps/calibrate.png',
            '%(datadir)s/xf86-input-evtouch/empty_cursor.xbm',
            '%(libdir)s/xf86-input-evtouch/calibrate.sh',
            '%(libdir)s/xf86-input-evtouch/ev_calibrate',
            '%(sysconfdir)s/evtouch',
            '%(initdir)s/evtouch',
            '%(bindir)s/calibrate_touchscreen',
            ]

        for file in calibrator:
            r.PackageSpec('evtouch-calibrator', file)

        r.PackageSpec('evtouch-calibrator', '%(datadir)s/hal/fdi/policy/20thirdparty/.*')

