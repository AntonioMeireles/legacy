#
# Copyright (c) 2004-2007 rPath, Inc.
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

class Smartmontools(AutoPackageRecipe):
    name = 'smartmontools'
    version = '5.36'

    def unpack(r):
        srpm = 'ftp://ftp.redhat.com/pub/redhat/linux/enterprise/5Server/en/os/SRPMS/%(name)s-%(version)s-3.1.el5.src.rpm'
        r.addArchive('mirror://sourceforge/smartmontools/smartmontools-%(version)s.tar.gz', keyid='841ABAE8')
        r.addPatch("smartmontools-5.36-cciss.patch", rpm=srpm)
        r.addPatch("smartmontools-5.36-cloexec.patch", rpm=srpm)
        r.addPatch("smartmontools-5.36-sata.patch", rpm=srpm)
        r.addSource("smartd.init")
        r.addSource('smartd.conf')

    def makeinstall(r):
        r.MakeInstall('initddir=%(initdir)s')
        r.Install('smartd.conf', '%(sysconfdir)s/', mode=0644)
        r.Install('smartd.init', "%(initdir)s/smartd", mode=0755)
        r.Remove('%(thisdocdir)s/smartd.conf') # since we have one...

    def policy(r):
        # Tag init scripts in case the initscript tag desc. is not installed
        r.TagSpec('initscript', '%(initdir)s/')
        r.Requires('psmisc:runtime', '%(sysconfdir)s/init\.d/smartd')
