#
# Copyright (c) 2011 rPath, Inc.
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

class Qemu(AutoPackageRecipe):
    name = 'qemu'
    version = '0.13.0'

    buildRequires = [
        'curl:devel',
        'e2fsprogs:devel',
        'libX11:devel',
        'ncurses:devel',
        'openssl:devel',
        'SDL:devel',
        'zlib:devel',
        ]

    def unpack(r):
        r.addArchive('http://wiki.qemu.org/download/')

    def configure(r):
        r.ManualConfigure(
            '--prefix=%(prefix)s '
            '--bindir=%(bindir)s '
            '--sysconfdir=%(sysconfdir)s '
            '--datadir=%(datadir)s/%(name)s '
            '--docdir=%(thisdocdir)s '
            '--interp-prefix=%(datadir)s/%(name)s/%%m '
            )

    def makeinstall(r):
        r.MakePathsInstall('datadir=%(destdir)s/%(datadir)s/%(name)s'
                           ' docdir=%(destdir)s%(thisdocdir)s')

    def policy(r):
        # qemu-img package contains just the image handling tools
        r.PackageSpec('%(name)s-img',
            r'%(bindir)s/qemu-(img|io)',
            r'%(mandir)s/man1/qemu-img.*',
            )
        r.Requires('%(bindir)s/qemu-img', '%(bindir)s/qemu')
