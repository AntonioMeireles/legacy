#
# Copyright (c) 2004-2006 rPath, Inc.
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

class Parted(CPackageRecipe):
    name = 'parted'
    version = '1.7.1'

    buildRequires = [ 'e2fsprogs:devel', 'libtool:runtime',
                      'install-info:runtime' ]
    if Use.readline:
        buildRequires.extend(
            ['readline:devel', 'libtermcap:devel', 'ncurses:devel'])

    def setup(r):
        r.addArchive('http://ftp.gnu.org/gnu/parted/parted-%(version)s.tar.gz')

        if 'LINGUAS' in os.environ:
            del os.environ['LINGUAS']
        extraConfigure = ""
        if Use.readline:
            extraConfigure += ' --with-readline'
        else:
            extraConfigure += ' --without-readline'

        r.Configure('--enable-shared --enable-part-static --enable-pc98=no'
            ' --enable-Werror=no --disable-dynamic-loading ' + extraConfigure)
        r.Make('LIBTOOL=/usr/bin/libtool', preMake='tagname=CC')
        r.MakeInstall('LIBTOOL=/usr/bin/libtool', preMake='tagname=CC')
        r.Doc('doc/API', 'doc/FAT')
