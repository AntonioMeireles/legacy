#
# Copyright (c) 2004-2006 rPath, Inc.
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

loadRecipe('gnomepackage.recipe')
class Evolution(GnomePackageRecipe):
    name = 'evolution'
    version = '2.6.0'

    extraConfig = GnomePackageRecipe.extraConfig + ' --enable-nss=yes --enable-mono=yes'
    # runtime requirements include gnome-spell:runtime

    buildRequires = [ 'evolution-data-server:devel', 'gal:devel', 
	'libsoup:devel', 'gtkhtml:devel', 'mozilla-nss:devel', 
	'libbonobo:devel', 'libbonoboui:devel', 'gnome-vfs:devel',
	'libgnomecanvas:devel', 'libxml2:devel', 'GConf:devel', 
	'intltool', 'ORBit2:devel', 'flex', 'bison', 'byacc', 
	'libtool', 'gettext', 'pkgconfig', 'desktop-file-utils',
	'psmisc', 'atk:devel', 'cairo:devel', 'dbus:devel', 
	'fontconfig:devel', 'freetype:devel', 
	'glib:devel', 'glibc:devel', 'gstreamer:devel', 'libart_lgpl:devel', 
	'libglade:devel', 'libgnome:devel', 'libgnomeprint:devel', 
	'libgnomeprintui:devel', 'libgnomeui:devel', 'libpng:devel', 
	'mono:devel', 'mozilla-nspr:devel', 'mozilla-nss:devel', 
	'mozilla:devel', 'pango:devel', 'popt:devel', 'gnome-keyring:devel',
	'GConf:runtime', 'bison:runtime', 'docbook-utils:runtime', 
	'flex:runtime', 'gettext:runtime', 'perl:runtime',
	'NetworkManager:devel', 'dbus-glib:devellib', 'hal:devel',
	'libnotify:devel' ]

    # add ldap support
    if Use.ldap:
        extraConfig += ' --with-openldap=yes'
        buildRequires.append('openldap:devel')
    else:
        extraConfig += ' --without-openldap'

    # add krb5 support
    if Use.krb:
        extraConfig += ' --with-krb5=/usr/kerberos'
        buildRequires.append('krb5:devel')
    else:
        extraConfig += ' --without-krb5'

    # remove support for pilot
    extraConfig += ' --enable-pilot-conduits=no'
    buildRequires.append('gnome-pilot:devel')
    buildRequires.append('pilot-link:devel')

    def unpack(r):
        GnomePackageRecipe.unpack(r)

    def build(r):
        r.Run('intltoolize -c -f')
        GnomePackageRecipe.build(r)

    def install(r):
        GnomePackageRecipe.install(r)
        r.SharedLibrary(subtrees='%(libdir)s/evolution/%(majversion)s')
	r.Symlink('%(bindir)s/evolution-2.6','%(bindir)s/evolution')
