#
# Copyright (c) 2004-2007 rPath, Inc.
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

class Fontconfig(CPackageRecipe):
    name = 'fontconfig'
    version = '2.4.2'

    buildRequires = [ 'freetype:devel', 'perl:runtime', 'zlib:devel',
        'pkgconfig:devel', 'libxml2:devel', ]

    def setup(r):
        r.addArchive('http://www.fontconfig.org/release/')
        r.addSource('cacheable-font.tagdescription', macros=True,
            dest='%(tagdescriptiondir)s/cacheable-font')
        r.addSource('cacheable-font.taghandler', macros=True,
            dest='%(taghandlerdir)s/cacheable-font', mode=0755)

        r.Configure('--enable-libxml2 --with-add-fonts=%(datadir)s/X11/fonts/Type1,'
                                                       '%(datadir)s/X11/fonts/TTF '
                    '--disable-docs')
        r.Make()
        r.MakeInstall()

        r.Move('%(docdir)s/%(name)s/*', '%(thisdocdir)s/')
        r.Requires('%(name)s:runtime', '%(libdir)s/.*')

        # FIXME: remove when/if RPL-1077 is implemented
        for req in ('%(essentialbindir)s/cat', '%(bindir)s/fc-cache',
                    '/dev/null'):
            r.Requires(req, '%(taghandlerdir)s/cacheable-font')
