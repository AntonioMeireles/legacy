#
# Copyright (c) 2004-2005 rPath, Inc.
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

class Fontconfig(CPackageRecipe):
    name = 'fontconfig'
    version = '2.3.95'

    buildRequires = [ 'freetype:devel', 'expat:devel', 'perl:runtime',
	'zlib:devel','pkgconfig:devel', 'opensp:runtime', 'perl-SGMLS:runtime',
	'tetex:runtime' ]
    if Use.builddocs:
        buildRequires.extend([
            'docbook-utils:runtime', 'docbook-utils-pdf:runtime'])

    def setup(r):
        r.addArchive('http://www.fontconfig.org/release/%(name)s-%(version)s.tar.gz')
        r.addSource('cacheable-font.tagdescription', macros=True)
        r.addSource('cacheable-font.taghandler', macros=True)

        extraConfig = ''
        if not Use.builddocs:
            extraConfig += ' --disable-docs'
            # --disable-docs doesn't do what you'd think, so we have to fix
            r.Replace(r'  enable_docs=\$default_docs',
                       '  enable_docs=no',
                       'configure')
        r.Configure('--with-add-fonts=%(x11prefix)s/%(lib)s/X11/fonts/Type1,'
                                      '%(x11prefix)s/%(lib)s/X11/fonts/OTF'
                    +extraConfig)
        if not Use.builddocs:
            # unfortunately, fc-cache and fc-list do not honor --disable-docs
            r.Replace(('^DOC2MAN = docbook2man',
                       'DOC2MAN = echo'),
                      ('install-man: install-man1',
                       'install-man:'), 'fc-{cache,list}/Makefile')
        r.Make()

        if not Use.builddocs:
            # these aren't installed by Makefile if !builddocs
            r.Install('doc/*.3', '%(mandir)s/man3/')
            r.Install('doc/*.5', '%(mandir)s/man5/')
        r.Install('cacheable-font.tagdescription', '%(tagdescriptiondir)s/cacheable-font')
        r.Install('cacheable-font.taghandler', '%(taghandlerdir)s/cacheable-font', mode=0755)
        r.MakeInstall()

        r.Move('%(docdir)s/%(name)s/*', '%(thisdocdir)s/')
        r.Requires('%(name)s:runtime', '%(libdir)s/.*')


	r.Config(exceptions='/etc/fonts/conf.d/10LohitGujarati.conf')
