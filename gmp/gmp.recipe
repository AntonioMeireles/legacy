#
# Copyright (c) 2004-2005 rpath, Inc.
# All rights reserved
#

class Gmp(PackageRecipe):

    buildRequires = [ 'm4:runtime' ]

    name = 'gmp'
    version = '4.1.4'

    def setup(r):
        r.addArchive('ftp://ftp.gnu.org/pub/gnu/gmp/gmp-%(version)s.tar.bz2')
        
        r.Configure('--enable-mpbsd --enable-mpfr --enable-cxx',
                    preConfigure='CCAS="gcc -c -Wa,--noexecstack"',
                    objDir='base')
                    
        # Disable rpath
        r.Replace('hardcode_libdir_flag_spec=.*', 
                  r'hardcode_libdir_flag_spec="-L\$libdir"', 
                  'base/libtool')
        r.Make(preMake='LD_LIBRARY_PATH=%(maindir)s/base/.libs',
               subDir='base')
        r.MakeInstall(subDir='base')
        r.Install('base/gmp-mparam.h', '%(includedir)s')

        if Arch.x86.sse2:
            r.Configure('--libdir=%(libdir)s/sse2 --enable-mpbsd --enable-mpfr --enable-cxx '
                        'pentium4-redhat-linux',
                        preConfigure='CFLAGS="-O2 -g -march=pentium4" CCAS="gcc -c -Wa,--noexecstack"',
                        objDir='build-sse2')
                        
            r.Replace('hardcode_libdir_flag_spec=.*',
                      r'hardcode_libdir_flag_spec="-L\$libdir"',
                      'build-sse2/libtool')
                      
            r.Make(preMake='LD_LIBRARY_PATH=%(maindir)s/build-sse2/.libs',
                   subDir='build-sse2')

            r.MakeInstall(installtarget='install-exec', subDir='build-sse2')
