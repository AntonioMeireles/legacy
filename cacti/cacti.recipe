#
# Copyright (c) 2005-2008 rPath, Inc.
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#
class Cacti(PackageRecipe):
    name = 'cacti'
    version = '0.8.7b'

    buildRequires = [ 'perl:lib', ]

    def setup(r):
        r.addArchive('http://www.cacti.net/downloads/')
        r.Install('.', '%(servicedir)s/cacti')
        r.Move('%(servicedir)s/cacti/docs/*', '%(thisdocdir)s/')
        r.Remove('%(servicedir)s/cacti/docs/', recursive=True)
        r.ComponentSpec('runtime', '%(servicedir)s/cacti/.*')
        r.Ownership('cacti', 'cacti', '%(servicedir)s/cacti/log')
        r.Ownership('cacti', 'cacti', '%(servicedir)s/cacti/log/.*')
        r.Ownership('cacti', 'cacti', '%(servicedir)s/cacti/rra')
        r.Ownership('cacti', 'cacti', '%(servicedir)s/cacti/rra/.*')
        r.ExcludeDirectories(exceptions='%(servicedir)s/cacti/log')
        r.ExcludeDirectories(exceptions='%(servicedir)s/cacti/rra')
        r.Create('%(sysconfdir)s/httpd/conf.d/cacti.conf',
                 contents='# Alias /cacti/ %(servicedir)s/cacti/')
        r.Requires('httpd:runtime', '%(sysconfdir)s/httpd/conf.d/cacti')
        r.Create('%(sysconfdir)s/cron.d/cacti',
                 contents='# */5 * * * * cacti php %(servicedir)s/cacti/poller.php > /dev/null 2>&1')
        r.Requires('rrdtool:runtime', '%(servicedir)s/cacti/lib/rrd.php')
        r.Requires('net-snmp:runtime', '%(servicedir)s/cacti/lib/snmp.php')
        r.Requires('php:runtime', '%(servicedir)s/cacti/index.php')
        r.Requires('php-mysql:lib', '%(servicedir)s/cacti/lib/database.php')
