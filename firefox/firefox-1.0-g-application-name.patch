Index: toolkit/xre/nsAppRunner.cpp
===================================================================
RCS file: /cvsroot/mozilla/toolkit/xre/nsAppRunner.cpp,v
retrieving revision 1.68
diff -d -u -p -r1.68 nsAppRunner.cpp
--- toolkit/xre/nsAppRunner.cpp	22 Feb 2005 21:49:43 -0000	1.68
+++ toolkit/xre/nsAppRunner.cpp	28 Feb 2005 04:28:58 -0000
@@ -1456,6 +1456,11 @@ public:
 };
 #endif
 
+#ifdef MOZ_WIDGET_GTK2
+#include "prlink.h"
+typedef void (*_g_set_application_name_fn)(const gchar *application_name);
+#endif
+
 int xre_main(int argc, char* argv[], const nsXREAppData* aAppData)
 {
   nsresult rv;
@@ -1598,6 +1603,19 @@ int xre_main(int argc, char* argv[], con
 #endif
   gtk_init(&gArgc, &gArgv);
 
+#if defined(MOZ_WIDGET_GTK2)
+  // g_set_application_name () is only defined in glib2.2 and higher.
+  PRLibrary *glib2;
+  _g_set_application_name_fn _g_set_application_name =
+      (_g_set_application_name_fn)PR_FindFunctionSymbolAndLibrary("g_set_application_name", &glib2);
+  if (_g_set_application_name) {
+    _g_set_application_name(gAppData->appName);
+  }
+  if (glib2) {
+    PR_UnloadLibrary(glib2);
+  }
+#endif
+
   gtk_widget_set_default_visual(gdk_rgb_get_visual());
   gtk_widget_set_default_colormap(gdk_rgb_get_cmap());
 #endif /* MOZ_WIDGET_GTK || MOZ_WIDGET_GTK2 */
