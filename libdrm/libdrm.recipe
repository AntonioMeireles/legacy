#
# Copyright (c) 2005-2008 rPath, Inc.
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

loadSuperClass('rpmpackage')
class LibDRM(RPMPackageRecipe, AutoPackageRecipe):
    name = 'libdrm'
    version = '2.4.21'
    isOPENsuse = True
    isXOrgFactory = True
    rpmRelease = '18.1'
    buildRequires = [ 'autoconf:runtime','automake:runtime','pkgconfig:devel', 'libxml2:runtime',
                      'libtool:devel', 'libtool:runtime', 'util-macros:devel', 
                      'libpthread-stubs:devellib', 'cairo:devel', 'udev:devel' ]

    rpmPatches = [ 'enable_test_tools.diff', 
                   # 'commit-3506173.diff'
                   ]

    def configure(r):
        r.addPatch('libdrm-204c76c.diff', extraArgs = '-R', rpm = r.srpm)
        r.macros.optflags += ' -fno-strict-aliasing '

        r.Run('autoreconf -fi')
        r.Configure('--with-pic --enable-nouveau-experimental-api --enable-radeon-experimental-api --enable-udev')


    def makeinstall(r):
        r.Make(dir = 'tests/modeprint')
        r.Make(dir = 'tests/modetest')

        r.MakeInstall()

        r.MakeInstall(dir = 'tests/modeprint')
        r.MakeInstall(dir = 'tests/modetest')
        
        
