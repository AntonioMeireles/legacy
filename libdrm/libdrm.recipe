#
# Copyright (c) 2005-2008 rPath, Inc.
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

loadSuperClass('rpmpackage')
class LibDRM(RPMPackageRecipe, AutoPackageRecipe):
    name = 'libdrm'
    version = '2.4.26'
    isOPENsuse = True
    isXOrgFactory = True
    rpmRelease = '59.1'
    buildRequires = [ 'autoconf:runtime','automake:runtime','pkgconfig:devel',
                      'libxml2:runtime',  'libpciaccess:devel',
                      'libtool:devel', 'libtool:runtime', 'util-macros:devel', 
                      'libpthread-stubs:devellib', 'cairo:devel', 'udev:devel' ]

    rpmPatches = [ ]
                   

    def configure(r):
        r.macros.optflags += ' -fno-strict-aliasing '

        r.Run('autoreconf -fi')
        r.Configure(' --with-pic'
                    ' --enable-nouveau-experimental-api '
                    ' --enable-radeon-experimental-api '
                    ' --enable-vmwgfx-experimental-api'
                    ' --enable-udev')

    def makeinstall(r):
        r.Make(dir = 'tests/modeprint')
        r.Make(dir = 'tests/modetest')
        r.Make('dristat drmstat', dir = 'tests')

        r.MakeInstall()

        r.MakeInstall(dir = 'tests/modeprint')
        r.MakeInstall(dir = 'tests/modetest')
        
        for f in ['tests/.libs/dristat',
                  'tests/.libs/drmstat',
                  'tests/modeprint/.libs/modeprint',
                  'tests/modetest/.libs/modetest',]:
            r.Install(f, '%(bindir)s/', mode = 0755)
