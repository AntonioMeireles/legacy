#
#
# Copyright (c) 2007-2008 Foresight Linux
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

loadSuperClass('rpmpackage')
class VirtInst(RPMPackageRecipe,PackageRecipe):

    name = 'virtinst'
    version = '0.500.3'
    rpmName = 'python-virtinst'
    rpmRelease = '3.fc13'
    rpmPatches = [ 
        # Fix --cdrom with media manually added to pool (bz 574973)
        '%(name)s-%(version)s-virtualdisk-refresh.patch',
        # Handle commas in security labels (bz 581473)
        '%(name)s-%(version)s-seclabel-comma.patch',
        # virt-install: Fix --location dvd.iso (bz 587679)
        '%(name)s-%(version)s-location-cdrom.patch',
        # Enable x2apic for new KVM guests
        '%(name)s-%(version)s-use-x2apic.patch',
        # Keep windows CDROM attached for second install stage
        '%(name)s-%(version)s-fix-windows-cdrom.patch',
        # Fix pool source listing in virt-manager
        '%(name)s-%(version)s-poolsource-check.patch',
        # If host is 64bit, make sure VM always sees 64bit CPU (bz 611584)
        '%(name)s-%(version)s-64bit-flag.patch',
        ]
    tarballName = '%(name)s-%(version)s.tar.gz'

    buildRequires = ['libvirt:python', 
                     'libxml2:python', 
                     'python:devel', 
                     'urlgrabber:python',
                     'python-setuptools:python',
                     'perl:devel',
                     'gzip:runtime',
                     'gettext:runtime']

    def setup(r):
        RPMPackageRecipe.unpack(r)
        r.PythonSetup()
        r.Replace('/tmp/rmake/builds/virtinst/%(name)s-%(version)s', '/usr/bin/python2.6', '%(destdir)s/%(bindir)s/*', allowNoChange=True)
        r.Symlink('%(bindir)s/virt-install', '%(sbindir)s/virt-install')

