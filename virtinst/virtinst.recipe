#
#
# Copyright (c) 2007-2008 Foresight Linux
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

loadSuperClass('rpmpackage')
class VirtInst(RPMPackageRecipe,PackageRecipe):

    name = 'virtinst'
    version = '0.500.0'
    rpmName = 'python-virtinst'
    rpmRelease = '4.fc12'
    rpmPatches = [ # Don't erroneously set limit for amount of virtio devices (bz 499654)
                   '%(name)s-%(version)s-virtio-dev-limit.patch',
                   # Don't use virtio for cdrom devices (bz 517151)
                   '%(name)s-%(version)s-virtio-cdrom.patch',
                   # Rawhide/F11 can auto detect keymapping (bz 487735)
                   '%(name)s-%(version)s-no-default-keymap.patch',
                   # Update test suite to verify patches
                   '%(name)s-%(version)s-update-testsuite.patch',
                   # Don't generate bogus disk driver XML.
                   'virtinst-0.500.0-bogus-driver-xml.patch',
                   # Add '--disk format=' for specifying format (qcow2, ...) when provisioning
                   'virtinst-0.500.0-disk-format.patch',
                   # Add Fedora12 to os dictionary
                   'virtinst-0.500.0-f12-distro.patch',
                   # Don't use usermode net for non-root qemu:///system via virt-install
                   '%(name)s-%(version)s-nonroot-qemu-net.patch',
                   # Fix cdrom installs where the iso is a storage volume (bz 524109)
                   '%(name)s-%(version)s-no-iso-driver.patch',
                   # Fix path permissions for kernel/initrd download location (bz 523960)
                   '%(name)s-%(version)s-change-path-perms.patch',
                   ]
    tarballName = '%(name)s-%(version)s.tar.gz'

    buildRequires = ['libvirt:python', 
                     'libxml2:python', 
                     'python:devel', 
                     'urlgrabber:python',
                     'python-setuptools:python',
                     'perl:devel',
                     'gzip:runtime',
                     'gettext:runtime']

    def setup(r):
        RPMPackageRecipe.unpack(r)
        r.PythonSetup()
        r.Replace('/tmp/rmake/builds/virtinst/%(name)s-%(version)s', '/usr/bin/python2.6', '%(destdir)s/%(bindir)s/*', allowNoChange=True)
        r.Symlink('%(bindir)s/virt-install', '%(sbindir)s/virt-install')

