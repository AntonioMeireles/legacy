#
# Copyright (c) 2007 rPath, Inc.
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

class Ec2AmiTools(PackageRecipe):

    name = 'ec2-ami-tools'
    version = '1.3_30354'

    buildRequires = [ 'ruby:runtime', 'unzip:runtime' ]

    def setup(r):
        r.macros.fixed_version = r.macros.version.replace('_','-')
        r.addArchive('http://ec2-downloads.s3.amazonaws.com/%(name)s-%(fixed_version)s.zip')
        r.addPatch('workaround-rpl-1066.patch', level=1)
        r.Move('bin','%(prefix)s')
        r.Move('lib','%(libdir)s/ruby/site_ruby')
        r.Move('etc','%(sysconfdir)s')

        # We have to synthesize deps because of the shellouts that are
        # done in all the Ruby scripts that are used to bundle the image.
        for t in [ 'coreutils:runtime', 'curl:runtime', 'e2fsprogs:runtime',
                   'lvm2:runtime', 'openssl:runtime', 'util-linux:runtime',
                   'ruby:runtime', 'MAKEDEV:runtime', 'rsync:runtime' ]:
            r.Requires(t, '%(libdir)s/ruby/site_ruby/ec2/.*')
