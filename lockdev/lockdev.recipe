#
# Copyright (c) 2004-2006 rPath, Inc.
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

loadSuperClass('rpmpackage.recipe')
class Lockdev(RPMPackageRecipe, CPackageRecipe):
    name = 'lockdev'
    version = '1.0.1'
    buildRequires = [ 'perl:runtime' ]
    rpmRelease = '10'
    rpmPatches = [ 'lockdev-1.0.0-rh.patch', 'lockdev-1.0.0-signal.patch',
        'lockdev-1.0.0-shared.patch', 'lockdev-1.0.0-cli.patch',
        'lockdev-1.0.1-checkname.patch', ]

    def setup(r):
        r.disableParallelMake()
        r.addArchive('lockdev_1.0.1.orig.tar.gz', rpm=r.srpm)
        for patch in r.rpmPatches:
            r.addPatch(patch, rpm=r.srpm)

        r.macros.cflags += ' -fPIC'
        r.Make('"CFLAGS=%(cflags)s"')

        r.MakePathsInstall('incdir=%(destdir)s/%(includedir)s')
        # dir and setgid helper binary required by the library, so in :lib
        r.SetModes('%(sbindir)s/lockdev', 02755, component='lib')
        r.Ownership('root', 'lock', '%(sbindir)s/lockdev')
