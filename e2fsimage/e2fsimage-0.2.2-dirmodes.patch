diff -ur e2fsimage-0.2.2/src/dirent.c /home/tgerla/e2fsimage-0.2.2.patched/src/dirent.c
--- e2fsimage-0.2.2/src/dirent.c	2005-05-25 14:06:51.000000000 -0400
+++ /home/tgerla/e2fsimage-0.2.2.patched/src/dirent.c	2006-02-25 14:21:54.000000000 -0500
@@ -90,7 +90,7 @@
 	if (uiddb_search(&uiddb, ".", &e2c.default_uid, &e2c.default_gid)){
 		e2c.preserve_uidgid = 0;
 	}
-	modinode(&e2c, ".", newdir);
+	modinode(&e2c, ".", newdir, 0);
 	
 	
 	/* iterate over all directory items */
diff -ur e2fsimage-0.2.2/src/e2fsimage.h /home/tgerla/e2fsimage-0.2.2.patched/src/e2fsimage.h
--- e2fsimage-0.2.2/src/e2fsimage.h	2006-02-25 14:20:23.000000000 -0500
+++ /home/tgerla/e2fsimage-0.2.2.patched/src/e2fsimage.h	2006-02-25 13:25:01.000000000 -0500
@@ -164,7 +164,7 @@
 
 int read_uids(e2i_ctx_t *e2c, uiddb_t *db);
 int read_gids(e2i_ctx_t *e2c, uiddb_t *db);
-int modinode(e2i_ctx_t *e2c, const char *fname, ext2_ino_t e2ino);
+int modinode(e2i_ctx_t *e2c, const char *fname, ext2_ino_t e2ino, int mode);
 
 int read_passwd(e2i_ctx_t *e2c);
 int read_group(e2i_ctx_t *e2c);
diff -ur e2fsimage-0.2.2/src/mkdir.c /home/tgerla/e2fsimage-0.2.2.patched/src/mkdir.c
--- e2fsimage-0.2.2/src/mkdir.c	2004-03-12 09:20:17.000000000 -0500
+++ /home/tgerla/e2fsimage-0.2.2.patched/src/mkdir.c	2006-02-25 13:24:27.000000000 -0500
@@ -85,7 +85,7 @@
 	ret = ext2fs_lookup(e2c->fs, e2c->curr_e2dir, dname, strlen(dname), 0, &nd);
 	E2_ERR(ret, "Could not Ext2-lookup: ", dname);
 	
-	modinode(e2c, dname, nd);
+	modinode(e2c, dname, nd, s.st_mode);
 	
 	if (newdir) {
 		*newdir = nd;
diff -ur e2fsimage-0.2.2/src/uids.c /home/tgerla/e2fsimage-0.2.2.patched/src/uids.c
--- e2fsimage-0.2.2/src/uids.c	2006-01-12 12:31:14.000000000 -0500
+++ /home/tgerla/e2fsimage-0.2.2.patched/src/uids.c	2006-02-25 14:22:10.000000000 -0500
@@ -119,7 +119,7 @@
 	return 0;
 }				
 
-int modinode(e2i_ctx_t *e2c, const char *fname, ext2_ino_t e2ino)
+int modinode(e2i_ctx_t *e2c, const char *fname, ext2_ino_t e2ino, int mode)
 {
 	struct ext2_inode inode;
 	int uid, gid, ret;
@@ -141,6 +141,11 @@
 		inode.i_uid = uid;
 		inode.i_gid = gid;
 	}		
+    if (mode) {
+        if (e2c->verbose)
+            printf("Setting mode of %s to %o\n", fname, mode);
+        inode.i_mode = mode;
+    }
 		
 	ret = ext2fs_write_inode(e2c->fs, e2ino, &inode);
 	E2_ERR(ret, "Ext2 write Inode Error", "");
diff -ur e2fsimage-0.2.2/src/util.c /home/tgerla/e2fsimage-0.2.2.patched/src/util.c
--- e2fsimage-0.2.2/src/util.c	2006-02-25 14:20:23.000000000 -0500
+++ /home/tgerla/e2fsimage-0.2.2.patched/src/util.c	2006-02-25 13:33:38.000000000 -0500
@@ -84,7 +84,7 @@
 {
 	int ret;
 
-	modinode(e2c, fname, e2ino);
+	modinode(e2c, fname, e2ino, 0);
 	
 	ret = ext2fs_link(e2c->fs, e2c->curr_e2dir, fname, e2ino, mode);
 	if (ret == EXT2_ET_DIR_NO_SPACE) {
