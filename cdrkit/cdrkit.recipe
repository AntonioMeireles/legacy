#
# Copyright (c) 2010 Foresight Linux
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

loadSuperClass('rpmpackage')
class Cdrkit(RPMPackageRecipe, CPackageRecipe):
    name = 'cdrkit'
    version = '1.1.10'
    rpmRelease = '1.fc13'

    tarballName = 'cdrkit-%(version)s.tar.gz'
    rpmPatches = [ 'cdrkit-1.1.8-werror.patch',
		   'cdrkit-1.1.9-efi-boot.patch',
		   #' cdrkit-1.1.9-no_mp3.patch ',
		   'cdrkit-1.1.9-buffer_overflow.patch',
		   #' cdrkit-1.1.9-rr_joliet.patch ',
		   'cdrkit-1.1.10-build-fix.patch', ]
 
    buildRequires = ['bzip2:devel', 'cmake:runtime', 'file:devel', 'libcap:devel', 'perl:devel', 'zlib:devel']

    def unpack(r):
	RPMPackageRecipe.unpack(r)

    def configure(r):
	r.CMake('-DCMAKE_INSTALL_PREFIX:PATH=%(prefix)s -DBUILD_SHARED_LIBS:BOOL=ON ..', objDir='build')

    def make(r):
	r.Make(dir='build')

    def makeinstall(r):
	r.MakeInstall('DESTDIR=%(destdir)s', dir='build')
	r.Symlink('%(bindir)s/genisoimage', '%(bindir)s/mkisofs')
	r.Symlink('%(bindir)s/genisoimage', '%(bindir)s/mkhybrid')
	r.Symlink('%(bindir)s/icedax', '%(bindir)s/cdda2wav')
	r.Symlink('%(bindir)s/wodim', '%(bindir)s/cdrecord')
	r.Symlink('%(bindir)s/wodim', '%(bindir)s/dvdrecord')

	r.PackageSpec('cdda2wav',
            '%(bindir)s/cdda2wav',
	    '%(bindir)s/icedax',
            r'%(mandir)s/man1/cdda2wav\.1.*')

        r.PackageSpec('mkisofs',
            '%(bindir)s/mkisofs',
            '%(bindir)s/mkhybrid',
            '%(bindir)s/isoinfo',
            '%(bindir)s/isodump',
            '%(bindir)s/isovfy',
            '%(bindir)s/isodebug',
	    '%(bindir)s/wodim',
            r'%(mandir)s/man8/isoinfo\.8.*',
            r'%(mandir)s/man8/mkisofs\.8.*',
            r'%(mandir)s/man8/mkhybrid\.8.*')

    def setup(r):
	r.unpack()
	r.configure()
	r.make()
	r.makeinstall()
