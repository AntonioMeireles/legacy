#
# Copyright (c) 2004 Specifix, Inc.
# All rights reserved
#

class Libxml2(PackageRecipe):
    buildRequires = [ 'python:runtime', 'python:devel' ]

    name = 'libxml2'
    version = '2.6.16'
    
    def setup(r):
	r.addArchive('ftp://xmlsoft.org/libxml2-%(version)s.tar.gz')

	r.Configure()
	r.Make()
	r.MakeInstall()

	# some docs are already installed by make install;
	# tell which component owns them
	r.ComponentSpec('devel', '%(thisdocdir)s/html/')
	r.Move('%(docdir)s/%(name)s-python-%(version)s/examples/*',
	               '%(thisdocdir)s/examples/',
		       component='python')
	r.Move('%(docdir)s/%(name)s-python-%(version)s/TODO',
	               '%(thisdocdir)s/TODO.python',
		       component='python')
	r.Remove('%(docdir)s/%(name)s-python-%(version)s', recursive=True)
	# other docs are not installed by make install:
	r.Doc('AUTHORS', 'ChangeLog', 'NEWS', 'README',
			 'Copyright', 'TODO')
	r.Doc('doc/*.html', 'doc/*.gif', 'doc/*.png',
			 'doc/tutorial', 'doc/libxml2-api.xml',
			 component='devel')
	r.Doc('python/libxml2class.txt', 'python/tests/*.py',
			 'doc/*.py', 'doc/python.html',
			 component='python')
        for test in ('check-relaxng-test-suite.py', 
                     'check-relaxng-test-suite2.py',
                     'check-xinclude-test-suite.py',
                     'check-xml-test-suite.py',
                     'check-xsddata-test-suite.py',
                     'testapi'
                     'testThreads',
                     'testapi'):
                if test.endswith('.py'):
                    r.Run('sed -i -e "s/quiet = 1/quiet = 0/g" %s' % test)
                    r.TestSuite('.', "./%s" % test)
