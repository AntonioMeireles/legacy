#
# Copyright (c) 2004-2006 rPath, Inc.
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

class Libxml2(AutoPackageRecipe):
    name = 'libxml2'
    version = '2.6.30'

    buildRequires = [ 'python:runtime', 'python:devel', 'zlib:devel',
        'perl:runtime', 'wget:runtime',  ]
    # Never put 'libxslt:python', 'libxslt:runtime' as buildReqs. breaks rMooking (dep loops)


    def unpack(r):
        r.addArchive('ftp://xmlsoft.org/libxml2/')

    def policy(r):
        # some docs are already installed by make install;
        # tell which component owns them
        r.ComponentSpec('devel', '%(thisdocdir)s/html/')
        r.Move('%(docdir)s/%(name)s-python-%(version)s/examples/*',
               '%(thisdocdir)s/examples/')

        r.Move('%(docdir)s/%(name)s-python-%(version)s/TODO',
               '%(thisdocdir)s/TODO.python')
        r.Remove('%(docdir)s/%(name)s-python-%(version)s', recursive=True)
        # other docs are not installed by make install:
        r.Doc('doc/*.html', 'doc/*.gif', 'doc/*.png',
              'doc/tutorial', 'doc/libxml2-api.xml',
              component='devel')
        r.Doc('python/libxml2class.txt', 'python/tests/*.py',
              'doc/*.py', 'doc/python.html')

        for test in ('check-relaxng-test-suite.py',
                     'check-relaxng-test-suite2.py',
                     'check-xinclude-test-suite.py',
                     'check-xml-test-suite.py',
                     'check-xsddata-test-suite.py',
                     'testapi'
                     'testThreads',
                     'testapi'):
                if test.endswith('.py'):
                    r.Run('sed -i -e "s/quiet = 1/quiet = 0/g" %s' % test)
                    r.TestSuite('.', "./%s" % test)
