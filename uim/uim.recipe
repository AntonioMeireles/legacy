#
# Copyright (c) %(year)s Foresight Linux
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

class Uim(AutoPackageRecipe):
    name = 'uim'
    version = '1.4.2'
    #Flags.m17n=False
 
    buildRequires = ['anthy:devel','atk:devel','cairo:devel',
                'desktop-file-utils','expat:devel',
                'fontconfig:devel','freetype:devel',
                'gettext:runtime','libpng:devel','librsvg:runtime',
                'libstdc++:devel','ncurses:devel','pango:devel',
                'perl:runtime','pkgconfig:devel','ruby:runtime','zlib:devel',
                'desktop-file-utils:runtime','m17n-lib:devel'
                ]
    if Use.X:
        buildRequires.extend(['libX11:devel','libXau:devel','libXdmcp:devel',
                            'libXext:devel','libXft:devel','libXrender:devel',
                            'libxcb:devel','pixman:devel','xcb-util:devel'])
        if Use.gtk:
            buildRequires.extend(['glib:devel','gtk:devel','gtk:runtime'])
        if Use.qt:
            buildRequires.extend(['qt:devel'])
    if Use.emacs:
        buildRequires.extend(['emacs:runtime'])
 
    def setup(r):
        r.addArchive('http://%(name)s.googlecode.com/files/'
                    '%(name)s-%(version)s.tar.gz')

        r.macros.extraConfig = ''
        if Use.X:
            if Use.qt:
                r.macros.extraConfig = '--with-qt --with-qt-immodule'
            if not Use.gtk:
                r.macros.extraConfig += ' --without-gtk2'
            else:
                if Use.gnome:
                    r.macros.extraConfig += ' --enable-gnome-applet'

        if not Use.emacs:
            r.macros.extraConfig += ' --disable-emacs'

        # is there a smart way?
        #if not Flags.m17n:
        #    r.macros.extraConfig += ' --without-m17lib'

        r.Configure('%(extraConfig)s')
        r.Make()
        r.MakeInstall()
