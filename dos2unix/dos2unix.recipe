#
# Copyright (c) 2004-2006 rPath, Inc.
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

loadSuperClass('rpmpackage')
class Dos2Unix(RPMPackageRecipe, CPackageRecipe):
    name = 'dos2unix'
    version = '3.1'
    # every distribution uses version 3.1, but the original appears
    # to have disappeared from the face of the net :(
    rpmRelease = '27.1'

    def setup(r):
        r.unpack()
        r.addPatch('dos2unix-3.1.patch')
        r.addPatch('dos2unix-3.1-segfault.patch')
        # C does not allow trailing garbage on #else/#endif
        # Remove junk after #else and #endif lines
        r.Replace('#e(lse|ndif).*', r'#e\1', '*.[ch]')

        r.Make('clean')
        r.Make('dos2unix')
        r.Install('dos2unix', '%(bindir)s/', mode=0755)
        r.Install('dos2unix.1', '%(mandir)s/man1/', mode=0644)
        r.Symlink('dos2unix', '%(bindir)s/mac2unix')
        r.Symlink('dos2unix.1', '%(mandir)s/man1/mac2unix.1')
