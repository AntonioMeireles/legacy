# Copyright (c) 2004, 2005-2007 Elliot Peele <elliot@bentlogic.net> and contributors
# Modified by Cesar Cardoso <cesar@zyakannazio.eti.br>
# Thanks to elliot and dugan for the macros
#

loadSuperClass('kernelmodulepackage')
class madWiFi(KernelModulePackageRecipe):

    name = 'madwifi'
    version = '20070326'

    buildRequires = ['kernel:build-tree', 'sharutils:runtime']

    def unpack(r):

        r.macros.svnVer = 'r2216'
        r.macros.ksrcdir = '/lib/modules/%(kver)s/build'
        r.macros.modpath = '/lib/modules/%(kver)s/kernel/drivers/net/wireless'
        r.macros.cflags += ' -I%(ksrcdir)s/include'
        r.macros.compNam = '%(name)s-ng'

        r.addArchive('http://snapshots.madwifi.org/madwifi-ng/%(compNam)s-%(svnVer)s-%(version)s.tar.gz')


    def build(r):
        r.Make('BINDIR=%(bindir)s MANDIR=%(mandir)s '
               'KERNELPATH=%(ksrcdir)s MODULEPATH=%(modpath)s')

    def install(r):
        r.MakeInstall('BINDIR=%(bindir)s MANDIR=%(mandir)s '
                      'KERNELPATH=%(ksrcdir)s MODULEPATH=%(modpath)s',
                      installtarget='install-tools')
