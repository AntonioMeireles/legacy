# Copyright (c) 2004, 2005-2007 Elliot Peele <elliot@bentlogic.net> and contributors
# Modified by Cesar Cardoso <cesar@zyakannazio.eti.br>
# Thanks to elliot and dugan for the macros
#

loadSuperClass('kernelmodulepackage')
class madWiFi(KernelModulePackageRecipe):

    name = 'madwifi'
    version = '0.9.3.2'

    buildRequires = ['kernel:build-tree', 'sharutils:runtime', 'libgcc:devellib', 'libgcc:lib']

    def unpack(r):
        r.macros.ksrcdir = '/lib/modules/%(kver)s/build'
        r.macros.modpath = '/lib/modules/%(kver)s/kernel/drivers/net/wireless'
        r.macros.cflags += ' -I%(ksrcdir)s/include'
        r.macros.compNam = '%(name)s-ng'

        r.addArchive('mirror://sourceforge/%(name)s/%(name)s-%(version)s.tar.bz2')

        r.addPatch('madwifi-11b_assoc_fix.dif')
        r.addPatch('http://viewcvs.gentoo.org/viewcvs.py/*checkout*/gentoo-x86/net-wireless/madwifi-ng/files/madwifi-ng-0.9.3-uudecode-gcda-fix.patch')
        r.Replace('-Werror', '', 'Makefile.inc')

    def build(r):
        r.Make('KERNELPATH=%(ksrcdir)s MODULEPATH=%(modpath)s')

    def install(r):
        r.MakeInstall('KERNELPATH=%(ksrcdir)s MODULEPATH=%(modpath)s BINDIR=%(bindir)s MANDIR=%(mandir)s' )

