# Copyright (c) 2004, 2005 Elliot Peele <elliot@bentlogic.net> and contributors
# Modified by Cesar Cardoso <cesar@zyakannazio.eti.br>
# Thanks to elliot and dugan for the macros
#

loadSuperClass('kernelmodulepackage.recipe')
class madWiFi(KernelModulePackageRecipe):

    name = 'madwifi'
    version = '2006_11_28'

    buildRequires = ['kernel:build-tree', 'sharutils:runtime']

    def unpack(r):
        r.macros.ksrcdir = '/lib/modules/%(kver)s/build'
        r.macros.modpath = '/lib/modules/%(kver)s/kernel/drivers/net/wireless'
        r.macros.cvsVer = r.version.replace('_', '')
        # We're building madwifi-ng
        # Please change this macro if you're cooking madwifi-old
        r.macros.compNam = '%(name)s-ng'
        # HACK ALERT!
        # Macro needed because of the way SVN's madwifi creates tarballs
        r.macros.svnVer = 'r1823'

        r.addArchive('http://snapshots.madwifi.org/madwifi-ng/%(compNam)s-%(svnVer)s-%(cvsVer)s.tar.gz')

        r.addPatch('madwifi-11b_assoc_fix.dif')


    def build(r):
        r.Make('KERNELPATH=%(ksrcdir)s MODULEPATH=%(modpath)s')


    def install(r):
        r.MakeInstall('KERNELPATH=%(ksrcdir)s MODULEPATH=%(modpath)s')

