# Copyright (c) 2004, 2005-2007 Elliot Peele <elliot@bentlogic.net> and contributors
# Modified by Cesar Cardoso <cesar@zyakannazio.eti.br>
# Thanks to elliot and dugan for the macros
#

loadSuperClass('kernelmodulepackage')
class madWiFi(KernelModulePackageRecipe):

    name = 'madwifi'
    version = '0.9.2.1'

    buildRequires = ['kernel:build-tree', 'sharutils:runtime']

    def unpack(r):
        r.macros.ksrcdir = '/lib/modules/%(kver)s/build'
        r.macros.modpath = '/lib/modules/%(kver)s/kernel/drivers/net/wireless'
        r.macros.cflags += ' -I%(ksrcdir)s/include'
        r.macros.compNam = '%(name)s-ng'

        r.addArchive('mirror://sourceforge/%(name)s/%(name)s-%(version)s.tar.bz2')

        r.addPatch('madwifi-11b_assoc_fix.dif')

        r.addPatch('http://viewcvs.gentoo.org/viewcvs.py/*checkout*/gentoo-x86/net-wireless/madwifi-ng/files/madwifi-ng-0.9.2-ath_intr.diff')
        r.addPatch('http://viewcvs.gentoo.org/viewcvs.py/*checkout*/gentoo-x86/net-wireless/madwifi-ng/files/madwifi-ng-0.9.2-config.h.diff')
        r.addPatch('http://viewcvs.gentoo.org/viewcvs.py/*checkout*/gentoo-x86/net-wireless/madwifi-ng/files/madwifi-ng-0.9.2-crypto_cipher_encrypt_one.diff')



        r.addPatch('http://viewcvs.gentoo.org/viewcvs.py/*checkout*/gentoo-x86/net-wireless/madwifi-ng/files/madwifi-ng-uudecode-gcda-fix.patch')
        r.addPatch('http://viewcvs.gentoo.org/viewcvs.py/*checkout*/gentoo-x86/net-wireless/madwifi-ng/files/madwifi-ng-0.9.2.1-linux-2.6.20.patch')
        r.addPatch('http://viewcvs.gentoo.org/viewcvs.py/*checkout*/gentoo-x86/net-wireless/madwifi-ng/files/madwifi-ng-0.9.2-allow-cipher-none.diff')

    def build(r):
        r.Make('KERNELPATH=%(ksrcdir)s MODULEPATH=%(modpath)s')

    def install(r):
        r.MakeInstall('KERNELPATH=%(ksrcdir)s MODULEPATH=%(modpath)s')

