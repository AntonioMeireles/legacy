# vim:set ts=4 sw=4 et:
#
# Copyright (c) 2009 Foresight Linux
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

class vlc(AutoPackageRecipe):
    buildRequires = ['glib:devel', 'wxWidgets:devel', 'libmtp:devel', 'hal:devel',
                     'udev:devel', 'libkate:devel', 'lame:devel', 'gsm:devel',
                     'lua:devel', 'liboil:devel', 'libv4l:devel', 'qt4:devel',
                     'libproxy:devel', 'libusb:devel', 'intltool:runtime', 'net-tools:runtime',
                     'libdvdcss:devellib', 'libXext:devel', 'libshout:devel',
                     'gettext:runtime', 'libtool:runtime', 'libmpcdec:devel',
                     'dbus:devel', 'faac:devel', 'zlib:devel', 'flac:devel',
                     'libdvdcss:devel', 'libvorbis:devel', 'xcb-util:devel',
                     'portaudio:devel', 'libgpg-error:devel', 'lua:runtime',
                     'SDL_image:devel', 'ORBit2:devel', 'samba-client:lib',
                     'libupnp:devel', 'alsa-lib:devel', 'libavc1394:devel',
                     'fluidsynth:devel', 'libXrandr:devel', 'gnutls:devel',
                     'xulrunner:devel', 'pkgconfig:devel', 'libass:devel',
                     'libdvbpsi:devel', 'libX11:devel', 'dbus-glib:devel',
                     'autoconf:runtime', 'libxml2:devel', 'librsvg:devel',
                     'libmodplug:devel', 'gettext:devel', 'libcaca:devel',
                     'libcddb:devel', 'schroedinger:devel', 'aalib:devel',
                     'live555:devel', 'qt4-core:lib', 'libXinerama:devel',
                     'libavc1394:devellib', 'lua:runtime', 'ffmpeg:devel',
                     'xulrunner:devel', 'freetype:devel', 'libXpm:devel',
                     'libogg:devel', 'libdvdread:devel', 'twolame:devel',
                     'libjpeg:devel', 'gnome-vfs:devel', 'fribidi:devel',
                     'sysfsutils:devel', 'libcdio:devel', 'a52dec:devel',
                     'libdvdnav:devel', 'libXv:devel', 'xvidcore:devel',
                     'libmad:devel', 'libXi:devel', 'libXxf86vm:devel',
                     'taglib:devel', 'automake:runtime', 'speex:devel',
                     'libstdc++:devel', 'ncurses:devel', 'libva:devel',
                     'libpng:devel', 'libtheora:devel', 'GConf:devel',
                     'glib:devel', 'libICE:devel', 'pulseaudio:devel',
                     'libmpeg2:devellib', 'hal:devel', 'faad2:devel',
                     'libtiff:devel', 'libtool:devel', 'qt4-gui:lib',
                     'libmpeg2:devel', 'desktop-file-utils:runtime',
                     'avahi:devel', 'libnotify:devel', 'SDL:devel',
                     'libgcrypt:devel', 'x264:devel', 'Mesa:devel',
                     'samba:devel', 'libSM:devel', 'libdca:devel',
                     'xz:runtime', 'libbluray:devel', 'libsamplerate:devel']

    name = "vlc"
    version = "2.0.0"

    packageSummary = 'VLC media player is a highly portable multimedia player'
    packageDescription = 'VLC media player is a highly portable multimedia player supporting most audio and video formats (H.264, Ogg, DivX, MKV, TS, MPEG-2, mp3, MPEG-4, aac, ...) from files, physical media (DVDs, VCD, Audio-CD), TV capture cards and many network streaming protocols.'

    def unpack(r):
        r.addArchive('http://download.videolan.org/pub/videolan/%(name)s/%(version)s/')
        r.Replace('vlclib_PROGRAMS = vlc-cache-gen', '#vlclib_PROGRAMS = vlc-cache-gen', 'bin/Makefile.am')

    def configure(r):
        r.Run('rm aclocal.m4 m4/lib*.m4 m4/lt*.m4 ; ./bootstrap')
        r.macros.cflags += ' -L%(libdir)s/xorg.mesa.3d'
        r.Configure(' --disable-rpath --enable-run-as-root --enable-pulse'
                    ' --enable-dv --enable-faad --enable-notify'
                    ' --enable-gnomevfs --enable-ogg --enable-mod'
                    ' --enable-flac --enable-vorbis --enable-libmpeg2'
                    ' --enable-libva --enable-nls')
        r.Environment('LIBTOOL', '%(bindir)s/libtool')

    def makeinstall(r):
        r.MakeInstall()
        r.addSource('vlc-cache-gen.tagdescription', macros=True,
                    dest='%(tagdescriptiondir)s/vlc-cache-gen')
        r.addSource('vlc-cache-gen.taghandler', macros=True,
                    dest='%(taghandlerdir)s/vlc-cache-gen', mode=0755)

    def policy(r):
        r.addSource('vlc.png')
        r.Install('vlc.png', '%(datadir)s/pixmaps/vlc.png')
