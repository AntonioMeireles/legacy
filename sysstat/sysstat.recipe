#
# Copyright (c) 2004-2007 rPath, Inc.
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

class SysStat(AutoPackageRecipe):
    name = 'sysstat'
    version = '7.1.1'

    buildRequires = [ 'gettext:runtime', 'chkconfig:runtime', ]

    def unpack(r):
        r.addArchive('http://perso.orange.fr/sebastien.godard/')

        r.addSource('sysstat.crond', macros=True,
                    dest='%(sysconfdir)s/cron.d/sysstat')
        r.addSource('sysstat.sysconfig',
                    dest='%(sysconfdir)s/sysconfig/sysstat', mode=0644)
        r.addSource('sysstat.init', macros=True, mode=0755,
                    dest='%(initdir)s/sysstat')

    def configure(r):
        r.Configure('--disable-man-group',
                    preConfigure='sa_lib_dir=%(libdir)s/sa')

    def makeinstall(r):
        # --disable-man-group doesn't seem to be working correctly.
        r.MakeInstall('IGNORE_MAN_GROUP=y DOC_DIR=%(thisdocdir)s')

    def policy(r):
        r.ExcludeDirectories(exceptions='%(localstatedir)s/log/sa')

        # Tag init scripts in case the initscript tag desc. is not installed
        r.TagSpec('initscript', '%(initdir)s/')
