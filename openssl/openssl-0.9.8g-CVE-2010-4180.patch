*) Disable code workaround for ancient and obsolete Netscape browsers
and servers: an attacker can use it in a ciphersuite downgrade attack.
Thanks to Martin Rex for discovering this bug. CVE-2010-4180

This patch was originally based on the 0.9.8e patch from RHEL 5.
--- ssl/s3_clnt.c.orig	2011-04-07 16:14:59.000000000 -0400
+++ ssl/s3_clnt.c	2011-04-07 16:16:48.000000000 -0400
@@ -784,8 +784,10 @@
 		s->session->cipher_id = s->session->cipher->id;
 	if (s->hit && (s->session->cipher_id != c->id))
 		{
+#if 0 // Workaround is no longer required.
 		if (!(s->options &
 			SSL_OP_NETSCAPE_REUSE_CIPHER_CHANGE_BUG))
+#endif
 			{
 			al=SSL_AD_ILLEGAL_PARAMETER;
 			SSLerr(SSL_F_SSL3_GET_SERVER_HELLO,SSL_R_OLD_SESSION_CIPHER_NOT_RETURNED);
--- ssl/s3_srvr.c.orig	2011-04-07 16:15:07.000000000 -0400
+++ ssl/s3_srvr.c	2011-04-07 16:17:20.000000000 -0400
@@ -885,12 +885,14 @@
 			}
 		if (j == 0)
 			{
+#if 0 // workaround is no longer required
 			if ((s->options & SSL_OP_NETSCAPE_REUSE_CIPHER_CHANGE_BUG) && (sk_SSL_CIPHER_num(ciphers) == 1))
 				{
 				/* Very bad for multi-threading.... */
 				s->session->cipher=sk_SSL_CIPHER_value(ciphers, 0);
 				}
 			else
+#endif
 				{
 				/* we need to have the cipher in the cipher
 				 * list if we are asked to reuse it */
--- ssl/ssl.h.orig	2011-04-07 16:15:14.000000000 -0400
+++ ssl/ssl.h	2011-04-07 16:17:45.000000000 -0400
@@ -488,7 +488,7 @@
 #define SSL_OP_NETSCAPE_CHALLENGE_BUG			0x00000002L
 /* Allow initial connection to servers that don't support RI */
 #define SSL_OP_LEGACY_SERVER_CONNECT			0x00000004L
-#define SSL_OP_NETSCAPE_REUSE_CIPHER_CHANGE_BUG		0x00000008L
+#define SSL_OP_NETSCAPE_REUSE_CIPHER_CHANGE_BUG		0x00000008L /* no effect */
 #define SSL_OP_SSLREF2_REUSE_CERT_TYPE_BUG		0x00000010L
 #define SSL_OP_MICROSOFT_BIG_SSLV3_BUFFER		0x00000020L
 #define SSL_OP_MSIE_SSLV2_RSA_PADDING			0x00000040L /* no effect since 0.9.7h and 0.9.8b */
--- doc/ssl/SSL_CTX_set_options.pod.orig	2011-04-07 16:20:29.000000000 -0400
+++ doc/ssl/SSL_CTX_set_options.pod	2011-04-07 16:21:12.000000000 -0400
@@ -78,18 +78,7 @@
 
 =item SSL_OP_NETSCAPE_REUSE_CIPHER_CHANGE_BUG
 
-ssl3.netscape.com:443, first a connection is established with RC4-MD5.
-If it is then resumed, we end up using DES-CBC3-SHA.  It should be
-RC4-MD5 according to 7.6.1.3, 'cipher_suite'.
-
-Netscape-Enterprise/2.01 (https://merchant.netscape.com) has this bug.
-It only really shows up when connecting via SSLv2/v3 then reconnecting
-via SSLv3. The cipher list changes....
-
-NEW INFORMATION.  Try connecting with a cipher list of just
-DES-CBC-SHA:RC4-MD5.  For some weird reason, each new connection uses
-RC4-MD5, but a re-connect tries to use DES-CBC-SHA.  So netscape, when
-doing a re-connect, always takes the first cipher in the cipher list.
+This option no longer has any effect.
 
 =item SSL_OP_SSLREF2_REUSE_CERT_TYPE_BUG
 
