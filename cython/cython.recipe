#
# Copyright (c) 2009-2011 The Foresight Linux Project
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

class Cython(AutoPackageRecipe):
    name = 'cython'
    version = '0.14.1'

    buildRequires = ['python:devel', 'python-setuptools:python', 
                     'cElementTree:python', 'numpy:python']

    def setup(r):
        r.macros.archive_name = 'Cython'
        r.addArchive('http://cython.org/release/')

        # r.PythonSetup()
        # XXX find out why ...
        r.Run('python setup.py install --prefix=%(prefix)s  --install-purelib=%(libdir)s/python%(pyver)s/site-packages/ '
              ' --install-platlib=%(libdir)s/python%(pyver)s/site-packages/  '
              ' --install-data=%(libdir)s/python%(pyver)s/site-packages/ --root %(destdir)s')

        # Separate compiler from stuff needed at runtime:
        # The compiler (including python!) lives in :devel
        # The runtime lives in :python and is all you need to
        # install for pure python that can optionally be built
        # with Cython - this way you don't need to drag in the
        # whole compiler just because your code is pure python
        # that can be conditionally compiled with Cython
        r.ComponentSpec('python', '.*/Cython/Shadow.pyc?',
                                  '.*/cython.pyc?')
        r.ComponentSpec('devel', '.*/site-packages/.*')

        # cython.py has conditional imports that we need to turn
        # off deps from
        r.Requires(exceptions='.*/cython.pyc?')
