#
# Copyright (c) 2009 rPath, Inc.
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

class lua(CPackageRecipe):
    name = 'lua'
    version = '5.1.4'

    buildRequires = [ 'ncurses:devel', 'readline:devel', ]

    def setup(r):
        r.addArchive('http://www.lua.org/ftp/')
        r.addPatch('lua-5.1.4-autotoolize.patch')
        r.addAction('chmod u+x autogen.sh config.guess config.sub configure depcomp install-sh missing')
        r.Configure(' --with-readline ')
        r.Replace(('^hardcode_libdir_flag_spec=.*', 'hardcode_libdir_flag_spec=""'),
                  ('^runpath_var=LD_RUN_PATH', 'runpath_var=DIE_RPATH_DIE' ),
                  'libtool')
        r.Make('INSTALL_TOP=%(prefix)s LIBS="-lm -ldl" luac_LDADD="liblua.la -lm -ldl"')
        r.Replace('-lreadline -lncurses ', '', 'etc/lua.pc')
        r.MakeInstall('INSTALL_TOP=%(destdir)s%(prefix)s')
