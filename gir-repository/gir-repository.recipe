#
# Copyright (c) 2009 Foresight Linux
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

loadRecipe('gnomepackage')
class GirRepository(GnomePackageRecipe):
    name = 'gir-repository'
    version = '0.6.5'
 
    buildRequires = [ 'automake:runtime', 'autoconf:runtime',
                      'gobject-introspection:devel', 'gobject-introspection:runtime', 
                      'clutter:devel', 'Mesa:devel',
                      'avahi:devel', 
                      'babl:devel', 
                      'GConf:devel', 
                      'gnome-keyring:devel', 
                      'gnome-menus:devel', 
                      'goocanvas:devel', 
                      'gssdp:devel', 
                      'gstreamer:devel', 
                      'gtk:devel', 
                      'gtksourceview:devel', 
                      'gupnp:devel', 
                      'libnotify:devel', 
                      'libsoup:devel', 
                      'libwnck:devel', 
                      'nautilus:devel', 
                      'poppler-glib:devel', 
                      'unique:devel', 
                      'vte:devel', 
                      'WebKit:devel',
                      ]

    extraConfig = '--disable-static'
    patches = ['gir-repo-install-dbus-glib.patch']

    def unpack(r):
        GnomePackageRecipe.unpack(r)
        # hotfix to behave with latest babl
        r.Replace('babl-0.0', 'babl-0.1', 'gir/Makefile.{in,am}')
        r.Run('autoreconf -fi')

    def policy(r):
        # drop atk and gtk, since these come with their own
        # introspection support now
        r.Remove('%(libdir)s/girepository-1.0/Atk-1.0.typelib')
        r.Remove('%(libdir)s/girepository-1.0/Gdk-2.0.typelib')
        r.Remove('%(libdir)s/girepository-1.0/GdkPixbuf-2.0.typelib')
        r.Remove('%(libdir)s/girepository-1.0/Gtk-2.0.typelib')
        r.Remove('%(datadir)s/gir-1.0/Atk-1.0.gir')
        r.Remove('%(datadir)s/gir-1.0/Gdk-2.0.gir')
        r.Remove('%(datadir)s/gir-1.0/GdkPixbuf-2.0.gir')
        r.Remove('%(datadir)s/gir-1.0/Gtk-2.0.gir')
