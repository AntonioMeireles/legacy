#
# Copyright (c) 2007-2010 Foresight Linux
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

loadSuperClass('gnomepackage')
class Empathy(GnomePackageRecipe):

    name = 'empathy'
    version = '2.32.2'

    buildRequires = [
        'GConf:devel',
        'GConf:runtime',
        'NetworkManager:devel',
        'WebKit:devel',
        'dbus-glib:runtime',
        'dbus:devel',
        'desktop-file-utils:runtime',
        'enchant:devellib',
        'evolution-data-server:devel',
        'folks:devel',
        'geoclue:devel',
        'gnome-keyring:devellib',
        'libgnome-keyring:devel',
        'gnutls:devel',
        'gst-plugins-base:devellib',
        'iso-codes:devellib',
        'libcanberra:devel',
        'libnotify:devel',
        'openssl:devel',
        'popt:devel',
        'pygobject:runtime',
        'pygtk:devel',
        'pygtk:devellib',
        'python:devel',
        'rarian:devel',
        'rarian:runtime',
        'telepathy-farsight:devellib',
        'telepathy-logger:devel',
        'telepathy-mission-control:devel',
        'unique:devellib',
        'libchamplain:devel',
        'nautilus-sendto:devellib',
        'nautilus-sendto:devel',
        'autoconf:runtime',
        'automake:runtime',
        ]

    extraConfig = (
        ' --disable-Werror'
        ' --enable-location=yes'
        ' --enable-map=yes'
        ' --enable-nautilus-sendto=yes'
        ' --enable-spell=yes'
        ' --enable-webkit=yes'
        ' --with-ca-file=/etc/ssl/certs/ca-bundle.crt'
        ' --with-connectivity=nm'
        ' --disable-static'
        )

    patches = ['empathy-2.32.2-libnotify-0.7.patch']

    def unpack(r):
        GnomePackageRecipe.unpack(r)
        # force these to be regenerated
        r.Remove('data/empathy.desktop')
        r.Remove('data/empathy.schemas')
        r.disableParallelMake()
        r.Replace('libnotify < 0.7', 'libnotify < 0.8', 'configure.ac')
        r.Run('autoreconf -fi')
