diff -r a31abd5ddc5f generic/tkImgGIF.c
--- a/generic/tkImgGIF.c	Tue Feb 05 00:09:57 2008 -0900
+++ b/generic/tkImgGIF.c	Tue Feb 05 00:24:33 2008 -0900
@@ -826,6 +826,12 @@ ReadImage(interp, imagePtr, chan, len, r
 		Tcl_PosixError(interp), (char *) NULL);
 	return TCL_ERROR;
     }
+
+    if (initialCodeSize > MAX_LWZ_BITS) {
+	Tcl_SetResult(interp, "malformed image", TCL_STATIC);
+	return TCL_ERROR;
+    }
+
     if (transparent != -1) {
 	cmap[transparent][CM_RED] = 0;
 	cmap[transparent][CM_GREEN] = 0;
