#
# Copyright (c) 2007 rPath, Inc.
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

# Note that this version of libelf has been modified as minimally
# as possible not to have conflicting file paths with the elfutils
# implementation of libelf, and it should work automatically with
# anything that uses libelf.pc to find libelf.

class libelf(AutoPackageRecipe):
    name = 'libelf-lgpl'
    version = '0.8.6'

    if not Use.bootstrap:
        buildRequires = [ 'gettext:runtime' ]

    def unpack(r):
        r.macros.archive_name = 'libelf'
        r.addArchive('http://www.mr511.de/software/')
        r.disableParallelMake()

    def configure(r):
        extraConfig = ''
        if Use.bootstrap:
            extraConfig = ' --disable-nls'
        r.Configure('--includedir=%(includedir)s/libelf-lgpl --enable-compat' + extraConfig)
        r.Replace(r'libelf\$', 'libelf-lgpl$', 'lib/Makefile')
        # Applications should include <gelf.h> and/or <libelf.h>
        # which are not in the libelf subdirectory
        r.Replace(('-lelf', '-lelf-lgpl'),
                  ('/libelf$', ''), 'libelf.pc')

    def make(r):
        r.Make('AR=%(target)s-ar')

    def makeinstall(r):
        r.MakeInstall(rootVar='instroot')
        r.Move('%(libdir)s/libelf.a', '%(libdir)s/libelf-lgpl.a')
