#
# Copyright (c) 2006 rPath, Inc.
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

class LibGphoto2(CPackageRecipe):
    name = 'libgphoto2'
    version = '2.4.0'

    buildRequires = [ 'gtk:devel', 'findutils:runtime', 'flex:runtime',
                      'libexif:devel', 'libusb:devel', 'bison:runtime',
                      'lockdev:devel', 'libjpeg:devel', 'swig:runtime',
                      'pkgconfig:devel', 'libtool:runtime', 'libtool:devel',
                      'gettext:runtime', 'libexif:devel', 
                      'dbus:devel', 'hal:devel']

    def setup(r):
        r.addArchive('mirror://sourceforge/gphoto/')
        r.addSource('usbcam.console')

        r.Run('libtoolize -f')
        r.Configure('--disable-rpath --with-doc-dir=%(thisdocdir)s')

        r.Make()
        r.MakeInstall()

        r.Remove('%(libdir)s/libgphoto2/%(version)s/*.a')
        r.Provides(exceptions=['%(libdir)s/gphoto2/%(version)s/'])

#FIXME.need to look at this carefully. but now i need it cooking
        # use the filewrap hack and LD_LIBRARY_PATH to bootstrap usbcam.usermap
#        r.Run('LD_LIBRARY_PATH=%(destdir)s/%(libdir)s'
#              ' %(destdir)s/%(libdir)s/libgphoto2/print-usb-usermap'
#              ' > usbcam.usermap </dev/null',
#              filewrap=True)
#        r.Install('usbcam.usermap','%(sysconfdir)s/hotplug/usb/usbcam.usermap')
#        r.Install('usbcam.console','%(sysconfdir)s/hotplug/usb/usbcam',
#                  mode=0755)
