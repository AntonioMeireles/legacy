#
# Copyright (c) 2010 Foresight Linux
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

class Nexus(PackageRecipe):
    name = 'nexus'
    version = '4.10.2.16'
 
    buildRequires = ['atk:devel', 'desktop-file-utils:runtime', 'expat:devel', 'glib:devel', 'gtk:devel', 'libSM:devel', 'libX11:devel', 'libXext:devel', 'libXinerama:devel', 'libgcc:devellib', 'libgcrypt:devel', 'libidn:devel', 'libpng:devel', 'pango:devel', 'zlib:devel']
 
    def setup(r):
        r.addArchive('LinuxPersonal.tgz')
	r.addSource('nexus.desktop')

	r.macros.personal = '%(destdir)s%(prefix)s/local/lib/personal/'

	r.MakeDirs('%(personal)s/config')
	r.MakeDirs('%(personal)s/icons')
	r.MakeDirs('%(personal)s/lang/sv_SE')

	r.Move('libai.so', '%(destdir)s%(prefix)s/lib/')
	r.Move('libP11.so', '%(destdir)s%(prefix)s/lib/')
	r.Move('libplugins.so', '%(destdir)s%(prefix)s/lib/')
	r.Move('libtokenapi.so', '%(destdir)s%(prefix)s/lib/')
	r.Move('libCardSiemens.so', '%(destdir)s%(prefix)s/lib/')
	r.Move('libCardSetec.so', '%(destdir)s%(prefix)s/lib/')
	r.Move('libCardPrisma.so', '%(destdir)s%(prefix)s/lib/')
	r.Move('personal.bin', '%(personal)s')
	r.Move('personal.sh', '%(personal)s')
	r.Move('persadm', '%(personal)s')
	r.Move('persadm.sh', '%(personal)s')
	r.Move('install.*.sh', '%(personal)s')
	r.Move('Nexus_Personal_Help_EN_US.htm', '%(personal)s')
	r.Move('PersonalUbuntu_ReadMe_EN_US.txt', '%(personal)s')
	r.Move('Nexus_Personal_Help_SE.htm', '%(personal)s')
	r.Move('PersonalUbuntu_ReadMe_SE.txt', '%(personal)s')
	r.Move('Release.txt', '%(personal)s')
	r.Move('libBranding.so', '%(personal)s')
	r.Move('Personal.cfg', '%(personal)s/config/')
	r.Move('nexus_logo_32x32.png', '%(personal)s/icons/')
	r.Move('personal.mo', '%(personal)s/lang/sv_SE/')
	
	# r.Symlink('%(personal)s/libai.so', '%(destdir)s%(prefix)s/lib/libai.so')
	r.Symlink('%(personal)s/libtokenapi.so', '%(destdir)s%(prefix)s/local/lib/libtokenapi.so')
	r.Symlink('%(personal)s/personal.sh', '%(destdir)s%(prefix)s/local/bin/personal')
	r.Symlink('%(personal)s/persadm.sh', '%(destdir)s%(prefix)s/local/bin/persadm')

	#install plugin for FF3
	r.Symlink('%(personal)s/libplugins.so', '%(libdir)s/xulrunner-1.9.2/plugins/libplugins.so')

	r.Desktopfile('nexus.desktop')
	r.DanglingSymlinks(exceptions='%(libdir)s/xulrunner-1.9.2/plugins/')
	r.DanglingSymlinks(exceptions='%(prefix)s/local/bin/')
	r.DanglingSymlinks(exceptions='%(prefix)s/local/lib/')
	
	r.CheckDestDir(exceptions='%(libdir)s/xulrunner-1.9.2/plugins/')
	r.CheckDestDir(exceptions='%(prefix)s/local/bin/')
	r.CheckDestDir(exceptions='%(prefix)s/local/lib/')
	r.FixupMultilibPaths(exceptions='.*')

	r.addSource('libstdc++.so.6.0.12', dest='/opt/%(name)s/')
        r.addSource('libgcc_s-4.4.1-20090729.so.1', dest='/opt/%(name)s/')
        r.Symlink('/opt/%(name)s/libstdc++.so.6.0.12', '/opt/%(name)s/libstdc++.so.6')
        r.Symlink('/opt/%(name)s/libgcc_s-4.4.1-20090729.so.1', '/opt/%(name)s/libgcc_s.so.1')

        for x in [ 'libgcc', 'libstdc\+\+']:
            r.Requires(exceptDeps='soname:\ ELF32.*%s.*' % x )
            r.Provides(exceptDeps='soname:\ ELF32.*%s.*' % x)

