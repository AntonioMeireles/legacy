loadInstalled('python')

class IOTop(CPackageRecipe):
    name = 'iotop'
    version = '0.2'
    buildRequires = [ 'python:devel', 'python-setuptools:python' ]

    def setup(r):
        r.macros.sitepkgs = Python.sitepkgs
        r.macros.pyinc = '%(includedir)s/python' + Python.majversion
        r.addArchive('http://guichaz.free.fr/iotop/files/')
        r.addSource('http://git.sipsolutions.net/?p=pynl80211.git;a=blob_plain;f=netlink.c;hb=HEAD', dest='_netlink.c')
        r.Replace('sys/types.h', 'linux/types.h', '_netlink.c')
        r.Replace('python25 = False', 'python25 = True', 'iotop/data.py')
        r.Run('gcc -shared -fPIC -I%(pyinc)s -o _netlinkmodule.so _netlink.c')
        r.Install('_netlinkmodule.so', '%(sitepkgs)s/')
        r.PythonSetup()
