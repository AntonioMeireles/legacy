#
# Copyright (c) 2007-2008 rPath, Inc.
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

class OpenIscsi(CPackageRecipe):
    name = 'open-iscsi'
    version = '2.0_865'

    buildRequires = [ 'chkconfig:runtime', ]

    def setup(r):
        r.macros.version = r.macros.version.replace('_', '-')
        r.addArchive('http://www.open-iscsi.org/bits/')
        r.addSource('open-iscsi.init')
        r.Make(dir='usr')
        r.Make(dir='utils')
        r.MakeDirs('%(essentialsbindir)s', '%(mandir)s/man8',
                   '%(initdir)s', '%(localstatedir)s/lock/iscsi')
        r.Install('usr/iscsi{d,adm,start}', '%(essentialsbindir)s')
        r.Install('utils/iscsi{_discovery,-iname}', '%(essentialsbindir)s',
                  mode=0744)
        r.Install('doc/*.8', '%(mandir)s/man8')
        r.Install('etc/iscsid.conf', '%(sysconfdir)s/iscsi/')
        r.Install('open-iscsi.init', '%(initdir)s/open-iscsi', mode=0744)
        r.ExcludeDirectories(exceptions='%(localstatedir)s/lock/iscsi')
