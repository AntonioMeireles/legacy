# Antonio Meireles
#
# sbin.reboot.sh

class Beryl(CPackageRecipe):

   name = "beryl"

   version= "060928"

   buildRequires = []


   if Use.bootstrap:
        buildRequires.extend(['glib:devel', 'libICE:devel', 'libSM:devel', 'libX11:devel', 'libXcomposite:devel', 'libXdamage:devel', 'libXext:devel', 'libXfixes:devel', 'libXinerama:devellib', 'libXrandr:devel', 'libXrender:devel', 'libpng:devel', 'pkgconfig:devel', 'startup-notification:devel', 'Mesa:devel', 'makedepend:runtime'
                  ])
   else:

       buildRequires.extend( ['atk:devel', 'cairo:devel', 'dbus-glib:devel', 'dbus:devel', 'desktop-file-utils:runtime', 'expat:devel', 'fontconfig:devel', 'freetype:devel', 'gettext:runtime', 'glib:devel', 'gtk:devel', 'gtk:runtime', 'libICE:devel', 'libSM:devel', 'libX11:devel', 'libXau:devel', 'libXcomposite:devel', 'libXdamage:devel', 'libXdmcp:devel', 'libXext:devel', 'libXfixes:devel', 'libXinerama:devellib', 'libXrandr:devel', 'libXrender:devel', 'libpng:devel', 'librsvg:devel', 'libwnck:devel', 'pango:devel', 'perl:runtime', 'pkgconfig:devel', 'shared-mime-info:runtime', 'startup-notification:devel', 'zlib:devel'])


   def setup(r):

#      r.addSource('compizrc')

        r.macros.mflags = ''

        r.addArchive('%(name)s-%(version)s.tar.bz2',
                     dir='%(name)s-%(version)s')

        if Use.bootstrap:
             r.Configure('--prefix=%(prefix)s', configureName='./autogen.sh', dir='beryl-core' )
             r.Make('', dir='beryl-core', preMake="CFLAGS='-L/usr/lib -lGL'")
             r.MakeInstall(dir='beryl-core', package='beryl-core')

             r.PackageSpec('beryl-core', '%(docdir)s/.*', '%(mandir)s/.*')

        else:
             r.Configure(configureName='./autogen.sh', dir='beryl-plugins' )
             r.Make(dir='beryl-plugins')
             r.MakeInstall(dir='beryl-plugins')

             r.Configure(configureName='./autogen.sh', dir='beryl-settings' )
             r.Make(dir='beryl-settings')
             r.MakeInstall(dir='beryl-settings')

             r.Configure(configureName='./autogen.sh', dir='beryl-manager' )
             r.Make(dir='beryl-manager')
             r.MakeInstall(dir='beryl-manager')

             r.Configure(configureName='./autogen.sh --disable-mime-update', 
                         dir='emerald' )
             r.Make(preMake=' GCONF_DISABLE_MAKEFILE_SCHEMA_INSTALL=1 ',
                    dir='emerald')
             r.MakeInstall(dir='emerald')

             r.Configure(configureName='./autogen.sh', dir='emerald-themes' )
             r.Make(dir='emerald-themes')
             r.MakeInstall(dir='emerald-themes')

             r.Configure(configureName='./autogen.sh', dir='xorg-sched-yield-hack')
             r.Make(dir='xorg-sched-yield-hack')
             r.MakeInstall(dir='xorg-sched-yield-hack')

             r.SharedLibrary(subtrees='%(libdir)s/beryl')
             r.SharedLibrary(subtrees='%(libdir)s/emerald/engines')

             r.SetModes('%(datadir)s/emerald/themes/Scaled Black Mod/*', 0644)
