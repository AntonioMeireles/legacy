#
# Copyright (c) 2009 Foresight Linux
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

class Mpd(CPackageRecipe):
    name = 'mpd'
    version = '0.16.5'
 
    buildRequires = [
		'alsa-lib:devel', 
		'audiofile:devel', 
		'avahi-glib:devel', 
		'avahi:devel', 
		'curl:devel', 
		'faad2:devel', 
		'flac:devel', 
		'gcc-c++:runtime', 
		'glib:devel', 
		'jack:devel', 
		'lame:devel', 
		'libao:devel', 
		'libid3tag:devel', 
		'libmad:devel', 
		'libmms:devel', 
		'libmodplug:devel', 
		'libogg:devel', 
		'libsamplerate:devel', 
		'libshout:devel', 
		'libstdc++:devel', 
		'libtheora:devel', 
		'libvorbis:devel', 
		'openssl:devel', 
		'pkgconfig:devel', 
		'pulseaudio:devel', 
		'speex:devel', 
		'sqlite:devel', 
		'zlib:devel', 
		'ffmpeg:devel', 
		'libmpcdec:devel', 
		'wavpack:devel',
		'libcue:devel', 
		'fluidsynth:devel', 
		'libcdio:devel', 
		'libmikmod:devel', 
		'wildmidi:devel', 
		'zziplib:devel',
		'gpac:devellib',
		'chkconfig:runtime',
		'valgrind:devel'
		]
 
    def setup(r):
        r.addArchive('http://downloads.sourceforge.net/project/musicpd/mpd/%(version)s/mpd-%(version)s.tar.gz')
    	r.Configure('--enable-mikmod --enable-bzip2 --enable-zip --enable-shout --enable-wildmidi --enable-fluidsynth --enable-iso9660 --enable-lastfm')
    	r.Make()
    	r.MakeInstall()
    	r.addSource('mpd.init')
    	r.Move('mpd.init', '%(initdir)s/mpd', mode = 0755)
    	r.addSource('mpd.conf', macros=True, dest='%(sysconfdir)s/mpd.conf')
    	r.Replace(('@var@', '%(localstatedir)s'), ('@bindir@', '%(bindir)s'), '%(initdir)s/mpd')

    	r.Create('%(localstatedir)s/lib/mpd/mpd.log')
    	r.Create('%(localstatedir)s/lib/mpd/mpd.error')
    	r.Create('%(localstatedir)s/lib/mpd/mpd.db')
    	r.Create('%(localstatedir)s/lib/mpd/mpdstate')
    	r.MakeDirs('%(localstatedir)s/lib/mpd/playlists')
    	r.MakeDirs('%(localstatedir)s/lib/mpd/music')
    	r.ExcludeDirectories(exceptions='%(localstatedir)s/lib/mpd/playlists')
    	r.ExcludeDirectories(exceptions='%(localstatedir)s/lib/mpd/music')
        r.UtilizeUser('mpd', '%(initdir)s/mpd')

	    #r.InitialContents('%(sysconfdir)s/mpd.conf')
