class MPlayer(CPackageRecipe):
    name = 'mplayer'
    version = '1.0r21812'

    buildRequires = [ 'alsa-lib:devel', 'arts:devel', 'audiofile:devel',
        'cdparanoia:devel', 'esound:devel', 'fontconfig:devel',
        'freetype:devel', 'glib:devel', 'lame:devel', 'libdv:devel',
        'libjpeg:devel', 'libmad:devel', 'libogg:devel', 'libpng:devel',
        'libtermcap:devel', 'libtheora:devel',
        'libvorbis:devel', 'lzo:devel', 'samba:devel', 'SDL:devel',
        'zlib:devel', 'nas:devel', 'Mesa:devel', 'faac:devel',
        'fribidi:devel', 'giflib:devel', 'jack:devel', 'libX11:devel',
        'libXext:devel', 'libXinerama:devellib', 'libXt:devel',
        'libXv:devel', 'libXxf86dga:devel', 'libXxf86vm:devel',
        'libdvdnav:devel', 'ncurses:devel', 'speex:devel', 'atk:devel',
        'cairo:devel', 'desktop-file-utils:config', 'gtk:devel',
        'libXrender:devel', 'libXvMC:devel', 'pango:devel' ]
    # for CVS snaps, also need libavcodec:devel

    Flags.generic = True
    Flags.generic.setShortDoc('build a version to run everywhere')

    def setup(r):
        r.addSvnSnapshot('svn://svn.mplayerhq.hu/mplayer/trunk')

        if Arch.x86_64:
            r.macros.archenv = 'host_arch=x86_64  proc=x86_64  iproc=x86_64'
            r.macros.extraconf = ''
        else:
            r.macros.archenv = 'host_arch=i386  proc=i686  iproc=686'
            r.macros.extraconf = '--enable-win32 --enable-qtx'


        # mplayer's configure script does not accept a number of standard
        # configure arguments...
        r.ManualConfigure('--prefix=%(prefix)s --bindir=%(bindir)s',
                          '--datadir=%(datadir)s --libdir=%(libdir)s',
                          '--mandir=%(mandir)s --confdir=%(sysconfdir)s',
                          '--enable-gui --enable-largefiles --enable-joystick',
                          '--enable-menu --enable-dynamic-plugins --language=all',
                          '--enable-faad-external --enable-runtime-cpudetection',
                          '--enable-xvmc --with-xvmclib=XvMCW %(extraconf)s',  
 
                          preConfigure='CFLAGS="%(cflags)s" CXXFLAGS="%(cflags)s" %(archenv)s')

        r.Make()
        r.MakeInstall()

        r.Install('etc/codecs.conf', '%(sysconfdir)s/')
        r.ComponentSpec('runtime', '%(libdir)s/mplayer/')
        r.Requires('MPlayer-codecs:runtime', '%(bindir)s/mplayer')
