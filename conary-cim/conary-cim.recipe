# Copyright (c) 2008-2009 rPath, Inc.
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

class ConaryCim(PackageRecipe):
    name = 'conary-cim'
    version = '2.0.1'

    buildRequires = [
        # For the tag handler
        'chkconfig:runtime',
        'cmpi-bindings:python',
        'make:runtime',
        'python:devel',
        'python:lib',
        'pywbem:python',
        # Rebooting
        'sblim-cmpi-base:lib',
        # For the tag handler
        'sblim-sfcb:runtime',
        # We need a schema
        'sblim-sfcb-schema:data',
    ]

    def setup(r):
        r.addMercurialSnapshot('http://scc.eng.rpath.com/products/%(name)s/trunk/%(name)s', tag='%(name)s-%(version)s')

        r.MakeInstall()

        r.TagSpec("config", "sfcb.cfg")

        r.ComponentSpec("lib", r".*\.mof")
        r.ComponentSpec("lib", r".*\.registration")
        r.ComponentSpec("lib", r".*\.sh")
        r.ComponentSpec("lib", r"sfcb\.cfg")

        r.ExcludeDirectories(exceptions = "%(localstatedir)s/lib/%(name)s.*")

        # We can't do much with these python files unless we have the CMPI
        # bindings available
        r.Requires("cmpi-bindings:python", "RPATH_.*\.py")
        # The schema is not pulled in by anything, since we're not sure what
        # to get
        r.Requires("sblim-sfcb-schema:data", "RPATH_.*\.py")

        # Configuration related stuff goes into a different package
        r.PackageSpec("%(name)s-configuration",
            ".*RPATH_Configuration.*",
            "config_manager.*")
