#
# Copyright (c) 2007-2008 rPath Inc.
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

class gnutls(AutoPackageRecipe):
    name = 'gnutls'
    version = '2.10.5'

    packageSummary = 'The GNU Transport Layer Security Library'
    packageDescription = 'GnuTLS is a project that aims to develop a library which provides a secure layer, over a reliable transport layer. Currently the GnuTLS library implements the proposed standards by the IETFs TLS working group.'

    buildRequires = [ 'install-info:runtime', 'libgcrypt:devel',
        'libgpg-error:devel', 'libstdc++:devel', 'lzo:devel', 'net-tools:runtime', 
        'ncurses:devel', 'readline:devel', 'zlib:devel', 'gettext:runtime', 'gtk-doc:runtime', 'guile:devel', 'guile:runtime', 'intltool:runtime', 'libtasn1:devel', 'pkgconfig:devel', ]

    def unpack(r):
        r.addArchive('mirror://gnu/gnutls/', keyid='B565716F')
	r.addSource('libgnutls-config')
        r.macros.ldflags += ' -Wl,--no-add-needed'

        r.addPatch('gnutls-2.10.4-rpath.patch')
        r.addPatch('gnutls-2.8.6-link-libgcrypt.patch')
        r.addPatch('gnutls-2.10.1-handshake-errors.patch')
        
    def configure(r):
        r.Configure(' --with-libtasn1-prefix=%(prefix)s '
                    ' --with-included-libcfg '
                    ' --disable-static '
                    # XXX enabling it brings build issues with gmp
                    ' --disable-guile '
                    )

    def policy(r):
        r.Install('libgnutls-config', '%(bindir)s/')
        r.Install('libgnutls-config', '%(bindir)s/libgnutls-extra-config')

