#
# Copyright (c) 2008 Foresight Linux
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

loadSuperClass('gnomepackage')
loadSuperClass('rpmpackage')
class RhythmBox(RPMPackageRecipe,GnomePackageRecipe):
    name = 'rhythmbox'
    version = '0.11.6'
    rpmRelease = '8.fc10'

    # the _only_ one we can leave without is the soup patch...
    rpmPatches = [
        # https://bugzilla.redhat.com/show_bug.cgi?id=428034
        'rb-disable-power-plugin-by-default.patch',
        # http://bugzilla.gnome.org/show_bug.cgi?id=374078
        # https://bugzilla.redhat.com/show_bug.cgi?id=440668
        'rhythmbox-0.11.5-ipod-vfat.patch',
        # http://bugzilla.gnome.org/show_bug.cgi?id=546962
        # https://bugzilla.redhat.com/show_bug.cgi?id=458388
        'rhythmbox-0.11.6-libmtp-0.3.patch',
        # http://bugzilla.gnome.org/show_bug.cgi?id=545555
        'rb-default-lirc-setup.patch',
        'rhythmbox-0.11.5-xfade-buffering.patch',
        ]
    rpmSources = ['rhythmbox-iradio-initial.pls']

    buildRequires = ['GConf:devel', 'GConf:runtime', 'ORBit2:devel', 'avahi-glib:devel', 'avahi:devel', 'dbus-glib:devel', 'dbus-glib:runtime', 'dbus:devel', 'desktop-file-utils:runtime', 'expat:devel', 'gettext:runtime', 'libgpod:devel', 'libmtp:devel', 'gnome-keyring:devel', 'gnome-media:devel', 'gnome-python:python', 'gnome-vfs:devel', 'gst-plugins-base:devel', 'gstreamer:devel', 'hal:devel', 'libart_lgpl:devel', 'libbonobo:devel', 'libbonoboui:devel', 'libglade:devel', 'libgnome:devel', 'libgnomecanvas:devel', 'libgnomeui:devel', 'libmtp:devel', 'libmusicbrainz:devel', 'libnotify:devel', 'libsexy:devel', 'libsoup:devel', 'libusb:devel', 'libxml2:devel', 'nautilus-cd-burner:devel', 'popt:devel', 'pygobject:python', 'pygtk:devel', 'pygtk:python', 'python:devel', 'rarian:devel', 'rarian:runtime', 'totem:devellib', 'lirc:devel', 'gnome-doc-utils:runtime', 'gnome-doc-utils:devel', 'glitz:devel', 'totem-pl-parser:devel' ]

    docs = ['AUTHORS', 'DOCUMENTERS', 'INTERNALS', 'THANKS' ]

    def unpack(r):
        r.disableParallelMake()
        RPMPackageRecipe.unpack(r)

    def configure(r):
        r.Configure(" --with-ipod --with-dbus --with-mdns=avahi "
                    " --disable-scrollkeeper --enable-tag-writing "
                    " --enable-track-transfer --enable-ipod-writing "
                    " --enable-audioscrobbler --enable-daap "
                    " --enable-libnotify --enable-python --with-cd-burning "
                    " --with-help-formats --enable-mtp --with-metadata-helper --with-gnome-keyring ")


    def policy(r):
        # Replace the default radios with Ogg Radios
        r.Install('rhythmbox-iradio-initial.pls', '%(libdir)s/rhythmbox/plugins/iradio/iradio-initial.pls')

        # install missing artwork image (Gnome BZ#387413)
        r.Install('plugins/artdisplay/rhythmbox-missing-artwork.svg', '%(libdir)s/rhythmbox/plugins/artdisplay/', mode = 0644)
