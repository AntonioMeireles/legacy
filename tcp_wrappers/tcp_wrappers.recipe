#
# Copyright (c) 2004-2005 rPath, Inc.
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

class Tcp_wrappers(CPackageRecipe):

    buildRequires = [ ]
    name = 'tcp_wrappers'
    version = '7.6'

    def setup(r):
        r.mainDir('tcp_wrappers_7.6')

        r.macros.lib_major = '0'
        r.macros.lib_minor = '7'
        r.macros.lib_rel = '6'
        r.macros.cflags += ' -fPIC -DPIC -D_REENTRANT -DHAVE_STRERROR'

        r.addArchive('ftp://coast.cs.purdue.edu/pub/tools/unix/netutils/tcp_wrappers/tcp_wrappers_7.6.tar.gz', keyid='D5327CB9')

        srpm = 'ftp://ftp.redhat.com/pub/redhat/linux/enterprise/3/en/os/i386/SRPMS/tcp_wrappers-%(version)s-34.src.rpm'
        for patch, level in (
            ('tcpw7.2-config', 1),
            ('tcpw7.2-setenv', 1),
            ('tcpw7.6-netgroup', 1),
            ('tcp_wrappers-7.6-bug11881', 1),
            ('tcp_wrappers-7.6-bug17795', 1),
            ('tcp_wrappers-7.6-bug17847', 1),
            ('tcp_wrappers-7.6-fixgethostbyname', 1),
            ('tcp_wrappers-7.6-docu', 1),
            ('tcp_wrappers.usagi-ipv6', 0),
            ('tcp_wrappers.ume-ipv6', 1),
            ('tcp_wrappers-7.6-shared', 1),
            ('tcp_wrappers-7.6-sig', 1),
            ('tcp_wrappers-7.6-strerror', 1)):
             r.addPatch(patch + '.patch', rpm=srpm, level=level)


        r.Make('MAJOR=%(lib_major)s MINOR=%(lib_minor)s '
                  ' REL=%(lib_rel)s linux')

        r.MakeDirs('%(includedir)s')
        r.MakeDirs('%(libdir)s')
        r.Install('hosts_access.3', '%(mandir)s/man3/')
        r.Install('hosts_access.5', 'hosts_options.5',
                          '%(mandir)s/man5/')
        r.Install('tcpd.8', '%(mandir)s/man8/')
        r.Symlink('hosts_access.5', '%(mandir)s/man5/hosts.allow.5')
        r.Symlink('hosts_access.5', '%(mandir)s/man5/hosts.deny.5')
        r.Install('libwrap.a', '%(libdir)s/')
        r.Install('libwrap.so.0.%(version)s', '%(libdir)s/')
        r.Symlink('libwrap.so.0.%(version)s',
                             '%(libdir)s/libwrap.so.0')
        r.Symlink('libwrap.so.0.%(version)s',
                             '%(libdir)s/libwrap.so')
        r.Install('tcpd.h',  '%(includedir)s/')
        r.Install('safe_finger', '%(sbindir)s/', mode=0755)
        r.Install('tcpd', '%(sbindir)s/', mode=0755)
        r.Install('try-from', '%(sbindir)s/', mode=0755)

        r.AutoDoc('BLURB', 'DISCLAIMER', 'Banners.Makefile')
