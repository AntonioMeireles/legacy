#
# Copyright (c) 2004-2007 rPath, Inc.
#               2012-2013 The Foresight Linux Project
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

class Gettext(CPackageRecipe):
    name = 'gettext'
    version = '0.18.2.1'

    # needs info-file tag description from the install-info package
    # texlive and emacs will create a build req loop
    buildRequires = [ 'install-info:runtime', 'libstdc++:devel',
                      'perl:runtime', 'texinfo:runtime', 'zlib:devel',
                      'bison:runtime', 'acl:devel', 'libgomp:devellib',
                      'glib:devel', 'intltool:runtime', 'libcroco:devel',
                      'ncurses:devel', 'python:devel', 'emacs:runtime', ]

    def setup(r):
        r.addArchive('http://ftp.gnu.org/gnu/gettext/')

        r.addSource('msghack.py')

        r.Configure(' --without-included-gettext --enable-nls'
                    ' --disable-java --disable-native-java'
                    ' --with-pic --disable-csharp --disable-rpath ')
        r.Make()

        r.MakeInstall(' lispdir=%(datadir)s/emacs/site-lisp/gettext'
                      ' aclocaldir=%(datadir)s/aclocal'
                      ' EXAMPLESFILES="" ')
        r.Move('%(bindir)s/gettext', '%(essentialbindir)s/')

        r.Symlink('%(essentialbindir)s/gettext', '%(bindir)s/gettext')

        r.Install('msghack.py', '%(bindir)s/msghack', mode=0755)

        r.Move('%(datadir)s/emacs/site-lisp/gettext/start-po.el',
               '%(datadir)s/emacs/site-lisp/site-start.d/')

        r.Remove('/usr/doc', '%(datadir)s/doc/gettext/{javadoc,examples}/',
                 recursive=True)
        r.AutoDoc(exceptions = 'gettext-tools/examples/.*')

        r.Remove('%(libdir)s/libintl.{,l}a',
                 '%(datadir)s/locale/locale.alias')
        r.Remove('%(datadir)s/gettext/javaversion.class')

        r.ExcludeDirectories(exceptions='%(datadir)s/locale/en@boldquot(/LC_MESSAGES)?')
        r.ExcludeDirectories(exceptions='%(datadir)s/locale/en@quot(/LC_MESSAGES)?')
