commit e71044ee2efa4792e21d243b03d49006db66aec9
Author: Michal Schmidt <mschmidt@redhat.com>
Date:   Thu Sep 3 14:27:08 2009 +0200

    [SCSI] sg: fix oops in the error path in sg_build_indirect()
    
    When the allocation fails in sg_build_indirect(), an oops happens in
    the error path. It's caused by an obvious typo.
    
    Signed-off-by: Michal Schmidt <mschmidt@redhat.com>
    Reported-by: Bob Tracy <rct@gherkin.frus.com>
    Acked-by: Douglas Gilbert <dgilbert@interlog.com>
    Cc: Stable Tree <stable@kernel.org>
    Signed-off-by: James Bottomley <James.Bottomley@suse.de>

diff --git a/drivers/scsi/sg.c b/drivers/scsi/sg.c
index 9230402..4968c4c 100644
--- a/drivers/scsi/sg.c
+++ b/drivers/scsi/sg.c
@@ -1811,7 +1811,7 @@ retry:
 	return 0;
 out:
 	for (i = 0; i < k; i++)
-		__free_pages(schp->pages[k], order);
+		__free_pages(schp->pages[i], order);
 
 	if (--order >= 0)
 		goto retry;
