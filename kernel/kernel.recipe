#
# Copyright (c) 2005-2008 rPath, Inc.
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#
loadInstalled('python')
loadSuperClass('kernelpackage')
class Kernel(KernelPackageRecipe):

    name = 'kernel'
    version = '2.6.27.10'

    def unpack(r):
        r.addPatch('linux-2.6-upstream-reverts.patch', extraArgs='-R')
        r.addPatch('git-cpufreq.patch')
        r.addPatch('linux-2.6-x86-mtrr-kill-bogus-warning.patch')
        r.addPatch('linux-2.6-x86-pci-amd-config-space.patch')
        r.addPatch('linux-2.6-sysrq-c.patch')
        r.addPatch('linux-2.6-sched-fine-tune-SD_MC_INIT.patch')
        r.addPatch('linux-2.6-sched-fine-tune-SD_SIBLING_INIT.patch')
        r.addPatch('linux-2.6-sched-wakeup-preempt-when-small-overlap.patch')
        r.addPatch('linux-2.6.27-ext4-rename-ext4dev-to-ext4.patch')
        r.addPatch('linux-2.6-usb-ehci-hcd-respect-nousb.patch')
        r.addPatch('linux-2.6-crypto-fips_enable.patch')
        r.addPatch('linux-2.6-defaults-acpi-video.patch')
        r.addPatch('linux-2.6-acpi-video-dos.patch')
        r.addPatch('linux-2.6-acpi-handle-ec-init-failure.patch')
        r.addPatch('linux-2.6-acpi-dock-fix-eject-request-process.patch')
        r.addPatch('linux-2.6-crash-driver.patch')
        r.addPatch('linux-2.6-defaults-pci_no_msi.patch')
        r.addPatch('linux-2.6-pciehp-update.patch')
        r.addPatch('linux-2.6-defaults-pciehp.patch')
        r.addPatch('linux-2.6-scsi-cpqarray-set-master.patch')
        r.addPatch('linux-2.6.27.9-alsa-driver-1.0.18a.patch')
        r.addPatch('linux-2.6.27.7-alsa-driver-fixups.patch')
        r.addPatch('linux-2.6.27.9-alsa-hda-add-a-quirk-for-dell-studio-15.patch')
        r.addPatch('linux-2.6.27.9-alsa-hda-no-headphone-as-line-out-swich-without-line-outs.patch')
        r.addPatch('linux-2.6.27.9-alsa-hda-mark-dell-studio-1535-quirk.patch')
        r.addPatch('linux-2.6-alsa-backport-beep-switch.patch')
        r.addPatch('linux-2.6-defaults-alsa-hda-beep-off.patch')
        r.addPatch('linux-2.6-alsa-hda-stac-dell-m6-eapd.patch')
        r.addPatch('linux-2.6-alsa-hda-revert-remove-unneeded-hp-nid-references.patch')
        r.addPatch('linux-2.6-alsa-hda-remove-broken-headphone-control-for-dell-laptops.patch')
        r.addPatch('linux-2.6-squashfs.patch')
        r.addPatch('linux-2.6-net-silence-noisy-printks.patch')
        r.addPatch('linux-2.6-input-kill-stupid-messages.patch')
        r.addPatch('linux-2.6.27-hwmon-applesmc-2.6.28.patch')
        r.addPatch('linux-2.6-input.git-i8042-add-xps-m1530-to-nomux.patch')
        r.addPatch('linux-2.6-serial-460800.patch')
        r.addPatch('linux-2.6-silence-noise.patch')
        r.addPatch('linux-2.6-iwlagn-downgrade-BUG_ON-in-interrupt.patch')
        r.addPatch('linux-2.6-iwl3945-ibss-tsf-fix.patch')
        r.addPatch('linux-2.6-wireless-ath9k-dma-fixes.patch')
        r.addPatch('linux-2.6-iwlwifi-use-GFP_KERNEL-to-allocate-Rx-SKB-memory.patch')
        r.addPatch('linux-2.6-at76.patch')
        r.addPatch('linux-2.6-nfs-client-mounts-hang.patch')
        r.addPatch('linux-2.6-uvc-hg.patch')
        r.addPatch('linux-2.6-uvc-spca525.patch')
        r.addPatch('linux-2.6-gspca-vc0321-fix-frame-overflow.patch')
        r.addPatch('linux-2.6-default-mmf_dump_elf_headers.patch')
        r.addPatch('linux-2.6.27-lirc.patch')
        r.addPatch('linux-2.6-hdpvr.patch')
        r.addPatch('linux-2.6-cdrom-door-status.patch')
        r.addPatch('linux-2.6-e1000-ich9.patch')
        r.addPatch('linux-2.6-e1000e-add-support-for-the-82567LM-4-device.patch')
        r.addPatch('linux-2.6-e1000e-add-support-for-82567LM-3-and-82567LF-3-ICH10D-parts.patch')
        r.addPatch('linux-2.6-e1000e-add-support-for-new-82574L-part.patch')
        r.addPatch('linux-2.6-netdev-r8169-2.6.28.patch')
        r.addPatch('linux-2.6-eeepc-laptop-update.patch')
        r.addPatch('linux-2.6-toshiba-acpi-update.patch')
        r.addPatch('linux-2.6-netdev-atl2.patch')
        r.addPatch('linux-2.6-net-tulip-interrupt.patch')
        r.addPatch('linux-2.6-net-qla-silence-debug-printks.patch')
        r.addPatch('linux-2.6-olpc-touchpad.patch')
        r.addPatch('linux-2.6-quieter-mmc.patch')
        r.addPatch('nvidia-agp.patch')
        r.addPatch('drm-next.patch')
        r.addPatch('drm-modesetting-radeon.patch')
        r.addPatch('drm-nouveau.patch')
        r.addPatch('drm-intel-8xx-pae-no-gem.patch')
        r.addPatch('drm-fix-master-enable.patch')
        r.addPatch('linux-2.6-firewire-git-update.patch')
        r.addPatch('linux-2.6-firewire-git-pending.patch')
        r.addPatch('linux-2.6-merge-efifb-imacfb.patch')
        r.addPatch('linux-2.6-dmi-autoload.patch')
        r.addPatch('linux-2.6-piix3-silence-quirk.patch')
        r.addPatch('linux-2.6-quiet-iommu.patch')
        r.addPatch('linux-2.6-silence-acpi-blacklist.patch')
        r.addPatch('linux-2.6-amd64-yes-i-know-you-live.patch')
        r.addPatch('linux-2.6.27-pci-hush-allocation-failures.patch')
        r.addPatch('linux-2.6-pci-fix-pciehp-irq0.patch')
        r.addPatch('linux-2.6-pciehp-kill-annoying-messages.patch')
        r.addPatch('disable-p4-cpufreq-ui.patch')
        r.addPatch('linux-2.6-open-vm-tools.patch')
        r.addPatch('0001-superreadahead-patch.patch')

    def build(r):
        r.Remove('/lib/firmware', recursive=True)

    def policy(r):
        # we don't want spurious deps on py24 in :build-tree as it will create odd
        # chroots when building external kmods with consequent assorted breackage
        r.macros.pyver = Python.majversion
        pybin = '%(bindir)s/python%(pyver)s'
        r.NormalizePythonInterpreterVersion(versionMap=(
                ('%(bindir)s/python2.4', pybin),
                ('%(bindir)s/python2.5', pybin),
                ('%(bindir)s/python', pybin),
                ))
