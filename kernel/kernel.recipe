#
# Copyright (c) 2005-2008 rPath, Inc.
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

loadSuperClass('kernelpackage.recipe')
class Kernel(KernelPackageRecipe):

    name = 'kernel'
    version = '2.6.26.5'

    def unpack(r):
        r.addPatch('vmware_mptbase_workaround.patch')
        r.addPatch('linux-2.6-open-vm-tools.patch')
        r.addPatch('no-generic-nopls-2.6.24.7.patch')

    def build(r):
        r.Run('for i in $(find %(destdir)s | grep drivers\/ata); '
              'do if [ $(nm $i |grep --count ata_pci_remove_one) -ne 0 ]; '
              'then basename `echo $i` ;fi ; done | grep -v sata | '
              'grep -v pdc_adma | sort >> modules.libata')
        r.Install('modules.libata', '/lib/modules/%(kver)s/modules.libata')
