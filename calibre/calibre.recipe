#
# Copyright (c) 2009 Foresight Linux
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

class PythonCalibre(PackageRecipe):
    name = 'calibre'
    version = '0.5.0'

    buildRequires = [
        'bzr:python',
        'dbus-python:python',
        'gcc-c++:runtime',
        'gcc:devel',
        'gcc:runtime',
        'help2man:runtime',
        'libusb:devel',
        'lxml:python',
        'make:runtime',
        'mod_python:python',
        'mx:python',
        'PIL:python',
        'PyQt4:python',
        'PyQt4:runtime',
        'python-cssutils:python',
        'python-dateutil:python',
        'python:devel',
        'python-mechanize:python',
        'python-setuptools:python',
        'sip:devel',
        'sip:runtime',
        'qt4:devel',
        'xdg-utils:runtime',
    ]

    def setup(r):
        r.addArchive('http://calibre.kovidgoyal.net/downloads/')
        # Force the use of qmake-qt4
        r.Replace('qmake', 'qmake-qt4', 'pyqtdistutils.py')
        # Don't execute calibre_postinstall
        r.Replace(r"subprocess\.check_call\('calibre_postinstall',",
                   "pass # subprocess.check_call('calibre_postinstall',",
                   "setup.py")
        # We already package cssutils
        r.Remove("src/cssutils", "src/encutils", recursive = True)
        r.PythonSetup()
