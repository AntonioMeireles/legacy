#
# Copyright (c) 2004-2008 rPath, Inc.
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

import datetime

class Dist(GroupRecipe):
    name = 'group-dist'
    version = datetime.date.today().strftime("%Y%m%d")

    depCheck = True
    checkOnlyByDefaultDeps = True
    Flags.devel = True
    checkPathConflicts=True

    def startGroup(r, name, parentGroup, depCheck=False, byDefault=True,
                   checkPathConflicts=None, excludeComponents=True):
        # creates group named "name", adds it to the toplevel group,
        # and sets the current group to that name.  calls to r.add()
        # will use the current group by default.

        # note: byDefault applies to whether the group is included by
        # default in its parent group, not whether the troves in
        # the group are added by default. (use the setByDefault() command
        # to get that)

        r.setDefaultGroup(parentGroup)
        r.createGroup(name, autoResolve=False, depCheck=depCheck,
                      byDefault=True, checkPathConflicts=checkPathConflicts)
        r.addNewGroup(name, groupName=parentGroup, byDefault=byDefault)
        r.setDefaultGroup(name)
        if excludeComponents and not Flags.devel:
            r.removeComponents(['devel', 'devellib'])

    def setup(r):
        # "groupLabel" is actually is for kernel logic
        groupLabel= 'conary.rpath.com@rpl:2'
        xenLabel='conary.rpath.com@rpl:2-xen-devel'
        r.setSearchPath(r.macros.buildlabel, groupLabel)

        if Arch.x86:
            glibcFlavor32 = None # needed so we can control addition of troves with use=
            opensslFlavor = 'is: x86(i486,i586,i686)'
            if Use.xen:
                glibcFlavor = 'xen is: x86(i486,i586,i686)'
                kernelLabel = xenLabel
                if Use.dom0:
                    if Use.domU:
                        print "This recipe may be built with dom0 or domU, but cannot use both.\n"
                        sys.exit(1)
                    kernelFlavor = 'xen,dom0,kernel.smp,kernel.pae is: x86(i486,i586,i686)'
                    kernelFlavorPAE = None
                    mkinitrdFlavor = '!xen,!domU'
                    releaseFlavor = 'xen,dom0'
                if Use.domU:
                    kernelFlavor = 'xen,domU,kernel.smp,kernel.pae is: x86(i486,i586,i686)'
                    kernelFlavorPAE = None
                    mkinitrdFlavor = 'xen,domU'
                    releaseFlavor = 'xen,domU'
            elif Use.vmware:
                glibcFlavor = 'is: x86(i486,i586,i686)'
                kernelFlavor = 'kernel.smp,!kernel.pae is: x86(i486,i586,i686)'
                kernelFlavorPAE = None
                kernelLabel = groupLabel
                mkinitrdFlavor = '!xen,!domU'
                releaseFlavor = 'vmware'
            else:
                glibcFlavor = 'is: x86(i486,i586,i686)'
                kernelFlavor = 'kernel.smp,!kernel.pae is: x86(i486,i586,i686)'
                kernelFlavorPAE = 'kernel.smp,kernel.pae is: x86(i486,i586,i686)'
                kernelLabel = groupLabel
                mkinitrdFlavor = '!xen,!domU'
                releaseFlavor = None
        elif Arch.x86_64:
            kernelFlavorPAE = None
            opensslFlavor = None
            opensslFlavor32 = 'is: x86(i486,i586,i686)'
            if Use.xen:
                glibcFlavor = None
                glibcFlavor32 = 'xen is: x86(i486,i586,i686)'
                kernelLabel = xenLabel
                if Use.dom0:
                    if Use.domU:
                        print "This recipe may be built with dom0 or domU, but cannot use both.\n"
                        sys.exit(1)
                    kernelFlavor = 'xen,dom0,kernel.smp'
                    mkinitrdFlavor = '!xen,!domU'
                    releaseFlavor = 'xen,dom0'
                if Use.domU:
                    kernelFlavor = 'xen,domU,kernel.smp'
                    mkinitrdFlavor = 'xen,domU'
                    releaseFlavor = 'xen,domU'
            elif Use.vmware:
                glibcFlavor = None
                glibcFlavor32 = 'is: x86(i486,i586,i686)'
                kernelFlavor = 'kernel.smp'
                kernelLabel = groupLabel
                mkinitrdFlavor = '!xen,!domU'
                releaseFlavor = 'vmware'
            else:
                glibcFlavor = None
                glibcFlavor32 = 'is: x86(i486,i586,i686)'
                kernelFlavor = 'kernel.smp'
                kernelFlavorPAE = None
                kernelLabel = groupLabel
                mkinitrdFlavor = '!xen,!domU'
                releaseFlavor = None

        # turn off checkPathConflicts bc not everything in group-os can/should
        # coexist on the same system
        r.createGroup('group-os', checkPathConflicts=False, depCheck=True)
        r.addNewGroup('group-dist', groupName='group-os')

        # Group appliance platform
        r.startGroup('group-appliance-platform', parentGroup='group-dist', depCheck=True)
        r.add('device-mapper:lib')
        r.add('lvm2:runtime')
        r.add('acpid:config')
        r.add('acpid:runtime')
        r.add('ConfigObj:python')
        r.add('curl:lib')
        r.add('crontabs:config')
        r.add('crontabs:runtime')
        r.add('dmidecode:runtime')
        r.add('ethtool:runtime')
        r.add('info-nobody')
        r.add('info-ntp')
        r.add('info-rpc')
        r.add('info-rpcuser')
        r.add('libelf:lib', source='elfutils')
        r.add('libevent:lib')
        r.add('libgssapi:lib')
        r.add('libnfsidmap:lib')
        r.add('librpcsecgss:lib')
        r.add('libusb:lib')
        r.add('lm_sensors:config')
        r.add('lm_sensors:lib')
        r.add('logrotate:config')
        r.add('logrotate:lib')
        r.add('logrotate:runtime')
        r.add('net-snmp:data')
        r.add('net-snmp:lib')
        r.add('net-snmp:runtime')
        r.add('newt:lib')
        r.add('newt:python')
        r.add('nfs-client:runtime', source='nfs-utils')
        r.add('nfs-utils:config')
        r.add('nfs-utils:runtime')
        r.add('ntp:config', use=(not Use.domU))
        r.add('ntp:runtime', use=(not Use.domU))
        r.add('openldap:config')
        r.add('openldap:lib')
        r.add('openssl:runtime')
        r.add('pciutils:runtime')
        r.add('perl:runtime')
        r.add('perl:lib')
        r.add('perl:perl')
        r.add('portmap:runtime')
        r.add('sdparm:runtime')
        r.add('tcp_wrappers:lib')
        r.add('usbutils:data')
        r.add('usbutils:runtime')
        r.add('vixie-cron:config')
        r.add('vixie-cron:runtime')
        r.add('w3c-libwww:data')
        r.add('w3c-libwww:lib')

        # Formerly group-bootable
        r.add('acl:lib')
        r.add('acl:runtime')
        r.add('ash:runtime')
        r.add('attr:lib')
        r.add('attr:runtime')
        r.add('audit:config')
        r.add('audit:lib')
        r.add('authconfig:config')
        r.add('authconfig:runtime')
        r.add('authconfig:python')
        r.add('bash:config')
        r.add('bash:runtime')
        r.add('bootman:config')
        r.add('bootman:lib')
        r.add('bootman:python')
        r.add('bootman:runtime')
        r.add('bridge-utils:runtime', use=(Use.xen and Use.dom0))
        r.add('bzip2:lib')
        r.add('bzip2:runtime')
        r.add('chkconfig:runtime')
        r.add('coreutils:config')
        r.add('coreutils:runtime')
        r.add('cpio:runtime')
        r.add('cracklib:data')
        r.add('cracklib:lib')
        r.add('cyrus-sasl:config')
        r.add('cyrus-sasl:lib')
        r.add('db:lib')
        r.add('device-mapper:lib')
        r.add('device-mapper:runtime')
        r.add('dev:runtime', source='MAKEDEV')
        r.add('dhclient:lib', source='dhcp')
        r.add('dhclient:runtime', source='dhcp')
        r.add('diffutils:runtime')
        r.add('distro-boot-config')
        r.add('distro-conary-config', flavor=releaseFlavor)
        r.add('distro-release')
        r.add('e2fsprogs:config')
        r.add('e2fsprogs:data')
        r.add('e2fsprogs:lib')
        r.add('e2fsprogs:runtime')
        # Python 2.6 requires expat
        r.add('expat:lib')
        r.add('ext3flush:runtime')
        r.add('extlinux:runtime', source='syslinux')
        r.add('filesystem:runtime')
        r.add('findutils:runtime')
        r.add('gawk:data')
        r.add('gawk:runtime')
        r.add('gdbm:lib')
        r.add('glibc:config', flavor=glibcFlavor)
        r.add('glibc:lib', flavor=glibcFlavor)
        r.add('glibc:lib', flavor=glibcFlavor32, use=Arch.x86_64)
        r.add('glibc:runtime', flavor=glibcFlavor)
        r.add('glib:data')
        r.add('glib:lib')
        r.add('grep:runtime')
        r.add('grub:data', flavor='grub.static is: x86')
        r.add('grub:runtime', flavor='grub.static is: x86')
        r.add('gzip:runtime')
        r.add('hwdata:config')
        r.add('info-daemon')
        r.add('info-disk')
        r.add('info-emerge')
        r.add('info-floppy')
        r.add('info-kmem')
        r.add('info-lock')
        r.add('info-lp')
        r.add('info-mail')
        r.add('info-sasldb')
        r.add('info-tty')
        r.add('info-users')
        r.add('info-utmp')
        r.add('info-uucp')
        r.add('info-vcsa')
        r.add('initscripts:config')
        r.add('initscripts:lib')
        r.add('initscripts:runtime')
        r.add('iproute:config')
        r.add('iproute:lib')
        r.add('iproute:runtime')
        r.add('iptables:config')
        r.add('iptables:lib')
        r.add('iptables:runtime')
        r.add('iputils:runtime')
        r.add('jfsutils:runtime')
        r.add('kbd:config')
        r.add('kbd:lib')
        r.add('kbd:runtime')
        r.add('kernel:runtime', kernelLabel, flavor=kernelFlavor)
        r.add('kernel:vmware', kernelLabel, flavor=kernelFlavor, use=(not Use.xen))
        r.add('krb5:data')
        r.add('krb5:lib')
        r.add('kudzu:config')
        r.add('kudzu:python')
        r.add('kudzu:runtime')
        # We are not supporting migrations from rPL 1
        # r.add('libata-migrate:python')
        # r.add('libata-migrate:runtime')
        r.add('libdhcp4client:lib', source='dhcp')
        r.add('libdhcp6client:lib', source='dhcpv6')
        r.add('libdhcp:lib')
        r.add('libelf:lib')
        r.add('libgcc:lib', source='gcc')
        r.add('libnl:lib')
        r.add('libstdc++:lib', source='gcc')
        r.add('libtermcap:lib')
        r.add('libuser:config')
        r.add('libuser:lib')
        r.add('libuser:python')
        r.add('libuser:runtime')
        r.add('lvm2:config')
        # r.add('lvm2:lib')
        r.add('lvm2:runtime')
        r.add('MAKEDEV:config')
        r.add('MAKEDEV:runtime')
        r.add('mdadm:config')
        r.add('mdadm:runtime')
        r.add('mingetty:runtime')
        r.add('mkinitrd:lib', 'conary.rpath.com@rpl:2-devel', flavor=mkinitrdFlavor)
        r.add('mkinitrd:runtime', 'conary.rpath.com@rpl:2-devel', flavor=mkinitrdFlavor)
        r.add('mktemp:runtime')
        r.add('module-init-tools:config')
        r.add('module-init-tools:runtime')
        r.add('ncurses:data')
        r.add('ncurses:lib')
        r.add('ncurses:runtime')
        r.add('net-tools:runtime')
        r.add('open-iscsi:config')
        r.add('open-iscsi:runtime')
        r.add('openssl:config')
        r.add('openssl:data')
        r.add('openssl:lib')
        r.add('pam:config')
        r.add('pam:data')
        r.add('pam:lib')
        r.add('parted:lib')
        r.add('passwd:config')
        r.add('passwd:runtime')
        r.add('pcre:lib')
        r.add('popt:lib')
        r.add('procps:lib')
        r.add('procps:runtime')
        r.add('psmisc:runtime')
        # authconfig requires /usr/bin/python right now.  fix this.
        r.add('python:bin')
        r.add('python:lib')
        r.add('python:runtime')
        r.add('qla-firmware:config')
        r.add('qla-firmware:lib')
        r.add('readline:lib')
        r.add('reiserfsprogs:runtime')
        r.add('rhpl:python')
        r.add('rootfiles:runtime')
        r.add('sed:runtime')
        r.add('setup:config')
        r.add('setup:runtime')
        r.add('shadow:config')
        r.add('shadow:runtime')
        r.add('slang:lib')
        # Python 2.6 requires sqlite
        r.add('sqlite:lib')
        r.add('sysfsutils:lib')
        r.add('sysfsutils:runtime')
        r.add('rsyslog:config')
        r.add('rsyslog:lib')
        r.add('rsyslog:runtime')
        r.add('sysvinit:runtime')
        r.add('termcap:config')
        r.add('tzdata:data')
        r.add('tzdata:runtime')
        r.add('udev:config')
        r.add('udev:data')
        r.add('udev:lib')
        r.add('udev:runtime')
        r.add('usermode:config')
        r.add('usermode:runtime')
        r.add('util-linux:config')
        r.add('util-linux:data')
        r.add('util-linux:runtime')
        r.add('vim-minimal:runtime', source='vim')
        r.add('wireless-tools:lib')
        r.add('xfsprogs:lib')
        r.add('xfsprogs:runtime')
        r.add('zlib:lib')

        # Formerly group-core
        r.add('amiconfig:python', use=(Use.xen and Use.domU))
        r.add('amiconfig:runtime', use=(Use.xen and Use.domU))
        r.add('bzip2:runtime')
        r.add('conary:config')
        r.add('conary:data')
        r.add('conary:python')
        r.add('conary:runtime')
        r.add('DirectFB:lib-core')
        r.add('dmraid:runtime')
        r.add('dnspython:python')
        r.add('file:data')
        r.add('file:lib')
        r.add('gmp:lib')
        # we are not supporting migrations
        # r.add('grubtobootman:python')
        # r.add('grubtobootman:runtime')
        r.add('hdparm:runtime')
        r.add('icu:data', use=Use.vmware)
        r.add('icu:lib', use=Use.vmware)
        r.add('libelf-lgpl:lib')
        r.add('m2crypto:python')
        r.add('open-vm-tools:config', use=Use.vmware)
        r.add('open-vm-tools:lib', use=Use.vmware)
        r.add('open-vm-tools:runtime', use=Use.vmware)
        r.add('pycrypto:python')
        r.add('PyXML:python')
        r.add('sgmlop:python')
        r.add('splashy:config')
        r.add('splashy:data')
        r.add('splashy:runtime')
        r.add('splashy-theme:config')
        r.add('splashy-theme:data')
        r.add('splashy-theme:runtime')
        r.add('sqlite:lib')

        # Formerly group-base
        r.setDefaultGroup('group-dist')
        r.add('acpid')
        r.add('amiconfig', use=(Use.xen and Use.domU))
        r.add('ash')
        # avahi has python bindings.  we may rebuild it later
        # r.add('avahi')
        r.add('bind-utils', source='bind')
        r.add('bootman')
        r.add('bridge-utils')
        r.add('bzip2-extras', source='bzip2')
        r.add('ConsoleKit')
        r.add('crontabs')
        r.add('dbus')
        r.add('dbus-glib')
        r.add('dnspython')
        r.add('dosfstools')
        r.add('ext3flush')
        r.add('extlinux', source='syslinux')
        r.add('glib')
        r.add('glibc', flavor=glibcFlavor)
        r.add('gnutls')
        r.add('gpm')
        r.add('grub', flavor='grub.static is: x86')
        r.add('gzip-extras', source='gzip')
        r.add('hal')
        r.add('hal-info')
        r.add('info', source='texinfo')
        r.add('kbd')
        r.add('kudzu')
        r.add('less')
        r.add('libnfsidmap')
        r.add('libvirt', use=(Use.xen and Use.dom0))
        r.add('logrotate')
        r.add('man')
        r.add('man-pages:doc')
        r.add('microcode_ctl')
        r.add('mkinitrd', 'conary.rpath.com@rpl:2-devel', flavor=mkinitrdFlavor)
        r.add('nfs-client', source='nfs-utils')
        r.add('nfs-utils')
        r.add('openssh-server', source='openssh')
        r.add('open-vm-tools', use=Use.vmware)
        r.add('PolicyKit')
        r.add('portmap')
        r.add('psmisc')
        r.add('smartmontools')
        r.add('smbios')
        r.add('termcap')
        r.add('tmpwatch')
        r.add('tzdata')
        r.add('udev')
        r.add('vim')
        r.add('vim-minimal', source='vim')
        r.add('vixie-cron')
        r.add('xen', use=(Use.xen and Use.dom0))

        # Formerly group-text-tools
        r.add('acl')
        r.add('alsa-lib')
        r.add('alsa-utils')
        r.add('anacron')
        r.add('aspell')
        r.add('aspell-en')
        r.add('at')
        r.add('attr')
        r.add('authconfig')
        r.add('authconfig-tui', source='authconfig')
        r.add('autofs')
        r.add('bash')
        r.add('bc')
        r.add('cdda2wav', source='cdrtools')
        r.add('cdrtools')
        r.add('chkconfig')
        r.add('conary')
        r.add('coreutils')
        r.add('cpufrequtils')
        r.add('cracklib')
        r.add('curl')
        r.add('device-mapper')
        r.add('dhclient', source='dhcp')
        r.add('diffutils')
        r.add('distro-conary-config', flavor=releaseFlavor)
        r.add('distro-release')
        r.add('dmidecode')
        r.add('dvd+rw-tools')
        r.add('e2fsprogs')
        r.add('eject')
        r.add('elinks')
        r.add('ethtool')
        r.add('fetchmail')
        r.add('file')
        r.add('filesystem')
        r.add('findutils')
        r.add('finger')
        r.add('ftp')
        r.add('gnupg')
        r.add('grep')
        # r.add('grubtobootman')
        r.add('hdparm')
        r.add('hwdata')
        r.add('info', source='texinfo')
        r.add('initscripts')
        r.add('install-info', source='texinfo')
        r.add('ipmitool')
        r.add('iproute')
        r.add('iptables')
        r.add('iputils')
        r.add('jwhois')
        r.add('krb5-workstation', source='krb5')
        r.add('less')
        r.add('lftp')
        r.add('lm_sensors')
        r.add('lockdev')
        r.add('logwatch')
        r.add('lsof')
        r.add('lvm2')
        r.add('lynx')
        r.add('mailbase')
        r.add('mailcap')
        r.add('mailx')
        r.add('MAKEDEV')
        r.add('man')
        r.add('man-pages')
        r.add('mdadm')
        r.add('minicom')
        r.add('mkisofs', source='cdrtools')
        r.add('mktemp')
        r.add('module-init-tools')
        r.add('mtr')
        r.add('mutt')
        r.add('nano')
        r.add('nc')
        r.add('netpbm')
        r.add('net-tools')
        r.add('nmap')
        r.add('ntp', use=(not Use.domU))
        r.add('ntp-utils', source='ntp', use=(not Use.domU))
        r.add('ntsysv', source='chkconfig')
        r.add('openldap-clients', source='openldap')
        r.add('openssh')
        r.add('openssh-client', source='openssh')
        r.add('openssl')
        r.add('pam')
        r.add('pam_krb5')
        r.add('pam_smb')
        r.add('passwd')
        r.add('patch')
        r.add('pciutils')
        r.add('pcmciautils')
        # r.add('pilot-link')
        r.add('pinfo')
        r.add('pm-utils')
        r.add('ppp')
        r.add('procmail')
        r.add('procps')
        r.add('pump')
        r.add('qla-firmware')
        r.add('quota')
        r.add('reiserfsprogs')
        r.add('rootfiles')
        r.add('rp-pppoe')
        r.add('rsh')
        r.add('rsync')
        r.add('rusers')
        r.add('screen')
        r.add('sdparm')
        r.add('sed')
        r.add('setserial')
        r.add('setup')
        r.add('setuptool')
        r.add('shadow')
        r.add('slocate')
        r.add('sudo')
        r.add('sysfsutils')
        r.add('syslinux')
        r.add('sysstat')
        r.add('sysvinit')
        r.add('talk')
        r.add('tar')
        r.add('tcpdump')
        r.add('tcp_wrappers')
        r.add('telnet')
        r.add('tftp')
        r.add('time')
        r.add('traceroute')
        r.add('urlgrabber')
        r.add('usbutils')
        r.add('utempter')
        r.add('util-linux')
        r.add('vconfig')
        r.add('vim')
        r.add('wget')
        r.add('which')
        r.add('wireless-tools')
        r.add('words')
        r.add('wvdial')
        r.add('wvstreams')
        r.add('x86info')
        r.add('xdelta')
        r.add('xfsprogs')
        r.add('ypbind')
        r.add('yp-tools')

        # Formerly group-netserver
        r.add('bind')
        r.add('cElementTree') # to speed up conary-repository
        r.add('conary-repository', source='conary')
        r.add('conary-web-common')
        r.add('elementtree')
        r.add('httpd')
        r.add('kid')
        r.add('krb5')
        r.add('mod_dav_svn', source='subversion')
        r.add('mod_python')
        r.add('mod_ssl', source='httpd')
        r.add('neon')
        r.add('nfs-server', source='nfs-utils')
        r.add('openssh-server', source='openssh')
        r.add('php')
        r.add('rdate')
        r.add('rdist')
        r.add('sendmail')
        r.add('sendmail-cf', source='sendmail')
        # r.add('xinetd')

        if Arch.x86_64:
            # Formerly group-compat32
            # 32-bit libraries on 64-bit systems
            r.add('acl:lib', flavor='is: x86')
            r.add('alsa-lib:lib', flavor='is: x86')
            r.add('aspell:lib', flavor='is: x86')
            r.add('atk:lib', flavor='is: x86')
            r.add('attr:lib', flavor='is: x86')
            # r.add('avahi:lib', flavor='is: x86')
            r.add('bzip2:lib', flavor='is: x86')
            # r.add('cairo:lib', flavor='is: x86')
            r.add('cracklib:lib', flavor='is: x86')
            r.add('cups:lib', flavor='is: x86')
            r.add('curl:lib', flavor='is: x86')
            r.add('cyrus-sasl:lib', flavor='is: x86')
            r.add('db:lib', flavor='is: x86')
            r.add('dbus:lib', flavor='is: x86')
            r.add('e2fsprogs:lib', flavor='is: x86')
            r.add('expat:lib', flavor='is: x86')
            r.add('fontconfig:lib', flavor='is: x86')
            r.add('freetype:lib', flavor='is: x86')
            r.add('gdbm:lib', flavor='is: x86')
            r.add('glibc:devellib', flavor=glibcFlavor32)
            r.add('glibc:lib', flavor=glibcFlavor32)
            r.add('glib:lib', flavor='is: x86')
            r.add('gmp:lib', flavor='is: x86(sse,sse2)')
            # r.add('gtk:lib', flavor='is: x86(sse,sse2)')
            r.add('icu:lib', flavor='is: x86')
            r.add('krb5:lib', flavor='is: x86')
            r.add('libcap:lib', flavor='is: x86')
            r.add('libgcrypt:lib', flavor='is: x86')
            r.add('libgpg-error:lib', flavor='is: x86')
            r.add('libgssapi:lib', flavor='is: x86')
            r.add('libICE:lib', flavor='is: x86')
            r.add('libidn:lib', flavor='is: x86')
            r.add('libjpeg:lib', flavor='is: x86')
            r.add('libmng:lib', flavor='is: x86')
            r.add('libmspack:lib', flavor='is: x86')
            r.add('libogg:lib', flavor='is: x86')
            r.add('libpng:lib', flavor='is: x86')
            r.add('libSM:lib', flavor='is: x86')
            r.add('libtermcap:lib', flavor='is: x86')
            r.add('libtiff:lib', flavor='is: x86')
            r.add('libtool:lib', flavor='is: x86')
            r.add('libusb:lib', flavor='is: x86')
            r.add('libX11:lib', flavor='is: x86')
            r.add('libXau:lib', flavor='is: x86')
            r.add('libXaw:lib', flavor='is: x86')
            r.add('libXcursor:lib', flavor='is: x86')
            r.add('libXdmcp:lib', flavor='is: x86')
            r.add('libXext:lib', flavor='is: x86')
            r.add('libXfixes:lib', flavor='is: x86')
            r.add('libXft:lib', flavor='is: x86')
            r.add('libXi:lib', flavor='is: x86')
            r.add('libXinerama:lib', flavor='is: x86')
            r.add('libxml2:lib', flavor='is: x86')
            r.add('libXmu:lib', flavor='is: x86')
            r.add('libXpm:lib', flavor='is: x86')
            r.add('libXrandr:lib', flavor='is: x86')
            r.add('libXrender:lib', flavor='is: x86')
            r.add('libxslt:lib', flavor='is: x86')
            r.add('libXt:lib', flavor='is: x86')
            r.add('mysql:lib', flavor='is: x86')
            r.add('ncurses:lib', flavor='is: x86')
            r.add('neon:lib', flavor='is: x86')
            r.add('nss_ldap:lib', flavor='is: x86')
            r.add('OpenEXR:lib', flavor='is: x86')
            r.add('openldap:lib', flavor='is: x86')
            r.add('openssl:lib', flavor=opensslFlavor32)
            r.add('pam_krb5:lib', flavor='is: x86')
            r.add('pam:lib', flavor='is: x86')
            r.add('pam_smb:lib', flavor='is: x86')
            # r.add('pango:lib', flavor='is: x86')
            r.add('pcre:lib', flavor='is: x86')
            r.add('popt:lib', flavor='is: x86')
            r.add('python:lib', flavor='is: x86')
            r.add('readline:lib', flavor='is: x86')
            r.add('samba-client:lib', flavor='is: x86', source='samba')
            r.add('tcl:lib', flavor='is: x86')
            r.add('tcp_wrappers:lib', flavor='is: x86')
            r.add('tk:lib', flavor='is: x86')
            r.add('zlib:lib', flavor='is: x86')

        # Removed group-X, group-X-applications, group-printing

        # Formerly group-dist-base
        # r.add('audit')
        # r.add('avahi-glib', source='avahi')
        # r.add('avahi-tools', source='avahi')
        r.add('boost')
        r.add('busybox')
        r.add('ConfigObj')
        r.add('db')
        r.add('dialog')
        r.add('distcache')
        r.add('fribidi')
        r.add('fuse')
        r.add('giflib')
        r.add('gmp')
        r.add('gpgme')
        r.add('hesiod')
        r.add('htmlview')
        r.add('icu')
        r.add('idle', source='python')
        r.add('info-adm')
        r.add('info-amanda')
        r.add('info-apache')
        r.add('info-avahi')
        r.add('info-beagleindex')
        r.add('info-bin')
        r.add('info-canna')
        r.add('info-cyrus')
        r.add('info-daemon')
        r.add('info-dbus')
        r.add('info-dip')
        r.add('info-disk')
        r.add('info-dovecot')
        r.add('info-exim')
        r.add('info-fax')
        r.add('info-fcron')
        r.add('info-floppy')
        r.add('info-ftp')
        r.add('info-games')
        r.add('info-gdm')
        r.add('info-gopher')
        r.add('info-haldaemon')
        r.add('info-halt')
        r.add('info-htt')
        r.add('info-ident')
        r.add('info-kmem')
        r.add('info-ldap')
        r.add('info-lock')
        r.add('info-lp')
        r.add('info-mail')
        r.add('info-mailman')
        r.add('info-mailnull')
        r.add('info-man')
        r.add('info-mem')
        r.add('info-mysql')
        r.add('info-named')
        r.add('info-netdump')
        r.add('info-news')
        r.add('info-nfsnobody')
        r.add('info-nobody')
        r.add('info-nscd')
        r.add('info-ntp')
        r.add('info-nut')
        r.add('info-operator')
        r.add('info-pcap')
        r.add('info-polkituser')
        r.add('info-postdrop')
        r.add('info-postfix')
        r.add('info-postgres')
        r.add('info-privoxy')
        r.add('info-pvm')
        r.add('info-quagga')
        r.add('info-quaggavt')
        r.add('info-radiusd')
        r.add('info-radvd')
        r.add('info-rmake')
        r.add('info-rmake-chroot')
        r.add('info-rpc')
        r.add('info-rpcuser')
        r.add('info-sasldb')
        r.add('info-shutdown')
        r.add('info-slocate')
        r.add('info-smmsp')
        r.add('info-squid')
        r.add('info-sshd')
        r.add('info-sync')
        r.add('info-sys')
        r.add('info-tomcat')
        r.add('info-tty')
        r.add('info-users')
        r.add('info-utmp')
        r.add('info-uucp')
        r.add('info-webalizer')
        r.add('info-wheel')
        r.add('info-wnn')
        r.add('info-xfs')
        r.add('ipvsadm')
        r.add('libassuan')
        # r.add('libata-migrate')
        r.add('libcap')
        r.add('libcroco')
        r.add('libdhcp')
        r.add('libdhcp4client', source='dhcp')
        r.add('libdhcp6client', source='dhcpv6')
        r.add('libdmx')
        r.add('libdrm')
        r.add('libelf', source='elfutils')
        # r.add('libevent')
        r.add('libexif')
        r.add('libfontenc')
        r.add('libFS')
        r.add('libgcc', source='gcc')
        r.add('libgcrypt')
        r.add('libgpg-error')
        r.add('libgssapi')
        r.add('libICE')
        r.add('libidn')
        r.add('libieee1284')
        r.add('libjpeg')
        r.add('libksba')
        r.add('liblbxutil')
        # r.add('libmal')
        r.add('libmng')
        r.add('libmspack')
        r.add('libnl')
        r.add('libogg')
        r.add('liboldX')
        r.add('libole2')
        r.add('libpcap')
        r.add('libpng')
        r.add('libpthread-stubs')
        r.add('librpcsecgss')
        r.add('libsigc++')
        r.add('libSM')
        r.add('libstdc++', source='gcc')
        r.add('libtermcap')
        r.add('libtiff')
        r.add('libtool')
        r.add('libusb')
        r.add('libuser')
        r.add('libX11')
        r.add('libXau')
        r.add('libXaw')
        r.add('libxcb')
        r.add('libXcomposite')
        r.add('libXcursor')
        r.add('libXdamage')
        r.add('libXdmcp')
        r.add('libXevie')
        r.add('libXext')
        r.add('libXfixes')
        r.add('libXfont')
        r.add('libXfontcache')
        r.add('libXft')
        r.add('libXi')
        r.add('libXinerama')
        r.add('libxkbfile')
        r.add('libxkbui')
        r.add('libxml2')
        r.add('libXmu')
        r.add('libXpm')
        r.add('libXrandr')
        r.add('libXrender')
        r.add('libXres')
        r.add('libXScrnSaver')
        r.add('libxslt')
        r.add('libXt')
        r.add('libXTrap')
        r.add('libXtst')
        r.add('libXv')
        r.add('libXvMC')
        r.add('libXxf86dga')
        r.add('libXxf86misc')
        r.add('libXxf86vm')
        r.add('lzo')
        r.add('mingetty')
        r.add('mysql:data')
        r.add('mysql:lib')
        # r.add('MySQL-python')
        r.add('net-snmp')
        r.add('net-snmp-client', source='net-snmp')
        r.add('nss_ldap')
        r.add('OpenEXR')
        r.add('open-iscsi')
        r.add('openldap')
        r.add('openslp')
        r.add('parted')
        r.add('pdksh')
        r.add('perl-Archive-Zip')
        r.add('perl-Compress-Zlib')
        r.add('perl-Crypt-PasswdMD5')
        r.add('perl-DateManip')
        r.add('perl-DBD-MySQL')
        r.add('perl-DBD-Pg')
        r.add('perl-DBD-SQLite')
        r.add('perl-DBI')
        r.add('perl-Digest-HMAC')
        r.add('perl-Digest-SHA1')
        r.add('perl-Filter')
        r.add('perl-Filter-Simple')
        r.add('perl-HTML-Parser')
        r.add('perl-HTML-Tagset')
        r.add('perl-IO-Socket-SSL')
        r.add('perl-IP-Country')
        r.add('perl-libwww-perl')
        r.add('perl-libxml-enno')
        r.add('perl-libxml-perl')
        r.add('perl-Net-DNS')
        r.add('perl-Net-IP')
        r.add('perl-Parse-Yapp')
        r.add('perl-SGMLS')
        r.add('perl-Time-HiRes')
        r.add('perl-URI')
        r.add('perl-XML-Dumper')
        r.add('perl-XML-Encoding')
        r.add('perl-XML-Grove')
        r.add('perl-XML-LibXML')
        r.add('perl-XML-LibXML-Common')
        r.add('perl-XML-NamespaceSupport')
        r.add('perl-XML-Parser')
        r.add('perl-XML-SAX')
        r.add('perl-XML-Simple')
        r.add('perl-XML-Twig')
        r.add('pinentry')
        r.add('postgresql')
        r.add('pwlib')
        r.add('PyPAM')
        r.add('pyparted')
        # the test component doesn't exist in the current py 2.6 build
        # r.add('python:test')
        r.add('python-sqlite')
        r.add('samba-client', source='samba')
        # r.add('scgi')
        r.add('taglib')
        r.add('tcsh')
        r.add('umb-scheme')
        r.add('VFlib')
        r.add('w3c-libwww')
        r.add('Xaw3d')
        r.add('xmlsec')
        r.add('xtrans')

        # Removed group-anaconda-deps -- anaconda remains py2.4-based

        # Formerly group-devel
        r.add('apr')
        r.add('apr-util')
        r.add('autoconf')
        r.add('automake')
        r.add('bigreqsproto')
        r.add('binutils')
        r.add('bison')
        r.add('byacc')
        r.add('bzip2')
        r.add('cdecl')
        r.add('compositeproto')
        r.add('conary-build', source='conary')
        r.add('conary-policy')
        r.add('cpio')
        r.add('cproto')
        r.add('ctags')
        r.add('cvs')
        r.add('cyrus-sasl')
        r.add('damageproto')
        r.add('debugedit')
        r.add('decorator')
        r.add('dejagnu')
        r.add('desktop-file-utils')
        r.add('dev86')
        r.add('diffstat')
        r.add('diffutils')
        r.add('DirectFB')
        # r.add('distcc')
        r.add('dmalloc')
        r.add('dmxproto')
        r.add('docbook-dsssl')
        r.add('docbook-dtds')
        r.add('docbook-xsl')
        r.add('dos2unix')
        r.add('ed')
        r.add('elfutils')
        r.add('epdb')
        r.add('evieext')
        r.add('expat')
        r.add('expect')
        r.add('expectk', source='expect')
        r.add('fixesproto')
        r.add('flex')
        r.add('fltk')
        r.add('fontcacheproto')
        r.add('fontsproto')
        r.add('gc')
        r.add('gcc')
        r.add('gcc-c++', source='gcc')
        r.add('gcc-fortran', source='gcc')
        # r.add('gcc-java', source='gcc')
        r.add('gcc-objc', source='gcc')
        r.add('gdb')
        r.add('gdbm')
        # r.add('gettext')
        r.add('git')
        r.add('glproto')
        r.add('gperf')
        r.add('groff')
        r.add('guile')
        r.add('gzip')
        r.add('indent')
        r.add('inputproto')
        r.add('jasper')
        r.add('kbproto')
        r.add('kernel', kernelLabel, flavor=kernelFlavor)
        # kernel:build-tree currently requires python 2.4 lib
        r.removeComponents('build-tree', 'group-dist')
        r.add('latex2html')
        r.add('libelf-lgpl')
        r.add('ltrace')
        r.add('lxml')
        r.add('m2crypto')
        r.add('m4')
        r.add('make')
        r.add('mercurial')
        r.add('mercurial-hgk', source='mercurial')
        r.add('mono')
        r.add('monodoc')
        r.add('mpfr')
        r.add('mx')
        r.add('nasm')
        r.add('ncurses')
        r.add('newt')
        r.add('openjade')
        r.add('opensp')
        r.add('oprofile')
        r.add('passivetex')
        r.add('patch')
        r.add('patchutils')
        r.add('pcre')
        r.add('pcre-c++')
        r.add('perl')
        r.add('perl-Module-Build')
        r.add('PIL')
        r.add('pkgconfig')
        # r.add('poppler')
        r.add('popt')
        r.add('pth')
        r.add('pycrypto')
        r.add('python-setuptools')
        r.add('python') # the rest of python, including the :test component
        r.add('rake')
        r.add('randrproto')
        r.add('rbuild')
        r.add('rbuilder-client')
        r.add('readline')
        r.add('recordproto')
        r.add('renderproto')
        r.add('resourceproto')
        r.add('rhpl')
        r.add('rmake')
        r.add('rpath-common')
        r.add('rpath-xmllib')
        r.add('rpath-product-definition')
        r.add('ruby')
        r.add('scrnsaverproto')
        r.add('setarch')
        r.add('sgml-common')
        r.add('sgmlop')
        r.add('sharutils')
        r.add('simplejson')
        r.add('slang')
        r.add('splashy')
        r.add('splashy-theme')
        r.add('splint')
        r.add('sqlite')
        r.add('strace')
        r.add('subversion')
        r.add('swig')
        r.add('tar')
        r.add('tcl')
        r.add('texi2html')
        r.add('texinfo')
        r.add('tk')
        r.add('trapproto')
        r.add('unifdef')
        r.add('unix2dos')
        r.add('unzip')
        r.add('usermode')
        r.add('userspace-kernel-headers')
        r.add('util-macros')
        r.add('videoproto')
        r.add('xcb-proto')
        r.add('xcmiscproto')
        r.add('xextproto')
        r.add('xf86bigfontproto')
        r.add('xf86dgaproto')
        r.add('xf86driproto')
        r.add('xf86miscproto')
        r.add('xf86rushproto')
        r.add('xf86vidmodeproto')
        r.add('xhtml1-dtds')
        r.add('xineramaproto')
        r.add('xmlto')
        r.add('xproto')
        r.add('xproxymanagementprotocol')
        r.add('xz')
        r.add('zip')
        r.add('zlib')
        # These are binary superclass packages:
        # *temporarily disabled (RPL-2409)*
        #r.add('autopackage')
        #r.add('buildpackage')
        #r.add('cpackage')
        #r.add('package')

        # Removed group-rails

        r.startGroup('group-factories', parentGroup='group-os',
                     byDefault=False)
        r.add('factory-archive')
        r.add('factory-base-packagecreator')
        r.add('factory-group-base')
        r.add('factory-rpm')
        r.add('rpm-import')

        # The rest of this file is for group-os contents that are outside
        # of group-dist, and so these groups are not included on the
        # installation media

        # Formerly group-os-devel
        # r.add('asciidoc')
        r.add('bdftopcf')
        r.add('docbook-utils')
        r.add('docbook-utils-pdf', source='docbook-utils')
        r.add('gccmakedep')
        r.add('imake')
        r.add('jadetex')
        r.add('linuxdoc-tools')
        r.add('makedepend')
        r.add('rcs')
        r.add('tetex')
        r.add('tetex-afm', source='tetex')
        r.add('tetex-dvips', source='tetex')
        r.add('tetex-fonts', source='tetex')
        r.add('tetex-latex', source='tetex')
        r.add('tetex-xdvi', source='tetex')
        r.add('xcursorgen')
        r.add('xorg-cf-files')
        r.add('xorg-sgml-doctools')

        # Formerly group-os-extras
        # pruned this group to some bare essentials
        r.setDefaultGroup('group-os')
        r.add('amiconfig')
        r.add('open-vm-tools')
        r.add('rmake-repos', source='rmake')
        r.add('rmake-node', source='rmake')
        r.add('rmake-multinode-server', source='rmake')
        r.add('python-pgsql')

    # Removed group-dom0-server, group-live-images, and subgroups
