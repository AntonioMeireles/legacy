#
# Copyright (c) 2007 Lance Haig.
#               2008 Foresight Linux Project
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

class VirtViewer(AutoPackageRecipe):
    name = 'virt-viewer'
    version = '0.4.2'
    buildRequires = [ 'libvirt:devel',
                      'libxml2:devel',
                      'libvirt:runtime',
                      'gtk-vnc:devel',
                      'gtk-vnc:python',
                      'gtk-vnc:lib',
                      'gtk-vnc:devellib',
                      'pkgconfig:devel',
                      'expat:devel',
                      'pygtk:python', 
                      'pygtk:devel',
                      'pygtk:runtime',
                      'pygtk:devellib',
                      'pygtk:lib',
                      'libvirt:devel',
                      'gtk:devel',
                      'libxml2:devel',
                      'perl:devel',
                      'gettext:runtime',
                      'libglade:devel',
                      'intltool:runtime',
                      ]
        

    def unpack(r):	
        r.addArchive('http://virt-manager.et.redhat.com/download/sources/virt-viewer/')
        r.addSource('xauth-libvirt-sdl-hack.sh')

    def configure(r):
        # mozilla plugin not ready for prime time...
        r.Configure('--enable-plugin=no --prefix=%(prefix)s --localstatedir=%(localstatedir)s --libdir=%(libdir)s')

    def policy(r):
        # virt-viwer SDL support hack (see source for details -ermo)
        r.Install('xauth-libvirt-sdl-hack.sh', '%(sysconfdir)s/X11/xinit/xinitrc.d/',
                    mode=0755)
        # this is not a config-file -- it's a runtime specific workaround
        r.ComponentSpec('runtime', '%(sysconfdir)s/X11/xinit/xinitrc.d/xauth-libvirt-sdl-hack.sh')
