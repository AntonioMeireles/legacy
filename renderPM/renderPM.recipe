#
# Copyright (c) 2006-2007 rPath, Inc.
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

fontMap = [
    ( "n021003l", "TimesNewRoman" ),
    ( "n021004l", "TimesNewRoman-Bold" ),
    ( "n021023l", "TimesNewRoman-Italic" ),
    ( "n021024l", "TimesNewRoman-BoldItalic" ),

    ( "n019003l", 'Arial' ),
    ( "n019004l", 'Arial-Bold' ),
    ( "n019023l", 'Arial-Italic' ),
    ( "n019024l", 'Arial-BoldItalic' ),


    ( "n022003l", 'Courier' ),
    ( "n022023l", 'Courier-Oblique' ),
    ( "n022004l", 'Courier-Bold' ),
    ( "n022024l", 'Courier-BoldOblique' ),

    ( "s050000l", "Symbol" ),
    ( "d050000l", "ZapfDingbats")
]

loadRecipe('python=conary.rpath.com@rpl:1')
class renderPM(CPackageRecipe):
    name = 'renderPM'
    version = '1.01'

    buildRequires = [ 'python:runtime', 'python-setuptools:python',
        'python:devel',
    ]

    def setup(r):
        r.addArchive('renderPM-1.01-daily-unix.tgz')
        r.mainDir('renderPM-1.01-20060421/renderPM')
        r.PythonSetup()
        # not 64-bit clean
        r.Move('/usr/lib/python2.4/site-packages/*',
               '%(libdir)s/python2.4/site-packages/')

        r.Requires('urw-fonts:data',
                   '%(libdir)s/python2.4/site-packages/_renderPM.so')
        r.Requires('reportlab:python',
                   '%(libdir)s/python2.4/site-packages/_renderPM.so')

        r.DanglingSymlinks(exceptions = '.*')

        pyVersion = ".".join(Python.version.split(".")[0:2])

        # Separate out the fonts -- that way the rest can be
        # multilib-safe, and only one fonts component needs to
        # be installed.
        r.NonMultilibComponent(exceptions='.*')
        r.ComponentSpec('fonts', '/usr/lib/python.*/site-packages/reportlab/fonts/' )
        for urwFile, renderFile in fontMap:
            r.Symlink("/usr/share/fonts/default/Type1/%s.pfb" % urwFile,
                      "/usr/lib/python%s/site-packages/reportlab/fonts/%s.pfb" 
                      %(pyVersion, renderFile))
