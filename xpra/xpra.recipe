#
# Copyright (c) 2011 Foresight Linux
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

class xpra(CPackageRecipe):
    name = 'xpra'
    version = '0.0.7.28'

    buildRequires = [
        'cython:runtime', 'PIL:python', 'atk:devel',
        'cairo:devel', 'dbus-python:python', 'fontconfig:devel',
        'freetype:devel', 'gdk-pixbuf:devel', 'glib:devel', 'gtk:devel',
        'ipython:python', 'libX11:devel', 'libXcomposite:devel',
        'libXdamage:devel', 'libXfixes:devel', 'libXrandr:devel',
        'libXtst:devel', 'libpng:devel', 'notify-python:python',
        'pango:devel', 'pycairo:python', 'pygobject:python',
        'pygtk:python', 'python:devel',
    ]

    def setup(r):
        r.addArchive('http://xpra.org/src/')
        # PythonSetup doesn't work, so emulate it
        r.Run('python make_constants_pxi.py wimpiggy/lowlevel/constants.txt wimpiggy/lowlevel/constants.pxi')
        r.Run('CFLAGS="%(cflags)s" python setup.py install --prefix=%(prefix)s  --install-purelib=%(libdir)s/python%(pyver)s/site-packages/  --install-platlib=%(libdir)s/python%(pyver)s/site-packages/  --install-data=%(libdir)s/python%(pyver)s/site-packages/ --root=%(destdir)s')
        # Man pages not installed by setup.py
        r.Install('*.1', '%(mandir)s/man1/')
        # Haven't tested whether parti can be separated out, or whether
        # xpra actually depends on it being around.  Feel free to test
        # whether it can be removed.
