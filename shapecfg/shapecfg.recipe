#
# Copyright (c) 2004-2005 rPath, Inc.
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

class Shapecfg(CPackageRecipe):
    name = 'shapecfg'
    version = '2.2.12'
    cbqversion = '0.7.3'

    def setup(r):

        r.mainDir('shaper')
        srpm = 'ftp://download.fedora.redhat.com/pub/fedora/linux/core/2/SRPMS/shapecfg-2.2.12-15.src.rpm'
        r.macros.cbqversion = r.cbqversion

        r.addArchive('shaper.36.tar.gz', rpm=srpm)
        r.addSource('README.shaper', rpm=srpm)
        r.addSource('mirror://sourceforge/cbqinit/cbq.init-v%(cbqversion)s')
        r.addSource('README.cbq', rpm=srpm)
        r.addSource('cbq-0000.example')
        r.addPatch('shapercfg-2.0.36-glibc.patch', rpm=srpm)
        r.addPatch('cbq-0.7.3-avpkt-enhancement.patch', level=0)

        r.Make()

        r.Install('shapecfg', '%(essentialsbindir)s/')
        r.Install('cbq.init-v%(cbqversion)s',
                  '%(essentialsbindir)s/cbq', mode=0755)

        r.Create('%(thisdocdir)s/example.README',
                 contents = 'Config files go in %(sysconfdir)s/sysconfig/cbq/')
        r.Install('cbq-0000.example', '%(thisdocdir)s/')
        r.Create('%(sysconfdir)s/sysconfig/cbq/avpkt',
                 contents='AVPKT=3000')

        r.AutoDoc('example.README')
