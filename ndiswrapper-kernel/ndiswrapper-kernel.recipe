
loadSuperClass('kernelmodulepackage.recipe', label='drivers.rpath.org@rpl:devel')
class NdiswrapperKernel(KernelModulePackageRecipe):
    name = 'ndiswrapper-kernel'
    version =  '1.51'

    def unpack(r):
        r.macros.name = r.macros.name.split('-')[0]
        r.addArchive('mirror://sourceforge/%(name)s/')
        r.Replace('.*depmod.*', '', 'driver/Makefile')

        r.macros.ksrcdir = '/lib/modules/%(kver)s/build'

        r.Make('-C driver')
        r.Make('DESTDIR=%(destdir)s -C driver install')

        # We want to make sure that the userspace code can require the
        # matching kernel-space code
        r.ComponentProvides('%(version)s')
        r.ComponentSpec('runtime', '/lib/modules/')

        # We need the kernel module and userspace versions to match
        r.Requires('%(name)s:runtime(%(version)s)', 
                   '/lib/modules/%(kver)s/kernel/misc/ndiswrapper.ko')
