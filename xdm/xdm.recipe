#
# Copyright (c) 2005-2007 rPath, Inc.
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

loadSuperClass('xorgpackage')
class Xdm(XorgPackageRecipe):
    name = 'xdm'
    version = '1.1.6'
    component = 'app'

    buildRequires = [ 'fontconfig:devel', 'freetype:devel', 'libICE:devel',
        'libSM:devel', 'libXaw:devel', 'libXext:devel', 'libXft:devel',
        'libXinerama:devellib', 'libXmu:devel', 'libXpm:devel',
        'libXrender:devel', 'libXt:devel', 'pam:devel', 'xproto:devel',
        'zlib:devel' ]

    def setup(r):
        # pulled from Fedora CVS (xorg-x11-xdm, rev. 1.1)
        # rev. 1.2 is designed for use with the audit system
        r.addSource('xdm.pamd', dest='%(sysconfdir)s/pam.d/xdm', mode=0644)

        # similar to Fedora CVS (xorg-x11-xdm, rev. 1.1)
        # includes rPath changes from monolithic xorg-x11-6.8.2-19
        r.addSource('xdm.init', dest='%(initdir)s/xdm', mode=0755)

        # copied from xorg-x11 recipe; explicitly create XDM authdir
        r.MakeDirs('%(localstatedir)s/lib/xdm/authdir', mode=0700)

        r.TagSpec('initscript', '%(initdir)s/')

        XorgPackageRecipe.setup(r)

        r.Requires('which:runtime', '%(sysconfdir)s/init\.d/xdm')

    def unpack(r):
        # Need the sources before we can patch them
        XorgPackageRecipe.unpack(r)

        # pulled from Fedora CVS (xorg-x11-xdm, rev. 1.1)
        # see RH BZ #86505
        r.addPatch('xdm-1.0.1-redhat-xdm-config-fix.patch', level=0)
