#
# Copyright (c) 2004-2008 rPath, Inc.
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

class Guile(CPackageRecipe):
    name = 'guile'
    version = '1.8.6'

    buildRequires = [
        'gettext:runtime', 'gmp:devel', 'gzip:runtime', 'install-info:runtime',
        'libtool:devel', 'ncurses:devel', 'patch:runtime', 'readline:devel',
        'tar:runtime', 'texinfo:runtime', 'umb-scheme:data',
    ]

    def setup(r):
        r.addSource('guile-slib.tagdescription',
                    '%(tagdescriptiondir)s/guile-slib')
        r.addSource('guile-slib.taghandler',
                    '%(taghandlerdir)s/guile-slib', mode=0755)
        r.disableParallelMake()
        r.addArchive('mirror://gnu/guile/')
        r.addPatch('guile-1.8.6-deplibs.patch')
        # We don't need to bail every time there's a warning in guile.
        r.Replace('-Werror', '', 'configure')
        r.Configure('--with-threads')
        r.Make()
        r.MakeInstall()
        # symlink in the slib library from umb-scheme
        for l in ('slib', 'slibcat'):
            r.Symlink('%(datadir)s/umb-scheme/' + l, '%(datadir)s/guile/' + l)
            r.Requires('umb-scheme:data', '%(datadir)s/guile/' + l)
            r.DanglingSymlinks(exceptions='%(datadir)s/guile/' + l)

