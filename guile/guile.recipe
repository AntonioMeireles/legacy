#
# Copyright (c) 2004-2005 rPath, Inc.
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

class Guile(CPackageRecipe):
    name = 'guile'
    version = '1.8.1'

    # needs info-file tag description from the install-info package
    buildRequires = [
                      'gmp:devel',
                      'install-info:runtime',
                      'libtool:devel',
                      'ncurses:devel',
                      'readline:devel',
                      'texinfo:runtime',
    ]

    def setup(r):
        r.disableParallelMake()

        srpm = 'http://download.fedora.redhat.com/pub/fedora/linux/core/development/source/SRPMS/guile-1.8.1-3.fc7.src.rpm'

        #r.addArchive('http://ftp.gnu.org/pub/gnu/guile/', keyid='8C7E73A4')
        r.addArchive('%(name)s-%(version)s.tar.gz', rpm=srpm)

        r.addSource('guile-slib.tagdescription', macros=True)
        r.addSource('guile-slib.taghandler', macros=True)

        r.addPatch('guile-1.8.0-rpath.patch', rpm=srpm)
        r.addPatch('guile-1.8.1-slib.patch', rpm=srpm)
        r.addPatch('guile-1.8.1-deplibs.patch', rpm=srpm)
        r.addPatch('guile-1.8.0-multilib.patch', rpm=srpm)

        extraConfig = '--disable-static --disable-error-on-warning '

        r.Configure(extraConfig)

        r.Make()
        r.MakeInstall()

        r.MakeDirs("%(datadir)s/guile/site/")
        r.Install('guile-slib.tagdescription', '%(tagdescriptiondir)s/guile-slib')
        r.Install('guile-slib.taghandler', '%(taghandlerdir)s/guile-slib', mode=0755)

        r.Provides('file', '%(bindir)s/guile')
        r.Requires('gmp:devel', '%(includedir)s/libguile.h')
        r.ExcludeDirectories(exceptions="%(datadir)s/guile/site")
