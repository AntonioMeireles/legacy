#
# Copyright (c) 2004-2007 rPath, Inc.
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

class Guile(CPackageRecipe):
    name = 'guile'
    version = '1.8.1'

    # needs info-file tag description from the install-info package
    buildRequires = [ 'install-info:runtime', 'sed:runtime', 'ncurses:devel',
        'readline:devel', 'gmp:devel', 'libtool:devel', 'texinfo:runtime', ]

    def setup(r):
        r.disableParallelMake()
        r.addArchive('mirror://gnu/guile/')
        r.addPatch('guile-1.8.1-deplibs.patch')

        # We don't need to bail every time there's a warning in guile.
        r.Replace('-Werror', '', 'configure')
        r.Configure('--with-threads')
        r.Make()
        r.MakeInstall()
        # symlink in the slib library from umb-scheme
        for l in ('slib', 'slibcat'):
            r.Symlink('%(datadir)s/umb-scheme/' + l, '%(datadir)s/guile/' + l)
            r.Requires('umb-scheme:runtime', '%(datadir)s/guile/' + l)
            r.DanglingSymlinks(exceptions='%(datadir)s/guile/' + l)
