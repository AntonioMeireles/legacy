# vim:set ts=4 sw=4 et:
#
# Copyright (c) 2009 Foresight Linux
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

class Xbmc(AutoPackageRecipe):
    name = 'xbmc'
    version = '10.0'
 
    buildRequires = ['Mesa:devel', 'PyQt:python', 'SDL:devel', 'SDL_image:devel', 'SDL_mixer:devel', 'alsa-lib:devel', 'autoconf:data', 'autoconf:runtime', 'automake:runtime', 'avahi:devel', 'bison:runtime', 'boost:devel', 'bzip2:devel', 'cmake:runtime', 'cvs:runtime', 'curl:devel', 'dbus:devel', 'desktop-file-utils:runtime', 'enca:devel', 'expat:devel', 'faac:devel', 'faad2:devel', 'ffmpeg:devel', 'flac:devel', 'flex:runtime', 'fontconfig:devel', 'freetype:devel', 'fribidi:devel', 'gcc-c++:runtime', 'gettext:runtime', 'git:runtime', 'glew:devel', 'glib:devel', 'gperf:runtime', 'hal:devel', 'intltool:runtime', 'jasper:devel', 'libICE:devel', 'libSM:devel', 'libX11:devel', 'libXScrnSaver:devel', 'libXau:devel', 'libXcomposite:devel', 'libXcursor:devel', 'libXdamage:devel', 'libXdmcp:devel', 'libXext:devel', 'libXfixes:devel', 'libXft:devel', 'libXi:devel', 'libXinerama:devel', 'libXmu:devel', 'libXpm:devel', 'libXrandr:devel', 'libXrender:devel', 'libXt:devel', 'libXtst:devel', 'libXv:devel', 'libXxf86misc:devel', 'libbluray:devel', 'libcdio:devel', 'libjpeg:devel', 'libmad:devel', 'libmicrohttpd:devel', 'libmms:devel', 'libmodplug:devel', 'libogg:devel', 'libpng:devel', 'libsamplerate:devel', 'libstdc++:devel', 'libtiff:devel', 'libtool:runtime', 'libvorbis:devel', 'lzo:devel','mpeg2dec:devel', 'mysql:devel', 'nasm:runtime', 'openssl:devel', 'pcre-c++:devel', 'pcre:devel', 'pkgconfig:devel', 'pulseaudio:devel', 'pygobject:python', 'pygtk:python', 'python:devel', 'readline:devel', 'rtmpdump:devel', 'samba:devel', 'samba-client:lib', 'sqlite:devel', 'subversion:runtime', 'unzip:runtime', 'wavpack:devel', 'zip:runtime', 'zlib:devel', 'PIL:python', 'bluez:devel', 'libtermcap:devel', 'ncurses:devel', 'python-sqlite:python', 'tcl:devel', 'tk:devel']
  
    def unpack(r):
        r.addArchive('http://mirrors.xbmc.org/releases/source/')
        r.macros.ldflags += ' -L%(libdir)s/xorg.mesa.3d/ -L%(libdir)s/mysql/'

    def configure(r):
        r.Run('./bootstrap')
        r.Configure('--disable-pulse --enable-hal --enable-avahi --disable-external-liba52 --disable-external-libdts --enable-external-libmpeg2 --enable-external-libogg --enable-external-libwavpack --disable-external-libass --disable-external-ffmpeg --enable-rtmp --enable-goom --enable-libbluray --disable-joystick --enable-faac --disable-external-python --disable-debug')

    def make(r):
        r.Make()
        r.Make('-C lib/addons/script.module.pil')
        r.Make('-C lib/addons/script.module.pysqlite')

    def makeinstall(r):
        r.MakeInstall('DESTDIR=%(destdir)s')
