#
# Copyright (c) 2006 rPath, Inc.
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

class AnacondaTemplates(PackageRecipe):
    name = 'anaconda-templates'
    version = '0.5'
    buildRequires = [ 'anaconda:runtime', 'coreutils:runtime',
                      'diffutils:runtime', 'findutils:runtime',
                      'fontconfig:runtime', 'gawk:runtime',
                      'glibc:runtime', 'gnupg:runtime', 'grep:runtime',
                      'mktemp:runtime', 'module-init-tools:runtime',
                      'netpbm:runtime', 'openssh:runtime',
                      'syslinux:runtime', 'mkfontdir:runtime',
                      'hwdata:runtime']

    def setup(r):
        r.addSource('template.conf')
        r.addSource('gentemplates')
        r.addSource('keymaps.gz')

        r.Replace('DESTDIR', '%(destdir)s', 'template.conf')
        r.Replace('VERSION', '%(version)s', 'template.conf')
        if Arch.x86:
            r.Replace('ARCH', 'i386', 'template.conf')
        if Arch.x86_64:
            r.Replace('ARCH', 'x86_64', 'template.conf')
        r.Run('./gentemplates')
        r.Install('keymaps.gz', '/makebootdisk.dir/etc/', mode=0644)

        # Policy exceptions, conary-policy really doesnt like these trees
        # but we dont want to mess with them.

        r.DanglingSymlinks(exceptions='.*')
        r.LinkCount(exceptions='.*')
        r.ExcludeDirectories(exceptions='.*')
        r.Requires(exceptDeps='.*')
        r.Strip(exceptions='.*')
        r.RemoveNonPackageFiles(exceptions='.*')
