#
# Copyright (c) 2004-2006 rPath, Inc.
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#


loadSuperClass('gnomepackage')
class SystemToolsBackends(GnomePackageRecipe):
    name = 'system-tools-backends'
    version = '2.3.1'

    buildRequires = [ 'intltool:runtime', 'gettext:runtime',
        'perl-Net-DBus:perl', 'chkconfig:runtime','glib:devel',
        'perl-XML-Twig:perl' ]

    extraConfig = '--with-net-dbus=/usr/lib/perl5/vendor_perl/5.8.7/i386-linux-thread-multi/Net'
    extraConfig += ' --with-stb-group=wheel'

    def unpack(r):
        GnomePackageRecipe.unpack(r)
        r.addPatch('foresight.patch')
        r.addPatch('useradd.patch')
        r.addSource('system-tools-backends.init')

    def install(r):
        GnomePackageRecipe.install(r)
        r.Install('system-tools-backends.init',
            '%(initdir)s/system-tools-backends')
        r.Copy('%(datadir)s/system-tools-backends-2.0/scripts/*', '/usr/lib/perl5/vendor_perl/')
        r.Remove('%(libdir)s/perl5/vendor_perl/Makefile*')


        r.Requires('perl-Time-HiRes:perl', '%(bindir)s/system-tools-backends')
        r.Requires('perl-XML-Parser:perl', '%(bindir)s/system-tools-backends')

    def policy(r):
        r.NormalizeInterpreterPaths(exceptions='%(datadir)s/system-tools-backends-2.0/scripts/SystemToolsBackends.pl')
        r.NormalizeInterpreterPaths(exceptions='%(libdir)s/perl5/vendor_perl/SystemToolsBackends.pl')

