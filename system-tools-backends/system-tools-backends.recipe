#
# Copyright (c) 2004-2008 rPath, Inc.
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

loadSuperClass('gnomepackage')
class SystemToolsBackends(AutoPackageRecipe,GnomePackageRecipe):
    name = 'system-tools-backends'
    version = '2.6.1'

    buildRequires = [ 'intltool:runtime', 'gettext:runtime',
                      'perl-Net-DBus:perl', 'chkconfig:runtime','glib:devel',
                      'perl-XML-Twig:perl', 'PolicyKit:devel', 'perl:devel' ]

    def unpack(r):
        GnomePackageRecipe.unpack(r)
        r.addPatch('foresight.patch')
        r.addSource('system-tools-backends.init', macros=True)

    def configure(r):
        if Arch.x86:
            extraConfig = '--with-net-dbus=%(libdir)s/perl5/vendor_perl/5.8.8/i686-linux-thread-multi/Net'
        else:
            extraConfig = '--with-net-dbus=%(libdir)s/perl5/vendor_perl/5.8.8/x86_64-linux-thread-multi/Net'
        extraConfig += ' --with-stb-group=wheel'

        r.Configure(extraConfig)

    def policy(r):
        r.Install('system-tools-backends.init',
                  '%(initdir)s/system-tools-backends', mode = 0755)

        r.Requires('perl-Time-HiRes:perl', '%(bindir)s/system-tools-backends')
        r.Requires('perl-XML-Parser:perl', '%(bindir)s/system-tools-backends')

        r.Requires(exceptDeps='perl:.*')
        r.Requires('distro-release:config', '%(bindir)s/system-tools-backends')
