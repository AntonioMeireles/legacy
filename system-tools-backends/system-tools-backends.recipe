#
# Copyright (c) 2004-2008 rPath, Inc.
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

loadSuperClass('gnomepackage')
class SystemToolsBackends(GnomePackageRecipe):
    name = 'system-tools-backends'
    version = '2.6.0'

    buildRequires = [ 'intltool:runtime', 'gettext:runtime',
                      'perl-Net-DBus:perl', 'chkconfig:runtime','glib:devel',
                      'perl-XML-Twig:perl', 'PolicyKit:devel', 'perl:devel' ]


    if Arch.x86:
        extraConfig = '--with-net-dbus=%(libdir)s/perl5/vendor_perl/5.8.8/i686-linux-thread-multi/Net'
    else:
        extraConfig = '--with-net-dbus=%(libdir)s/perl5/vendor_perl/5.8.8/x86_64-linux-thread-multi/Net'

    extraConfig += ' --with-stb-group=wheel'

    def unpack(r):
        GnomePackageRecipe.unpack(r)
        r.addPatch('foresight.patch')
        r.addPatch('copy_not_link.patch')
        r.addSource('system-tools-backends.init')

    def install(r):
        GnomePackageRecipe.install(r)
        r.Install('system-tools-backends.init',
            '%(initdir)s/system-tools-backends')

        r.Requires('perl-Time-HiRes:perl', '%(bindir)s/system-tools-backends')
        r.Requires('perl-XML-Parser:perl', '%(bindir)s/system-tools-backends')

    def policy(r):
        r.Requires(exceptDeps='perl:.*')
        r.Requires('distro-release:config', '%(bindir)s/system-tools-backends')
