#
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

loadSuperClass('kdecorepackage')
class kdeBaseRuntime(kdeCorePackageRecipe):

    name = 'kdebase-runtime'
    version = '4.6.1'


    buildRequires = [
        'alsa-lib:devel',
        'attica:devel',
        'bzip2:devel',
        'bzr:runtime',
        'clucene:devel',
        'cvs:runtime',
        'doxygen:runtime',
        'exiv2:devel',
        'graphviz:runtime',
        'kdelibs:lib',
        'kdelibs:runtime',
        'kdelibs:devel',
        'libcanberra:devel',
        'libjpeg:devel',
        'libssh:devel',
        'libX11:devel',
        'libXcursor:devel',
        'libxkbfile:devel',
        'libXpm:devel',
        'libXScrnSaver:devel',
        'libXtst:devel',
        'libXv:devel',
        'libXxf86misc:devel',
        'NetworkManager:devel',
        'OpenEXR:devel',
        'openslp:devel',
        'openssh:runtime',
        'perl:devel',
        'pulseaudio:devel',
        'python:devel',
        'qca2:devel',
        'samba:devel',
        'shared-desktop-ontologies:devellib',
        'soprano:devel',
        'soprano:runtime',
        'strigi:devel',
        'xine-lib:devel',
        'xz:devel',
        'xz:runtime',
        'git:runtime', 
        'mercurial:runtime', 
        'subversion:runtime',
        ]


    def unpack(r):
        r.addArchive('mirror://kde//stable/%(version)s/src/%(name)s-%(version)s.tar.bz2')

        r.cmakeArgs += (
            ' -DWITH_Nepomuk:BOOL=OFF '
            ' -DCMAKE_SKIP_RPATH=ON '
            ' -DWITH_QNtrack=OFF '
            ' -DWITH_Xine=OFF '
            )


    def postUnpack(r):

        r.addSource('kde.pam', dest='%(sysconfdir)s/pam.d/kde')


        # Kubuntu patches
        r.addPatches(
            '03_disable_usr_lib_install_rpath.diff',
            '05_dont_show_netattach_outside_kde.diff',
            'kubuntu_01_nodisplay_knetattach.diff',
            'kubuntu_03_knetattach_use_sftp.diff',
            'kubuntu_07_oxygenify_knetattach_icon.diff',
            'kubuntu_89_strigi_ram_detection.diff',
            'kubuntu_91_phonon_forget_option.diff',
        )

    def policy(r):

        # Installed by hicolor-icon-theme
        r.Remove('%(datadir)s/icons/hicolor/index.theme')

        r.Requires('oxygen-icon-theme:data', '%(bindir)s/kcmshell4')
        r.Requires('hicolor-icon-theme:data', '%(bindir)s/kcmshell4')
        r.Requires('shared-mime-info:runtime', '%(bindir)s/kcmshell4')

        r.SetModes('%(prefix)s/libexec/kdesud', 02755)

        r.DanglingSymlinks(exceptions='%(datadir)s/icons/default.kde4')
