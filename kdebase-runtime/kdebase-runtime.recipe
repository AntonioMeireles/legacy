#
# Copyright (c) 2004-2009 rPath, Inc.
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

loadSuperClass('kdecorepackage')
class kdeBaseRuntime(kdeCorePackageRecipe):

    name = 'kdebase-runtime'
    version = '4.4.3+r1122210'

    module = 'kdebase/runtime'

    buildRequires = [
        'alsa-lib:devel', 'attica:devel', 'bzip2:devel', 'clucene:devel',
        'exiv2:devel', 'libjpeg:devel', 'libssh:devel', 'libX11:devel',
        'libXcursor:devel', 'OpenEXR:devel', 'perl:devel', 'pulseaudio:devel',
        'samba:devel', 'soprano:devel', 'strigi:devel', 'xine-lib:devel'
    ]

    def postUnpack(r):

        r.addSource('kde.pam', dest='%(sysconfdir)s/pam.d/kde')

        # Kubuntu patches
        r.addPatches(
            '04_disable_debug_by_default.diff',
            'kubuntu_01_nodisplay_knetattach.diff',
            'kubuntu_03_knetattach_use_sftp.diff',
            'kubuntu_07_oxygenify_knetattach_icon.diff',
            'kubuntu_87_nepomuk_virtuosoconverter.diff',
            'kubuntu_88_nepomuksearch_uds-url.diff',
            'kubuntu_89_strigi_ram_detection.diff',
        )

    def policy(r):

        # Installed by hicolor-icon-theme
        r.Remove('%(datadir)s/icons/hicolor/index.theme')

        r.Requires('oxygen-icon-theme:data', '%(bindir)s/kcmshell4')
        r.Requires('hicolor-icon-theme:data', '%(bindir)s/kcmshell4')
        r.Requires('shared-mime-info:runtime', '%(bindir)s/kcmshell4')

        r.SetModes('%(libdir)s/kde4/libexec/kdesud', 02755)

        r.DanglingSymlinks(exceptions='%(datadir)s/icons/default.kde4')

