#
# Copyright (c) 2005 rPath, Inc.
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

class UMBScheme(CPackageRecipe):

    name = 'umb-scheme'
    version = '3.2'
    # need zip in order to unzip slib
    buildRequires = [ 'texinfo:runtime', 'unzip:runtime' ]

    def setup(r):
        r.addArchive('http://www.cs.umb.edu/~wrc/scheme/umb-scheme-%(version)s.tar.gz')
        r.addArchive('http://swissnet.ai.mit.edu/ftpdir/scm/slib3a1.zip',
                     dir='/%(datadir)s/umb-scheme')
        srpm = 'http://download.fedora.redhat.com/pub/fedora/linux/core/3/SRPMS/umb-scheme-3.2-35.src.rpm'
        r.addSource('slibcat', rpm=srpm, dest='%(datadir)s/umb-scheme/slibcat',
                    mode=0644)
        r.addPatch('umb-scheme-3.2-misc.patch', rpm=srpm)
        r.addPatch('umb-scheme-3.2-texinfo.patch', rpm=srpm)
        r.addPatch('umb-scheme-3.2-config.patch', rpm=srpm)
        r.addPatch('umb-scheme-3.2-man.patch', rpm=srpm)
        r.addPatch('umb-scheme-3.2-chapter.patch', rpm=srpm)
        r.addPatch('umb-scheme-3.2-slib2c7.patch', rpm=srpm)
        r.addPatch('umb-scheme-3.2-share.patch', rpm=srpm,
                   dir='%(datadir)s/umb-scheme/')
        r.addPatch('umb-scheme-3.2-vi.patch', rpm=srpm)
        r.mainDir('scheme-%(version)s')
        r.Make()
        r.Run('makeinfo scheme.texinfo')
        r.Install('scheme', '%(bindir)s/umb-scheme')
        r.Install('scheme.1', '%(mandir)s/man1/umb-scheme.1')
        r.Install('scheme.info', '%(infodir)s/')
        r.Install('prelude.scheme', '%(datadir)s/umb-scheme/')
        r.Move('%(datadir)s/umb-scheme/slib/slib.info', '%(infodir)s/')

