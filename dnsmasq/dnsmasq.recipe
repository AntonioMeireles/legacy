#
# Copyright (c) 2004-2006 rPath, Inc.
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

class dnsmasq(CPackageRecipe):

    name = "dnsmasq"
    version = "2.26"

    def setup(r):
        r.addArchive('http://www.thekelleys.org.uk/%(name)s/%(name)s-%(version)s.tar.gz')
        r.addPatch('dnsmasq-2.26-initscript-rpath.patch')

        r.Make()
        r.install()

    def install(r):
        #Start before sendmail & rmake but after openvpn.
        r.Replace('^# chkconfig: 2345 99 01$', '# chkconfig: 2345 79 01',
                  'rpm/dnsmasq.rh')
        #Make install doesn't work quite right, so, since there are only a
        #handful of files, install them here
        r.Install("src/dnsmasq", "%(sbindir)s/", mode=0755)
        r.Install("man/dnsmasq.8", "%(mandir)s/man8/", mode=0644)
        r.Install("rpm/dnsmasq.rh", "%(initdir)s/dnsmasq", mode=0755)
        r.Install("dnsmasq.conf.example", "%(sysconfdir)s/dnsmasq.conf", mode=0644)
        r.Install("contrib/openvpn/dhclient-enter-hooks", "%(sysconfdir)s/", mode=0644)
        r.TagSpec("initscript", "%(initdir)s/")
