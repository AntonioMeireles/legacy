#
# Copyright (c) 2004-2005 rPath, Inc.
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

class Ftp(CPackageRecipe):
    name = 'ftp'
    version = '0.17'

    buildRequires = [ 'ncurses:devel', 'readline:devel' ]

    def setup(r):
        #latest version in netkit-devel/
        r.addArchive('ftp://ftp.uk.linux.org/pub/linux/Networking/netkit/netkit-ftp-%(version)s.tar.gz')
        r.addPatch('netkit-ftp-0.17-pre20000412.pasv-security.patch')
        r.addPatch('netkit-ftp-0.17-acct.patch')
        r.addPatch('netkit-ftp.usagi-ipv6.patch')

        r.ManualConfigure('--with-c-compiler=%(cc)s --enable-ipv6')

        r.Replace(('^CC=.*$', 'CC=%(cc)s'),
                  ('-O2', '%(cflags)s -D_GNU_SOURCE -D_LARGEFILE_SOURCE -D_LARGEFILE64_SOURCE -D_FILE_OFFSET_BITS=64'),
                  ('^BINDIR=.*$', 'BINDIR=%(bindir)s'),
                  ('^MANDIR=.*$', 'MANDIR=%(mandir)s'),
                  ('^SBINDIR=.*$', 'SBINDIR=%(sbindir)s'),
                  'MCONFIG')

        r.Make()
        r.MakeInstall(rootVar='INSTALLROOT')
