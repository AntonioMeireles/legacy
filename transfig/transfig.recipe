#
# Copyright (c) 2004, 2008 rPath, Inc.
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

class TransFig(CPackageRecipe):
    name = 'transfig'
    version = '3.2.4'

    buildRequires = [
        'imake:runtime', 'libjpeg:devel', 'libpng:devel', 'zlib:devel',
    ]

    def setup(r):
        r.macros.xfig_libdir = '%(x11prefix)s/lib/X11/xfig'
        r.macros.fig2dev_libdir = '%(datadir)s/fig2dev'

        r.addArchive('http://www.xfig.org/xfigdist/transfig.%(version)s.tar.gz')
        srpm='ftp://download.fedora.redhat.com/pub/fedora/linux/core/2/SRPMS/transfig-3.2.4-6.src.rpm'
        r.addPatch('transfig.3.2.4-strerror.patch', rpm=srpm)
        r.addPatch('transfig-3.2.4-gcc33.patch', rpm=srpm)
        r.addPatch('transfig.3.2.4-broken.patch', rpm=srpm)

        os.environ['PATH'] = os.environ['PATH'] + ':/usr/X11R6/bin'
        r.Run('xmkmf')
        r.Make('Makefiles XFIGLIBDIR=%(xfig_libdir)s'
               ' FIG2DEV_LIBDIR=%(fig2dev_libdir)s')
        r.Make('XFIGLIBDIR=%(xfig_libdir)s FIG2DEV_LIBDIR=%(fig2dev_libdir)s')

        r.MakeDirs('%(xfig_libdir)s', '%(fig2dev_libdir)s')
        r.Make('BINDIR=%(destdir)s/%(bindir)s'
               ' FIG2DEV_LIBDIR=%(destdir)s/%(fig2dev_libdir)s'
               ' XFIGLIBDIR=%(destdir)s/%(xfig_libdir)s'
               ' MANSOURCEPATH=%(destdir)s/%(mandir)s/man'
               ' DOCDIR=%(destdir)s/%(docdir)s'
               ' install install.man')
        for script in ('fig2ps2tex', 'fig2ps2tex.sh', 'pic2tpic'):
            r.Install('fig2dev/%s.script'%script, '%(bindir)s/'+script, mode=0755)
        r.Doc('CHANGES', 'NOTES', 'README', 'LATEX.AND.XFIG')
