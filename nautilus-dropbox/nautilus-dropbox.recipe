#
# Copyright (c) 2008-2009 Foresight Linux
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

class NautilusDropbox(AutoPackageRecipe):
    name = 'nautilus-dropbox'
    version = '0.6.1'

    buildRequires = ['atk:devel', 'cairo:devel', 'dbus-glib:devel', 
        'dbus:devel', 'docutils:runtime', 'expat:devel', 'fontconfig:devel',
        'freetype:devel', 'gcc-c++:runtime', 'glib:devel', 'gtk:devel',
        'gtk:runtime', 'libX11:devel', 'libXrender:devel', 'libnotify:devel',
        'libpng:devel', 'libxcb:devel', 'nautilus:devel', 'pango:devel',
        'pixman:devel', 'pkgconfig:devel', 'pygtk:devel', 'xcb-util:devel',
        'zlib:devel']


    def unpack(r):
        r.addArchive('http://linux.dropbox.com/packages/')
        r.addSource("nautilus-dropbox.tagdescription", macros=True)
        r.addSource("nautilus-dropbox.taghandler", macros=True)

        # anything above 0.6.1  fails to mook as 
        # configure wants to call python -c 'import gtk'
        # which fails inside chroots as no X  display there...
#        r.Replace('import gtk', 'print "import gtk"', 'configure')
#        r.Replace('import gtk', '# import gtk"', 'serializeimages.py')


    def makeinstall(r):
        AutoPackageRecipe.makeinstall(r)
        r.Install("nautilus-dropbox.tagdescription",
            "%(tagdescriptiondir)s/nautilus-dropbox")
        r.Install("nautilus-dropbox.taghandler",
            "%(taghandlerdir)s/nautilus-dropbox", mode=0755)

    def policy(r):
        r.Requires('%(bindir)s/dropbox','%(taghandlerdir)s/')

        # Taghandler dependencies
        r.Requires('coreutils:runtime', '%(taghandlerdir)s/')
        r.Requires('grep:runtime', '%(taghandlerdir)s/')
        r.Requires('procps:runtime', '%(taghandlerdir)s/')
