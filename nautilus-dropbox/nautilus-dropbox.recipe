#
# Copyright (c) 2008-2009 Foresight Linux
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

class NautilusDropbox(AutoPackageRecipe):
    name = 'nautilus-dropbox'
    version = '0.6.8'

    buildRequires = [ 'atk:devel', 'cairo:devel', 'dbus-glib:devel', 
                      'dbus:devel', 'docutils:runtime', 'expat:devel', 'fontconfig:devel',
                      'freetype:devel', 'gcc-c++:runtime', 'glib:devel', 'gtk:devel',
                      'gtk:runtime', 'libX11:devel', 'libXrender:devel', 'libnotify:devel',
                      'libpng:devel', 'libxcb:devel', 'nautilus:devel', 'pango:devel',
                      'pixman:devel', 'pkgconfig:devel', 'pygtk:devel', 'xcb-util:devel',
                      'zlib:devel', 'desktop-file-utils:runtime', 'nautilus:runtime',
                      'pygtk:python', 'python:devel', 'pygtk:runtime', 'pygtk:devel']

    def unpack(r):
        r.addArchive('http://linux.dropbox.com/packages/')
        r.addSource("nautilus-dropbox.tagdescription", macros=True)
        r.addSource("nautilus-dropbox.taghandler", macros=True)
        # configure wants to call python -c 'import gtk'
        # which fails inside chroots as no X  display there...
        r.Replace('import gtk', 'print "import gtk"', 'configure')
        # XXX still doesn't mook
        # even while building this expects an X display to be around

    def makeinstall(r):
        AutoPackageRecipe.makeinstall(r)
        r.Install("nautilus-dropbox.tagdescription",
            "%(tagdescriptiondir)s/nautilus-dropbox")
        r.Install("nautilus-dropbox.taghandler",
            "%(taghandlerdir)s/nautilus-dropbox", mode=0755)

    def policy(r):
        r.Requires('%(bindir)s/dropbox','%(taghandlerdir)s/')

        # Taghandler dependencies
        r.Requires('coreutils:runtime', '%(taghandlerdir)s/')
        r.Requires('grep:runtime', '%(taghandlerdir)s/')
        r.Requires('procps:runtime', '%(taghandlerdir)s/')
