#
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

class Gsm(AutoPackageRecipe):

    name = 'gsm'
    version = '1.0.13'

    def unpack(r):

        r.addArchive('http://howto-pages.org/ffmpeg/libgsm-%(version)s.tar.bz2')

        r.MakeDirs((
            '%(mandir)s/man1', '%(mandir)s/man3',
            '%(bindir)s', '%(libdir)s', '%(includedir)s'
        ))


    def configure(r):

        r.Replace(
            ('^CCFLAGS.*= ', 'CCFLAGS = -fPIC '),
            ('^INSTALL_ROOT.*', 'INSTALL_ROOT = %(destdir)s'),
            ('_INSTALL_BIN = .*', '_INSTALL_BIN = $(INSTALL_ROOT)/%(bindir)s'),
            ('_INSTALL_LIB = .*', '_INSTALL_LIB = $(INSTALL_ROOT)/%(libdir)s'),
            ('_INSTALL_INC = .*', '_INSTALL_INC = $(INSTALL_ROOT)/%(includedir)s'),
            ('_INSTALL_MAN = .*/man/', '_INSTALL_MAN = $(INSTALL_ROOT)/%(mandir)s/'),
            'Makefile'
        )

    def policy(r):
	r.Requires(exceptDeps=r'soname\:\ ELF64\/libgsm\.so\.1\(SysV\ x86\_64\)')
