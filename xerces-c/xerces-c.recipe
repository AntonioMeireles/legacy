#
# Copyright (c) 2007 rPath, Inc.
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

class XercesC(AutoPackageRecipe):
    name = 'xerces-c'
    version = '2.7.0'

    buildRequires = [ 'autoconf:runtime', 'libstdc++:devel' ]

    def unpack(r):
        # cvc refresh is your friend!
        r.macros.archive_version = 'current'
        r.addArchive('http://www.apache.org/dist/xml/xerces-c/')

        # This package manages to use autoconf in an unusual way
        r.Environment('XERCESCROOT', '%(builddir)s/../..')
        r.Environment('TRANSCODER', 'NATIVE')
        r.Environment('MESSAGELOADER', 'INMEM')
        r.Environment('NETACCESSOR', 'Socket')
        r.Environment('THREADS', 'pthread')
        r.Environment('LIBS', '-lpthread')
        if Arch.bits64:
            r.Environment('BITSTOBUILD', '64')
        else:
            r.Environment('BITSTOBUILD', '32')

        r.macros.cflags += (' -DNDEBUG -DPROJ_XMLPARSER'
            ' -DPROJ_XMLUTIL -DPROJ_PARSERS -DPROJ_SAX4C'
            ' -DPROJ_SAX2 -DPROJ_DOM -DPROJ_DEPRECATED_DOM'
            ' -DPROJ_VALIDATORS -DXML_USE_NATIVE_TRANSCODER'
            ' -DXML_USE_INMEM_MESSAGELOADER -DXML_USE_PTHREADS'
            ' -DXML_USE_NETACCESSOR_SOCKET')
        
        r.mainDir('xerces-c-src_%s/src/xercesc' %r.version.replace('.', '_'))
        r.Run('autoconf')
