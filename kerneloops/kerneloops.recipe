#
# Copyright (c) 2008 rPath, Inc.
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

class Kerneloops(CPackageRecipe):
    name = 'kerneloops'
    version = '0.11'

    buildRequires = [ 'curl:devel', 'chkconfig:runtime', 'dbus-glib:devel', 'dbus:devel',
                      'desktop-file-utils:runtime', 'glib:devel', 'gtk:devel',
                      'libnotify:devel', 'pkgconfig:devel', 'expat:devel' ]

    def setup(r):
        r.addArchive('http://www.kerneloops.org/download/')
        # These patches will probably be unnecessary after the next
        # upstream release of kerneloops; they have been sent upstream
        # and have tentative approval.
        r.addPatch('no_sleep_known_buffer_length.patch')
        r.addPatch('provide_details_to_user.patch')
        r.addPatch('limit_log_buffer_length.patch')
        r.addPatch('find_and_report_kver.patch')

        r.Replace(re.escape(r'desktop-file-install --mode 0644 --dir=$(DESTDIR)/etc/xdg/autostart/ kerneloops-applet.desktop'),
                  'install -m 0644 kerneloops-applet.desktop $(DESTDIR)/etc/xdg/autostart/', 'Makefile')
        r.Make()
        r.MakeInstall()
        r.Install('kerneloops.init', '%(initdir)s/kerneloops', mode=0755)
        r.TagSpec('desktop-file', '%(sysconfdir)s/xdg/autostart/kerneloops-applet.desktop')
