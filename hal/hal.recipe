#
# Copyright (c) 2004-2006 rPath, Inc.
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

loadSuperClass('rpmpackage.recipe', label='conary.rpath.com@rpl:devel')
class Hal(RPMPackageRecipe,CPackageRecipe):
    buildRequires = [ 'expat:devel', 'glib:devel', 'dbus:devel', 
        'hwdata:runtime', 'libcap:devel', 'popt:devel',
        'dbus-glib:devellib', 'glibc:devel', 'libusb:devel',
        'perl-XML-Parser:perl', 'gnome-python:python',
        'pygtk:python', 'binutils:runtime', 'docbook-utils:runtime',
        'doxygen:runtime', 'gawk:runtime', 'gettext:runtime',
        'glibc:runtime', 'perl:runtime', 'pkgconfig:devel',
        'dbus-glib:devel', 'pygobject:python', 'udev:devel', 'xmlto:runtime' ]

    extraConfig = '--disable-docbook-docs --with-os-type=redhat --enable-console-kit --enable-acl-management --enable-umount-helper --enable-acpi-ibm --enable-acpi-toshiba --with-eject=/usr/sbin/eject'

    extraConfig += '  --with-hal-user=root   --with-hal-group=root' 
    #workaround solong the conary group / user support is broken. Otherway the dbus will not start

    name = 'hal'
    version = '0.5.9'
    rpmRelease = '5.fc7'
    rpmPatches = ['hal-0.5.9-fixes.patch']
    def setup(r):
        r.unpack()
        r.addAction("sed -i '/# chkconfig:/s/ 98/ 09/g' hald/haldaemon.in")
        r.Configure(r.extraConfig)
        r.Make()
        r.MakeInstall()
        r.PackageSpec('hal-gnome', '%(datadir)s/%(name)s/device-manager/',
            '%(bindir)s/hal-device-manager')
        r.TagSpec('initscript', '%(initdir)s/')
        r.Requires('hal-info:data', '%(sbindir)s/hald')
        r.Requires('ConsoleKit:runtime', '%(sbindir)s/hald')
