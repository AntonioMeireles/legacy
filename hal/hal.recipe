#
# Copyright (c) 2004 Specifix, Inc.
# All rights reserved
#
# FIXME make sure builddocs = True buildRequires is complete
# FIXME I brute-force-disabled builddocs here because something doesn't
#       seem to parse properly when building docs
#
# Search for GIL for current gil changes -
# GIL in a commented line usually means that line has just been removed

class Hal(PackageRecipe):
    buildRequires = [ 'expat:devel', 'glib:devel', 'dbus:devel', 
                      'hwdata:runtime', 'libcap:devel',
                      'popt:devel' ]

    extraConfig = '--disable-docbook-docs --enable-hotplug-map --enable-fstab-sync --with-init-scripts=redhat --with-os-type=redhat --with-pid-file=%(localstatedir)s/run/haldaemon.pid --enable-sysfs-carrier'
    
    extraConfig += '  --with-hal-user=root   --with-hal-group=haldaemon' 
    #workaround solong the conary group / user support is broken. Otherway the dbus will not start

    name = 'hal'
    version = '0.5.3'

    def setup(r):
	r.addArchive('http://freedesktop.org/~david/dist/%(name)s-%(version)s.tar.gz')

        # GIL
        # New 0.5.2 patches:

        r.addPatch('hal-0.5.2-dont-mount-sync.patch',level=0)
        r.addPatch('hal-0.5.2-fixup-fstab-sync-man-page.patch',level=0)
        r.addPatch('hal-0.5.2-fix-doublefree.patch',level=0)

        r.addAction("sed -i '/# chkconfig:/s/ 98/ 09/g' hald/haldaemon.in")

        r.Configure(r.extraConfig)
        r.Make()
        r.User('haldaemon', 68, comment='HAL daemon',
             homedir='/')
        r.Group('haldaemon', 68)
        r.UtilizeUser('haldaemon', '.*')
        r.UtilizeGroup('haldaemon', '.*')

	r.MakeInstall()

	r.PackageSpec('hal-gnome', '%(datadir)s/%(name)s/device-manager/',
				   '%(bindir)s/hal-device-manager')
	r.TagSpec('initscript', '%(initdir)s/')
