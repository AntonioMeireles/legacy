#
# Copyright (c) 2004-2006 rPath, Inc.
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

class Hal(PackageRecipe):
    buildRequires = [ 'expat:devel', 'glib:devel', 'dbus:devel', 
        'hwdata:runtime', 'libcap:devel', 'popt:devel',
        'dbus-glib:devellib', 'glibc:devel', 'libusb:devel',
        'perl-XML-Parser:perl', 'gnome-python:python',
        'pygtk:python', 'binutils:runtime', 'docbook-utils:runtime',
        'doxygen:runtime', 'gawk:runtime', 'gettext:runtime',
        'glibc:runtime', 'perl:runtime', 'pkgconfig:devel',
        'dbus-glib:devel' ]

    extraConfig = '--disable-docbook-docs --enable-hotplug-map --with-init-scripts=redhat --with-os-type=redhat --with-pid-file=%(localstatedir)s/run/haldaemon.pid --enable-sysfs-carrier --with-backend=linux2'
    
    extraConfig += '  --with-hal-user=root   --with-hal-group=root' 
    #workaround solong the conary group / user support is broken. Otherway the dbus will not start

    name = 'hal'
    version = '0.5.7.1'

    def setup(r):
        r.addArchive('http://freedesktop.org/~david/dist/%(name)s-%(version)s.tar.gz')
        r.addPatch('hal-0.5.7-dbus-deprecated.patch')
        r.addPatch('hal-0.5.7-lid-open-fix.patch')
        r.addPatch('hal-0.5.7-fix-fedora-power-save.patch')
        r.addPatch('hal-0.5.7-pcmcia-readers.patch')

        r.addAction("sed -i '/# chkconfig:/s/ 98/ 09/g' hald/haldaemon.in")
        r.Configure(r.extraConfig)
        r.Make()
        r.MakeInstall()
        r.PackageSpec('hal-gnome', '%(datadir)s/%(name)s/device-manager/',
            '%(bindir)s/hal-device-manager')
        r.TagSpec('initscript', '%(initdir)s/')
