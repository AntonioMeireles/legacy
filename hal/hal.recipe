#
# Copyright (c) 2004 Specifix, Inc.
# All rights reserved
#
# FIXME make sure builddocs = True buildRequires is complete
# FIXME I brute-force-disabled builddocs here because something doesn't
#       seem to parse properly when building docs
#
# Search for GIL for current gil changes -
# GIL in a commented line usually means that line has just been removed

class Hal(PackageRecipe):
    buildRequires = [ 'expat:devel', 'glib:devel', 'dbus:devel', 
                      'hwdata:runtime', 'libcap:devel',
                      'popt:devel' ]

    extraConfig = '--disable-docbook-docs --enable-hotplug-map --enable-fstab-sync --with-init-scripts=redhat --with-pid-file=%(localstatedir)s/run/haldaemon.pid --enable-sysfs-carrier'

    #GIL - this is the Fedora configure switches for hal 0.5.2
    #extraConfig = '--disable-docbook-docs --enable-fstab-sync --with-os-type=redhat --enable-pcmcia-support --with-stab-file=/var/lib/pcmcia/stab'

    name = 'hal'
    version = '0.5.2'

    def setup(r):
        #GILsrpm = "http://download.fedora.redhat.com/pub/fedora/linux/core/3/SRPMS/hal-0.4.0-10.src.rpm"
	r.addArchive('http://freedesktop.org/~david/dist/%(name)s-%(version)s.tar.gz')

        #r.addPatch('hal-0.4.0-allow-floppy-drives.patch', level=0, rpm=srpm)
	#r.addPatch('01-lsbrelease.patch')
	#r.addPatch('02-procfs.patch')
	#GILr.addPatch('03-cdrom-debugging.patch')
	#GILr.addPatch('04-hwdb.patch')
	#r.addPatch('05-dmidecode.patch')
	#GILr.addPatch('06-harddisk-volumes.patch')
	#r.addPatch('99-autoconf.patch')
	#GILr.addPatch('hal-dbus_max_match_rules_per_connection.diff')
	#GILr.addPatch('hal-fdi.patch')
        #GILr.addPatch('hal-hotplug-map.patch')
	#GILr.addPatch('ids-search.patch')
	#GILr.addPatch('no_sysdevice.patch')
	#GILr.addPatch('storage-policy.patch')
	#GILr.addSource('ipod.fdi',dir='fdi/95userpolicy/')
	#GILr.Replace('dist_fdi95userpolicy_DATA =','dist_fdi95userpolicy_DATA = ipod.fdi','fdi/95userpolicy/Makefile.in')

        # GIL
        # New 0.5.2 patches:

        r.addPatch('hal-0.5.2-dont-mount-sync.patch')
        r.addPatch('hal-0.5.2-fixup-fstab-sync-man-page.patch')
        r.addPatch('hal-0.5.2-fix-doublefree.patch')

        r.addAction("sed -i '/# chkconfig:/s/ 98/ 09/g' hald/haldaemon.in")

	r.Configure(r.extraConfig)
	r.Make()
	    
	r.MakeInstall()

	r.PackageSpec('hal-gnome', '%(datadir)s/%(name)s/device-manager/',
				   '%(bindir)s/hal-device-manager')
	r.TagSpec('initscript', '%(initdir)s/')
