#
# Copyright (c) 2007 Foresight Linux
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

loadRecipe('gnomepackage.recipe')
class GnomePackagekit(GnomePackageRecipe):
    name = 'gnome-packagekit'
    version = '2.29.3'

    buildRequires =  [ 'GConf:runtime',
                       'PackageKit:devel',
                       'desktop-file-utils:runtime',
                       'libglade:devel',
                       'libnotify:devel',
                       'rarian:runtime',
                       'GConf:devel',
                       'ORBit2:devel',
                       'gnome-doc-utils:devel',
                       'libxml2:runtime',
                       'gnome-doc-utils:runtime',
                       'libsexy:devel',
                       'dbus-glib:runtime',
                       'opensp:runtime',
                       'pygtk:python',
                       'gnome-menus:devel',
                       'python:devel',
                       'gnome-common:runtime',
                       'PackageKit:devellib',
                       'DeviceKit-power:devel',
                       'libcanberra:devel',
                       'unique:devel',
                       'polkit-gnome:devel',
                       'polkit:devel',
                       ]
    extraConfig = '--disable-scrollkeeper  --disable-compile-warnings '

    def unpack(r):
        r.addArchive('http://www.packagekit.org/releases/')
        r.addPatch('disable-font-helper.patch') 
#        r.addPatch('update_quickfix.patch') 
#        r.addPatch('remove_quickfix.patch') 
#        r.addPatch('upgrade_quickfix.patch') 

    def policy(r):
        r.Requires('polkit-gnome:runtime', '%(bindir)s/gpk-application')
        r.Requires('GConf:runtime', '%(sysconfdir)s/gconf/schemas/gnome-packagekit.schemas')
        # r.Remove('%(datadir)s/applications/gpk-repo.desktop')
        r.Remove('%(datadir)s/applications/gpk-service-pack.desktop')
        # r.Replace("Exec=gpk-update-viewer2","Exec=gpk-update-viewer","%(datadir)s/applications/gpk-update-viewer.desktop")
        r.Move('%(datadir)s/gnome/autostart/gpk-update-icon.desktop', '%(sysconfdir)s/xdg/autostart/gpk-update-icon.desktop')
