#
# Copyright (c) 2007 Foresight Linux
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

loadRecipe('gnomepackage.recipe')
class GnomePackagekit(GnomePackageRecipe):
    name = 'gnome-packagekit'
    version = '2.27.2'
    configureName ="autogen.sh"

    buildRequires =  ['GConf:runtime', 'PackageKit:devel', 'desktop-file-utils:runtime', 'libglade:devel', 'libnotify:devel', 'rarian:runtime', 'GConf:devel', 'ORBit2:devel', 'gnome-doc-utils:devel', 'libxml2:runtime', 'gnome-doc-utils:runtime', 'libsexy:devel', 'glitz:devel', 'PolicyKit-gnome:devel', 'PolicyKit:devel', 'dbus-glib:runtime', 'opensp:runtime', 'pygtk:python', 'gnome-menus:devel','python:devel','gnome-common:runtime','PackageKit:devellib']
    extraConfig = '--disable-scrollkeeper  --disable-compile-warnings '

    def unpack(r):
        #r.addArchive('http://www.packagekit.org/releases/')
        r.addGitSnapshot('git://people.freedesktop.org/~hughsient/gnome-packagekit')
        r.addPatch('werror.patch') 
        #r.Run('NOCONFIGURE=yes ./autogen.sh')
       # r.addPatch('not_show_in_fix.patch') 
       # r.Environment('LIBSEXY_LIBS', '-L%(libdir)s -lsexy -lgtk-x11-2.0 -lgdk-x11-2.0 -latk-1.0 -lgdk_pixbuf-2.0 -lpangocairo-1.0 -lpango-1.0 -lcairo -lgobject-2.0 -lgmodule-2.0 -ldl -lglib-2.0 -lfreetype -lfontconfig -lglitz -lpng12 -lxcb -lxcb-render -lxcb-render-util -lXrender -lX11 -lpthread -lxml2 -lz -lm')
        r.MakeDirs("m4")
        r.Run("gnome-autogen.sh")
        r.Run('autoreconf')

    def policy(r):
        r.Requires('PolicyKit-gnome:runtime', '%(bindir)s/gpk-application')
        r.Requires('GConf:runtime', '%(sysconfdir)s/gconf/schemas/gnome-packagekit.schemas')
        r.Remove('%(datadir)s/applications/gpk-repo.desktop')
        r.Remove('%(datadir)s/applications/gpk-service-pack.desktop')
        #r.Replace("Exec=gpk-update-viewer2","Exec=gpk-update-viewer","%(datadir)s/applications/gpk-update-viewer.desktop")
        r.Move('%(datadir)s/gnome/autostart/gpk-update-icon.desktop', '%(sysconfdir)s/xdg/autostart/gpk-update-icon.desktop')
