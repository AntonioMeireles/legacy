#
# Copyright (c) 2005-2008 rPath, Inc.
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

class FoomaticFilters(AutoPackageRecipe):
    name = 'foomatic-filters'
    version = '3.0_20071218'

    buildRequires = [ 'cups:devel', 'a2ps:runtime', 'autoconf:runtime',
                      'enscript:runtime', 'file:runtime' ]

    def unpack(r):
        r.macros.archive_version = r.version.replace('_', '-')
        r.addArchive('http://www.linuxprinting.org/download/foomatic/')

        # Multilib issues
        r.Replace(
            '^LIBSEARCHPATH=.*',
            'LIBSEARCHPATH=%(libdir)s:%(libexecdir)s',
            'configure'
        )

    def configure(r):
        # More multilib issues (RPL-2295)
        r.Configure(preConfigure='CUPS_FILTERS=%(libdir)s/cups/filter CUPS_BACKENDS=%(libdir)s/cups/backend PPR_INTERFACES=%(libdir)s/ppr/interfaces PPR_LIB=%(libdir)s/ppr/lib')

    def policy(r):
        r.Move('%(sysconfdir)s/foomatic/filter.conf.sample', '%(thisdocdir)s/')
        r.Symlink('%(bindir)s/foomatic-gswrapper', '%(libdir)s/cups/filter/')
        r.Symlink('%(bindir)s/foomatic-rip',
                  '%(libdir)s/cups/filter/cupsomatic')
        r.Symlink('%(bindir)s/foomatic-rip',
                  '%(libdir)s/cups/filter/foomatic-rip-hplip')
        r.Symlink('%(bindir)s/foomatic-rip', '%(bindir)s/lpdomatic')

        r.ComponentSpec('runtime', '%(libdir)s/')
