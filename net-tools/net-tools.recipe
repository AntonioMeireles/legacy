#
# Copyright (c) 2004-2006 rPath, Inc.
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

loadSuperClass('rpmpackage')
class NetTools(RPMPackageRecipe, CPackageRecipe):
    name = 'net-tools'
    version = '1.60'

    buildRequires = [ 'gettext:runtime', ]

    rpmRelease = '73'
    externalArchive = 'http://www.tazenda.demon.co.uk/phil/net-tools/'
    # redhat appears to be the defacto maintainer of this package - hence a
    # huge patchset
    rpmPatches = [ 'net-tools-1.57-bug22040.patch',
        'net-tools-1.60-miiioctl.patch',
        'net-tools-1.60-manydevs.patch',
        'net-tools-1.60-virtualname.patch',
        'net-tools-1.60-cycle.patch',
        'net-tools-1.60-nameif.patch',
        'net-tools-1.60-ipx.patch',
        'net-tools-1.60-inet6-lookup.patch',
        'net-tools-1.60-man.patch',
        'net-tools-1.60-gcc33.patch',
        'net-tools-1.60-trailingblank.patch',
        'net-tools-1.60-interface.patch',
        'net-tools-1.60-gcc34.patch',
        'net-tools-1.60-overflow.patch',
        'net-tools-1.60-siunits.patch',
        'net-tools-1.60-trunc.patch',
        'net-tools-1.60-return.patch',
        'net-tools-1.60-parse.patch',
        'net-tools-1.60-netmask.patch',
        'net-tools-1.60-ulong.patch',
        'net-tools-1.60-bcast.patch',
        'net-tools-1.60-mii-tool-obsolete.patch',
        'net-tools-1.60-netstat_ulong.patch',
        'net-tools-1.60-note.patch',
        'net-tools-1.60-num-ports.patch',
        'net-tools-1.60-duplicate-tcp.patch',
        'net-tools-1.60-statalias.patch',
        'net-tools-1.60-isofix.patch',
        #'net-tools-1.60-bitkeeper.patch',
        'net-tools-1.60-ifconfig_ib.patch',
        'net-tools-1.60-de.patch',
        #'netplug-1.2.9-execshield.patch',
        'net-tools-1.60-pie.patch',
        'net-tools-1.60-ifaceopt.patch',
        'net-tools-1.60-trim_iface.patch',
        'net-tools-1.60-stdo.patch',
        'net-tools-1.60-statistics.patch',
        'net-tools-1.60-ifconfig.patch',
        'net-tools-1.60-arp_overflow.patch',
        'net-tools-1.60-hostname_man.patch',
        'net-tools-1.60-interface_stack.patch',
        'net-tools-1.60-selinux.patch',
        'net-tools-1.60-netstat_stop_trim.patch',
        'net-tools-1.60-netstat_inode.patch',
        'net-tools-1.60-fgets.patch',
        'net-tools-1.60-ifconfig_man.patch',
        'net-tools-1.60-x25-proc.patch',
        'net-tools-1.60-sctp.patch',
        'net-tools-1.60-arp_man.patch',
        'net-tools-1.60-ifconfig-long-iface-crasher.patch',
        'net-tools-1.60-netdevice.patch',
        #'net-tools-1.60-skip.patch',
        ]

    def setup(r):
        r.disableParallelMake()
        r.unpack()
        r.addSource('ether-wake.c', rpm=r.srpm)
        r.addSource('config.rpl', apply='./configure.sh config.rpl')
        r.addSource('config.h.rpl')
        r.addAction('rm config.h && cp config.h.rpl config.h')

        r.Make()
        r.Make('ether-wake')

        r.Run("""
            mv man/de_DE man/de
            mv man/fr_FR man/fr
            mv man/pt_BR man/pt
        """)
        r.MakeInstall('mandir=%(mandir)s', rootVar='BASEDIR')
        r.Install('ether-wake', '%(essentialsbindir)s/', mode=0755)
        r.Remove('%(essentialsbindir)s/rarp', '%(mandir)s/man8/rarp.8*')
