#
# Copyright (c) 2004-2006 rPath, Inc.
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

class XmlTex(PackageRecipe):
    name = 'xmltex'
    version = '20061107'

    buildRequires = [ 'tetex:runtime', ]

    # FIXME: adding crontabs to work around rmake bug RMK-580
    buildRequires.extend(['crontabs:runtime', 'tmpwatch:runtime', ])

    def setup(r):
        # lftp -c mirror ftp://ftp.tex.ac.uk/tex-archive/macros/xmltex/base/
        r.addArchive('http://people.rpath.com/~smithj/')
        r.addSource('xmltexfmtutil.cnf')

        r.Run('pdftex -ini "&pdflatex" pdfxmltex.ini')
        r.Run('tex -ini "&hugelatex" xmltex.ini')
        r.Install('*.{xmt,ini,tex}', 'xmltex.cfg', 'xmltexfmtutil.cnf',
                  '%(datadir)s/texmf/tex/xmltex/')
        r.Install('xmltex.fmt', '%(datadir)s/texmf/web2c/')

        r.Symlink('pdftex', '%(bindir)s/pdfxmltex')
        r.Symlink('tex', '%(bindir)s/xmltex')

        # provided by tetex:runtime
        r.DanglingSymlinks(exceptions='%(bindir)s/(pdfxmltex|xmltex)')

        r.Doc('readme.txt', '*.html')
        r.Requires('tetex:runtime', '%(bindir)s/(pdfxmltex|xmltex)',
                                    '%(datadir)s/texmf/tex/')
        r.InitialContents(r'%(datadir)s/texmf/.*/.*\.fmt')
