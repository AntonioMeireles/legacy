#
# Copyright (c) 2004-2005 rPath, Inc.
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

class LmSensors(CPackageRecipe):
    buildRequires = ['grep:runtime', 'bison:runtime', 'flex:runtime' ]
    name = "lm_sensors"
    version = "2.9.2"

    def setup(r):
        r.addArchive(
          'http://www2.lm-sensors.nu/~lm78/archive/%(name)s-%(version)s.tar.gz',
          keyid='65236AD5')

        # configuration in Makefile...
        r.Replace(('^PREFIX.*', 'PREFIX := %(prefix)s'),
                  ('^ETCDIR.*', 'ETCDIR := %(sysconfdir)s'),
                  ('^LIBDIR.*', 'LIBDIR := %(libdir)s'),
                  ('^MANDIR.*', 'MANDIR := %(mandir)s'),
                  ('^I2C_HEADERS.*', 'I2C_HEADERS := %(includedir)s'),
                  'Makefile')
        r.Make('user')
        r.MakeInstall(installtarget='user_install')
        # user_install shouldn't install kernel header files...
        r.Remove('%(includedir)s/linux', recursive=True)

        r.Install('prog/init/lm_sensors.init', '%(initdir)s/lm_sensors')
