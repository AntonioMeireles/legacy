#
# Copyright (c) 2004-2005 rPath, Inc.
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

class Slang(CPackageRecipe):
    name = 'slang'
    version = '1.4.9'

    buildRequires = [ 'libtool:runtime', 'ncurses:devel' ]

    def setup(r):
        r.disableParallelMake()
        srpm='http://download.fedora.redhat.com/pub/fedora/linux/core/4/SRPMS/slang-1.4.9-17.src.rpm'
        # Source: ftp://space.mit.edu/pub/davis/slang/v1.4/
        r.addArchive('slang-%(version)s.tar.bz2', rpm=srpm)
        r.addSource('README.UTF-8', rpm=srpm)
        r.addPatch('slang-debian-utf8.patch', rpm=srpm)
        r.addPatch('slang-utf8-acs.patch', rpm=srpm)
        r.addPatch('slang-1.4.5-utf8-segv.patch', rpm=srpm)
        r.addPatch('slang-utf8-fix.patch', rpm=srpm)
        r.addPatch('slang-1.4.9-gcc4.patch', rpm=srpm)

        r.Run("sed -i '/ ELF_CFLAGS/s/-O2 -fno-strength-reduce/%(cflags)s/' configure")
        r.Run('cp /usr/share/libtool/config.{sub,guess} autoconf')

        r.Configure('--includedir=%(includedir)s/slang')
        r.Make('elf all')

        r.MakeInstall('install-elf')
        r.Symlink('libslang-utf8.so.%(version)s', '%(libdir)s/libslang-utf8.so.1')
        r.Symlink('libslang-utf8.so', '%(libdir)s/libslang.so')
        r.Symlink('libslang-utf8.a', '%(libdir)s/libslang.a')
        r.Remove('/usr/doc/slang/*.txt', '/usr/doc/slang/*.html')
        # these document slsh, which we do not ship
        r.Remove('%(thisdocdir)s/tm/rtl/{tm-sort,whatelse}.sl')
        r.Move('/usr/doc/slang/', '%(thisdocdir)s/')
        r.Remove('/usr/doc/', recursive=True)
        r.AutoDoc()
        r.Doc('doc/*')
