#
# Copyright (c) 2008-2011 Foresight Linux
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

loadSuperClass('kernelmodulepackage')
class TPsmapiKMOD(KernelModulePackageRecipe):
    name = 'tp_smapi-kernel'
    version =  '0.40'

    def unpack(r):
        r.addArchive('mirror://sourceforge/tpctl/tp_smapi/0.40/tp_smapi-%(version)s.tgz')
        # some useefull deb patches
        for p in [ '01_include-thinkpad_ec.h-directly.patch',
                   '02_hdaps-orientation-update.patch',
                   '03_2.6.37-compatibility.patch']:
            r.addPatch('http://patch-tracker.debian.org/patch/series/dl/tp-smapi/0.40-9/' + p)
        
    def build(r):
        r.Make("KVER=%(kver)s HDAPS=1")

    def policy(r):
        # if we install this we want matching userland...
        r.Requires('hdapsd:runtime', '/lib/modules/%(kver)s/misc/hdaps.ko')

