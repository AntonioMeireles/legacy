#
# Copyright (c) 2008 Lance Haig.
#               2008 Foresight Linux Project
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

loadSuperClass('rpmpackage')
class VirtManager(RPMPackageRecipe,AutoPackageRecipe):

        name = 'virt-manager'
        version = '0.8.0'
        rpmRelease = '5.fc12'

        rpmPatches = [ # Fix disk XML mangling via connect/eject cdrom (bz 516116)
		'%(name)s-%(version)s-cdrom-eject-driver.patch',
		# Fix delete button sensitivity (bz 518536)
		'%(name)s-%(version)s-no-delete-active.patch',
		# Fix populating text box from storage browser in 'New VM' (bz 517263)
		'%(name)s-%(version)s-newvm-storage-cb.patch',
		# Fix a traceback in an 'Add Hardware' error path (bz 517286)
		'%(name)s-%(version)s-addhw-errmsg-typo.patch',
		# Fixes for pylint script to return nicer results on F11/F12
		'%(name)s-%(version)s-pylint-tweak.patch',
		# Don't close libvirt connection for non-fatal errors (bz 522168)
		'%(name)s-%(version)s-conn-close-exception.patch',
		# Manager UI tweaks
		'%(name)s-%(version)s-manager-ui-tweaks.patch',
		# Generate better errors is disk/net stats polling fails
		'%(name)s-%(version)s-stats-logging.patch',
		# Refresh host disk space in create wizard (bz 502777)
		'%(name)s-%(version)s-refresh-disk-space.patch',
		# Offer to fix disk permission issues (bz 517379)
		'%(name)s-%(version)s-fix-path-perms.patch',
		]
        rpmSources = [ 'state_paused.png',
			       'state_running.png',
		       'state_shutoff.png']
                      
        buildRequires = ['atk:devel',
                         'cairo:devel',
                         'dbus-python:python',
                         'desktop-file-utils:runtime',
                         'expat:devel',
                         'fontconfig:devel',
                         'freetype:devel',
                         'gcc-c++:runtime',
                         'gtk-vnc:python', 
                         'glib:devel', 
                         'gnome-python-desktop:python', 
                         'gnome-python:python', 
                         'gtk:devel', 
                         'libX11:devel', 
                         'libXrender:devel', 
                         'libpng:devel', 
                         'libxcb:devel', 
                         'libxml2:python', 
                         'pango:devel', 
                         'perl:runtime', 
                         'pixman:devel', 
                         'pkgconfig:devel', 
                         'pycairo:python', 
                         'pygobject:runtime',
                         'pygobject:python', 
                         'pygtk:python',
                         'pygtk:lib',
                         'pygtk:devellib',
                         'pygtk:devel', 
                         'python:devel', 
                         'rarian:devel', 
                         'rarian:runtime', 
                         'urlgrabber:python', 
                         'vte:python', 
                         'xcb-util:devel', 
                         'zlib:devel',
                         'libvirt:python',
                         'gettext:runtime', 
                         'intltool:runtime',
                         'usermode:runtime',
                         'virtinst:python'
                         ]


        def configure(r):
		for f in r.rpmSources:
			r.Copy(f, 'pixmaps/')
		config  = ' --prefix=%(prefix)s --localstatedir=%(localstatedir)s --libdir=%(libdir)s'
		r.ManualConfigure(config)

        def policy(r):
                # Adjust for console-helper magic
                r.Move('%(bindir)s/%(name)s', '%(sbindir)s/%(name)s')
                r.Symlink('%(bindir)s/consolehelper', '%(bindir)s/%(name)s')

                r.Requires('libvirt:python', '%(sbindir)s/virt-manager')
                r.Requires('virtinst:runtime', '%(sbindir)s/virt-manager')
                r.Requires('virt-viewer:runtime', '%(sbindir)s/virt-manager')

