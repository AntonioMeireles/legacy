#
# Copyright (c) 2008 Lance Haig.
#               2008 Foresight Linux Project
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

loadSuperClass('rpmpackage')
class VirtManager(RPMPackageRecipe,AutoPackageRecipe):

        name = 'virt-manager'
        version = '0.9.0'
        rpmRelease = '7.fc16'

        rpmPatches = [ '%(name)s-fix-net-stats.patch',
		       # Fix 'Resize to VM' graphical option (bz 738806)
		       '%(name)s-fix-resize-to-vm.patch',
		       # Fix deleting guest with managed save data
		       '%(name)s-managed-save-delete.patch',
		       # Fix error when adding default storage
		       '%(name)s-default-storage-error.patch',
		       # Don't flush XML cache on every tick
		       '%(name)s-cache-xml-fix.patch',
		       # Use labels for non-editable network info fields (bz 738751)
		       '%(name)s-host-net-labels.patch',
		       # Fix crashes when deleting a VM (bz 749263)
		       '%(name)s-console-cleanup-crash.patch' ]
                      
        buildRequires = ['atk:devel',
                         'cairo:devel',
                         'dbus-python:python',
                         'desktop-file-utils:runtime',
                         'expat:devel',
                         'fontconfig:devel',
                         'freetype:devel',
                         'gcc-c++:runtime',
                         'gtk-vnc:python', 
                         'glib:devel', 
                         'gnome-python-desktop:python', 
                         'gnome-python:python', 
                         'gtk:devel', 
                         'libX11:devel', 
                         'libXrender:devel', 
                         'libpng:devel', 
                         'libxcb:devel', 
                         'libxml2:python', 
                         'pango:devel', 
                         'perl:runtime', 
                         'pixman:devel', 
                         'pkgconfig:devel', 
                         'pycairo:python', 
                         'pygobject:runtime',
                         'pygobject:python', 
                         'pygtk:python',
                         'pygtk:lib',
                         'pygtk:devellib',
                         'pygtk:devel', 
                         'python:devel', 
                         'rarian:devel', 
                         'rarian:runtime', 
                         'urlgrabber:python', 
                         'vte:python', 
                         'xcb-util:devel', 
                         'zlib:devel',
                         'libvirt:python',
                         'gettext:runtime', 
                         'intltool:runtime',
                         'usermode:runtime',
                         'virtinst:python',
			 'GConf:runtime',
			 'libuser:python',
			 'newt:python',
                         ]


        def configure(r):
		config  = (# ' --without-tui'
			   ' --prefix=%(prefix)s'
			   ' --localstatedir=%(localstatedir)s'
			   ' --libdir=%(libdir)s'
			   ' --with-kvm-packages=qemu-system-x86'
			   )
		r.ManualConfigure(config)
		r.Configure(config)

        def policy(r):
                # Adjust for console-helper magic
                r.Move('%(bindir)s/%(name)s', '%(sbindir)s/%(name)s')
                r.Symlink('%(bindir)s/consolehelper', '%(bindir)s/%(name)s')

                r.Requires('libvirt:python', '%(sbindir)s/virt-manager')
                r.Requires('libvirt:runtime', '%(sbindir)s/virt-manager')
                r.Requires('virtinst:runtime', '%(sbindir)s/virt-manager')
                r.Requires('virt-viewer:runtime', '%(sbindir)s/virt-manager')
                r.Requires('x11-ssh-askpass:runtime', '%(sbindir)s/virt-manager')

