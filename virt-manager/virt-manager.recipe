#
# Copyright (c) 2008 Lance Haig.
#               2008 Foresight Linux Project
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

loadSuperClass('rpmpackage')
class VirtManager(RPMPackageRecipe,AutoPackageRecipe):

        name = 'virt-manager'
        version = '0.8.4'
        rpmRelease = '2.fc13'

        rpmPatches = [ 
		'%(name)s-%(version)s-perms-qemu-user.patch',
		# Fix using a manual 'default' pool (bz 557020)
		'%(name)s-%(version)s-packagekit-packages.patch',
		# Only close connection on specific remote errors
		'%(name)s-%(version)s-close-remote-error.patch',
		# Fix weird border in manager UI (bz 583728)
		'%(name)s-%(version)s-fix-border.patch',
		# Fix broken icons
		'%(name)s-%(version)s-fix-icon-install.patch',
		# Cancel post-install reboot if VM is forced off
		'%(name)s-%(version)s-install-force-off.patch',
		# Fix traceback if customizing a livecd install (bz 583712)
		'%(name)s-%(version)s-livecd-customize.patch',
		# Add pool refresh button
		'%(name)s-%(version)s-pool-refresh-button.patch',
		# Properly autodetect VNC keymap (bz 586201)
		'%(name)s-%(version)s-vnc-auto-keymap.patch',
		# Fix traceback when reconnecting to remote VNC console (bz 588254)
		'%(name)s-%(version)s-vnc-reconnect-traceback.patch',
		# Fix remote VNC connection with zsh as default shell
		'%(name)s-%(version)s-vnc-zsh.patch',
		# Really fix VNC keymap negotiation (bz 586201)
		'%(name)s-%(version)s-really-fix-keymap.patch'
		]
                      
        buildRequires = ['atk:devel',
                         'cairo:devel',
                         'dbus-python:python',
                         'desktop-file-utils:runtime',
                         'expat:devel',
                         'fontconfig:devel',
                         'freetype:devel',
                         'gcc-c++:runtime',
                         'gtk-vnc:python', 
                         'glib:devel', 
                         'gnome-python-desktop:python', 
                         'gnome-python:python', 
                         'gtk:devel', 
                         'libX11:devel', 
                         'libXrender:devel', 
                         'libpng:devel', 
                         'libxcb:devel', 
                         'libxml2:python', 
                         'pango:devel', 
                         'perl:runtime', 
                         'pixman:devel', 
                         'pkgconfig:devel', 
                         'pycairo:python', 
                         'pygobject:runtime',
                         'pygobject:python', 
                         'pygtk:python',
                         'pygtk:lib',
                         'pygtk:devellib',
                         'pygtk:devel', 
                         'python:devel', 
                         'rarian:devel', 
                         'rarian:runtime', 
                         'urlgrabber:python', 
                         'vte:python', 
                         'xcb-util:devel', 
                         'zlib:devel',
                         'libvirt:python',
                         'gettext:runtime', 
                         'intltool:runtime',
                         'usermode:runtime',
                         'virtinst:python',
			 'GConf:runtime',
                         ]


        def configure(r):
		config  = ' --prefix=%(prefix)s --localstatedir=%(localstatedir)s --libdir=%(libdir)s'
		r.ManualConfigure(config)
		r.Configure(config)

        def policy(r):
                # Adjust for console-helper magic
                r.Move('%(bindir)s/%(name)s', '%(sbindir)s/%(name)s')
                r.Symlink('%(bindir)s/consolehelper', '%(bindir)s/%(name)s')

                r.Requires('libvirt:python', '%(sbindir)s/virt-manager')
                r.Requires('libvirt:runtime', '%(sbindir)s/virt-manager')
                r.Requires('virtinst:runtime', '%(sbindir)s/virt-manager')
                r.Requires('virt-viewer:runtime', '%(sbindir)s/virt-manager')

