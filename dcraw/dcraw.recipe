#
# Copyright (c) 2004-2005 rPath, Inc.
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

# We can't use autosource for the source files, because they do not
# have changing version numbers in the names.  Please update them
# with the following scriptlet:
# for file in dcraw.{c,1} dcwrap .badpixels {parse,fixdates}.c ; do
#   rm $file
#   wget http://www.cybercom.net/~dcoffin/dcraw/$file
# done

class DCRaw(CPackageRecipe):
    buildRequires = ['libjpeg:devel']
    name = "dcraw"
    # using the RCS revision of dcraw.c for this package
    # Thanks to Dave Coffin for this excellent software!
    version = "1.305"

    def setup(r):
        # http://www.cybercom.net/~dcoffin/dcraw/
        r.addSource('dcraw.c')
        r.addSource('dcraw.1', dest='%(mandir)s/man1/')
        r.addSource('dcwrap', dest='%(thisdocdir)s/')
        r.addSource('.badpixels', dest='%(thisdocdir)s/dot.badpixels')
        r.addSource('parse.c')
        r.addSource('fixdates.c')

        r.Make('LDFLAGS="-lm -ljpeg" dcraw')
        r.Make('parse fixdates')
        r.Install('dcraw', '%(bindir)s/')
        r.Install('parse', '%(bindir)s/dcraw-parse')
        r.Install('fixdates', '%(bindir)s/dcraw-fixdates')

        r.Provides('file', '%(bindir)s/dcraw')
