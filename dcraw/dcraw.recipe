#
# Copyright (c) 2004-2008 rPath, Inc.
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

class DCRaw(CPackageRecipe):
    name = 'dcraw'
    # use RCS version from dcraw.c as the version
    version = '1.403'
    buildRequires = [ 'libjpeg:devel', ]

    def setup(r):
        # No versions in file names, so refresh with "cvc refresh"
        r.macros.urlbase = 'http://www.cybercom.net/~dcoffin/dcraw'
        r.addSource('%(urlbase)s/dcraw.c')
        r.addSource('%(urlbase)s/dcraw.1', dest='%(mandir)s/man1/')
        r.addSource('%(urlbase)s/.badpixels', dest='%(thisdocdir)s/dot.badpixels')
        r.addSource('%(urlbase)s/parse.c')
        r.addSource('%(urlbase)s/clean_crw.c')
        r.addSource('%(urlbase)s/fujiturn.c')
        r.addSource('%(urlbase)s/fuji_green.c')

        r.Make('LDFLAGS="-lm -ljpeg" dcraw')
        r.Make('parse clean_crw fujiturn')
        r.Make('LDFLAGS="-lm" fuji_green')
        r.Install('dcraw', '%(bindir)s/')
        r.Install('parse', '%(bindir)s/dcraw-parse')
        r.Install('{clean_crw,fujiturn,fuji_green}', '%(bindir)s/')
