#
# Copyright (c) 2004-2008 rPath, Inc.
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

class Unzip(CPackageRecipe):
    name = 'unzip'
    version = '5.52'

    if Use.bootstrap:
        clearBuildRequires()
        buildRequires = [ 'gcc[!cross]', 'glibc', 'setup:runtime',
            'tar:runtime', 'gzip:runtime', ]

    def setup(r):
        r.macros.infozipversion = r.version.replace('.', '')
        r.addArchive('ftp://ftp.info-zip.org/pub/infozip/src/unzip%(infozipversion)s.tar.gz')

        # RPL-2317 CVE-2008-0888
        r.addPatch('unzip-5.5.2-goo-sec.diff')

        r.macros.cflags += ' -I. -DLARGEFILE_SOURCE -D_FILE_OFFSET_BITS=64'
        r.Replace('CF="-O -Wall -I\. \$\(LOC\)"', 'CF="%(cflags)s"',
                  'unix/Makefile')
        r.Make('-f unix/Makefile linux_noasm LF2=""')

        r.MakeInstall('prefix=%(destdir)s/%(prefix)s'
                      ' MANDIR=%(destdir)s/%(mandir)s/man1 install LF2=""')
