#
# Copyright (c) 2004-2006 rPath, Inc.
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

loadSuperClass('rpmpackage')
class Minicom(RPMPackageRecipe, AutoPackageRecipe):

    buildRequires = [ 'lockdev:devel', 'ncurses:devel' ] # > 1.0.0-13
    if Use.desktop:
        buildRequires.append('desktop-file-utils:runtime')

    name = 'minicom'
    version = '2.1'
    rpmRelease = '2'
    rpmPatches = [ 'minicom-drop-privs.patch',
        'minicom-umask.patch', 'minicom-2.00.0-inssp.patch',
        'minicom-2.00.0-gotodir.patch', 'minicom-2.00.0-gcc4.patch' ]

    def unpack(r):
        RPMPackageRecipe.unpack(r)
        # URL:    http://alioth.debian.org/projects/minicom/
        # Source: ftp://metalab.unc.edu/pub/Linux/apps/serialcomm/dialout/
        #r.addArchive('http://alioth.debian.org/download.php/123/minicom-%(version)s.tar.gz')

        r.addSource('minicom.desktop' , rpm=r.srpm, use=Use.desktop)
        r.addPatch('minicom-2.1-rh.patch') #lockdev
        r.addPatch('minicom-2.1-staticbuf.patch')
        r.addPatch('minicom-2.1-esc.patch')

    def install(r):
        r.MakePathsInstall()
        r.MakeDirs('/etc')
        if Use.desktop:
            r.Desktopfile('minicom.desktop')
        r.Install('doc/minicom.users', '%(sysconfdir)s/minicom.users')
        r.Ownership('root', 'uucp', '%(bindir)s/minicom')
        r.User('uucp', 10, groupid=14, homedir='/var/spool/uucp', comment='uucp')
        r.Requires('lockdev:lib', '%(bindir)s/minicom')
