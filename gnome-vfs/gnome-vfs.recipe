#
# Copyright (c) 2004 Specifix, Inc.
# All rights reserved
#

loadRecipe('gnomepackage.recipe')
class GnomeVfs(GnomePackageRecipe):
    
    buildRequires = GnomePackageRecipe.buildRequires
    buildRequires.extend([ 'libbonobo:devel', 'GConf:devel',
                           'gnome-mime-data:runtime', 'glib:devel',
			   'libxml2:devel', 'zlib:devel', 'popt:devel', 
			   'bzip2:devel', 'ORBit2:devel',
                           'xorg-x11:devel', 'howl:devel' ])
                      
    if Use.builddocs:
        buildRequires.append('openjade:devel')
        
    extraConfig = GnomePackageRecipe.extraConfig
    extraConfig += ' --with-gtk=no --enable-hal --with-hal-mount=/usr/bin/pmount-hal --with-hal-umount=/usr/bin/custom_umount.sh'
        
    name = 'gnome-vfs'
    version = '2.12.0'
    
    docs = ['AUTHORS', 'COPYING', 'ChangeLog', 'NEWS', 'README']

    def unpack(r):
        GnomePackageRecipe.unpack(r)
	#r.addPatch('00_gnome-vfs-hal0.5.patch', level=0)
	#r.addPatch('01_fstab_edit_crash.patch', level=1)
	#r.addPatch('02_get_volume_for_path.patch', level=1)
	#r.addPatch('09_pmount.patch', level=1)
	#r.addPatch('12_user_visible_drives.patch', level=1)
	#r.addPatch('13_resolve_fstab_symlinks.patch', level=1)
	#r.addPatch('14_null_volume_crash.patch', level=0)
	#r.addPatch('15_cddb_bufferoverflow.patch', level=0)
	#r.addPatch('16_preserve_timestamps.patch', level=0)
	#r.addPatch('18_cdrom_fallback.patch', level=0)
	#r.addPatch('19_hurd_path_max.patch', level=0)
	#r.addPatch('20_fadvise_linux26.patch', level=0)
	#r.addPatch('21_kfreebsd_cdrom.patch', level=0)
	#r.addPatch('neon-0.24.7-gssapi.patch', level=0)
	r.addSource('custom_umount.sh')

    def install(r):
	GnomePackageRecipe.install(r)
	r.Run('chmod +x custom_umount.sh')
	r.Install('custom_umount.sh','%(bindir)s')
    
	# remove bogus empty directory
	r.Remove('%(prefix)s/doc', recursive=True)
