#
# Copyright (c) 2004-2007 rPath, Inc.
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

loadSuperClass('gnomepackage')
class GnomeVfs(GnomePackageRecipe):
    name = 'gnome-vfs'
    version = '2.20.1'

    buildRequires = [ 'bzip2:devel', 'GConf:devel',
        'glib:devel', 'gnome-mime-data:devellib', 'gnome-mime-data:config',
        'intltool:runtime', 'krb5:devel', 'libbonobo:devel', 'libxml2:devel',
        'openssl:devel', 'ORBit2:devel', 'popt:devel', 'samba:devel',
        'zlib:devel', 'gettext:runtime', 'avahi:devel', 'GConf:runtime',
        'openssh-client:runtime', 'perl:runtime', 'e2fsprogs:devel',
        'dbus:devel', 'dbus-glib:devel', ]

    extraConfig = GnomePackageRecipe.extraConfig
    extraConfig += ' --with-gtk=no --disable-hal'

    def unpack(r):
        GnomePackageRecipe.unpack(r)
        r.addSource('custom_umount.sh')
        r.addPatch('05_default-browser.patch')

    def policy(r):
        r.Install('custom_umount.sh', '%(bindir)s', mode=0755)
        r.Remove('%(prefix)s/doc', recursive=True)
        # libraries require runtime for daemon and config files
        r.ComponentRequires({'runtime': set(('lib',))})
