#
# Copyright (c) 2004-2006 rPath, Inc.
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

loadRecipe('gnomepackage.recipe')
class GnomeVfs(GnomePackageRecipe):

    buildRequires = [ 'libbonobo:devel', 'GConf:devel',
       'gnome-mime-data:runtime', 'glib:devel',
       'libxml2:devel', 'zlib:devel', 'popt:devel', 
       'bzip2:devel', 'ORBit2:devel', 'avahi:devel',
       'xorg-x11:devel', 'dbus-glib:devellib', 'intltool:runtime',
       'dbus:devel', 'gamin:devel', 'hal:devel', 'gcc-c++:runtime',
       'krb5:devel', 'openssl:devel', 'samba:devel',
        'GConf:runtime', 'gettext:runtime', 'perl:runtime',
        'openssh-client:runtime' ]

    extraConfig = GnomePackageRecipe.extraConfig
    extraConfig += ' --with-gtk=no --enable-hal --with-hal-mount=/usr/bin/pmount --with-hal-umount=/usr/bin/custom_umount.sh --disable-howl --enable-avahi'
        
    name = 'gnome-vfs'
    version = '2.14.2'
    
    docs = ['AUTHORS', 'COPYING', 'ChangeLog', 'NEWS', 'README']

    def unpack(r):
       GnomePackageRecipe.unpack(r)
       r.addPatch('02_get_volume_for_path.patch')
       r.addPatch('03_app_cdda.patch')
       r.addPatch('04_moniker_libexecdir.patch', level=0)
       r.addPatch('05_default-browser.patch', level=0)
       r.addPatch('11_network-volumes-in-network.patch', level=0)
       r.addPatch('12_user_visible_drives.patch')
       r.addPatch('13_resolve_fstab_symlinks.patch')
       r.addPatch('14_export_needs_eject.patch')
       r.addPatch('19_hurd_path_max.patch', level=0)
       r.addSource('custom_umount.sh')
       r.macros.optflags = '-g -Os'

    def install(r):
       GnomePackageRecipe.install(r)
       r.Run('chmod +x custom_umount.sh')
       r.Install('custom_umount.sh','%(bindir)s')
    
       # remove bogus empty directory
       r.Remove('%(prefix)s/doc', recursive=True)
