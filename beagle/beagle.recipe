#
# Copyright (c) 2007 rPath, Inc.
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

class Beagle(CPackageRecipe):
    name = 'beagle'
    version = '0.2.16.3'
    buildRequires = [ 'atk:devel', 'cairo:devel', 'desktop-file-utils:runtime', 'evolution-sharp:devellib', 'evolution-sharp:lib', 'expat:devel', 'fontconfig:devel', 'freetype:devel', 'galago-sharp:devellib', 'galago-sharp:lib', 'gettext:runtime', 'glib:devel', 'gmime:devellib', 'gmime:lib', 'gnome-sharp:devellib', 'gnome-sharp:lib', 'gnome-vfs:devellib', 'gsf-sharp:devellib', 'gsf-sharp:lib', 'gtk-sharp:devellib', 'gtk-sharp:lib', 'gtk:devel', 'intltool:runtime', 'libICE:devel', 'libSM:devel', 'libX11:devel', 'libXScrnSaver:devel', 'libXrender:devel', 'libexif:devellib', 'libgnome:devellib', 'libpng:devellib', 'librsvg:devel', 'libxml2:devel', 'mono:devel', 'mono:lib', 'mono:runtime', 'pango:devel', 'perl:runtime', 'pkgconfig:devel', 'pygtk:devel', 'python:devel', 'shared-mime-info:devellib', 'sqlite:devellib', 'zip:runtime', 'zlib:devel' ]

    def setup(r):
        r.macros.majversion = '.'.join(r.version.split('.')[0:2])
        r.Environment('MONO_PATH','%(destdir)s%(libdir)s/beagle')
        r.Environment('MONO_SHARED_DIR', '/tmp')
        r.addArchive('mirror://gnome/beagle/%(majversion)s/')
        r.addSource('sysconfig.beagle')
        r.Replace('Categories=Application;Settings;AdvancedSettings;Utility;Filesystem;X-Ximian-Settings;','Categories=Application;Settings;','tools/beagle-settings.desktop')
        r.Configure('--enable-epiphany-extension-install --enable-epiphany-extension --enable-sqlite3')
        r.Run('echo >> tools/crawl-rules/crawl-applications')
        r.Make()
        r.MakeInstall()
        r.UtilizeUser('beagleindex', '%(libexecdir)s/beagle-crawl-system')
        r.MakeDirs('%(localstatedir)s/cache/beagle/indexes')
        r.Ownership('beagleindex','beagleindex','%(localstatedir)s/cache/beagle/indexes')
        r.ExcludeDirectories(exceptions='%(localstatedir)s/cache/beagle/indexes')
        r.Requires('/bin/awk', '%(taghandlerdir)s/home-user_xattr-user')
        r.Requires('e2fsprogs:runtime', '%(taghandlerdir)s/home-user_xattr-user')
        r.macros.mozilladir = 'mozilla-1.7.13'
        r.Requires(rpath='%(libdir)s/%(mozilladir)s')
        r.TagSpec('home-user_xattr-user', '%(bindir)s/beagled')

        r.ComponentSpec('lib','%(libdir)s/beagle/libbeagle*.so')

        # Remove the launcher for the config tool, it is available
        # in the search tool
        r.Remove('%(datadir)s/applications/beagle-settings.desktop')
