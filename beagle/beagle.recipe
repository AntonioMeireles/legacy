class Beagle(PackageRecipe):

    buildRequires = ['atk:devel', 'cairo:devel', 'fontconfig:devel',
                     'desktop-file-utils:runtime', 'freetype:devel',
                     'glib:devel', 'glibc:devel', 'gtk:devel',
                     'libpng:devel', 'librsvg:devel', 'libxml2:devel',
                     'pango:devel', 'xorg-x11:devel', 'zlib:devel',
                     'gmime:lib', 'gsf-sharp:lib',
                     'gtk-sharp:lib', 'mono:lib', 'binutils:runtime',
                     'gawk:runtime', 'gettext:runtime', 'glibc:runtime',
                     'mono:runtime', 'perl:runtime', 'pkgconfig:devel',
                     'pygtk:devel', 'zip:runtime', 'evolution-sharp:lib']

    name = 'beagle'
    version = '0.2.7'
    def setup(r):
        r.addArchive('ftp://ftp.gnome.org/pub/GNOME/sources/beagle/0.2/%(name)s-%(version)s.tar.bz2')
        r.addSource('beagle.sh')
        r.addSource('cron.beagle')
        r.addSource('sysconfig.beagle')
        r.Replace('Categories=Application;Settings;AdvancedSettings;Utility;Filesystem;X-Ximian-Settings;','Categories=Application;Settings;','tools/beagle-settings.desktop')
        r.Configure('--enable-maintainer-mode --with-mozilla=mozilla --enable-webservices=yes')
        r.Run('echo >> tools/crawl-rules/crawl-applications')
        r.Make()
        r.MakeInstall()
        r.Install('cron.beagle','%(sysconfdir)s/cron.hourly/beagle')
        r.Install('beagle.sh', '/etc/X11/xinit/xinitrc.d/beagle.sh')
        r.UtilizeUser('beagleindex', '%(libexecdir)s/beagle-crawl-system')
        r.MakeDirs('%(localstatedir)s/cache/beagle/indexes')
        r.Ownership('beagleindex','beagleindex','%(localstatedir)s/cache/beagle/indexes')
        r.ExcludeDirectories(exceptions='%(localstatedir)s/cache/beagle/indexes')
        r.MakeDevices('/dev/inotify','c',10,63,'root','root',0644)
        r.Requires('/bin/awk', '%(taghandlerdir)s/home-user_xattr-user')
        r.Requires('e2fsprogs:runtime', '%(taghandlerdir)s/home-user_xattr-user')
        r.Requires('distro-release:runtime', '%(bindir)s/beagled')
        r.macros.mozilladir = 'mozilla-1.7.12'
        r.Requires(rpath='%(libdir)s/%(mozilladir)s')
        r.TagSpec('home-user_xattr-user', '%(bindir)s/beagled')

        r.ComponentSpec('lib','%(libdir)s/beagle/libbeagle*.so')

        # Remove the launcher for the config tool, it is available
        # in the search tool
        r.Remove('%(datadir)s/applications/beagle-settings.desktop')
