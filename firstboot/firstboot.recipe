#
# Copyright (c) 2004 Specifix, Inc.
# All rights reserved
#

class FirstBoot(PackageRecipe):
    buildRequires = [ 'intltool:runtime' ]
    name = "firstboot"
    version = "1.3.55"

    def setup(r):
        r.addArchive('%(name)s-%(version)s.tar.bz2',
            rpm='ftp://ftp.linux.ncsu.edu/pub/fedora/linux/core/development/SRPMS/%(name)s-%(version)s-1.src.rpm')
	r.addPatch('sudo.patch')
	#r.addPatch('firstboot-1.3.33-race.patch')

        r.Replace('RPM_BUILD_ROOT', 'INSTROOT', 'po/Makefile')
        r.Replace('python2', 'python',
                  'src/{firstboot,runTextWindow}.py', 'src/firstboot')
        # needs to run before prefdm!
        r.Replace('chkconfig: 35 95 95',
                  'chkconfig: 35 17 95', 'firstboot.init')
	#r.Replace('gtk.TRUE','True','src/exceptionWindow.py','src/firstbootWindow.py','src/modules/*.py')
	#r.Replace('gtk.FALSE','False','src/exceptionWindow.py','src/firstbootWindow.py','src/modules/*.py')
        r.Remove('src/pixmaps/rhn*png')
        r.Remove('src/modules/additional_cds.py')
	r.addSource('splash.png')
        r.Make()
        r.MakeInstall(rootVar='INSTROOT')
	r.Install('splash.png', '%(datadir)s/firstboot/pixmaps/splash.png')
	r.Install('splash.png', '%(datadir)s/firstboot/pixmaps/splash-small.png')

        for requirement in (
            'pygtk:python', 'python:runtime', 'metacity:runtime',
            'rhpl:python', 'libuser:python', 'system-config-date:runtime',
            'system-config-display:runtime',
            'system-config-language:runtime',
            'system-config-keyboard:runtime',
            'system-config-securitylevel:runtime',
            'system-config-rootpassword:runtime',
            'system-config-network:runtime',
            'authconfig:runtime',
        ):
            r.Requires(requirement, '%(sbindir)s/firstboot')
