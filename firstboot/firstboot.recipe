#
# Copyright (c) 2004-2006 rPath, Inc.
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

loadSuperClass('rpmpackage', label='conary.rpath.com@rpl:devel')
class FirstBoot(RPMPackageRecipe):
    buildRequires = [ 'intltool:runtime', 'libuser:python',
        'newt:python', 'pygtk:python', 'kudzu:python',
        'pyxf86config:python', 'rhpl:python', 'chkconfig:runtime',
        'rhpxl:python', 'pygobject:python' ]

    name = "firstboot"
    version = "1.4.6"
    distroVersion = '5'

    def setup(r):
       r.unpack()
       #r.addPatch('sudo.patch')
       r.addPatch('whack.patch')
       r.addSource('create_user.py', dir='src/modules/')

       r.Replace('RPM_BUILD_ROOT', 'INSTROOT', 'po/Makefile')
       r.Replace('python2', 'python',
                  'src/{x,}firstboot.py', 'src/firstboot')
       #r.Replace('7e8ea0','679167','src/firstbootWindow.py')
       # needs to run before prefdm!
       r.Replace('chkconfig: 35 95 95',
                  'chkconfig: 35 09 95', 'firstboot.init')
       r.Remove('src/pixmaps/rhn*png')
       r.Remove('src/modules/additional_cds.py')
       r.addSource('splash.png')
       r.Make()
       r.MakeInstall(rootVar='INSTROOT')
       r.Install('splash.png', '%(datadir)s/firstboot/pixmaps/splash.png')
       r.Install('splash.png', '%(datadir)s/firstboot/pixmaps/splash-small.png')
