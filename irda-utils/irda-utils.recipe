#
# Copyright (c) 2004-2005 rPath, Inc.
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

loadSuperClass('rpmpackage')
class IrdaUtils(RPMPackageRecipe, CPackageRecipe):
    name = 'irda-utils'
    version = '0.9.17'
    rpmRelease = '2.fc6'
    externalArchive = 'mirror://sourceforge/irda/irda-utils-%(version)s.tar.gz'
    rpmPatches = [ 'irda-utils-0.9.14-chkconfig.patch',
        'irda-utils-0.9.14-typo.patch', 'irda-utils-0.9.13-i18n.patch',
        'irda-utils-0.9.17-rootonly.patch', 'irda-utils-0.9.15-rh1.patch',
        'irda-utils-0.9.16-rh2.patch', 'irda-utils-0.9.16-io.patch',
        'irda-utils-0.9.17-makefile.patch',
        'irda-utils-0.9.17-smcdisable.patch',
        'irda-utils-0.9.17-initscript.patch', ]

    buildRequires = [ 'automake:runtime', 'autoconf:runtime', 'libtool:runtime',
        'glib:devel', 'chkconfig:runtime', ]

    def setup(r):
        r.unpack()
        r.Replace('/etc/rc.d/init.d', '%(initdir)s', 'etc/install-etc')
        r.Make('all OPTS="%(cflags)s" ROOT=%(destdir)s')

        # ROOT needs to be both an environment and make variable...
        # There's also a hodge-podge of other required variables
        r.MakeDirs('%(sbindir)s', '%(bindir)s')
        r.MakeInstall('MANDIR=%(destdir)s/%(mandir)s DESTDIR=%(destdir)s',
            preMake='ROOT=%(destdir)s', rootVar='ROOT')

        # causes package policy errors
        r.Remove('/usr/share/man/man*/*')
