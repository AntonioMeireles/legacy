#
# Copyright (c) 2008 Foresight Linux
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

class VirtualboxKernel(CPackageRecipe):
    name = 'virtualbox-kernel'
    version = '2.0.2'
 
    buildRequires = ['file:runtime', 'make:runtime', 'autoconf:runtime', 'kernel:build-tree', 'mkinitrd:runtime']
 
    def setup(r):
        if Arch.x86:
            r.addArchive('vbox-module-%(version)s-x86.tar.gz', use=Arch.x86)
        else:
            r.addArchive('vbox-module-%(version)s-x86_64.tar.gz', use=Arch.x86_64)
        r.addSource('vbox.modules')
        r.MakeDirs('/etc/sysconfig/modules/')
        r.Environment('KERN_DIR', '/lib/modules/%(kver)s/build/')
        r.Make()
        r.Copy('vboxdrv.ko', '/lib/modules/%(kver)s/misc/')
        r.Copy('vbox.modules', '/etc/sysconfig/modules/', mode=0755)
