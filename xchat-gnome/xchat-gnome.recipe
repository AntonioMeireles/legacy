# Gil Hamlin
# gil@foresightlinux.com
# 11th October 2005

loadRecipe('gnomepackage.recipe')
class XchatGnome(GnomePackageRecipe):
    buildRequires = [ 'glibc:devel', 'krb5:lib', 'expat:devel',
        'gtk:runtime', 'python:devel', 'perl:runtime', 
        'e2fsprogs:devel', 'pkgconfig:devel', 'bison:runtime',
        'gettext:runtime', 'zlib:lib', 'GConf:runtime',
        'GConf:devel', 'ORBit2:devel', 'atk:devel', 'libxslt:runtime',
        'cairo:devel', 'fontconfig:devel', 'freetype:devel',
        'glib:devel', 'gnome-keyring:devel', 'gnome-vfs:devel',
        'libart_lgpl:devel', 'libsexy:devel', 'libbonobo:devel',
        'libbonoboui:devel', 'libglade:devel', 'libgnome:devel',
        'libgnomecanvas:devel', 'libgnomeui:devel', 'libpng:devel',
        'libxml2:devel', 'openssl:devel', 'pango:devel', 'popt:devel',
        'tcl:devel', 'dbus:devel', 'dbus-glib:devellib', 'krb5:devel',
        'libnotify:devel', 'dbus-glib:runtime', 'glib:runtime',
        'scrollkeeper:runtime', 'desktop-file-utils:runtime' ]

    name = "xchat-gnome"
    version = "0.17"

    externalArchive = 'http://releases.navi.cx/%(name)s/%(name)s-%(version)s.tar.gz'

    def unpack(r):
       GnomePackageRecipe.unpack(r)
       r.macros.optflags = '-Os'
       r.addPatch('http://launchpadlibrarian.net/8037711/preferences.c.patch')
       r.addPatch('http://launchpadlibrarian.net/8037712/setup-dialog.c.patch')
       # Patch to fix python plugin loading
       r.addPatch('http://bugs.archlinux.org/task/7508?getfile=1303')
       # Patch to fix tcl plugin loading
       r.addPatch('http://bugs.archlinux.org/task/7508?getfile=1304')
       # Add the banshee plugin
       r.addSource('banshee.py')

    def build(r):
       r.Configure('--enable-ipv6 --enable-shm --disable-perl --with-plugins=autoaway,dbus,net-monitor,notification,sound-notification,notify-osd,python,tcl,url_scraper')
       r.Make('CFLAGS=-I/usr/kerberos/include')

    def install(r):
       GnomePackageRecipe.install(r)
       r.Remove('%(datadir)s/applications/xchat.desktop')
       r.Requires('enchant:lib','%(bindir)s/xchat-gnome')
       # Install the banshee plugin
       r.Install('banshee.py', '%(libdir)s/xchat-gnome/plugins/')
       r.Install('banshee.py', '%(libdir)s/xchat/plugins/')

