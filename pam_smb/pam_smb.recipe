#
# Copyright (c) 2004-2006 rPath, Inc.
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

loadSuperClass('rpmpackage')
class PamSmb(RPMPackageRecipe, AutoPackageRecipe):
    name = 'pam_smb'
    version = '1.1.7'
    rpmRelease = '7.2.1'
    rpmSources = ['pam_smb.conf']

    buildRequires = [ 'pam:devel', 'autoconf:runtime' ]

    def unpack(r):
        RPMPackageRecipe.unpack(r)
        r.addPatch('pam_smb-configure.in.patch')
        r.Replace(('AC_PROG_CC_WORKS', ''), ('AC_PROG_CC_GNU', ''),
                  'configure.in')
        r.Run('autoconf')

    def makeinstall(r):
        r.Install('pam_smb_auth.so', '%(essentiallibdir)s/security/')
        r.Install('pam_smb.conf', '%(sysconfdir)s/', mode=0644)
        # system-config-auth writes out pam_smb.conf, preserve it
        r.InitialContents('%(sysconfdir)s/pam_smb.conf')
        r.Doc('pam_smb.conf.example')
