#
# Copyright (c) 2004-2008 rPath, Inc.
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

loadSuperClass('rpmpackage')
class Enscript(RPMPackageRecipe, CPackageRecipe):
    name = 'enscript'
    version = '1.6.4'

    # perl needs to exist for configure to find it and use it
    buildRequires = [ 'flex:runtime', 'perl:runtime', 'bison:runtime',
                      'gettext:runtime', 'autoconf:runtime' ]

    rpmRelease = '3.1'
    rpmPatches = [ 'enscript-1.6.1-config.patch',
        'enscript-1.6.1-locale.patch', 'enscript-doublefree.patch',
        'enscript-1.6.1-CAN-2004-1185.patch',
        'enscript-1.6.1-CAN-2004-1186.patch', ]

    def setup(r):
        r.unpack()
        r.addPatch('enscript-allow-cc.patch')
        r.addPatch('enscript-CVE-2008-3863+CVE-2008-4306.patch')
        r.Run('autoconf -f')
        r.Configure('--with-media=Letter')
        r.Make()
        # locale directories must exist for locale files to be installed
        r.MakeDirs('%(datadir)s/locale/{de,es,fi,fr,nl,sl}/LC_MESSAGES')
        r.MakeInstall()
        r.Symlink('enscript', '%(bindir)s/nenscript')

        # test
        #r.TestSuiteFiles('/.*.txt', '/src/psgen.c', 'README.ESCAPES')
        #r.TestSuite('states/tests')
        #r.TestSuite('tests')
