#
# Copyright (c) 2006 rPath, Inc.
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

class NSS(CPackageRecipe):
    name = 'nss'
    version = '3.11.2'

    buildRequires = [ 'nspr:devel' ]

    def setup(r):
        r.macros.underVer = r.version.replace('.', '_')
        r.addArchive('ftp://ftp.mozilla.org/pub/mozilla.org/security/%(name)s/releases/NSS_%(underVer)s_RTM/src/%(name)s-%(version)s.tar.gz')

        if Arch.x86_64:
            r.Environment('USE_64', '1')

        r.Make(subDir='mozilla/security/coreconf')
        r.Make(subDir='mozilla/security/dbm')
        r.Make(subDir='mozilla/security/nss')

        for file in ('libnss3.so', 'libssl3.so', 'libsmime3.so',
                     'libsoftokn3.so', 'libnssckbi.so', 'libfreebl3.so'):
            r.Install('mozilla/dist/*.OBJ/lib/%s' % file, '%(libdir)s/', mode=0755)

        for file in ('libsoftokn3.chk', 'libfreebl3.chk'):
            r.Install('mozilla/dist/*.OBJ/lib/%s' % file, '%(libdir)s/')

        for file in ('certutil', 'modutil', 'pk12util', 'signtool', 'ssltap'):
            r.Install('mozilla/dist/*.OBJ/bin/%s' % file, '%(bindir)s/')

        r.Install('mozilla/dist/public/nss/*.h', '%(includedir)s/nss3/')
