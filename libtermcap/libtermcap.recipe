#
# Copyright (c) 2004-2005 rPath, Inc.
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

class Libtermcap(CPackageRecipe):
    name = 'libtermcap'
    version = '2.0.8'

    buildRequires = [ 'texinfo:runtime' ]

    #runRequires = [ 'termcap' ]


    def setup(r):
        r.addArchive('http://www.funet.fi/pub/Linux/PEOPLE/HLu/termcap-%(version)s.tar.gz')
        r.mainDir('termcap-%(version)s')
        r.addPatch('termcap-2.0.8-shared.patch')
        r.addPatch('termcap-2.0.8-setuid.patch')
        r.addPatch('termcap-2.0.8-instnoroot.patch')
        r.addPatch('termcap-2.0.8-compat21.patch')
        r.addPatch('termcap-2.0.8-xref.patch')
        r.addPatch('termcap-2.0.8-fix-tc.patch')
        r.addPatch('termcap-2.0.8-ignore-p.patch')
        r.addPatch('termcap-buffer.patch')
        # This patch is a REALLY BAD IDEA without libtermcap-aargh.patch below.
        r.addPatch('termcap-2.0.8-bufsize.patch')
        r.addPatch('termcap-2.0.8-colon.patch')
        r.addPatch('libtermcap-aaargh.patch')
        r.addPatch('termcap-2.0.8-glibc22.patch')
        r.disableParallelMake()

        if Use.bootstrap:
            r.macros.mflags = 'CC=%(target)s-gcc AR=%(target)s-ar %(mflags)s'
        r.Make()
        # makefile doesn't build all needed destination directories
        r.MakeDirs('%(datadir)s', '%(infodir)s', '%(includedir)s',
                  '%(libdir)s', '%(essentiallibdir)s')
        if '%(libdir)s' != '/usr/lib':
            r.MakeDirs('/usr/lib')
        r.MakePathsInstall('prefix=%(destdir)s/%(prefix)s')
        r.Install('termcap.info*', '%(infodir)s/')
        # Makefile always installs to /usr/lib
        r.Move('/usr/lib/libtermcap.so.*', '%(essentiallibdir)s/')
        r.Remove('/usr/lib/libtermcap.so*')
        r.Move('/usr/lib/*', '%(libdir)s/')
        r.Symlink('%(essentiallibdir)s/libtermcap.so.2.0.8',
                             '%(libdir)s/libtermcap.so')
        r.Symlink('libtermcap.so.2.0.8', '%(essentiallibdir)s/libtermcap.so.2')
