#
# Copyright (c) 2011-2013 Openfiler Ltd
#               2012-2013 The Foresight Linux Project
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#


loadSuperClass('rpmpackage')
class Mcelog(RPMPackageRecipe, CPackageRecipe):
    name = 'mcelog'
    version = '1.0pre3_20120814_2'
    distroVersion = '6Server'
    rpmRelease = '0.6.el6'
    isRHEL = True
    rpmPatches = [ 'mcelog-initscript.patch',
                   'mcelog-lockfile.patch',
                   'mcelog-conf.patch',
                   'mcelog-make-README-RHEL-specific.patch',
                   'mcelog-add-supported-flag.patch',
                   'mcelog-fix-support-for-AMD-15.patch', ]

    buildRequires = [ 'chkconfig:runtime' ]
 
    def setup(r):
        r.unpack()
        r.macros.cflags += ' -fpie -pie '
        r.Make()
        r.MakeDirs('%(sysconfdir)s/cron.hourly')
        r.MakeDirs('%(sysconfdir)s/mcelog')
        r.MakeDirs('%(mandir)s/man8')
        r.Install('mcelog.conf','%(sysconfdir)s/%(name)s/')
        r.Install('mcelog','%(sbindir)s/',mode=0755)
        r.Install('mcelog.cron', '%(sysconfdir)s/cron.hourly/mcelog.cron')
        r.Install('mcelog.init', '%(initdir)s/mcelogd', mode=0755)
        r.Install('mcelog.sysconfig', '%(sysconfdir)s/sysconfig/mcelogd')
        r.Install('mcelog.8', '%(mandir)s/man8/')
