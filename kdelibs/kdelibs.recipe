#
# Copyright (c) 2004-2009 rPath, Inc.
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

loadSuperClass('kdecorepackage')
class kdeLibs(kdeCorePackageRecipe):

    name = 'kdelibs'
    version = '4.2.2+r947575'

    buildRequires = [
        'acl:devel', 'aspell:devel', 'attr:devel', 'automoc:runtime',
        'avahi-qt4:devel', 'avahi:devel', 'bzip2:devel', 'gamin:devel',
        'giflib:devel', 'ilmbase:devel', 'inputproto:devel', 'jasper:devel',
        'krb5:devel', 'libjpeg:devel', 'libstdc++:devel', 'libXcursor:devel',
        'libXfixes:devel', 'libxml2:devel', 'libxml2:runtime', 'libxslt:devel',
        'libXtst:devel', 'OpenEXR:devel', 'openssl:devel', 'pcre:devel',
        'perl:devel', 'perl:perl', 'python:devel', 'shared-mime-info:runtime',
        'sip:python', 'soprano:devel', 'strigi:devel', 'utempter:devel'
    ]

    clearBuildReqs('kdelibs:devel', 'kdepimlibs:devel')

    def postUnpack(r):

        # Ubuntu patches
        r.addUbuntuPatches('k/kde4libs',
            '09_disable_debug_messages_if_not_explicitly_enabled.diff',
            '14_hardcode_ptm_device.diff',
            '19_findqt4_optional_x11_pthread.diff',
            '20_use_dejavu_as_default_font.diff',
            '22_hack_in_etc_kde4_in_kstandarddirs.diff',
            'kubuntu_01_no_translate_pc_dir.diff',
            'kubuntu_54_use_xdg_menu_prefix.diff',
        )

        r.Replace(
            '/opt/local/bin', '/usr/kerberos/bin', 'cmake/modules/FindGSSAPI.cmake'
        )

    def policy(r):

        # develtools that startkde uses
        # put it into :config b/c x86 and x86_64 kdelibs:lib must be co-installable
        r.ComponentSpec('config', '%(bindir)s/kde4-config')
        r.ComponentSpec('config', '%(bindir)s/buildsycoca4')

        develTools = [
            'checkXML', 'kconfig_compiler', 'kde4automoc', 'kunittestmodrunner',
            'makekdewidgets', 'meinproc4', 'nepomuk-rcgen', 'preparetips'
        ]
        for x in develTools:
            r.ComponentSpec('devel', '%(bindir)s/' + x)

        # we need it for kopete, kmail and probably for others
        r.Requires('qca2:lib', '%(bindir)s/kded4')
        r.Requires('qca2-ossl:lib', '%(bindir)s/kded4')

        # crypto module needs this
        r.Requires('openssl:devellib', '%(bindir)s/kded4')

