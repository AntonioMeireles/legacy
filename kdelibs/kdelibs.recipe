#
# Copyright (C) 2004-2007 rPath, Inc.
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

loadSuperClass('kdecorepackage')
class kdeLibs(kdeCorePackageRecipe):

    name = 'kdelibs'
    version = '3.5.8'
    kversion = '%(version)s'

    clearBuildReqs('kdelibs:devel')

    buildRequires = [ 'Mesa:devel', 'nvidia:devellib', 'OpenEXR:devel', 'aspell:devel', 'bzip2:devel', 'cups:devel',
'gnutls:devellib', 'ilmbase:devel', 'jasper:devel', 'krb5:devel',
'libjpeg:devel', 'libtiff:devel', 'libxml2:devel',
'libxslt:devel', 'pcre:devel', 'sudo:runtime']

 
    buildAPIDox = False

    extraConf  = kdeCorePackageRecipe.extraConf
    extraConf += (' --with-alsa --with-distribution'
                  ' --disable-dnssd'
                  ' --with-sudo-kdesu-backend'
                  ' --enable-dnotify --enable-inotify')

    def postUnpack(r):

        r.addPatch('kstandarddirs.patch')

    def postInstall(r):

        r.SetModes('%(bindir)s/kgrantpty',
                   '%(bindir)s/fileshareset',
                   '%(bindir)s/start_kdeinit',
                   '%(bindir)s/kpac_dhcp_helper', 04755)

        # For kde-only-menus.patch
        r.Move('%(sysconfdir)s/xdg/menus/applications.menu',
               '%(sysconfdir)s/xdg/menus/kde-applications.menu')

        # Provided by hicolor-icon-scheme
        r.Remove('%(datadir)s/icons/hicolor/index.theme')

        # We don't want to package stub
        r.Remove('%(libdir)s/libkdnssd.*')
        r.Remove('%(includedir)s/dnssd', recursive=True)

    def policy(r):

        r.Doc('KDE2PORTING.html', 'KDE3PORTING.html')

        licenses = [ 'ARTISTIC', 'BSD', 'GPL_V2', 'LGPL_V2', 'QPL_V1.0' ]

        for license in licenses:
            r.Doc('licenses/'+license, dir='licenses')

        develTools = [
            'dcopidl.*', 'makekdewidgets', 'kconfig_compiler',
            'meinproc', 'preparetips'
        ]

        for tool in develTools:
            r.ComponentSpec('devel', '%(bindir)s/'+tool)

        # Even startkde uses it
        r.ComponentSpec('lib', '%(bindir)s/kde-config')

        r.Requires('hicolor-icon-theme:data',
                   '%(datadir)s/icons/crystalsvg/index.theme')

        r.Requires(exceptDeps='java: .*')

        r.Requires('coreutils:runtime', '%(bindir)s/imagetops')
        r.Requires('file:runtime', '%(bindir)s/imagetops')
        r.Requires('mktemp:runtime', '%(bindir)s/imagetops')
        r.Requires('netpbm:runtime', '%(bindir)s/imagetops')
        r.Requires('coreutils:runtime', '%(bindir)s/dcopidlng')
        r.Requires('perl:runtime', '%(bindir)s/dcopidlng')
        r.Requires('coreutils:runtime', '%(datadir)s/apps/kconf_update/move_kio_help_cache.sh')

