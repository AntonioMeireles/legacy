#
# Copyright (c) 2004-2009 rPath, Inc.
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

loadSuperClass('kdecorepackage')
class kdeLibs(kdeCorePackageRecipe):

    name = 'kdelibs'
    version = '4.3.2+r1032896'

    buildRequires = [
        'acl:devel', 'aspell:devel', 'attr:devel', 'automoc:runtime',
        'avahi-qt4:devel', 'avahi:devel', 'bison:runtime', 'bzip2:devel',
        'enchant:devel', 'flex:devel', 'flex:runtime', 'gamin:devel',
        'giflib:devel', 'icedtea-jre:runtime', 'ilmbase:devel',
        'inputproto:devel', 'jasper:devel', 'krb5:devel', 'libjpeg:devel',
        'libstdc++:devel', 'libXcursor:devel', 'libXfixes:devel',
        'libxml2:devel', 'libxml2:runtime', 'libxslt:devel', 'libXtst:devel',
        'OpenEXR:devel', 'openssl:devel', 'pcre:devel', 'perl:devel',
        'perl:perl', 'python:devel', 'shared-mime-info:runtime', 'sip:python',
        'soprano:devel', 'strigi:devel', 'utempter:devel',
        # 'xz:devel'
    ]

    clearBuildReqs('kdelibs:devel', 'kdepimlibs:devel')

    def postUnpack(r):

        # Ubuntu patches
        r.addUbuntuPatches('k/kde4libs',
            '11_default_kde4_xdg_menu_prefix.diff',
            '14_hardcode_ptm_device.diff',
            '19_findqt4_optional_x11_pthread.diff',
            '20_use_dejavu_as_default_font.diff',
            '22_hack_in_etc_kde4_in_kstandarddirs.diff',
            '23_solid_no_double_build.diff',
            '25_ld_exclude_libs_qtuitools.diff',
            'kubuntu_01_no_translate_pc_dir.diff',
            'kubuntu_67_cmake_install_paths.diff',
        )

        r.Replace(
            '/opt/local/bin', '/usr/kerberos/bin', 'cmake/modules/FindGSSAPI.cmake'
        )

    def policy(r):

        # develtools that startkde uses
        # put it into :config b/c x86 and x86_64 kdelibs:lib must be co-installable
        r.ComponentSpec('config', '%(bindir)s/kde4-config')
        r.ComponentSpec('config', '%(bindir)s/buildsycoca4')

        develTools = [
            'checkXML', 'kconfig_compiler', 'kde4automoc', 'kunittestmodrunner',
            'makekdewidgets', 'meinproc4', 'nepomuk-rcgen', 'preparetips'
        ]
        for x in develTools:
            r.ComponentSpec('devel', '%(bindir)s/' + x)

        # common deps that must be installed:
        commonDeps = [
            'openssl:devellib',
            'qca2-ossl:lib',
            'qca2:lib',
            'qimageblitz:lib'
        ]
        for package in commonDeps:
            r.Requires(package, '%(libdir)s/libkdecore.so.5')

