#
# Copyright (c) 2005-2006 rPath, Inc.
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

loadSuperClass('xorgpackage.recipe')
class Xinit(XorgPackageRecipe):
    name = 'xinit'
    version = '1.0.3'
    component = 'app'

    buildRequires = [ 'util-linux:runtime' ]

    def setup(r):
        r.macros.mflags += ' XINITDIR=%(sysconfdir)s/X11/xinit'

        XorgPackageRecipe.setup(r)

    def unpack(r):
        XorgPackageRecipe.unpack(r)

        # all pulled from Fedora CVS (xorg-x11-xinit, rev. 1.1)
        r.addSource('Xmodmap', dest='%(sysconfdir)s/X11/', mode=0644)
        r.addSource('Xresources', dest='%(sysconfdir)s/X11/', mode=0644)

        for script in ('Xclients', 'Xsession', 'xinitrc-common'):
            r.addSource(script, dest='%(sysconfdir)s/X11/xinit/', mode=0755)

        r.addSource('xinput.sh',
                    dest='%(sysconfdir)s/X11/xinit/xinitrc.d/', mode=0755)

        # must add after the upstream tarball is unpacked so we replace its copy
        r.addSource('xinitrc')

        # Security patch for setuid issue
#        r.addPatch('http://xorg.freedesktop.org/releases/X11R7.1/patches/xinit-1.0.2-setuid.diff')

    # XXX: this should go away when upstream is fixed to install xinitrc
    # with the correct mode
    def install(r):
        XorgPackageRecipe.install(r)

        r.SetModes('%(sysconfdir)s/X11/xinit/xinitrc', 0755)
