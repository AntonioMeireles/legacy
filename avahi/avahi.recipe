#
# Copyright (c) 2006-2007 rPath, Inc.
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

class Avahi(CPackageRecipe):
    name = 'avahi'
    version = '0.6.20'

    # do not add graphviz:runtime as a build req... it causes a loop:
    # gnome-vfs -> avahi -> graphviz -> gnome-vfs
    buildRequires = [ 'gdbm:devel', 'glib:devel',
        'perl:runtime', 'pkgconfig:devel', 'gtk:devel', 'atk:devel',
        'cairo:devel', 'fontconfig:devel', 'freetype:devel', 'libglade:devel',
        'libpng:devel', 'libxml2:devel', 'pango:devel', 'zlib:devel',
        'expat:devel', 'pygtk:python', 'pygobject:python',
        'pycairo:python',  'desktop-file-utils:runtime',
        'libdaemon:devel', 'libX11:devel', 'libXext:devel',
        'libXrender:devel', 'libXt:devel', 'libjpeg:devel', 'libXi:devel',
        'libXrandr:devel', 'libXcursor:devel', 'libXinerama:devellib',
        'libXft:devel', 'libSM:devel', 'libICE:devel',
        'desktop-file-utils:runtime', 'libstdc++:devel', 'libcap:devel',
        'chkconfig:runtime', 'pygobject:devel', ]

    def setup(r):
        r.addArchive('http://avahi.org/download/')
        r.Configure(' --with-distro=fedora --disable-qt3 --disable-qt4 '
            '--disable-dbus --disable-mono --with-avahi-priv-access-group=avahi')
        r.Make()
        r.MakeInstall()
        r.UtilizeUser('avahi', '%(bindir)s/.*')

        # glib
        r.PackageSpec('avahi-glib', '%(includedir)s/avahi-glib/')
        r.PackageSpec('avahi-glib', '%(libdir)s/libavahi-glib.*')
        r.PackageSpec('avahi-glib', '%(libdir)s/pkgconfig/avahi-glib.pc')

        # tools for browsing zeroconf shares
        r.PackageSpec('avahi-tools', '%(bindir)s/.*')
        r.PackageSpec('avahi-tools', '%(mandir)s/man1/.*')
