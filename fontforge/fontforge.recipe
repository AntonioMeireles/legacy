#
# Copyright (c) 2004-2006 rPath, Inc.
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

class FontForge(AutoPackageRecipe):
    name = 'fontforge'

    # version and docversion are the same now, but maybe they won't
    # always be?
    version = '20081224'
    docversion = '20081224'

    buildRequires = ['cairo:devel', 'fontconfig:devel', 'giflib:devel',
                     'libICE:devel', 'libSM:devel', 'libX11:devel',
                     'libXft:devel', 'libXi:devel', 'libjpeg:devel',
                     'libpng:devel', 'libtiff:devel', 'libxkbui:devel',
                     'python:devel', 'zlib:devel',
                    ]

    Flags.multilayer = True

    def setup(r):
        r.macros.docversion = r.docversion
        r.macros.sf = 'mirror://sourceforge/fontforge'
        r.addArchive('%(sf)s/fontforge_full-%(version)s.tar.bz2')
        # docs do not go in %(thisdocdir)s because fontforge looks for
        # the docs and presents them to the user as help
        r.addArchive('%(sf)s/fontforge_htdocs-%(docversion)s.tar.bz2',
                     dir='%(docdir)s/%(name)s')
        r.addPatch('fontforge-lutil.patch')

        # freetype _source_ is needed to build w/ freetype
        # building with python fails without linking in -lutil
        config = '--disable-freetype'
        if r.Flags.multilayer:
            config += ' --with-multilayer'
        r.addAction('autoconf')
        r.Configure(config)
        r.Make()

        r.MakePathsInstall()

        r.Provides('file', '%(bindir)s/fontforge')

