#
# Copyright (c) 2004-2008 rPath, Inc.
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

class Xmlto(AutoPackageRecipe):
    name = 'xmlto'
    version = '0.0.18'

    buildRequires = [ 'docbook-xsl:data', 'util-linux:runtime',
                      'libxml2:runtime', 'libxslt:runtime',
                      'docbook-dtds:data', 'flex:runtime',
                      'sgml-common:config',
                      'findutils:runtime', 'mktemp:runtime',
                      'passivetex:data', 'sgml-common:runtime',
                      'sed:runtime', 'coreutils:runtime']

    def unpack(r):
        r.disableParallelMake()

        srpm = 'ftp://download.fedora.redhat.com/pub/fedora/linux/core/2/SRPMS/xmlto-0.0.18-2.src.rpm'
        r.addArchive('xmlto-0.0.18.tar.bz2', rpm=srpm)
        r.addPatch('xmlto-0.0.12-encoding.patch', rpm=srpm)

        if not Use.builddocs:
            r.Replace ('^man1_MANS = man/man1/xmlto.1 man/man1/xmlif.1',
                       'man1_MANS =',
                       'Makefile.in')

    def policy(r):
        r.Requires('docbook-xsl:data', '%(bindir)s/xmlto')
        r.Requires('passivetex:data', '%(bindir)s/xmlto')
        r.Requires('docbook-dtds:data', '%(bindir)s/xmlto')
        r.Requires('libxslt:runtime', '%(bindir)s/xmlto')
        # needed for getopt
        r.Requires('util-linux:runtime', '%(bindir)s/xmlto')
        r.Requires('findutils:runtime', '%(bindir)s/xmlto')
        r.Requires('%(essentialbindir)s/mktemp', '%(bindir)s/xmlto')
