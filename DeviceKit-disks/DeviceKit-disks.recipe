
loadSuperClass('rpmpackage')
class DeviceKitDisks(RPMPackageRecipe,AutoPackageRecipe):
    buildRequires = [ 'dbus-glib:devel', 'dbus:devel', 'glib:devel',
                      'libxslt:runtime', 'pkgconfig:devel', 'udev:devel',
                      'DeviceKit:devel', 'PolicyKit:devel', 'gettext:runtime',
                      'intltool:runtime', 'libusb:devel', 'sg3_utils:devel',
                      'parted:devel', 'device-mapper:devel', 'udev:devel',
                      'libatasmart:devel', 'sqlite:devel', 'zlib:devel']

    name = "DeviceKit-disks"
    version = '004'
    rpmRelease = '4.fc11'
    rpmPatches = [ 'avoid-ata-smart-check-for-removable-disks.patch',
                   'devkit-disks-004-ignore-pc-floppy-drives.patch' ]

    def configure(r):
        # https://bugzilla.redhat.com/show_bug.cgi?id=513495
        r.addPatch('https://bugzilla.redhat.com/attachment.cgi?id=364258')
        #
        # r.addPatch('http://cgit.freedesktop.org/DeviceKit/DeviceKit-disks/commit/?id=97d71294bdb15eda4ff6624b80601cd847953e46')

        r.Replace('-Werror', '', 'configure')
        # FIXME: get manpages generation to work inside mooks
        r.Configure('--disable-gtk-doc --disable-man-pages')

    def policy(r):
        # add runtime Requires - see RH srpm
        r.SetModes('%(sysconfdir)s/profile.d/devkit-disks-bash-completion.sh', 0644)
        r.NonBinariesInBindirs(exceptions = '%(sysconfdir)s/profile.d/devkit-disks-bash-completion.sh')
        r.SetModes('%(localstatedir)s/run/DeviceKit-disks', 0770)
        r.SetModes('%(localstatedir)s/lib/DeviceKit-disks', 0770)
        
