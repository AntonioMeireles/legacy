#
# Copyright (c) 2004-2007 rPath, Inc.
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

loadSuperClass('binarypackage=conary.rpath.com@rpl:devel')
class OpenOffice(BinaryPackageRecipe):
    name = 'openoffice.org'
    version = '2.3.1'

    # for taghandlers
    buildRequires = [ 'desktop-file-utils:runtime', 'gtk:runtime',
        'shared-mime-info:runtime', ]

    def unpack(r):
        # a mirror of openoffice.org
        r.addArchive('http://openoffice.bouncer.osuosl.org/?product=OpenOffice.org&os=linuxintelwjre&lang=en-US&version=%(version)s')

        r.Run('cd %(destdir)s ; '
            'for x in ../OO*/RPMS/*.rpm ../OO*/RPMS/desktop-integration/*.rpm ; '
            'do rpm2cpio $x | cpio -ivd ; done')
        r.Symlink('/opt/openoffice.org%(major_version)s','%(sysconfdir)s/openoffice.org%(major_version)s')
        r.Remove('%(initdir)s/*')
        # to be compatible with stuff build from oo-build
        r.Symlink('%(bindir)s/openoffice.org%(major_version)s', '%(bindir)s/ooffice')

        #r.DanglingSymlinks(exceptions='/usr/bin/unopkg_gui')
        # deps in binary blob of ooo are just too painful for words. we'll do
        # "dep resolution" via groups
        r.Provides(exceptions='.*')
        r.Requires(exceptions='.*')
        r.ComponentSpec('runtime', '/opt/')

