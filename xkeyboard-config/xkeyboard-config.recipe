#
# Copyright (c) 2006 rPath, Inc.
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

class XkeyboardConfig(AutoPackageRecipe):
    name = 'xkeyboard-config'
    version = '0.8'

    buildRequires = [ 'gettext:runtime', 'perl:runtime', 'perl-XML-Parser:perl',
        'xkbcomp:runtime' ]

    # copied from rev. 1.7 of Gentoo's ebuild for 0.8
    extraConfig = ( ' --with-xkb-base=%(datadir)s/X11/xkb'
                    ' --enable-compat-rules'
                    ' --disable-xkbcomp-symlink'
                    ' --with-xkb-rules-symlink=xorg' )

    def unpack(r):
        r.addArchive('http://xlibs.freedesktop.org/xkbdesc/%(name)s-%(version)s.tar.gz')

    def configure(r):
        r.Configure(r.extraConfig)

    def makeinstall(r):
        r.MakeInstall()

        # to avoid dangling symlink
        r.MakeDirs('%(localstatedir)s/lib/xkb')
        r.Remove('%(datadir)s/X11/xkb/compiled')

    def policy(r):
        # to avoid dangling symlink
        r.ExcludeDirectories(exceptions='%(localstatedir)s/lib/xkb')

        # package the directory in data component to be with symlink
        r.ComponentSpec('data', '%(localstatedir)s/lib/xkb')
