#
# Copyright (c) 2006-2008 rPath, Inc.
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

loadSuperClass('rpmpackage')
class XkeyboardConfig(RPMPackageRecipe,AutoPackageRecipe):
    name = 'xkeyboard-config'
    version = '1.5'
    rpmRelease = '1.10'
    isOPENsuse = True
    isXOrgFactory = True

    rpmPatches = [ 'xkeyboard-config.mainline-cvs.mac-es.patch',
                   'xkeyboard-config.macintosh.patch',
                   'p_suse.diff',
#                   'ibm_space_saver.diff',
                   'xkeyboard-config.inet.patch',
                   'microsoftnek4k.diff',
                   'microsoftnek4k-symbols.diff',
                   'microsoftnek4k-keycodes.diff',
                   'disable-2xalt_2xctrl-toggle.diff',
                   'MDSW-change-keycode.diff',
#                   'ucw_suse.diff',
                   'xkeyboard-config.sr@latin.diff',
#                   'cs.po.diff',
                   ]

    buildRequires = [ 'gettext:runtime', 'perl:runtime', 'perl-XML-Parser:perl',
        'xkbcomp:runtime', 'intltool:runtime' ]

    extraConfig = ( ' --with-xkb-base=%(datadir)s/X11/xkb'
                    ' --enable-compat-rules'
                    ' --disable-xkbcomp-symlink'
                    ' --with-xkb-rules-symlink=xorg' )
#                    ' --with-xkb-rules-symlink=xfree86,xorg' )


    def configure(r):
        # add some more RH patches ...
        rhCVS = 'http://cvs.fedoraproject.org/viewvc/rpms/%(name)s/devel/'
        for p in [ 'usinet.patch',
                   # Sent to svu, partially committed as d0ff2e0d4ac, expect for 1.6
                   'xkeyboard-config-1.4-battery.patch',
                   # Sent to svu
                   'xkeyboard-config-1.4-jp-tilde.patch',
                   # Taken from upstream, remove with 1.6
                   'xkeyboard-config-1.5-evdevkbds.patch',
                   'xkeyboard-config-1.5-suspend-hibernate.patch',
                   ]:
            r.addPatch(rhCVS + p + '?view=co')
        r.Run('mv po/sr@{Latn,latin}.po')
        r.Configure(r.extraConfig)
#        r.Run('rm -rf */*.dir')

#    def policy(r):
#        r.MakeDirs('%(localstatedir)s/lib/xkb/')
#        r.MakeDirs('%(localstatedir)s/lib/xkb/compiled/')
#        r.Symlink('%(localstatedir)s/lib/xkb/compiled/', '%(datadir)s/X11/xkb/compiled')
#        r.ExcludeDirectories(exceptions = '%(localstatedir)s/lib/xkb/compiled')
