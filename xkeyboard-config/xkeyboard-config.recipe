#
# Copyright (c) 2006-2008 rPath, Inc.
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

loadSuperClass('rpmpackage')
class XkeyboardConfig(RPMPackageRecipe,AutoPackageRecipe):
    name = 'xkeyboard-config'
    version = '1.7'
    rpmRelease = '4.1'
    isOPENsuse = True
    isXOrgFactory = True

    rpmPatches = [ 'xkeyboard-config.mainline-cvs.mac-es.patch',
                   'xkeyboard-config.macintosh.patch',
                   'p_suse.diff',
                   'ibm_space_saver.diff',
                   'xkeyboard-config.inet.patch',
                   'microsoftnek4k.diff',
                   'microsoftnek4k-symbols.diff',
                   'microsoftnek4k-keycodes.diff',
                   'disable-2xalt_2xctrl-toggle.diff',
                   'MDSW-change-keycode.diff',
                   'xkeyboard-config.inet.microsoftpro.patch',
                   'xkeyboard-config-commit-81d9313.diff',
                   ]

    buildRequires = [ 'gettext:runtime', 'perl:runtime', 'perl-XML-Parser:perl',
        'xkbcomp:runtime', 'intltool:runtime' ]

    extraConfig = ( ' --with-xkb-base=%(datadir)s/X11/xkb'
                    ' --enable-compat-rules'
                    ' --disable-xkbcomp-symlink'
                    ' --with-xkb-rules-symlink=xorg' )
#                    ' --with-xkb-rules-symlink=xfree86,xorg' )


    def configure(r):
        r.Configure(r.extraConfig)
        r.Run('rm -rf */*.dir')


    def policy(r):
        r.MakeDirs('%(localstatedir)s/lib/xkb')
        r.Symlink('%(bindir)s/xkbcomp', '%(datadir)s/X11/xkb/xkbcomp')
        r.MakeDirs('%(localstatedir)s/lib/xkb/compiled/')
        r.Symlink('%(localstatedir)s/lib/xkb/compiled/', '%(datadir)s/X11/xkb/compiled')
        r.ExcludeDirectories(exceptions = '%(localstatedir)s/lib/xkb/compiled')
