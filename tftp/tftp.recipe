#
# Copyright (c) 2004-2007 rPath, Inc.
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

class Tftp(CPackageRecipe):
    name = 'tftp'
    version = '0.48'

    buildRequires = [ 'libtermcap:devel', 'readline:devel',
        'tcp_wrappers:devel', ]

    def setup(r):
        r.macros.archive_name = 'tftp-hpa'
        r.addArchive('http://www.kernel.org/pub/software/network/tftp/', keyid='517D0F0E')

        r.Configure('--with-readline --with-tcpwrappers')
        r.Make()

        r.MakeDirs('/tftpboot')
        r.MakeInstall('INSTALLROOT=%(destdir)s SBINDIR=%(sbindir)s'
                      ' MANDIR=%(mandir)s install')
        r.Install('tftp-xinetd', '%(sysconfdir)s/xinetd.d/tftp')
        r.Requires('xinetd:runtime', '%(sysconfdir)s/xinetd.d/tftp')

        r.UtilizeUser('nobody', '%(sbindir)s/.*')
        r.ExcludeDirectories(exceptions='/tftpboot')
        r.PackageSpec('tftp-server',
                      '%(sbindir)s/.*',
                      '%(sysconfdir)s/.*',
                      '%(mandir)s/man8/.*',
                      '/tftpboot')
