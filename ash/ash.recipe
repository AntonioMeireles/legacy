#
# Copyright (c) 2004-2005 rPath, Inc.
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

loadSuperClass('rpmpackage')
class Ash(RPMPackageRecipe, CPackageRecipe):
    name = 'ash'
    version = '0.3.8'

    buildRequires = [ 'bison:runtime', 'flex:runtime', 'flex:devel', ]
    isRHEL = True
    rpmRelease = '20'

    def setup(r):
        r.disableParallelMake()
        # Source: ftp://ftp.debian.org/debian/dists/woody/main/source/shells/
        r.addArchive('ash_%(version)s.orig.tar.gz', rpm=r.srpm)
        r.addPatch( 'ash_0.3.8-38.diff.gz', rpm=r.srpm)
        r.addPatch('ash-0.3.8-tempfile.patch')
        r.addPatch('ash-0.3.8-mannewline.patch')
        r.addPatch('ash-0.3.8-segv.patch')
        r.addPatch('ash-0.3.8-history-man.patch')
        r.addPatch('ash-0.3.8-gnu.patch')
        r.addPatch('ash-0.3.8-for.patch')

        r.Run('chmod -R a+rX .')
        r.Make()
        r.Install('sh', '%(essentialbindir)s/ash', mode=0755)
        r.Run('rm sh')
        r.Make(preMake='LDFLAGS="-static"')
        r.Install('sh', '%(essentialbindir)s/ash.static', mode=0755)
        r.Install('sh.1', '%(mandir)s/man1/ash.1')
        r.Symlink('ash.1', '%(mandir)s/man1/bsh.1')
        r.Symlink('ash', '%(essentialbindir)s/bsh')
        r.TagSpec('shell', '%(essentialbindir)s/[ab]sh')
