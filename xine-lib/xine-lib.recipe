loadSuperClass('rpmpackage')
class Xinelib(RPMPackageRecipe,AutoPackageRecipe):
        name = 'xine-lib'
        version = '1.1.7'
        rpmRelease = '2.fc8'
        buildRequires = [ 'GConf:devel', 'ImageMagick:devel', 'ORBit2:devel',
            'SDL:devel', 'alsa-lib:devel', 'libXv:devel', 'libXvMC:devel',
            'audiofile:devel', 'bzip2:devel', 
            'flac:devel', 'freetype:devel', 'glib:devel',
            'gnome-vfs:devel', 'libbonobo:devel', 'libXinerama:devellib',
            'libjpeg:devel', 'libmng:devel', 'libogg:devel',
            'libpng:devel', 'libtheora:devel', 'libtiff:devel',
            'libvorbis:devel', 'libxml2:devel', 'samba:devel',
            'speex:devel', 'zlib:devel', 'libX11:devel', 'libXext:devel',
            'ImageMagick:devel', 'SDL:devel', 'libICE:devel', 'libSM:devel',
            'freetype:devel', 'Mesa:devel', 'gtk:devel',
            'module-init-tools:runtime', 'pkgconfig:devel', 'libX11:devel',
            'automake:runtime', 'autoconf:runtime', 'gcc-c++:runtime', 'expat:devel',
            'jack:devel', 'libXinerama:devel', 'pulseaudio:devel']

        rpmPatches = [ 
                       'xine-lib-1.1.7-open.patch',
                       'xine-lib-1.1.4-optflags.patch',
                       'xine-lib-1.1.1-deepbind-939.patch',
                       'xine-lib-1.1.5-multilib-devel.patch',
                       
                       ]

        # we don't want to use RPMs tarball because Fedora ppl is neurotic. They prune 'potentially patented code'

        def unpack(r):
                r.addArchive('mirror://sourceforge/xine/xine-lib-1.1.7.tar.bz2')
                for p in r.rpmPatches:
                        r.addPatch(p, rpm=r.srpm)

        def configure(r):
                # Avoid standard rpaths on lib64 archs:
                r.Run("""sed -i -e 's|"/lib /usr/lib\b|"/%(lib)s %(libdir)s|' configure""")
                r.Run(""" touch -r configure.ac aclocal.m4 m4/optimizations.m4 m4/optimizations.m4.stamp m4/optimizations.m4.stamp m4/optimizations.m4""")
                r.Configure('--disable-imagemagick --with-freetype --with-fontconfig --enable-antialiasing')

