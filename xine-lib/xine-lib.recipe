#
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

loadSuperClass('rpmpackage')
class Xinelib(RPMPackageRecipe,AutoPackageRecipe):

    name = 'xine-lib'
    version = '1.1.11'
    rpmRelease = '1.fc8'

    buildRequires = [
        'alsa-lib:devel', 'audiofile:devel', 'autoconf:runtime',
        'automake:runtime', 'bzip2:devel', 'expat:devel', 'flac:devel',
        'freetype:devel', 'gcc-c++:runtime', 'GConf:devel', 'glib:devel',
        'gnome-vfs:devel', 'gtk:devel', 'ImageMagick:devel', 'jack:devel',
        'libbonobo:devel', 'libICE:devel', 'libjpeg:devel', 'libmng:devel',
        'libogg:devel', 'libpng:devel', 'libSM:devel', 'libtheora:devel',
        'libtiff:devel', 'libvorbis:devel', 'libX11:devel', 'libxcb:devel',
        'libXext:devel', 'libXinerama:devel', 'libxml2:devel', 'libXv:devel',
        'libXvMC:devel', 'Mesa:devel', 'module-init-tools:runtime',
        'ORBit2:devel', 'pkgconfig:devel', 'pulseaudio:devel', 'samba:devel',
        'SDL:devel', 'speex:devel', 'zlib:devel'
    ]

    rpmPatches = [
        'xine-lib-1.1.4-optflags.patch',
        'xine-lib-1.1.1-deepbind-939.patch',
    ]

    # we don't want to use RPMs tarball because Fedora ppl is neurotic.
    # They prune 'potentially patented code'
    def unpack(r):
        r.addArchive('mirror://sourceforge/xine/')
        for p in r.rpmPatches:
            r.addPatch(p, rpm=r.srpm)

    def configure(r):
        # Avoid standard rpaths on lib64 archs:
        r.Run("""sed -i -e 's|"/lib /usr/lib\b|"/%(lib)s %(libdir)s|' configure""")
        r.Run(""" touch -r configure.ac aclocal.m4 m4/optimizations.m4 m4/optimizations.m4.stamp m4/optimizations.m4.stamp m4/optimizations.m4""")
        r.Configure('--enable-imagemagick --with-freetype --with-fontconfig --enable-antialiasing')

    def policy(r):
        r.PackageSpec('xine-lib-gnome', '%(libdir)s/xine/plugins/%(version)s/xineplug_inp_gnome_vfs.so')

