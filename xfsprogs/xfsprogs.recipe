#
# Copyright (c) 2004-2007 rPath, Inc.
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

class Xfsprogs(CPackageRecipe):
    name = 'xfsprogs'
    version = '2.8.21_1'

    buildRequires = [ 'readline:devel', 'libtermcap:devel', 'libtool:runtime',
                      'gettext:runtime', 'e2fsprogs:devel' ]

    def setup(r):
        r.macros.upver = r.version.replace('_', '-')
        r.addArchive('ftp://oss.sgi.com/projects/xfs/cmd_tars/%(name)s_%(upver)s.tar.gz')

        r.Configure('--enable-shared=yes --enable-gettext=yes '
                    '--enable-readline=yes --enable-editline=no '
                    '--enable-shared-uuid=yes DEBUG=-DNDEBUG')

        r.Make()
        r.MakeInstall(rootVar='DIST_ROOT')
        r.MakeInstall(rootVar='DIST_ROOT', installtarget='install-dev')

        # Put certain items in proper place--the install Makefile doesn't
        # properly use libexecdir and friends. Maybe there's a better
        # way to do this.
        r.Move('%(libexecdir)s/*', '%(libdir)s/')
        r.Move('%(sbindir)s/*', '%(essentialsbindir)s/')
        r.Move('%(bindir)s/*', '%(sbindir)s/')
        r.Remove('%(libdir)s/libhandle.so')
        r.Remove('%(docdir)s/xfsprogs/', recursive=True)
