class TorcsNG(CPackageRecipe):
    name = "torcs-ng"
    version = "r850"
    buildRequires = [
        'freeglut:devel', 'gcc:devel', 'libpng:devel', 'openal:devel',
        'zlib:devel', 'gcc:devel', 'desktop-file-utils:runtime', 'Mesa:devel',
        'freealut:devel', 'libICE:devel', 'libSM:devel', 'libX11:devel',
        'libXext:devel', 'libXi:devel', 'libXmu:devel', 'libXrandr:devel',
        'libXrender:devel', 'libXt:devel', 'libXxf86vm:devel', 'SDL:devel',
        'libstdc++:devel', 'python:bin', 'cmake:runtime', 'plib:devel'
    ]

    def setup(r):
#        r.addSvnSnapshot('http://torcs-ng.svn.sourceforge.net/svnroot/torcs-ng/branches/sdl-port')
        r.addArchive('http://torcs-ng.svn.sourceforge.net/viewvc/torcs-ng/branches/sdl-port.tar.gz?view=tar')
        r.Desktopfile('torcs-ng.desktop')
        r.addSource('torcs-ng.desktop')
        r.Install('data/data/icons/Ticon.png', '%(datadir)s/pixmaps/torcs-ng.png')
        r.addPatch('destdir.patch')
        r.addPatch('rpath.patch')
        r.addPatch('strip_destdir.patch')
        r.Run('cmake -D CMAKE_SKIP_BUILD_RPATH=TRUE -D CMAKE_INSTALL_PREFIX=%(prefix)s .')
        r.Make()
        r.MakeInstall()
        r.SharedLibrary(subtrees='%(libdir)s/torcs-ng/drivers')
        r.SharedLibrary(subtrees='%(libdir)s/torcs-ng/lib')
        r.SharedLibrary(subtrees='%(libdir)s/torcs-ng/modules')
