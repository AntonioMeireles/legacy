Index: cmake/macros.cmake
===================================================================
--- cmake/macros.cmake	(revision 850)
+++ cmake/macros.cmake	(working copy)
@@ -967,7 +967,7 @@
 				GET_TARGET_PROPERTY(TGF_LIB tgf LOCATION)
 				INSTALL(CODE "FILE(READ ${CMAKE_BINARY_DIR}/xmlversion_loc.txt XMLVERSION_EXE)\nSTRING(REPLACE \"$(OutDir)\" \"\${CMAKE_INSTALL_CONFIG_NAME}\" XMLVERSION_EXE \${XMLVERSION_EXE})\nGET_FILENAME_COMPONENT(XMLVERSION_DIR \${XMLVERSION_EXE} PATH)\nSET(TXML_LIB ${TXML_LIB})\nSTRING(REPLACE \"$(OutDir)\" \"\${CMAKE_INSTALL_CONFIG_NAME}\" TXML_LIB \${TXML_LIB})\nSET(TGF_LIB ${TGF_LIB})\nSTRING(REPLACE \"$(OutDir)\" \"\${CMAKE_INSTALL_CONFIG_NAME}\" TGF_LIB \${TGF_LIB})\nFILE(INSTALL DESTINATION \${XMLVERSION_DIR} TYPE FILE FILES \${TXML_LIB} \${TGF_LIB})\nEXECUTE_PROCESS(COMMAND \"\${XMLVERSION_EXE}\" \"${TORCS_DATADIR_ABS}/version.xml\" \"${CMAKE_INSTALL_PREFIX}/${DEST1}/${DEST2}/${XMLFILENAME}\" \"${USER_PATH}/${XMLFILENAME}\" RESULT_VARIABLE XMLVERSTATUS)\nIF(XMLVERSTATUS)\nMESSAGE(FATAL_ERROR \"ERROR: xmlversion failed\")\nENDIF(XMLVERSTATUS)")
 			ELSE(WIN32)
-				INSTALL(CODE "FILE(READ ${CMAKE_BINARY_DIR}/xmlversion_loc.txt XMLVERSION_EXE)\nEXECUTE_PROCESS(COMMAND \${XMLVERSION_EXE} ${TORCS_DATADIR_ABS}/version.xml ${CMAKE_INSTALL_PREFIX}/${DEST1}/${DEST2}/${XMLFILENAME} ${USER_PATH}/${XMLFILENAME} RESULT_VARIABLE XMLVERSTATUS)\nIF(XMLVERSTATUS)\nMESSAGE(FATAL_ERROR \"ERROR: xmlversion failed\")\nENDIF(XMLVERSTATUS)")
+				INSTALL(CODE "FILE(READ ${CMAKE_BINARY_DIR}/xmlversion_loc.txt XMLVERSION_EXE)\nEXECUTE_PROCESS(COMMAND \${XMLVERSION_EXE} \$ENV{DESTDIR}/${TORCS_DATADIR_ABS}/version.xml \$ENV{DESTDIR}/${CMAKE_INSTALL_PREFIX}/${DEST1}/${DEST2}/${XMLFILENAME} ${USER_PATH}/${XMLFILENAME} RESULT_VARIABLE XMLVERSTATUS)\nIF(XMLVERSTATUS)\nMESSAGE(FATAL_ERROR \"ERROR: xmlversion failed\")\nENDIF(XMLVERSTATUS)")
 			ENDIF(WIN32)
 		ENDFOREACH(XML_FILE ${FILES})
 	ENDIF(IS_USER)
@@ -976,7 +976,7 @@
 
 IF(IN_SOURCETREE)
 	MACRO(INSTALL_TORCSNG_CMAKE)
-	INSTALL(CODE "FILE(MAKE_DIRECTORY \"${TORCS_DATADIR_ABS}/cmake\")\n  FILE(WRITE \"${TORCS_DATADIR_ABS}/cmake/torcs-ng.cmake\" \"SET(TORCS_DATADIR_ABS \\\"${TORCS_DATADIR_ABS}\\\")\nSET(TORCS_LOCALDIR \\\"${TORCS_LOCALDIR}\\\")\nSET(TORCS_LIBDIR_ABS \\\"${TORCS_LIBDIR_ABS}\\\")\nSET(TORCS_BINDIR_ABS \\\"${TORCS_BINDIR_ABS}\\\")\nSET(TORCS_INCLUDEDIR_ABS \\\"${TORCS_INCLUDEDIR_ABS}\\\")\n\nSET(IN_SOURCETREE FALSE)\\n\\n\")\nFILE(READ \"${SOURCE_DIR}/cmake/macros.cmake\" TORCS_MACRO_CONTENT)\nFILE(APPEND \"${TORCS_DATADIR_ABS}/cmake/torcs-ng.cmake\" \${TORCS_MACRO_CONTENT})")
+	INSTALL(CODE "FILE(MAKE_DIRECTORY \"\$ENV{DESTDIR}/${TORCS_DATADIR_ABS}/cmake\")\n  FILE(WRITE \"\$ENV{DESTDIR}/${TORCS_DATADIR_ABS}/cmake/torcs-ng.cmake\" \"SET(TORCS_DATADIR_ABS \\\"${TORCS_DATADIR_ABS}\\\")\nSET(TORCS_LOCALDIR \\\"${TORCS_LOCALDIR}\\\")\nSET(TORCS_LIBDIR_ABS \\\"${TORCS_LIBDIR_ABS}\\\")\nSET(TORCS_BINDIR_ABS \\\"${TORCS_BINDIR_ABS}\\\")\nSET(TORCS_INCLUDEDIR_ABS \\\"${TORCS_INCLUDEDIR_ABS}\\\")\n\nSET(IN_SOURCETREE FALSE)\\n\\n\")\nFILE(READ \"${SOURCE_DIR}/cmake/macros.cmake\" TORCS_MACRO_CONTENT)\nFILE(APPEND \"\$ENV{DESTDIR}/${TORCS_DATADIR_ABS}/cmake/torcs-ng.cmake\" \${TORCS_MACRO_CONTENT})")
 		
 	ENDMACRO(INSTALL_TORCSNG_CMAKE)
 ENDIF(IN_SOURCETREE)
