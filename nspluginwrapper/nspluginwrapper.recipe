#
# Copyright (c) 2006-2007 rPath, Inc.
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#


class NsPluginwrapper(CPackageRecipe):
    name = 'nspluginwrapper'
    version = '0.9.91.5'

    buildRequires = [ 'glib:devel', 'gtk:devel', 'libX11:devel', 'libXt:devel',
                      'zlib:devel', 'expat:devel', 'nspr:devel', 'gcc-c++:runtime', 
                      'GConf:runtime', 'pkgconfig:devel', 'which:runtime',
                      'glibc:devellib[is: x86(i486,i586,i686)]', 'xextproto:devel']


    # This is x86_64 ONLY

    def setup(r):
        r.addArchive('http://www.gibix.net/projects/%(name)s/files/')

        r.macros.cflags += ' -m64 '

        r.Configure(' --with-biarch')
        r.Make()
        r.MakeInstall()
        r.FixupMultilibPaths(exceptions='/usr/lib/nspluginwrapper/i386/linux/libxpcom.so')
        r.FixupMultilibPaths(exceptions='/usr/lib/nspluginwrapper/x86_64/linux/npwrapper.so')

        # FIXME: fc8 has a much nicer way of solving , system-wide, this but for now
        # i resort to the hack bellow. 
        r.MakeDirs('/etc/profile.d')
        r.Run(""" echo "nspluginwrapper  -a -i > /dev/null 2>&1" > %(destdir)s/etc/profile.d/nspluginwrapper.sh """)
        r.SetModes('/etc/profile.d/nspluginwrapper.sh', 0755)
