class FlashPlayer(PackageRecipe):
    name = "flashplayer"
    version = "10.3.183.5"

    buildRequires = [ 'glibc:devel', 'zlib:devel', 'fontconfig:devel',
                      'freetype:devel', 'glib:devel', 'gtk:devel',
                      'libX11:devel', 'libXext:devel', 'libXt:devel',
                      'libgcc:devellib', 'libstdc++:devel',
                      'desktop-file-utils:runtime',]

    def setup(r):
        waterMark = '%(libdir)s/mozilla/plugins/%(name)s' + '_IS_BROKEN_IN_NATIVE_x86_64__AS_IS_rBO_FLASH_UI'

        r.addArchive('http://fpdownload.macromedia.com/get/flashplayer/current/install_flash_player_10_linux.tar.gz', use=Arch.x86)

        if Arch.x86:
        # http://labs.adobe.com/downloads/flashplayer10.html
        #        r.addArchive('http://download.macromedia.com/pub/labs/flashplayer10/libflashplayer-%(version)s.linux-x86_64.so.tar.gz', use=(Arch.x86_64),
        #                     dir = '%(name)s-%(version)s')
            
        #        if Arch.x86_64:
        #            r.Install('libflashplayer.so','%(libdir)s/mozilla/plugins/')
        #        else:

            r.Install('../libflashplayer.so','%(libdir)s/mozilla/plugins/')
            r.Install('../usr/bin/flash-player-properties', '%(bindir)s/', mode = 0755)
            r.Install('../usr/share/pixmaps/*', '%(datadir)s/pixmaps/', mode = 0644)
            r.Install('../usr/share/icons/*', '%(datadir)s/icons/', mode = 0644)
            r.Install('../usr/share/applications/*', '%(datadir)s/applications/', mode = 0644)

            r.ComponentSpec("runtime", "%(libdir)s/mozilla.*")
            r.Requires('xulrunner:lib', '%(libdir)s/')
            r.Requires('mozilla-filesystem:runtime', '%(libdir)s/')

            # to get hw accel
            r.Requires('libvdpau:lib', '%(libdir)s/')
            # http://www.nvnews.net/vbulletin/showthread.php?s=aa9efb4514edb3f3ff4338679327aac4&t=148409&page=5
            #r.Create('%(sysconfdir)s/adobe/mms.cfg',
            #         contents = 'EnableLinuxHWVideoDecode=1')
            #r.ComponentSpec('runtime', '%(sysconfdir)s/adobe/mms.cfg')
            # XXX do not enable hw accel byDefault as it creates more issues
            # than the ones it solves when using at least nvidia drivers...
            # see - http://www.nvnews.net/vbulletin/showthread.php?t=159619
            # 

            # expose it to x86_64 counter part
            r.Create(waterMark)
            r.Provides('file', waterMark)
        else:
            # as we can't do partial / per arch redirects 
            r.Create(waterMark)
            
            waterMark32 = '%(prefix)s/lib/mozilla/plugins/%(name)s' + '_IS_BROKEN_IN_NATIVE_x86_64__AS_IS_rBO_FLASH_UI'
            r.Requires(waterMark32, waterMark)
