#
# Copyright (c) 2008 Foresight Linux
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

class kino(AutoPackageRecipe):
    name = 'kino'
    version = '1.3.4'

    buildRequires = ['a52dec:devel','alsa-lib:devel', 'atk:devel', 'cairo:devel',
                'expat:devel', 'desktop-file-utils:runtime', 'fontconfig:devel',
                'faac:devel', 'faad2:devel', 'freetype:devel', # 'ffmpeg:devel',
                'glib:devel', 'gettext:runtime', 'Mesa:devel', 'Mesa:devellib',
                'gtk:devel', 'libICE:devel', 'libSM:devel', 'libX11:devel', 'libXext:devel', 
                'libogg:devel', 'libquicktime:devel', 'libtheora:devel', 'libvorbis:devel',
                'libXrender:devel', 'libXv:devel', 'libavc1394:devel', 'libdv:devel',
                'libglade:devel', 'libiec61883:devel', 'libpng:devellib', 'libraw1394:devel',
                'libsamplerate:devel', 'libstdc++:devel', 'libxml2:devel', 'pango:devel', 
                'perl:devel', 'perl:lib', 'pkgconfig:devel', 'shared-mime-info:runtime', 
                'x264:devel', 'xvidcore:devel', 'zlib:devel', 'intltool:runtime']

    def unpack(r):
        r.addArchive('mirror://sourceforge/%(name)s/%(name)s-%(version)s.tar.gz')
        # build fix. taken from gentoo
        r.addPatch('kino-1.3.4-v4l1.patch')

    def configure(r):

        r.Replace('quicktime.h','lqt/quicktime.h','src/filehandler.h',lines=182)
        # use local ffmpeg until we get it to work with our own...
        # r.Configure(' --disable-local-ffmpeg --enable-quicktime --mandir=/usr/share/man')
        r.Configure(' --enable-quicktime --mandir=%(mandir)s')
        r.macros.ldflags += ' -L%(libdir)s/xorg.mesa.3d/ '

    def policy(r):
        r.Remove('%(bindir)s/kino2raw')
        r.Symlink('%(bindir)s/kino', '%(bindir)s/kino2raw')
        r.Requires('ffmpeg:runtime','%(bindir)s/kino')
        r.Requires('dvgrab:runtime','%(bindir)s/kino')
    # consider these optional programs as missing runtime reqs:
    # /usr/share/kino/scripts/dvdauthor/.*
    # /usr/share/kino/scripts/exports/ffmpeg_dvd.*
    # -> dvdauthor
    # /usr/share/kino/scripts/dvdauthor/qdvdauthor.sh
    # -> qdvdauthor
    # /usr/share/kino/scripts/exports/ffmpeg_3gp.sh
    # -> MP4Box
    # /usr/share/kino/scripts/exports/rawplay.sh
    # -> rawplay
    # /usr/share/kino/scripts/exports/ffmpeg2theora.sh
    # -> ffmpeg2theora
