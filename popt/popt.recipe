#
# Copyright (c) 2004-2008 rPath, Inc.
#               2010      The Foresight Linux Project
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

class Popt(AutoPackageRecipe):
    name = 'popt'
    version = '1.13'
    buildRequires = ['gettext:runtime', 'intltool:runtime']

    def unpack(r):
        r.addArchive('http://www.rpm5.org/files/%(name)s/')
        r.addPatch('popt-1.13-popt_fprintf.patch')

    def configure(r):
        conf = '--libdir=/%(lib)s'
        if Use.bootstrap:
            conf += ' --target=%(target)s --host=%(host)s --build=%(build)s'
        r.Configure(conf)

    def policy(r):
        r.Remove('/%(lib)s/libpopt.{la,so}')
        r.MakeDirs('%(libdir)s')
        r.Run("ln -sf ../../%(lib)s/libpopt.so.?.?.? libpopt.so",
              dir = '%(destdir)s/%(libdir)s')
        r.Move('/%(lib)s/libpopt.a',
               '%(libdir)s/libpopt.a')

        # Multiple popt configurations are possible
        r.MakeDirs('%(sysconfdir)s/popt.d')
        r.ExcludeDirectories(exceptions='%(sysconfdir)s/.*')
