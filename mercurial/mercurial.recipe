#
# Copyright (c) 2005-2008 rPath, Inc.
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

class Mercurial(CPackageRecipe):
    name = 'mercurial'
    version = '1.5.4'

    buildRequires = [ 
        'python:runtime', 'python:devel', 'asciidoc:runtime',
        'xmlto:runtime', 'tk:runtime', 'MySQL-python:python',
        'bzr:python', 'subversion:python',
        'python-setuptools:python', 'pyOpenSSL:python', ]

    def setup(r):
        r.addArchive('http://www.selenic.com/mercurial/release/%(name)s-%(version)s.tar.gz')

        r.PythonSetup()
        r.MakeInstall("PREFIX=%(prefix)s", dir='doc')

        # Bash Completion stuff
        r.Install('hgweb*.cgi', '%(servicedir)s/hg/', mode=0755)
        r.Install('contrib/mercurial.el', '%(datadir)s/emacs/site-lisp/%(name)s.el')
        r.Install('contrib/hgk', '%(bindir)s/')
        r.Install('contrib/bash_completion',
                  '%(sysconfdir)s/bash_completion.d/hg')
        r.addSource('hg-bash_completion.sh')
        r.Install('hg-bash_completion.sh',
                  '%(sysconfdir)s/profile.d/', mode = 0755)
        r.Config(exceptions=['%(sysconfdir)s/bash_completion.d/',
                             '%(sysconfdir)s/profile.d/'])

        r.Requires('%(bindir)s/wish', '%(bindir)s/hgk')
        r.PackageSpec('%(name)s-hgk', '.*hgk.*')
        # We do not include bugzilla in rPath Linux, so requiring that
        # all users of mercurial have python: MySQLdb satisfied is too
        # heavy-weight.
        r.Requires(exceptDeps='python: MySQLdb.*')
        # Same with subversion and bzr
        r.Requires(exceptDeps='python: bzrlib.*')
        r.Requires(exceptDeps='python: svn.*')
