#
# Copyright (c) 2005-2008 rPath, Inc.
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

class Mercurial(CPackageRecipe):
    name = 'mercurial'
    version = '1.0.1'

    buildRequires = [ 'python:runtime', 'python:devel', 'asciidoc:runtime',
        'xmlto:runtime', 'MySQL-python:python', 'tk:runtime',
        'python-setuptools:python', ]

    def setup(r):
        r.addArchive('http://www.selenic.com/mercurial/release/')

        r.addPatch('http://www.selenic.com/hg/raw-rev/87c704ac92d4')

        r.PythonSetup()
        r.MakeInstall("PREFIX=%(prefix)s", dir='doc')

        r.Install('hgweb*.cgi', '%(servicedir)s/hg/', mode=0755)
        r.Install('contrib/mercurial.el', '%(datadir)s/emacs/site-lisp/%(name)s.el')
        r.Install('contrib/hgk', '%(bindir)s/')

        r.Requires('%(bindir)s/wish', '%(bindir)s/hgk')
        r.PackageSpec('%(name)s-hgk', '.*hgk.*')
        # We do not include bugzilla in rPath Linux, so requiring that
        # all users of mercurial have python: MySQLdb satisfied is too
        # heavy-weight.
        r.Requires(exceptDeps='python: MySQLdb.*')
