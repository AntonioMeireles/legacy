#
# Copyright (c) 2005-2006 rPath, Inc.
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#
loadInstalled('python=conary.rpath.com@')

class Mercurial(CPackageRecipe):
    name = 'mercurial'
    version = '0.9.3'

    buildRequires = [ 'python:runtime', 'python:devel',
                      'asciidoc:runtime', 'xmlto:runtime',
                      'MySQL-python:python', 'tk:runtime' ]

    def setup(r):
        r.macros.url = 'http://www.selenic.com/mercurial/release'
        r.addArchive('%(url)s/%(name)s-%(version)s.tar.gz')

        r.Run('python setup.py install --root=%(destdir)s --prefix=%(prefix)s')
        r.Make(dir='doc')
        r.Install('doc/*.1', '%(mandir)s/man1/')
        r.Install('doc/*.5', '%(mandir)s/man5/')
        r.Doc('hgweb*.cgi')
        r.Install("contrib/mercurial.el", "%(datadir)s/emacs/site-lisp/%(name)s.el")
        r.Install("contrib/hgk", '%(bindir)s/')

        r.Requires('/usr/bin/wish', '%(bindir)s/hgk')
        r.PackageSpec('%(name)s-hgk', '%(bindir)s/hgk')
        r.PackageSpec('%(name)s-bugzilla',
                      Python.sitepkgs + '/hgext/bugzilla.py.?')
