loadSuperClass('kernelmodulepackage.recipe', label='drivers.rpath.org@rpl:devel')
class Ndiswrapper(KernelModulePackageRecipe):

    buildRequires = [ 'perl:lib', 'perl:runtime' ]
    name = 'ndiswrapper'
    version = '1.12'

    def unpack(r):
        r.macros.ksrcdir = '/lib/modules/%(kver)s/build'
        r.addArchive('http://download.sourceforge.net/sourceforge/%(name)s/%(name)s-%(version)s.tar.gz')
        r.Replace('.*depmod.*', '', 'driver/Makefile')

    def build(r):
        r.Make()

    def install(r):
        r.MakeDirs('%(essentialsbindir)s')
        r.MakeDirs('%(sbindir)s')
        r.MakeDirs('%(mandir)s/man8')
        r.MakeInstall()
        r.Install('driver/ndiswrapper.ko', '/lib/modules/%(kver)s/misc/')
        r.TagSpec('kernel', '/lib/modules/.*/.*\.k?o$')
