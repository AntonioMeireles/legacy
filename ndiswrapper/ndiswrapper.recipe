#
# Copyright (c) 2004 Ken VanDine
# Written by Ken VanDine <ken@vandine.org>
#

class Ndiswrapper(PackageRecipe):
    buildRequires = [ 'kernel:build-tree' ]

    name = 'ndiswrapper'
    version = '0.10'

    def setup(r):
        r.macros.kver = os.uname()[2]
        r.macros.ksrcdir = '/lib/modules/%s/build' % r.macros.kver
        r.addArchive('http://unc.dl.sourceforge.net/sourceforge/ndiswrapper/ndiswrapper-%(version)s.tar.gz')
	r.addPatch('ndiswrapper.patch')
	r.addAction("sed -i 's/\/sbin\/depmod/#\/sbin\/depmod/g' driver/Makefile")
	r.addAction("sed -i 's/install -m 0644 /#install -m 0644 /g' driver/Makefile")
	r.addAction("sed -i 's/ \/sbin/ $(INST_DIR)\/sbin/g' utils/Makefile")
	r.addAction("sed -i 's/ \/usr\/sbin/ $(INST_DIR)\/usr\/sbin/g' utils/Makefile")
	r.MakeDirs('%(essentialsbindir)s')
	r.MakeDirs('%(sbindir)s')
	r.MakeDirs('%(mandir)s/man8')
        r.MakeInstall(rootVar='INST_DIR')
	r.Install('driver/ndiswrapper.ko', '/lib/modules/%s/misc/' % r.macros.kver)
        r.TagSpec('kernel', '/lib/modules/.*/.*\.k?o$')
