#
# Copyright (c) 2004-2006 rPath, Inc.
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

loadSuperClass('kdecorepackage')
class kdeSDK(kdeCorePackageRecipe):

    name = 'kdesdk'
    version = '3.5.9'

    verify = False
    buildAPIDox = False

    buildRequires = [
        'apr-util:devel', 'apr:devel', 'db:devel', 'expat:devel',
        'flex:runtime', 'gdbm:devel', 'ktnef:devel', 'libkcal:devel',
        'libxml2:devel', 'libxslt:devel', 'openldap:devel', 'pcre:devel',
        'perl:runtime', 'subversion:devel', 'e2fsprogs:devel', 'e2fsprogs:lib', 
        'gettext:runtime', 'perl:devel', 'python:devel', 'bison:runtime'
    ]

    extraConf = kdeCorePackageRecipe.extraConf
    extraConf += (
        ' --with-apr-config=%(bindir)s/apr-1-config'
        ' --with-apu-config=%(bindir)s/apu-1-config'
    )

    modules = [
        'cervisia',
        'kapptemplate',
        'kbabel',
        'kbugbuster',
        'kcachegrind',
        'kdeaccounts-plugin',
       ('kfile-plugins-sdk', 'kfile-plugins'),
       ('kio-plugins-sdk', 'kioslave'),
        'kmtrace',
        'kompare',
        'kprofilemethod',
        'kspy',
#        'kstartperf', - disabled in configure
        'kuiviewer',
        'kunittest',
        'poxml',
       ('kdesdk-scheck', 'scheck'),
       ('kdesdk-scripts', 'scripts'),
        'umbrello'
    ]

    def postUnpack(r):

        # Build fix
        r.Replace('-lsvn_client-1', '-lsvn_client-1 -lsvn_ra-1 -lsvn_subr-1',
                  'configure')

        # Manifest code doesn't like renames, so gzip it during install
        r.Replace('\$\(INSTALL_DATA\) "\$\$file" "\$\(DESTDIR\)\$\(man1dir\)/\$\$inst";',
                  '$(INSTALL_DATA) "$$file" "$(DESTDIR)$(man1dir)/$$inst"; gzip -f "$(DESTDIR)$(man1dir)/$$inst";',
                  '{cervisia,scripts}/Makefile.in')

        # Normalize interpreter path
        r.Replace('/usr/bin/env php', '%(bindir)s/php', 'kcachegrind/converters/pprof2calltree')

