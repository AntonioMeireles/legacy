#
# Copyright (c) 2009-2010 rPath, Inc.
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

class PgBouncer(CPackageRecipe):
    name = 'pgbouncer'
    version = '1.3.3'

    buildRequires =  [
        'asciidoc:runtime',
        'autoconf:runtime',
        'chkconfig:runtime',
        'libevent:devel',
        'xmlto:runtime'
      ]
    
    def setup(r):
        r.addArchive('http://pgfoundry.org/frs/download.php/2677/')
        # Patches found useful for Conary repositories
        r.addPatch('PAUSE.patch')
        r.addPatch('KILL.patch')

        r.Configure()
        r.Make()
        r.MakeInstall()

        r.addSource('pgbouncer.init', dest='/etc/init.d/pgbouncer', mode=0755)
        r.addSource('pgbouncer.ini', dir='/etc/')

        # pidfile
        r.MakeDirs('/var/run/pgbouncer')
        r.Ownership('nobody', 'nobody', '/var/run/pgbouncer')

        # Make it easy to replace the default config file by not having
        # a requirement on :config
        r.ComponentRequires({'config': ()})
