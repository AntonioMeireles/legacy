#
# Copyright (c) 2009 rPath, Inc.
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

class PgBouncer(CPackageRecipe):
    name = "pgbouncer"
    version = "1.4.2"
    fileId = 3085

    buildRequires =  [
        'autoconf:runtime',
        'chkconfig:runtime',
        'libevent:devel',
        'xmlto:runtime'
      ]
    
    def setup(r):
        r.macros.fileId = str(r.fileId)
        r.addArchive('http://pgfoundry.org/frs/download.php/%(fileId)s/'
                '%(name)s-%(version)s.tgz')

        r.Configure()

        r.Make()
        r.MakeInstall()

        r.addSource('pgbouncer.init', dest='/etc/init.d/pgbouncer', mode=0755)
        r.addSource('pgbouncer.ini', dir='/etc/')

        # pidfile
        r.MakeDirs('/var/run/pgbouncer')
        r.Ownership('nobody', 'nobody', '/var/run/pgbouncer')

        # Make it easy to replace the default config file by not having
        # a requirement on :config
        r.ComponentRequires({'config': ()})
