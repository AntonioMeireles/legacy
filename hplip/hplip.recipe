#
# Copyright (c) 2005-2006 rPath, Inc.
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

class Hplip(CPackageRecipe):
    name = 'hplip'
    version = '1.6.9'

    buildRequires = [ 'python:devel', 'sane-backends:runtime', 'cups:devel',
                      'libjpeg:devel', 'openssl:devel', 'file:runtime',
                      'desktop-file-utils:runtime', 'libusb:devel',
                      'libstdc++:devel', 'PyQt:python', 'chkconfig:runtime',
                      'sip:python', 'cups:runtime' ]

    def setup(r):
        r.macros.foomaticver = '20060816'
        r.addArchive('mirror://sourceforge/hplip/')
        r.addArchive('http://www.linuxprinting.org/download/foomatic/foomatic-db-hpijs-%(foomaticver)s.tar.gz')

        r.Configure('--disable-cups-install --disable-foomatic-install '
                    '--disable-network-build')
        r.Make()

        r.MakeInstall()
        r.Remove('/etc/sane.d/dll.conf')
        r.Create('/etc/sane.d/dll.conf.d/hplip', contents='hpaio')
        r.Move('prnt/hpijs/ppd/*', '%(datadir)s/ppd/')

        r.Configure(dir='../foomatic-db-hpijs-%(foomaticver)s')
        r.Make(dir='../foomatic-db-hpijs-%(foomaticver)s')
        r.MakeInstall(dir='../foomatic-db-hpijs-%(foomaticver)s')

        # Standardize and compress ppd files
        r.MakeDirs('%(datadir)s/ppd/HP/')
        r.Move('%(datadir)s/ppd/*.ppd', '%(datadir)s/ppd/HP/')
        r.Run('gzip %(destdir)s%(datadir)s/ppd/HP/*.ppd')

        r.Requires('foomatic-filters:runtime', '%(bindir)s/hpi(js|od)')
        r.Requires('libusb:devel', '%(bindir)s/hpi(js|od)')
        r.Requires('espgs:runtime', '%(bindir)s/hpi(js|od)')
        r.TagSpec('initscript', '%(initdir)s/')
