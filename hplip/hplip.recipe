#
# Copyright (c) 2005-2008 rPath, Inc.
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

class Hplip(CPackageRecipe):
    name = 'hplip'
    version = '2.7.9'

    buildRequires = [ 'python:devel', 'sane-backends:runtime', 'cups:devel',
        'libjpeg:devel', 'openssl:devel', 'file:runtime',
        'desktop-file-utils:runtime', 'libusb:devel', 'libstdc++:devel',
        'chkconfig:runtime', 'cups:runtime', 'python:tk',
        'desktop-file-utils:runtime', 'pygtk:python', 'net-snmp:devel',
        'sane-backends:devel', 'perl:runtime', 'PIL:python', ]

    def setup(r):
        r.addArchive('mirror://sourceforge/hplip/')
        # RPL-1812
        r.addPatch('hplip-CVE-2007-5208.patch')

        r.Configure(' --enable-foomatic-ppd-install'
                    ' --with-cupsbackenddir=%(libdir)s/cups/backend')
        r.Make()
        r.MakeInstall()

        r.Remove('/etc/sane.d/dll.conf')
        r.Create('%(sysconfdir)s/sane.d/dll.conf.d/hplip', contents='hpaio')

        # These conflict with foomatic-db (RPL-2278)
        r.Remove('%(datadir)s/foomatic/db/source/PPD/HP', recursive=True)
        # This conflicts with foo2zjs (RPL-2278)
        r.Remove('%(datadir)s/foomatic/db/source/printer/HP-LaserJet_1022.xml')

        r.Requires('foomatic-filters:runtime', '%(bindir)s/hpi(js|od)')
        r.Requires('libusb:devel', '%(bindir)s/hpi(js|od)')
        r.Requires('%(bindir)s/gs', '%(bindir)s/hpi(js|od)')
