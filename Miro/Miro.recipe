#
# Copyright (c) 2007-2008 Foresight Linux
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

loadInstalled('python')
loadSuperClass('rpmpackage')
class Miro(RPMPackageRecipe,CPackageRecipe):
    name = 'Miro'
    version = '1.2.3'
    rpmRelease = '2.fc9'
    rpmPatches = [ '%(name)s-1.1-utf8.patch',
                   '%(name)s-xulrunner.patch'
                  ]
    buildRequires = [ 'Pyrex:python', 'atk:devel', 'boost:devel',
                      'cairo:devel', 'dbus-python:python', 'desktop-file-utils:runtime',
                      'expat:devel', 'fontconfig:devel', 'freetype:devel', 'glib:devel',
                      'glibc:devel', 'gnome-python-extras:python', 'gnome-python:python',
                      'gst-python:python', 'gtk:devel', 'libX11:devel', 'libXrender:devel',
                      'libXv:devel', 'libgcc:devellib', 'libpng:devel', 'libstdc++:devel',
                      'mx:python', 'notify-python:python', 'nspr:devel', 'pango:devel',
                      'pkgconfig:devel', 'pygobject:python', 'pygtk:devel', 'pygtk:devellib',
                      'pygtk:python', 'python-setuptools:python', 'python-sqlite:python',
                      'python:devel', 'shared-mime-info:runtime', 'xextproto:devel',
                      'xine-lib:devel', 'xulrunner:devel', 'zlib:devel', 'openssl:devel',
                      'bsddb3:python'
                      ]

    def setup(r):
        RPMPackageRecipe.unpack(r)

        r.Replace('__file__', 'os.curdir', 'platform/gtk-x11/setup.py')
        r.PythonSetup(dir='platform/gtk-x11')

        r.macros.pydir = Python.sitepkgs
        r.ComponentSpec('test', '%(pydir)s/miro/test/')
        r.ComponentSpec('test', '%(pydir)s/miro/compiled_templates/unittest/')
        r.RemoveNonPackageFiles('%(pydir)s/miro/setup.py[oc]?')
        r.Requires(exceptDeps='python: BitTorrent')
        r.Requires(exceptDeps='python: feedparser')

        r.Requires('bsddb3:python', '%(bindir)s/miro')
