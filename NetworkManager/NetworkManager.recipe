loadSuperClass('gnomepackage')
class NetworkManager(GnomePackageRecipe):

   buildRequires = [ 'GConf:devel', 'ORBit2:devel', 'chkconfig:runtime',
                     'gnome-keyring:devel', 'gnome-vfs:devel', 'ppp:devel',
                     'hal:devel', 'iproute:runtime', 'libart_lgpl:devel',
                     'libbonobo:devel', 'libbonoboui:devel', 'libgcrypt:devel',
                     'libglade:devel', 'libgnome:devel', 'libgnomecanvas:devel',
                     'libgnomeui:devel', 'libgpg-error:devel', 'libnl:devel',
                     'popt:devel', 'wireless-tools:devel', 'dbus:devel',
                     'dbus-glib:devellib', 'glib:devel', 'pango:devel',
                     'autoconf:runtime', 'automake:runtime', 'libtool:devel',
                     'desktop-file-utils:runtime', 'libnotify:devel',
                     'intltool:runtime', 'autoconf:data', 'libtool:runtime',
                     'pkgconfig:devel', 'intltool:devel', 'gettext:runtime',
                     'gettext:devel', 'gnome-common:devel', 'gnome-common:runtime', 
                     'dbus-glib:runtime', 'automake:runtime', 'autoconf:runtime',
                     'intltool:devel', 'libtool:devel', 'util-macros:devel',
                     'PolicyKit:devel', 'PolicyKit:runtime', 'nspr:devel', 'nss:devel',
                     'e2fsprogs:devel',
                     ]


   name = "NetworkManager"
   version = '0.7.0.97+git20090224'

   extraConfig = ' --disable-static --with-distro=redhat  --with-dhcp-client=dhclient --with-crypto=nss '
   configureName = 'autogen.sh'

   def unpack(r):
      r.addGitSnapshot('git://anongit.freedesktop.org/NetworkManager/NetworkManager.git')
      # don't crash on shutdown
      r.addPatch('no-crash-on-shutdown.patch')
      r.addSource('ntpd.dispatch')

      rhCVS = 'http://cvs.fedoraproject.org/viewvc/rpms/NetworkManager/devel/'

      for p in [ 'explain-dns1-dns2.patch',
                 ]:
                 r.addPatch(rhCVS + p + '?view=co')

      r.addSource(rhCVS + 'nm-system-settings.conf'  + '?view=co', dest = 'nm-system-settings.conf')
      r.Replace('-Wall -Werror', ' ', 'configure.in')


   def policy(r):
      r.MakeDirs('%(sysconfdir)s/NetworkManager/VPN')
      r.MakeDirs('%(sysconfdir)s/NetworkManager/dispatcher.d')
      r.ExcludeDirectories(exceptions='%(localstatedir)s/run/%(name)s')
      r.ExcludeDirectories(exceptions='%(sysconfdir)s/%(name)s/system-connections')
      r.ExcludeDirectories(exceptions='%(sysconfdir)s/NetworkManager/VPN')
      r.Install('ntpd.dispatch', '%(sysconfdir)s/NetworkManager/dispatcher.d/ntpd')

      r.Requires('libnl:lib','%(sbindir)s/NetworkManager')
      r.Requires('wpa_supplicant:runtime','%(sbindir)s/NetworkManager')

      r.Install('nm-system-settings.conf', '%(sysconfdir)s/%(name)s/')

      r.Install('test/.libs/nm-online', '%(bindir)s/', mode = 0755)
