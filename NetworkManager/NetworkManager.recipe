loadSuperClass('gnomepackage')
loadSuperClass('rpmpackage')
class NetworkManager(RPMPackageRecipe,GnomePackageRecipe):

   buildRequires = [ 'GConf:devel', 'ORBit2:devel', 'chkconfig:runtime',
                     'gnome-keyring:devel', 'gnome-vfs:devel', 'ppp:devel',
                     'hal:devel', 'iproute:runtime', 'libart_lgpl:devel',
                     'libbonobo:devel', 'libbonoboui:devel', 'libgcrypt:devel',
                     'libglade:devel', 'libgnome:devel', 'libgnomecanvas:devel',
                     'libgnomeui:devel', 'libgpg-error:devel', 'libnl:devel',
                     'popt:devel', 'wireless-tools:devel', 'dbus:devel',
                     'dbus-glib:devellib', 'glib:devel', 'pango:devel',
                     'autoconf:runtime', 'automake:runtime', 'libtool:devel',
                     'desktop-file-utils:config', 'libnotify:devel',
                     'intltool:runtime', 'autoconf:data', 'libtool:runtime',
                     'pkgconfig:devel', 'intltool:devel', 'gettext:runtime', 'gettext:devel']

   name = "NetworkManager"
   version = "0.7.0"

   tarballName = '%(name)s-%(version)s.svn2983.tar.gz'
   rpmRelease = '0.4.svn2983.fc9'
   rpmArchives = [ 'nm-applet-%(version)s.svn261.tar.gz']

   rpmPatches = [ 'NetworkManager-0.6.5-fixup-internal-applet-build.patch',
                  'nm-applet-0.7.0-disable-stuff.patch'
                  ]

   extraConfig = ' --disable-static --with-distro=redhat  --with-named=/usr/sbin/named --with-named-user=named --with-named-dir=%(localstatedir)s/named '

   def unpack(r):

      RPMPackageRecipe.unpack(r)
      r.addSource('ntpd.dispatch')

   def build(r):

      r.Run('autoreconf -i')
      r.Configure( r.extraConfig)


      r.extraConfig += '--with-notify'
      r.Run('autoreconf -i', dir = 'nm-applet-%(version)s')
      r.Configure( r.extraConfig,
                   configureName = r.configureName,
                   preConfigure = r.preConfigure,
                   dir = 'nm-applet-%(version)s')

      r.Make()
      r.Make(dir = 'nm-applet-%(version)s')

   def install(r):
      r.MakeInstall()
      r.MakeInstall('DESTDIR=%(destdir)s', dir = 'nm-applet-%(version)s', package='network-manager-applet')

      r.MakeDirs('%(sysconfdir)s/NetworkManager/VPN')
      r.ExcludeDirectories(exceptions='%(localstatedir)s/run/%(name)s')
      r.ExcludeDirectories(exceptions='%(sysconfdir)s/NetworkManager/VPN')
      r.Install('ntpd.dispatch', '%(sysconfdir)s/NetworkManager/dispatcher.d/ntpd')

   def policy(r):
      r.Requires('libnl:lib','%(sbindir)s/NetworkManager')
      r.Requires('wpa_supplicant:runtime','%(sbindir)s/NetworkManager')
