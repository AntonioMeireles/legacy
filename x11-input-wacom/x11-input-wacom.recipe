#
# Copyright (c) 2007 rPath, Inc.
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

loadSuperClass('rpmpackage')
class X11InputWacom(RPMPackageRecipe, AutoPackageRecipe):
    name = 'x11-input-wacom'
    version = '0.8.2'
    rpmRelease = '3.22'
    isOPENsuse = True
    isXOrgFactory = True

    buildRequires = [  'libICE:devel', 'ncurses:devel', 'tcl:runtime',
                       'tcl:devel', 'tk:devel',
                       'libX11:devel', 'libXi:devel', 'pkgconfig:devel',
                       'autoconf:runtime', 'libtool:runtime', 'libpciaccess:devel',
                       'automake:runtime', 'xorg-server:devel', 'inputproto:devel',
                       'libtool:devel', 'libtool:runtime', 'util-macros:devel',
                       'xorg-server:devel', 'randrproto:devel',]

    tarballName = 'linuxwacom-%(version)s-2.tar.bz2'

    rpmPatches = [ ]
    rpmSources = [ '65-wacom.rules' ]

    def unpack(r):
        RPMPackageRecipe.unpack(r)
        r.macros.optflags += ' -fno-strict-aliasing -DWCM_XORG_XSERVER_1_6 '
        r.Run('libtoolize --force; autoreconf -fi')
        r.Install('65-wacom.rules', '%(sysconfdir)s/udev/rules.d/', mode = 0644)

    def configure(r):
        r.macros.optflags += ' -fno-strict-aliasing  '

        configureArgs =  '--enable-wacdump --enable-libwacomcfg --enable-dlloader  '
        configureArgs += '--with-xmoduledir=/usr/%(lib)s/xorg/modules/input --with-xlib=/usr/%(lib)s'
        if Arch.x86_64:
            configureArgs += ' --enable-xserver64 '

        r.Configure(configureArgs)

    def policy(r):
        r.Move('/usr/%(lib)s/TkXInput/pkgIndex.tcl', '/usr/share/tcl/%(name)s-tools/')
        r.Symlink('/usr/%(lib)s/TkXInput/libwacomxi.so', '/usr/share/tcl/x11-input-wacom-tools/libwacomxi.so')
