#
# Copyright (c) 2011 Foresight Linux
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

class Panda3d(PackageRecipe):
    name = 'panda3d'
    version = '1.7.0'
 
    buildRequires = ['Mesa:devel', 'atk:devel', 'cairo:devel', 'desktop-file-utils:runtime', 'ffmpeg:devel', 'fmodex:devel', 'fontconfig:devel', 'freetype:devel', 'gdk-pixbuf:devel', 'glib:devel', 'gtk:devel', 'libX11:devel', 'libXrandr:devel', 'libXxf86dga:devel', 'libgcc:devellib', 'libjpeg:devel', 'libpng:devel', 'libstdc++:devel', 'libtiff:devel', 'nvidia-cg-toolkit:devel', 'openal:devel', 'openssl:devel', 'pango:devel', 'python:devel', 'python:tk', 'tinyxml:devel', 'zlib:devel', 'libsquish:devel', 'ode:devel', 'bison:devel', 'bison:runtime', 'flex:devel', 'flex:runtime', 'make:runtime', 'gcc-c++:runtime', 'libgcc:devellib', 'gcc:runtime', 'gcc:devel', 'glibc:devel']
 
    def setup(r):
        r.addArchive('http://www.panda3d.org/download/%(name)s-%(version)s/%(name)s-%(version)s.tar.gz')
        r.Replace('CFLAGS=""','CFLAGS="-D__STDC_CONSTANT_MACROS -L%(libdir)s/xorg.mesa.3d"', 'makepanda/makepanda.py')
        r.Replace('LDLAGS=""','LDLAGS="-L%(libdir)s/xorg.mesa.3d"', 'makepanda/makepanda.py')
        r.Run("%(builddir)s/makepanda/makepanda.py --everything")
        r.Run("python %(builddir)s/makepanda/installpanda.py --destdir=%(destdir)s")
        r.Ldconfig("%(libdir)s/panda3d")
        r.NormalizeInterpreterPaths(exceptions=".*")
