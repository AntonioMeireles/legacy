#
# Copyright (c) 2006 rPath, Inc.
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

class Nspr(CPackageRecipe):
    name = 'nspr'
    version = '4.6.5'

    buildRequires = []

    if Arch.x86_64:
        extraConfig = '--with-64bit'
    else:
        extraConfig = ''

    def setup(r):
        r.macros.subDir = 'mozilla/nsprpub'
        r.addArchive('ftp://ftp.mozilla.org/pub/mozilla.org/nspr/releases/v%(version)s/src/%(name)s-%(version)s.tar.gz')
        r.addSource('nspr.pc.in', macros=True)

	r.Configure('--includedir=%(includedir)s ' + r.extraConfig, dir='%(subDir)s')
        r.Make(dir='%(subDir)s')
        r.MakeInstall(dir='%(subDir)s', installtarget='real_install')
	r.MakeDirs('/usr/lib/pkgconfig')


	r.Run(""" 
	NSPR_LIBS=`/usr/bin/nspr-config --libs`  
	NSPR_CFLAGS=`/usr/bin/nspr-config --cflags`  	
	NSPR_VERSION=`/usr/bin/nspr-config --version` 
	
	sed nspr.pc.in  -e "s,_NSPR_VERSION_,${NSPR_VERSION}," 	-e "s,_FULL_NSPR_LIBS_,${NSPR_LIBS}," 	-e "s,_FULL_NSPR_CFLAGS_,${NSPR_CFLAGS}," > nspr.pc
	""")
      	
	r.Copy('nspr.pc', '/usr/lib/pkgconfig/nspr.pc')
	r.Remove('/usr/bin/compile-et.pl')
	r.Remove('/usr/bin/prerr.properties')
	r.Remove('/usr/share/aclocal/nspr.m4')
	r.Remove('/usr/include/md/*')
	r.Remove('/usr/include/md')
