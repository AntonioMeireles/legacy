#
# Copyright (c) 2004-2008 rPath, Inc.
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

class Boost(AutoPackageRecipe):
    name = 'boost'
    version = '1.34.1'

    buildRequires = [
        'bzip2:devel', 'icu:devel', 'libstdc++:devel', 'python:devel',
        'zlib:devel'
    ]

    def unpack(r):
        r.macros.undersc_ver = r.version.replace('.', '_')
        r.addArchive('mirror://sourceforge/boost/%(name)s_%(undersc_ver)s.tar.bz2')

        # RPL-2143 CVE-2008-0171 CVE-2008-0172
        r.addPatch('http://svn.boost.org/trac/boost/changeset/42674?format=diff&new=42674')
        r.addPatch('http://svn.boost.org/trac/boost/changeset/42745?format=diff&new=42745')

        r.Replace('^BJAM_CONFIG=""', 'BJAM_CONFIG="--layout=system"',
                  'configure')

    def configure(r):
        r.ManualConfigure(
            '--with-icu '
            ' --prefix=%(destdir)s%(prefix)s'
            ' --libdir=%(destdir)s%(libdir)s'
        )

    def policy(r):
        r.AutoDoc(exceptions='/.+/')

        docs = [ 'LICENSE_1_0.txt', 'boost.{css,png}',
                 'google_logo_40wht.png', 'index.htm', 'rst.css',
                 'more', 'people', 'status', 'wiki' ]

        r.Doc(*docs)
        r.Doc('doc/html', dir='doc')

        r.CheckSonames(exceptions='%(libdir)s/libboost_.*')

