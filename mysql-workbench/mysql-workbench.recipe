class MySQLWorkbench(CPackageRecipe):

    name = 'mysql-workbench'
    version = '6.0.6'

    buildRequires = [
        'libzip:devel', 'gcc-c++:runtime', 'libxml2:devel', 'libsigc++:devel', 
        'gtkmm:devel', 'mysql:devel', 'util-linux:devel', 'pcre:devel', 
        'pexpect:python', 'sqlite:devel', 'python:devel',
        'google-ctemplate:devel', 'Mesa:devel', 'openssl:devel',
        'boost:devel', 'libtool:runtime', 'lua:devel', 'tinyxml:devel', 
        'libiodbc:devel', 'python-sqlite:python', 'mysql-connector-c++',
        'cmake:runtime', 'pcre-c++:devel', 'vsqlite++:devel',
        # Autoreconf is called early in the build in some subdirs.
        'autoconf:runtime'
    ]

    # On non-Gnome systems, Gnome Keyring is not used, so password "keyring" functionality
    # is disabled.
    if Use.gnome:
        buildRequires.append('libgnome-keyring:devel')

    def setup(r):
        #Disable parallel build.
        r.unpack()
        r.build()
        r.policy()

    def unpack(r):
        r.addArchive('http://mysql.he.net/Downloads/MySQLGUITools/%(name)s-community-%(version)s-src.tar.gz')

    def build(r):
        r.macros.parallelmflags = ''
        r.CMake(objDir='build')
        r.Make(dir='build')
        r.MakeInstall(dir='build')

    def policy(r):
        # This is required for workbench's SSH tunnel functionality.  Not sure why it's not found by PythonRequires.
        r.Requires('paramiko:python', '%(datadir)s/%(name)s/.*py$')
        r.ComponentSpec('%(name)s:lib', '%(libdir)s/%(name)s/.*so$')
        r.Description(shortDesc=r.summary(), longDesc=r.description()) 

    def summary(r):
        packageSummary = "MySQL Workbench is the standard, comprehensive GUI tool suite offered by Oracle for MySQL."
        packageSummary += " With it, one can visually Administer servers, design schemas and develop SQL queries within"
        packageSummary += " a single, unified GUI tool.  Released under the GPL"
        return packageSummary

    def description(r):
        packageDescription = "Design:\n"
        packageDescription += "    MySQL Workbench contains powerful modeling tools which allow DBAs or architects visually"
        packageDescription += " create complex EER models, reverse engineer existing schemas, and forward engineer alterations"
        packageDescription += " to existing schemas.  This handles key change management and documentation tasks which are"
        packageDescription += " otherwise both time consuming, error prone, and technically challenging.\n"
        packageDescription += "Development:\n"
        packageDescription += "    MySQL Workbench provides tools for creating, executing, and optimizing queries, complete"
        packageDescription += " syntax highlighting amd a re-usable statement history. A panel for selecting connections to"
        packageDescription += " multiple servers is also provided, along with an object broswer allowing the query designer"
        packageDescription += " to browse the schemas of connected databases at a glance.\n"
        packageDescription += "Administration\n"
        packageDescription += "    MySQL Workbench gives DBAs the tools required to obtain instant insignt into MySQL server"
        packageDescription += " health, performance metrics, and tunable parameters.  It also provides a database user and"
        packageDescription += " permissions administration tool, a visual configuration file editor, and a data import/export"
        packageDescription += " tool."
        packageDescription += "MySQL Workbench Product Site:  http://www.mysql.com/products/community/"
        packageDescription += "MySQL Workbench Manual: http://dev.mysql.com/doc/workbench/en/index.html"
        packageDescription += "This software is distributed under the GNU General Public License, Version 2, June 1991."
        packageDescription += "http://www.gnu.org/licenses/gpl-2.0.html"
        packageDescription += "Some bundled software is redistributed under different licenses."
        return packageDescription

