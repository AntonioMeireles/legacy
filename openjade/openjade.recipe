#
# Copyright (c) 2004-2007 rPath, Inc.
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

class Openjade(CPackageRecipe):
    name = 'openjade'
    version = '1.3.2'

    buildRequires = [ 'docbook-dtds:data', 'libxml2:runtime',
                      'opensp:devel', 'libstdc++:devel',
                      'sgml-common:runtime', 'perl:runtime', ]

    def setup(r):
        r.disableParallelMake()

        r.macros.jadedir = '%(datadir)s/sgml/OpenJade'
        r.addArchive('mirror://sourceforge/openjade/')

        # Don't check for lib64, conary will get that right in r.Configure().
        r.Replace('test.*osplibdir.*64.*', 'osplibdir=${libdir}', 'configure')

        r.Configure('--enable-http --enable-html --enable-mif'
                    ' --datadir=%(jadedir)s')
        r.Make()
        r.MakeInstall()
        r.MakeInstall(installtarget='install-man')

        r.Symlink('openjade', '%(bindir)s/jade')
        r.Create('%(mandir)s/man1/jade.1', contents='.so man1/openjade.1')

        r.Install('dsssl/catalog', '%(jadedir)s/')
        r.Install('dsssl/builtins.dsl', '%(jadedir)s/')
        r.Install('dsssl/{dsssl,style-sheet,fot}.dtd', '%(jadedir)s/')

        # Create catalog
        r.SGMLCatalogEntry('openjade.cat', '%(jadedir)s/catalog')

        # Requirements
        r.Requires('docbook-dtds:data', '%(bindir)s/openjade')
        r.Requires('sgml-common:runtime', '%(bindir)s/openjade')
