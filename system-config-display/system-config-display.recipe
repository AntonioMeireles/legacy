#
# Copyright (c) 2004 Specifix, Inc.
# All rights reserved
#

class SystemConfigDisplay(PackageRecipe):
    buildRequires = [ 'desktop-file-utils:runtime', 'intltool:runtime' ]
    name = "system-config-display"
    version = "1.0.33"

    def setup(r):
        r.addArchive('%(name)s-%(version)s.tar.bz2',
            rpm='ftp://ftp.linux.ncsu.edu/pub/fedora/linux/core/development/SRPMS/%(name)s-%(version)s-1.src.rpm')

        r.Run("sed -i '/xsri/d' src/xconf.py")
        r.Replace('python2', 'python',
                  'src/system-config-display', 'src/xconf.py')
	r.Replace('rhpl.monitor', 'rhpxl.monitor', 'src/xconf.py')
	r.Replace('rhpl.monitor', 'rhpxl.monitor', 'src/monitorDialog.py')
	r.Replace('rhpl.mouse', 'rhpxl.mouse', 'src/xconf.py')
	r.Replace('rhpl.videocard', 'rhpxl.videocard', 'src/xconf.py')
	r.Replace('rhpl.xhwstate', 'rhpxl.xhwstate', 'src/xconf.py')
	r.Replace('rhpl.xhwstate', 'rhpxl.xhwstate', 'src/xConfigDialog.py')
	r.Replace('rhpl.videocard', 'rhpxl.videocard', 'src/videocardDialog.py')
	r.Replace('rhpl.videocard', 'rhpxl.videocard', 'src/xConfigDialog.py')
        # fixed in upstream CVS, so remove on next update
        #r.Replace('RPM_BUILD_ROOT', 'INSTROOT', 'po/Makefile')
        r.Replace('Exec=','Exec=gksudo ','system-config-display.desktop')
        r.Replace('Categories=System;Application;SystemSetup;GTK;','Categories=Application;System;Settings','system-config-display.desktop')

        r.Make()
        r.MakeInstall(rootVar='INSTROOT')
        #r.Desktopfile('system-config-display.desktop')

        r.Remove('%(datadir)s/system-config-display/pixmaps/lightrays.png')
        r.Requires('pyxf86config:python', '%(bindir)s/system-config-display')
        r.Requires('rhpl:python', '%(bindir)s/system-config-display')
        # this is probably the only thing that *does* require rhpl:runtime
        r.Requires('rhpxl:python', '%(bindir)s/system-config-display')
        r.Requires('xorg-x11:runtime', '%(bindir)s/system-config-display')
        r.Requires('pygtk:python', '%(bindir)s/system-config-display')
        r.Requires('kudzu:python', '%(bindir)s/system-config-display')
