#
# Copyright (c) 2008 - 2010 Foresight Linux Project
# Copyright (c) 2005-2009 rPath, Inc.
#
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

class Sword(CPackageRecipe):
    name = "sword"
    version = "1.6.2+r2679"

    buildRequires = ['clucene:devel', 'curl:devel', 'libstdc++:devel',
                     'openssl:devel', 'pkgconfig:devel', 'zlib:devel', 
                     'icu:runtime', 'icu:devel', 'cmake:runtime',
                     'libtool:runtime',
                     'cppunit:devel', 'php:runtime', 'python:devel',
                     'swig:runtime', 'perl:devel']

    def setup(r):
        r.macros.majversion = '.'.join(r.version.split('.')[0:2])
        r.macros.rev = r.version[-4:]
        r.macros.url = 'http://crosswire.org/ftpmirror/pub/sword/source'
        r.addSvnSnapshot('http://crosswire.org/svn/sword/trunk/', revision='%(rev)s')
        r.addPatch('cmake_libdir.patch')
        #r.addArchive('%(url)s/v%(majversion)s/sword-%(version)s.tar.gz')
        r.macros.cmake_args = ' -DSWORD_BINDINGS=Python'
        if Arch.x86_64:
            r.macros.cmake_args += ' -DLIB_SUFFIX=64'
        r.CMake('%(cmake_args)s', objDir='build')
        r.Make(dir='build')
        r.MakeInstall(dir='build')
        # Only python bindings atm until 
        r.PythonSetup('install', dir='build/bindings/swig/python/')

        r.MakeDirs('%(datadir)s/sword/modules')
        r.ExcludeDirectories(exceptions='%(datadir)s/sword/modules')

        r.Create('%(sysconfdir)s/sword.conf', contents="\n".join((
            '[Install]',
            'DataPath=/usr/share/sword/',
            '',
            '[Sources]',
            'DIRSource=/usr/share/sword|[local]|/usr/share/sword',
            '',
        )))
