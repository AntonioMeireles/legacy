#
# Copyright (c) 2008 - 2009 Foresight Linux Project
# Copyright (c) 2005-2009 rPath, Inc.
#
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

class Sword(CPackageRecipe):
    name = "sword"
    version = "1.6.0"

    buildRequires = ['clucene:devel', 'curl:devel', 'libstdc++:devel',
                     'openssl:devel', 'pkgconfig:devel', 'zlib:devel', 
                     'icu:runtime', 'icu:devel']

    def setup(r):
        r.macros.majversion = '.'.join(r.version.split('.')[0:2])
        r.macros.url = 'http://crosswire.org/ftpmirror/pub/sword/source'
        r.addArchive('%(url)s/v%(majversion)s/sword-%(version)s.tar.gz')

        r.Configure('--disable-static --with-icu --with-clucene')
        r.Make()
        r.MakeInstall()
        # Sword 1.5. has a packaging "bug" we need to work around
        # No language bindings atm until 
        #I found out how to make them compile
        #r.Run('cd bindings/swig/package')#; ./autogen.sh')
	    #r.Automake()
        #r.Configure(subDir='bindings/swig/package')
        #r.Make('pythonswig', subDir='bindings/swig/package')
        #r.Make(subDir='bindings/swig/package')
        #r.Run('cd bindings/swig/package/python;'
        #      ' python setup.py install --prefix=%(destdir)s/%(prefix)s')

        r.Create('%(sysconfdir)s/sword.conf', contents="\n".join((
            '[Install]',
            'DataPath=/usr/share/sword/',
            '',
            '[Sources]',
            'DIRSource=/usr/share/sword|[local]|/usr/share/sword',
            '',
        )))
