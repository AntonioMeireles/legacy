#
# Copyright (c) 2004-2008 rPath, Inc.
# Changed 2007 by Foresight Linux (Thilo Pfennig)
# Copyright (c) 2009 Foresight Linux
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#
 
loadRecipe('gnomepackage')
class GnomeGames(GnomePackageRecipe):
    
    name = 'gnome-games'
    version = '2.30.0'

    buildRequires =  [
        'GConf:devel',
        'GConf:runtime',
        'PIL:python',
        'clutter-gtk:devellib',
        'clutter:devellib',
        'desktop-file-utils:runtime',
        'gir-repository:data',
        'gnome-python-desktop:python',
        'gnome-python:python',
        'gobject-introspection:devellib',
        'gobject-introspection:runtime',
        'gtk:runtime',
        'guile:devel',
        'libcanberra:devellib',
        'librsvg:devel',
        'perl:runtime',
        'pycairo:python',
        'pygtk:devel',
        'pygtk:python',
        'python:devel',
        'rarian:runtime',
        ]

    extraConfig = (
        ' --disable-scrollkeeper'
        ' --enable-introspection'
        )

    def install(r):
        r.Run('echo >> libgames-support/libgnomegames.schemas')
        GnomePackageRecipe.install(r)

    def policy(r):
        r.InitialContents('%(localstatedir)s/games/.*scores')

        # Process binaries
        # these ten games store scores
        games = ('%(bindir)s/(glines|gnibbles|gnobots2|gnometris|'
            'gnomine|gnotravex|gnotski|gtali|mahjongg|same-gnome)')
        r.Ownership('root', 'games', games) # chgrp
        r.SetModes(r.regexp(games), 02755) # setgid

        # Process score files
        r.Ownership('root', 'games', '%(localstatedir)s/games/.*scores')
        # set modes explicitly to avoid WarnWriteable
        r.SetModes('%(localstatedir)s/games/.*scores', 0664)

        r.Requires('seed:runtime', '%(bindir)s/lightsoff')
        r.Requires('file: %(datadir)s/gir-1.0/PangoCairo-1.0.gir',
            '%(datadir)s/gnome-games/lightsoff/main.js')

