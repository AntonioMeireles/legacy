#
# Copyright (c) 2004-2008 rPath, Inc.
# Changed 2007 by Foresight Linux (Thilo Pfennig)
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#
 
loadRecipe('gnomepackage')
class GnomeGames(GnomePackageRecipe):
    
    buildRequires =  [ 'libglade:devel', 'libgnome:devel', 'libgnomeui:devel',
                       'GConf:devel', 'gnome-vfs:devel', 'gtk:devel',
                       'librsvg:devel', 'guile:devel', 'rarian:devellib',
                       'ORBit2:devel', 'atk:devel', 'cairo:devel',
                       'fontconfig:devel', 'freetype:devel', 'glib:devel',
                       'gmp:devel', 'gnome-keyring:devel', 'gstreamer:devel',
                       'libart_lgpl:devel', 'libbonobo:devel', 'libbonoboui:devel',
                       'libgnomecanvas:devel', 'libICE:devel', 'libpng:devel',
                       'libSM:devel', 'pygtk:devel', 'gnome-python-desktop:devellib',
                       'libX11:devel', 'libXau:devel', 'libXdmcp:devel',
                       'libXrender:devel', 'libxml2:devel', 'pango:devel',
                       'popt:devel', 'audiofile:devel', 'esound:devel',
                       'libstdc++:devel', 'GConf:runtime', 'desktop-file-utils:runtime',
                       'gcc-c++:runtime', 'gettext:runtime', 'perl:runtime',
                       'ggz-server:devel', 'rarian:runtime', 'avahi:devel',
                       'gtk:runtime', 'libggz:devel', 'ggz-client-libs:devel',
                       'avahi-glib:devel', 'expat:devel', 'PIL:python',
                       'avahi:python', 'dbus-python:python', 'gnome-python-desktop:python',
                       'gnome-python:python', 'libgcrypt:devel', 'pycairo:python',
                       'pygtk:python', 'gnome-doc-utils:runtime', 'gnome-doc-utils:devel',
                       'SDL:devel', 'SDL_mixer:devel', 'python:devel',
                       'libgpg-error:devel', 'Mesa:devel', 'clutter-gtk:devel',
                       'clutter:devel', 'libXcomposite:devel', 'libXdamage:devel', 
                       'libXfixes:devel', 'gobject-introspection:devel', 
                       'gobject-introspection:runtime', 'gir-repository:data',
                       ]

    name = 'gnome-games'
    version = '2.28.0'

    extraConfig = GnomePackageRecipe.extraConfig
    extraConfig += (' --with-gcrypt'
                    ' --with-tls'
                    ' --with-scores-group=games'
                    ' --with-ggz-server'
                    ' --with-card-theme-formats=all'
                    ' --enable-sound'
                    ' --with-sound=gstreamer '
                    ' --disable-scrollkeeper')
    patches = [ 'ggz-api-changes.patch' ]


    def unpack(r):
        GnomePackageRecipe.unpack(r)
        r.macros.cflags += ' -L%(libdir)s/xorg.mesa.3d'

    def install(r):
        r.Run('echo >> libgames-support/libgnomegames.schemas')
        GnomePackageRecipe.install(r)
        r.InitialContents('%(localstatedir)s/games/.*scores')

        # Process binaries
        # these ten games store scores
        games = ('%(bindir)s/(glines|gnibbles|gnobots2|gnometris|'
                 'gnomine|gnotravex|gnotski|gtali|mahjongg|same-gnome)')
        r.Ownership('root', 'games', games) # chgrp
        r.SetModes(r.regexp(games), 02755) # setgid

        # Process score files
        r.Ownership('root', 'games', '%(localstatedir)s/games/.*scores')
        # set modes explicitly to avoid WarnWriteable
        r.SetModes('%(localstatedir)s/games/.*scores', 0664)
