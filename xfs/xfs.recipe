#
# Copyright (c) 2005-2007 rPath, Inc.
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

loadSuperClass('xorgcpackage')
class Xfs(XorgCPackageRecipe):
    name = 'xfs'
    version = '1.0.4'
    component = 'app'

    buildRequires = [ 'fontsproto:devel', 'freetype:devel', 'libFS:devel',
        'libXfont:devel', 'libfontenc:devel', 'xtrans:devel', 'zlib:devel' ]

    # XXX: this sets the default configdir built into the xfs binary
    # and default fontdir for the included config file, but we install our
    # config file in %(sysconfdir)s by NOT setting makeInstallArgs
    makeArgs = 'configdir=%(sysconfdir)s/X11/fs FONTDIR=%(datadir)s/X11/fonts'

    def unpack(r):
        XorgCPackageRecipe.unpack(r)

        # pulled from Fedora CVS (xorg-x11-xfs, rev. 1.7)
        # removed the Fedora migration code; may need to do our own thing
        r.addSource('xfs.init', dest='%(initdir)s/xfs', mode=0755)

        # fonts for both fontconfig & xfs go in sysfontdir;
        # those only for xfs go in xfontdir
        r.macros.sysfontdir = '%(datadir)s/fonts'
        r.macros.xfontdir = '%(datadir)s/X11/fonts'

        # based on Fedora CVS (xorg-x11-xfs, rev. 1.2)
        r.addSource('xfs.config',
                    dest='%(sysconfdir)s/X11/fs/config', mode=0644, macros=True)

        # xfs.init has -droppriv to run as user xfs
        r.UtilizeUser('xfs', '%(bindir)s/xfs')

        r.TagSpec('initscript', '%(initdir)s/')
