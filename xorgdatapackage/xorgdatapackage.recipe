#
# Copyright (c) 2005-2007 rPath, Inc.
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

class XorgDataPackageRecipe(BuildPackageRecipe):
    name = 'xorgdatapackage'
    version = '1'

    component = None

    extraConfig = ''
    preConfigure = ''
    preMake = ''
    preMakeInstall = ''
    makeArgs = ''
    makeInstallArgs = ''

    # set this to the URL of a source archive if the package
    # is not on xorg.freedesktop.org
    externalArchive = None

    # standard docs
    docs = []

    def setup(r):
        if r.__class__.__name__ == 'XorgDataPackageRecipe':
            return

        if r.component is None and not r.externalArchive:
            raise Exception('You must specify the component for this package '
             '*or* declare an external archive')
        r.macros.component = r.component

        r.unpack()
        r.build()
        r.install()
        r.policy()

    def unpack(r):
        if r.externalArchive:
            r.addArchive(r.externalArchive)
        else:
            r.addArchive('mirror://xorg/individual/%(component)s/')

    def build(r):
        r.Configure(r.extraConfig, preConfigure=r.preConfigure)
        r.Make(r.makeArgs, preMake=r.preMake)

    def install(r):
        r.MakeInstall(r.makeInstallArgs, preMake=r.preMakeInstall)

        if r.docs:
            r.Doc(*r.docs)

    def policy(r):
        pass
