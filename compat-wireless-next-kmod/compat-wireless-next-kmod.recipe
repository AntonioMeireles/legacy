#
# Copyright (c) 2008-2011 The Foresight Linux Project
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

loadSuperClass('kernelmodulepackage')
class CompatWirelessNext(KernelModulePackageRecipe):
    name = 'compat-wireless-next-kmod'
    version =  '2012_01_26'

    moduleDir = 'updates'
    buildRequires = [ 'which:runtime', ]

    def unpack(r):
        r.macros.version = r.macros.version.replace('_','-')
        r.addArchive('http://linuxwireless.org/download/compat-wireless-2.6/compat-wireless-%(version)s.tar.bz2')

    def build(r):
        r.Make(' KVER=%(kver)s KLIB=/lib/modules/%(kver)s '
               ' KLIB_BUILD=/lib/modules/%(kver)s/build   ')

    def install(r):
        r.macros.moduledir = r.moduleDir
        r.Make(' -C /lib/modules/%(kver)s/build M=$(pwd) '
               ' INSTALL_MOD_PATH=%(destdir)s '
               ' INSTALL_MOD_DIR=%(moduledir)s modules_install')
