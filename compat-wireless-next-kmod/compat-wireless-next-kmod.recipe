#
# Copyright (c) 2008-2013 The Foresight Linux Project
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

loadSuperClass('kernelmodulepackage')
class CompatWirelessNext(KernelModulePackageRecipe):
    name = 'compat-wireless-next-kmod'
    version =  '3.8_1_u'

    moduleDir = 'updates'
    buildRequires = [ 'which:runtime', ]

    def unpack(r):
        # XXX TODO change package name to accomodate upstreams' rename
        r.macros.name = 'compat-drivers'
        r.macros.version = r.macros.version.replace('_','-')
        # https://backports.wiki.kernel.org/index.php/Releases
        # http://www.kernel.org/pub/linux/kernel/projects/backports/stable/
        r.addArchive('http://www.kernel.org/pub/linux/kernel/projects/backports/stable/v%s/' % r.macros.version.split('-')[0])
        
        r.macros.moduledir = r.moduleDir
        r.Environment('KBUILD_NOPEDANTIC', 'foo')

    def build(r):
        r.Make(' KVER=%(kver)s' 
               ' KLIB=/lib/modules/%(kver)s ')
               
    def install(r):
        r.Make(' KVER=%(kver)s' 
               ' KLIB=/lib/modules/%(kver)s '
               ' KMODDIR=%(moduledir)s'
               ' KMODPATH_ARG=\'INSTALL_MOD_PATH=%(destdir)s\''
               ' install-modules'
               )
