#
# Copyright (c) 2008-2012 The Foresight Linux Project
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

loadSuperClass('kernelmodulepackage')
class CompatWirelessNext(KernelModulePackageRecipe):
    name = 'compat-wireless-next-kmod'
    version =  '3.5_1_sn'

    moduleDir = 'updates'
    buildRequires = [ 'which:runtime', ]

    def unpack(r):
        r.macros.version = r.macros.version.replace('_','-')
        # http://linuxwireless.org/en/users/Download/stable/#compat-wireless_3.5_stable_releases
        r.addArchive('http://www.orbit-lab.org/kernel/compat-wireless-3-stable/v3.5/compat-wireless-%(version)s.tar.bz2')
        
        r.macros.moduledir = r.moduleDir

    def build(r):
        r.Make(' KVER=%(kver)s' 
               ' KLIB=/lib/modules/%(kver)s ')
               
    def install(r):
        r.Make(' KVER=%(kver)s' 
               ' KLIB=/lib/modules/%(kver)s '
               ' KMODDIR=%(moduledir)s'
               ' KMODPATH_ARG=\'INSTALL_MOD_PATH=%(destdir)s\''
               ' install-modules'
               )
