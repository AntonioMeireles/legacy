#
# Copyright (c) 2008 Lance Haig.
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

class LibVirt(CPackageRecipe):
    buildRequires = [ 'iptables:runtime', 
			'libxml2:devel', 
			'libxml2:runtime', 
			'libxslt:runtime', 
			'ncurses:devel', 
			'readline:devel', 
			'sysfsutils:devel', 
			'zlib:devel',
			#'xen:devel', # enable this on rpl2 for xen support
			'kqemu:lib',
			'gnutls:devel',
                        'gnutls:runtime',
                        'cyrus-sasl:devel',
                        'cyrus-sasl:runtime',
			'parted:devel',
			'parted:devellib',
			'parted:runtime',
			'pkgconfig:devel',
			'PolicyKit:devel',
                        'avahi:devel',
                        'bridge-utils:runtime',
                        'cyrus-sasl:devel',
                        'dbus:devel',
                        'python:devel',
                        'readline:devel',
			'PolicyKit:runtime', 
			'gcc-c++:runtime', 
			'kvm:runtime', 
			'open-iscsi:runtime',
			'gettext:runtime', 
			'intltool:runtime'
			]

    name = 'libvirt'
    version = '0.4.2'

    def setup(r):
        r.addArchive('http://libvirt.org/sources/%(name)s-%(version)s.tar.gz')
       # r.addArchive('http://libvirt.org/sources/libvirt-cvs-snapshot.tar.gz') # Use this line to build the nightly snapshot.
	#cmd = './configure --with-libvirtd --with-init-scripts=auto --with-sasl --with-polkit --with-avahi --with-gnu-ld --with-lxc --with-xen=no'
        cmd = './configure --with-libvirtd --with-init-scripts=redhat --with-sasl --with-polkit --with-avahi --with-gnu-ld --with-lxc --with-xen=no --prefix=%(prefix)s --localstatedir=%(localstatedir)s --libdir=%(libdir)s'
        r.Run(cmd)
        r.Make()
        r.MakeInstall()
	#r.Install('init/bongo.init.rpl.in', '%(initdir)s/bongo', mode=0755)
	r.TagSpec('initscript', '%(initdir)s/')
