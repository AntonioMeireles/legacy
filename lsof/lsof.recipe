#
# Copyright (c) 2004-2006 rPath, Inc.
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

class lsof(CPackageRecipe):
    name = 'lsof'
    version = '4.77'

    def setup(r):
        r.addArchive('ftp://lsof.itap.purdue.edu/pub/tools/unix/lsof/lsof_%(version)s.tar.bz2')
        r.mainDir('lsof_%(version)s')

        # The lsof archive contains another tarball with the actual
        # source, so it must be unpacked here
        r.addAction('tar xf lsof_%(version)s_src.tar')
        r.addAction('mv lsof_*_src/* .')

        # Allow to run with older kernels by using older kernel
        # version string.
        r.Run('LSOF_VERS=24018 LSOF_VSTR=2.4.18 LINUX_BASE=/proc'
                 ' ./Configure -n linux')
        r.Make()

        r.Install('lsof', '%(sbindir)s/')
        r.Install('lsof.8', '%(mandir)s/man8/')
        r.AutoDoc('00.*')
