class GoogleEarth(PackageRecipe):
    name = 'google-earth'
    version = '5.1.3534.0411'


    buildRequires = [ 'bash:runtime', 'fontconfig:devel', 'freetype:devel',
                      'glibc:devel', 'perl:lib', 'perl:runtime',
                      'desktop-file-utils:runtime','atk:devel',
                      'glib:devel', 'gtk:devel', 'pango:devel',
                      'libICE:devel', 'libSM:devel', 'libX11:devel', 'curl:devel',
                      'libXcursor:devel', 'libXext:devel', 'perl:devel',
                      'libXft:devel', 'libXrender:devel', 'Mesa:devel', 'gawk:runtime',
                      'libXi:devel', 'libXrandr:devel', 'libgcc:devellib', 'libstdc++:devel',
                      'qt4-core:lib', 'qt4-gui:lib', 'qt4:devel', 'libgcc:lib', 'libstdc++:lib']

    installPath = "/opt/"
    installPath2 = "/opt/google-earth/"

    def setup(r):

        r.addSource('http://dl.google.com/earth/client/current/GoogleEarthLinux.bin')
        r.addSource('googleearth.desktop')
        r.Desktopfile('googleearth.desktop')

        r.Run(r"""
        sh GoogleEarthLinux.bin --nox11  --nochown --noexec --target %(builddir)s/ 
        """)
        r.MakeDirs('/opt/%(name)s')

        r.Run("tar -xf googleearth-data.tar -C %(destdir)s/opt/%(name)s/")
        r.SetModes('/opt/%(name)s/gpsbabel', 0755)
        r.Run("tar -xf googleearth-linux-x86.tar -C %(destdir)s/opt/%(name)s/")


        r.Remove('{plugins,qt.conf}', recursive =True )

        r.addSource('googleearth')
        r.Install('googleearth','%(bindir)s/googleearth', mode = 0755)

        r.Symlink('%(bindir)s/googleearth', '%(bindir)s/google-earth')

        r.Symlink('/usr/lib/qt4/plugins/styles', '/opt/%(name)s/plugins/')
        r.DanglingSymlinks(exceptions='/opt/%(name)s/plugins/.*')

        # things shouldn't be this way ...
        # we are adding a recent libstdc++ / libgcc_s combo and hidding it
        # from the Requires / Provides machinery...

        r.addSource('libstdc++.so.6.0.12', dest='/opt/%(name)s/')
        r.addSource('libgcc_s-4.4.1-20090729.so.1', dest='/opt/%(name)s/')
        r.Symlink('/opt/%(name)s/libstdc++.so.6.0.12', '/opt/%(name)s/libstdc++.so.6')
        r.Symlink('/opt/%(name)s/libgcc_s-4.4.1-20090729.so.1', '/opt/%(name)s/libgcc_s.so.1')

        for x in [ 'libgcc', 'libstdc\+\+']:
            r.Requires(exceptDeps='soname:\ ELF32.*%s.*' % x )
            r.Provides(exceptDeps='soname:\ ELF32.*%s.*' % x)

        # stuff we have and that works, and so we wipe it to make pkg smaller...
        r.Remove('/opt/%(name)s/lib{crypto.so.*,Qt*,GLU.so.*,curl.so.*,z.so.*}', allowNoMatch = True)

