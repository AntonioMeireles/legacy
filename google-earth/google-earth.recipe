class GoogleEarth(PackageRecipe):
    name = 'google-earth'
    version = '6.0.0.1735'


    buildRequires = [ 'bash:runtime', 'fontconfig:devel', 'freetype:devel',
                      'glibc:devel', 'perl:lib', 'perl:runtime',
                      'desktop-file-utils:runtime','atk:devel',
                      'glib:devel', 'gtk:devel', 'pango:devel',
                      'libICE:devel', 'libSM:devel', 'libX11:devel', 'curl:devel',
                      'libXcursor:devel', 'libXext:devel', 'perl:devel',
                      'libXft:devel', 'libXrender:devel', 'Mesa:devel', 'gawk:runtime',
                      'libXi:devel', 'libXrandr:devel', 'libgcc:devellib', 'libstdc++:devel',
                      'qt4-core:lib', 'qt4-gui:lib', 'qt4:devel', 'libgcc:lib', 'libstdc++:lib']

    installPath = "/opt/"
    installPath2 = "/opt/google-earth/"

    def setup(r):

        r.addSource('http://dl.google.com/earth/client/current/GoogleEarthLinux.bin')
        r.addSource('googleearth.desktop')
        r.Desktopfile('googleearth.desktop')

        r.Run(r"""
        sh GoogleEarthLinux.bin --nox11  --nochown --noexec --target %(builddir)s/ 
        """)
        r.MakeDirs('/opt/%(name)s')

        r.Run("tar -xf googleearth-data.tar -C %(destdir)s/opt/%(name)s/")
        r.SetModes('/opt/%(name)s/gpsbabel', 0755)
        r.Run("tar -xf googleearth-linux-x86.tar -C %(destdir)s/opt/%(name)s/")

        r.Remove('{plugins,qt.conf}', recursive =True )

        r.addSource('googleearth', macros = True)
        r.Install('googleearth','%(bindir)s/googleearth', mode = 0755)

        r.Symlink('%(bindir)s/googleearth', '%(bindir)s/google-earth')

        r.Symlink('%(libdir)s/qt4/plugins/styles', '/opt/%(name)s/plugins/')
        r.DanglingSymlinks(exceptions='/opt/%(name)s/plugins/.*')

        r.Install('googleearth-icon.png', '%(datadir)s/pixmaps/', mode = 0644)

        # stuff we have and that works, and so we wipe it to make pkg smaller...
        r.Remove('/opt/%(name)s/lib{crypto,z,curl,GLU,Qt}.*', allowNoMatch = True)

        for x in [ 'libz']:
            r.Requires(exceptDeps='soname:\ ELF32.*%s.*' % x )
            r.Provides(exceptDeps='soname:\ ELF32.*%s.*' % x)

        # make sure global fl settings are consumed
        r.Create('/opt/%(name)s/qt.conf', mode = 0644,
                 contents = """
[Paths]
Documentation=%(docdir)s/
Libraries=%(libdir)s
Plugins=%(libdir)s/qt4/plugins
Translations=/usr/share/qt4/translations
""")
        r.Create('/opt/%(name)s/pangorc', mode = 0644,
                 contents = """
[Pango]
ModuleFiles=%(libdir)s/pango/1.6.0/modules/
[PangoX]
AliasFiles=/etc/pango/pangox.aliases
""")
