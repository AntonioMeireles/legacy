class GoogleEarth(PackageRecipe):
    name = 'google-earth'
    version = '5.1.3509.4636'


    buildRequires = [ 'bash:runtime', 'fontconfig:devel', 'freetype:devel',
                      'glibc:devel', 'perl:lib', 'perl:runtime',
                      'desktop-file-utils:runtime','atk:devel',
                      'glib:devel', 'gtk:devel', 'pango:devel',
                      'libICE:devel', 'libSM:devel', 'libX11:devel',
                      'libXcursor:devel', 'libXext:devel', 'perl:devel',
                      'libXft:devel', 'libXrender:devel', 'Mesa:devel', 'gawk:runtime',
                      'libXi:devel', 'libXrandr:devel', 'libgcc:devellib', 'libstdc++:devel',
                      'qt4-core:lib', 'qt4-gui:lib', 'qt4:devel',]

    installPath = "/opt/"
    installPath2 = "/opt/google-earth/"

    def setup(r):

        r.addSource('http://dl.google.com/earth/client/current/GoogleEarthLinux.bin')

        r.Run(r"""
        sh GoogleEarthLinux.bin --nox11  --nochown --noexec --target %(builddir)s/ 
        """)
        r.Run("mkdir google-earth")
        r.Run("tar -xf googleearth-data.tar -C google-earth")
        r.Run("tar -xf googleearth-linux-x86.tar -C google-earth")

        r.Replace('Categories=Application;Network',
                  'Categories=GNOME;3DGraphics;Network;',
                  'googleearth.desktop')

        r.MakeDirs('/opt/%(name)s')
        r.Copy("google-earth",r.installPath)
        r.Copy("bin/googleearth",r.installPath2)
        r.Copy("googleearth-icon.png",r.installPath2)

        r.addSource('googleearth.desktop')
        r.Desktopfile('googleearth.desktop')

        r.addSource('googleearth')
        r.Install('googleearth','%(bindir)s/googleearth')
        r.Symlink('%(bindir)s/googleearth', '%(bindir)s/google-earth')

        # http://www.google.com/support/forum/p/earth/thread?tid=656ef9a98bc427dd&hl=en
        r.Remove('/opt/%(name)s/libQt*')
        r.Remove('/opt/%(name)s/libgcc_s*')
        r.Remove('/opt/%(name)s/libstdc++*')
        r.Symlink('/usr/lib/qt4/plugins/styles', '/opt/%(name)s/plugins/')
        r.DanglingSymlinks(exceptions='/opt/%(name)s/plugins/.*')

