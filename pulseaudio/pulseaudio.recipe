#
# Copyright (c) 2004-2008 rPath, Inc.
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

loadSuperClass('rpmpackage')
class PulseAudio(RPMPackageRecipe,AutoPackageRecipe):
    name = 'pulseaudio'
    version  = '0.9.10'
    rpmRelease = '1.fc9'

    buildRequires = [ 'GConf:devel', 'ORBit2:devel', 'alsa-lib:devel', 'avahi:devel', 'hal:devel', 'libcap:devel', 'liboil:devel', 'libsamplerate:devel', 'libsndfile:devel', 'libtool:devel', 'm4:runtime', 'tcp_wrappers:devel', 'libatomic_ops:devel', 'libtool:runtime', 'autoconf:runtime','automake:runtime', 'gettext:devel', 'PolicyKit:devel', 'bluez-libs:devel', 'gcc-fortran:runtime', 'jack:devel', 'libICE:devel', 'libSM:devel', 'pkgconfig:devel', 'pulseaudio:devel', 'lirc:devel']

    def unpack(r):
        RPMPackageRecipe.unpack(r)
        r.addSource('pulseaudio-daemon.desktop', dir='%(sysconfdir)s/xdg/autostart')

    def configure(r):
        extraConfig = ' --disable-ltdl-install --disable-static --disable-rpath --with-system-user=pulse --with-system-group=pulse --with-realtime-group=pulse-rt --with-access-group=pulse-access'
        r.Configure(extraConfig)

    def make(r):
        r.Make('LIBTOOL=%(bindir)s/libtool')

    def policy(r):
        r.SetModes('%(libexecdir)s/pulse/bt-proximity-helper', 04755)
        r.SetModes('%(bindir)s/pulseaudio', 04755)
        r.Symlink('%(bindir)s/esdcompat','%(bindir)s/esd')
        r.UtilizeGroup('pulse', '%(bindir)s/pulseaudio')
        r.UtilizeGroup('pulse-access', '%(bindir)s/pulseaudio')
        r.UtilizeGroup('pulse-rt', '%(bindir)s/pulseaudio')

        r.Requires('esound:runtime', '%(bindir)s/esd')
