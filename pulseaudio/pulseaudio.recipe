#
# Copyright (c) 2004-2007 rPath, Inc.
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

loadRecipe('rpmpackage')
loadRecipe('gnomepackage')
class PulseAudio(RPMPackageRecipe,GnomePackageRecipe):
    name = 'pulseaudio'
    version  = '0.9.7'
    rpmRelease = '0.7.svn20070816.fc8'
#    rpmPatches = ['pulseaudio-0.9.6-nochown.patch']

    # hack! to not have to wait ... 
    #tarballName = '%(name)s-%(version)s.svn20070816.tar.gz'
    externalArchive = '%(name)s-svn20070824.tar.gz'
    buildRequires = ['GConf:devel', 'ORBit2:devel', 'alsa-lib:devel', 'avahi:devel', 'hal:devel', 'libcap:devel', 'liboil:devel', 'libsamplerate:devel', 'libsndfile:devel', 'libtool:devel', 'm4:runtime', 'tcp_wrappers:devel', 'libatomic_ops:devel', 'libtool:runtime', 'autoconf:runtime','automake:runtime', 'gettext:devel']
    configureName = 'autogen.sh'

    extraConfig = '--disable-ltdl-install --disable-static --disable-rpath --with-system-user=pulse --with-system-group=pulse --with-realtime-group=pulse-rt --with-access-group=pulse-access'
    def unpack(r):
        GnomePackageRecipe.unpack(r)

        # Apparently this is an automake 1.10 issue and can be avoided by using automake 1.9
        # http://ramblingfoo.blogspot.com/2007/07/required-file-configrpath-not-found.html
        r.Run('touch config.rpath')
        r.Run('./bootstrap.sh')

    def policy(r):
        r.SetModes('%(bindir)s/pulseaudio', 0755)
        r.Symlink('%(bindir)s/esdcompat','%(bindir)s/esd')
        r.UtilizeGroup('pulse', '%(bindir)s/pulseaudio')
        r.UtilizeGroup('pulse-access', '%(bindir)s/pulseaudio')
        r.UtilizeGroup('pulse-rt', '%(bindir)s/pulseaudio')
