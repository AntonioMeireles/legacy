#
# Copyright (c) 2004-2007 rPath, Inc.
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

class Elinks(CPackageRecipe):
    name = 'elinks'
    version = '0.13'

    buildRequires = [ 'autoconf:runtime', 'automake:runtime', 'openssl:devel',
                      'pkgconfig:devel', 'bzip2:devel', 'expat:devel',
                      'zlib:devel', 'libidn:devel', 'ncurses:runtime',
                      'docbook-utils:runtime', 'perl:runtime',
                      'xmlto:runtime', 'gc:devel', 'samba:runtime', ]

    def setup(r):
        r.addArchive('http://elinks.or.cz/download/elinks-current-%(version)s.tar.bz2')
        # CVE-2007-2027
        r.addPatch('http://viewcvs.gentoo.org/viewcvs.py/*checkout*/gentoo-x86/www-client/elinks/files/elinks-po-path.patch')

        r.macros.cppflags += ' -I%(krbprefix)s/include'
        r.macros.cflags += ' -I%(krbprefix)s/include'
        r.macros.ldflags += ' -L%(krbprefix)s/lib'
        r.Configure('--without-x --without-gpm --disable-smb')
        r.Make()

        r.MakeInstall()
        r.Symlink('elinks', '%(bindir)s/links')
        r.Symlink('elinks.1', '%(mandir)s/man1/links.1')
        r.Doc('SITES')
        r.Remove('%(datadir)s/locale/locale.alias')
