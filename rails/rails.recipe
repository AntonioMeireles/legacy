#
# Copyright (c) 2006-2008 rPath, Inc.
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

class Rails(PackageRecipe):
    name = 'rails'
    version = '2.2.2'

    buildRequires = [ 'ruby:runtime', ]

    def setup(r):
        r.addGitSnapshot('git://github.com/rails/rails.git', 'v%(version)s')
        # r.addArchive('http://rubyforge.org/frs/download.php/26563/')
        r.addSource('rails', macros=True, mode=0755, dest='%(bindir)s/')
        r.addSource('rails.1', macros=True, mode=0644, dest='%(mandir)s/')

        # fix a SQL injection
        # RPL-2832 CVE-2008-4094
        # r.addPatch('http://rails.lighthouseapp.com/attachments/43792/offset_limit_fix_backport_1-2-stable.diff', dir='vendor/rails/activerecord')

        # Install required libraries in site_ruby directory
        r.Install('railties', '%(libdir)s/ruby/site_ruby/',
                  mode=0644)

        # This is used by /usr/bin/rails by default
        r.Doc('railties/doc/guides')

        r.Requires('actionmailer:ruby', '%(libdir)s/ruby/site_ruby/.*')
        r.Requires('actionpack:ruby', '%(libdir)s/ruby/site_ruby/.*')
        r.Requires('actionwebservice:ruby', '%(libdir)s/ruby/site_ruby/.*')
        r.Requires('activerecord:ruby', '%(libdir)s/ruby/site_ruby/.*')
        r.Requires('activesupport:ruby', '%(libdir)s/ruby/site_ruby/.*')
