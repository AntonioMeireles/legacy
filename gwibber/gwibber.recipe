#
# Copyright (c) 2008-2011 Foresight Linux
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

class Gwibber(PackageRecipe):

    name = 'gwibber'
    version = '2.33.0+bzr894'
    buildRequires = ['python-setuptools:python','PIL:python', 'dbus-python:python', 'desktop-file-utils:runtime', 'gettext:runtime', 'gnome-python:python', 'intltool:runtime', 'python:devel', 'pyxdg:python', 'sexy-python:python', 'simplejson:python','python-distutils-extra:python', 'notify-python:python', 'pygtk:python', 'pycurl:python','gnome-python-desktop:python', 'gnome-python-extras:python', 'libindicate:python', 'libproxy:python', 'python-mako:python', 'pywebkitgtk:python','mx:python', 'desktopcouch:python', 'python-oauth:python']

    def setup(r):
        # r.addBzrSnapshot('lp:gwibber', tag = '894')
#        r.macros.subversion = r.version[:6]
#        r.macros.subsubversion = r.version[:4]
#        r.addArchive("http://launchpad.net/gwibber/%(subsubversion)s/%(subversion)s/+download/gwibber-%(version)s.tar.gz")
        r.addArchive('gwibber-894bzr.tar.gz')
        for p in [ 
            # https://bugs.launchpad.net/gwibber/+bug/577050
            'gwibber-865bzr-undefined.patch',
            # Disable libproxy support
            # It doesn't work for some unknown reason.
            'gwibber-894bzr-no-libproxy.patch',
            # Handle \x00 if it shows up in our content string
            # bz 630944 & 620170
            # https://bugs.launchpad.net/gwibber/+bug/647049
            'gwibber-867bzr-handle-x00-in-content.patch',
            # Oauth bits
            'gwibber-832bzr-twitter-oauth.patch',
            # Gowalla
            'gwibber-867bzr-gowalla.patch',
            'gwibber-867bzr-gowalla-icons.patch',
            # Minimize characters with unicode equivs
            'gwibber-867bzr-minimize-chars.patch',
            # Fix iter call to non-existent "mark", use "mark_start"
            # bz635345 bz623754
            'gwibber-867bzr-missing-mark.patch',
            # Use kitchen to force all strings generated by microblog inputs to unicode
            'gwibber-894bzr-kitchen-utf8.patch',
            # Right click on a stream in the navigation bar to close it.
            'gwibber-875bzr-right-click-to-close-stream.patch',
            ]:
            r.addPatch(p)

        r.PythonSetup()
        r.Move('%(libdir)s/python%(pyver)s/site-packages/share/*', '%(datadir)s/')
        r.Run('cp -a build/mo %(destdir)s%(datadir)s/locale')
        #r.addSource('gwibber.png')
        #r.Install('gwibber.png', '%(datadir)s/gwibber/ui/')
        r.Requires('python-mako:python', '%(bindir)s/gwibber')
        r.Requires('pywebkitgtk:python', '%(bindir)s/gwibber')
        r.Requires('pycurl:python', '%(bindir)s/gwibber')
        r.Requires('python-feedparser:python', '%(bindir)s/gwibber')
        r.Requires('python-oauth:python', '%(bindir)s/gwibber')
