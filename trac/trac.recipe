#
# Copyright (c) 2005-2008 rPath, Inc.
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

class Trac(PackageRecipe):
    name = 'trac'
    version = '0.11b2'

    buildRequires = [ 'mod_python:python', 'python-setuptools:python',
        'Genshi:python', 'python-sqlite:python', 'subversion:python',
        'MySQL-python:python', 'pypgsql:python', 'Pygments:python',
        'python:devel']

    def setup(r):
        r.addArchive('http://ftp.edgewall.com/pub/trac/Trac-%(version)s.tar.gz')
        r.addSource('trac.conf', dest='%(sysconfdir)s/httpd/conf.d/trac.conf', mode=0644)

        r.Replace('TRAC_ENV_PARENT_DIR','%(servicedir)s/trac',
                  '%(sysconfdir)s/httpd/conf.d/trac.conf')

        #r.PythonSetup() doesn't work with trac
        r.PythonSetup()

        r.MakeDirs('%(servicedir)s/trac')
        r.ExcludeDirectories(exceptions='%(servicedir)s/trac')

        r.ComponentSpec(':postgresql', 'postgres_backend.py.*')
        r.ComponentSpec(':mysql', 'mysql_backend.py.*')

        r.Requires("httpd:runtime", '%(sysconfdir)s/httpd/conf.d/trac.conf')
        r.Requires("mod_python:runtime", '%(sysconfdir)s/httpd/conf.d/trac.conf')

