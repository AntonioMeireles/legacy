#
# Copyright (c) 2004-2006 rPath, Inc.
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

loadSuperClass('rpmpackage')
class Quota(RPMPackageRecipe, CPackageRecipe):
    name = 'quota'
    version = '3.13'
    externalArchive = 'mirror://sourceforge/linuxquota/'
    rpmRelease = '1.2.3.1'
    rpmPatches = [ 'quota-3.06-no-stripping.patch',
        'quota-3.06-man-page.patch', 'quota-3.06-pie.patch', ]

    buildRequires = [ 'e2fsprogs:devel', 'gettext:runtime',
                      'tcp_wrappers:devel' ]

    def setup(r):
        r.unpack()
        r.Configure('--with-ext2direct=no')
        r.Make()

        r.MakeDirs('%(essentialsbindir)s', '%(sysconfdir)s', '%(sbindir)s',
                   '%(bindir)s', '%(mandir)s/man{1,2,3,8}')
        r.MakeInstall(rootVar='ROOTDIR')
        r.Install('warnquota.conf', '%(sysconfdir)s/', mode=0644)
        # glibc:devel has this file
        r.Remove('%(prefix)s/include/rpcsvc/rquota.x')
