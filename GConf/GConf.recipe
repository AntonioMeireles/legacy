#
# Copyright (c) 2004-2008 rPath, Inc.
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

loadRecipe('gnomepackage')
class GConf(GnomePackageRecipe):

    buildRequires = [ 'libxml2:devel', 'ORBit2:devel', 'glib:devel',
        'gtk:devel', 'pkgconfig:devel', 'gettext:runtime',
        'atk:devel', 'cairo:devel', 'fontconfig:devel', 
        'freetype:devel', 'glibc:devel', 'libpng:devel', 
        'openldap:devel', 'pango:devel', 'popt:devel', 'expat:devel',
        'glib:runtime', 'indent:runtime', 'perl:runtime', 'PolicyKit:devel', 'PolicyKit:runtime' ]

    name = 'GConf'
    version = '2.26.2'

    docs = ['COPYING', 'ChangeLog', 'NEWS', 'README']

    def unpack(r):
        r.disableParallelMake()
        GnomePackageRecipe.unpack(r)

    def install(r):
        GnomePackageRecipe.install(r)
        r.ComponentSpec('runtime', '%(libdir)s/GConf/2/.*\\.so')
        r.MakeDirs('%(sysconfdir)s/gconf/gconf.xml.system')
        r.MakeDirs('%(sysconfdir)s/gconf/schemas')
        r.ExcludeDirectories(exceptions='%(sysconfdir)s/gconf/gconf.xml.*')
        r.ExcludeDirectories(exceptions='%(sysconfdir)s/gconf/schemas')
        r.addSource('gconf2schema.tagdescription', macros=True)
        r.addSource('gconf2schema.taghandler')
        r.Install('gconf2schema.tagdescription',
            '%(tagdescriptiondir)s/gconf2schema')
        r.Install('gconf2schema.taghandler',
            '%(taghandlerdir)s/gconf2schema', mode=0755)

        # this just makes the testgconf program
        r.Make('check', subDir='tests')
        r.TestSuiteFiles('testgconf')
        r.TestSuite('tests', './testgconf') 
