#
# Copyright (c) 2004-2007 rPath, Inc.
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

loadSuperClass('gnomepackage')
class GConf(GnomePackageRecipe):
    name = 'GConf'
    version = '2.20.1'

    buildRequires = [ 'libxml2:devel', 'ORBit2:devel', 'glib:devel',
        'gtk:devel', 'gettext:runtime', 'popt:devel',
        'atk:devel', 'pango:devel', 'openldap:devel', 'perl:runtime',
        'cairo:devel', 'fontconfig:devel', 'freetype:devel', 'libpng:devel',
        'indent:runtime', 'file:runtime', ]

    def setup(r):
        r.disableParallelMake()
        GnomePackageRecipe.setup(r)

    def policy(r):
        r.addSource('gconf2schema.tagdescription', macros=True,
            dest='%(tagdescriptiondir)s/gconf2schema')
        r.addSource('gconf2schema.taghandler',
            dest='%(taghandlerdir)s/gconf2schema', mode=0755)

        r.Requires('/dev/null', '%(taghandlerdir)s/gconf2schema')
        r.Requires('GConf:runtime', r'%(libdir)s/libgconf.*\.so\..*')
        r.ExcludeDirectories(exceptions='%(sysconfdir)s/gconf/gconf.xml.*')

        # this just makes the testgconf program
        r.Make('check', dir='tests')
        r.TestSuiteFiles('testgconf')
        r.TestSuite('tests', './testgconf')

