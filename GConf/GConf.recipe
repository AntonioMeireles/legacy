#
# Copyright (c) 2004-2007 rPath, Inc.
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

loadRecipe('gnomepackage')
loadRecipe('rpmpackage')
class GConf(RPMPackageRecipe,GnomePackageRecipe):

    buildRequires = [ 'libxml2:devel', 'ORBit2:devel', 'glib:devel',
        'gtk:devel', 'pkgconfig:devel', 'gettext:runtime',
        'atk:devel', 'cairo:devel', 'fontconfig:devel', 
        'freetype:devel', 'glibc:devel', 'libpng:devel', 
        'openldap:devel', 'pango:devel', 'popt:devel', 'expat:devel',
        'glib:runtime', 'indent:runtime', 'perl:runtime' ]

    name = 'GConf'
    version = '2.20.1'
    rpmRelease = '2.fc9'
    rpmName = 'GConf2'
    rpmPatches = [ 'GConf-2.18.0.1-reload.patch',
                   # http://bugzilla.gnome.org/show_bug.cgi?id=356573
                   'GConf2-2.14.0-timeout.patch',
                   # http://bugzilla.gnome.org/show_bug.cgi?id=475970
                   'sync-leak.patch',
                   'dir-leak.patch',
                   'dead-leak.patch', 
                   # Add system-wide settings location
                   'system-settings.patch',
                   ]

    docs = ['COPYING', 'ChangeLog', 'NEWS', 'README']

    def unpack(r):
        r.disableParallelMake()
        RPMPackageRecipe.unpack(r)

    def install(r):
        GnomePackageRecipe.install(r)
        r.ComponentSpec('runtime', '%(libdir)s/GConf/2/.*\\.so')
        r.MakeDirs('%(sysconfdir)s/gconf/gconf.xml.system')
        r.MakeDirs('%(sysconfdir)s/gconf/schemas')
        r.ExcludeDirectories(exceptions='%(sysconfdir)s/gconf/gconf.xml.*')
        r.ExcludeDirectories(exceptions='%(sysconfdir)s/gconf/schemas')
        r.addSource('gconf2schema.tagdescription', macros=True)
        r.addSource('gconf2schema.taghandler')
        r.Install('gconf2schema.tagdescription',
            '%(tagdescriptiondir)s/gconf2schema')
        r.Install('gconf2schema.taghandler',
            '%(taghandlerdir)s/gconf2schema', mode=0755)

        # this just makes the testgconf program
        r.Make('check', subDir='tests')
        r.TestSuiteFiles('testgconf')
        r.TestSuite('tests', './testgconf') 
