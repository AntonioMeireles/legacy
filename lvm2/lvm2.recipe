#
# Copyright (c) 2005-2009 rPath, Inc.
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

class LVM2(CPackageRecipe):
    name = 'lvm2'
    version = '2.02.51'

    buildRequires = [ 'ncurses:devel', 'readline:devel',
        'userspace-kernel-headers:devel', ]

    def setup(r):
        r.addArchive('ftp://sources.redhat.com/pub/lvm2/LVM2.%(version)s.tgz', keyid='567E2C17')

        r.Configure(
            '--enable-lvm1_fallback '
            '--enable-fsdm '
            '--with-cluster=internal '
            '--with-pool=internal '
            '--with-user= '
            '--with-group= '

            '--with-staticdir=%(essentialsbindir)s '
            '--with-usrbindir=%(essentialsbindir)s '
            '--with-userlibdir=%(essentiallibdir)s '

            '--enable-static_link '
            '--enable-readline '

            '--enable-applib '
            '--enable-cmdlib '
            '--enable-pkgconfig '
            )
        r.Make()
        r.MakeInstall()

        for x in ('lvm', 'pvscan', 'vgchange', 'vgscan'):
            r.Symlink('lvm.static', '%(essentialsbindir)s/' + x)
        r.Doc('VERSION', 'WHATS_NEW')

        r.Move('/usr/sbin/dmsetup*', '/sbin/')
        r.Move('%(libdir)s/libdevmapper.*', '%(essentiallibdir)s/')
        r.PackageSpec('device-mapper',
            '%(essentiallibdir)s/libdevmapper.*',
            '%(essentialsbindir)s/dmsetup.*',
            '%(includedir)s/libdevmapper.h',
            '%(libdir)s/pkgconfig/devmapper.pc',
            '%(mandir)s/man8/dmsetup.8.gz'
            )
