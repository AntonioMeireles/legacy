#
# Copyright (c) 2006 rPath, Inc.
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

class XylRunner(CPackageRecipe):
    name = 'xulrunner'
    version = '1.8.0.4'
    buildRequires = [ 'GConf:devel', 'ORBit2:devel', 'atk:devel', 'cairo:devel',
        'fontconfig:devel', 'freetype:devel', 'glib:devel', 'perl:runtime',
        'gnome-keyring:devel', 'gnome-vfs:devel', 'gtk:devel', 'libIDL:devel',
        'libart_lgpl:devel', 'libbonobo:devel', 'libbonoboui:devel',
        'libgnome:devel', 'libgnomecanvas:devel', 'libgnomeui:devel',
        'libjpeg:devel', 'libpng:devel', 'libstdc++:devel', 'libxml2:devel',
        'pango:devel', 'popt:devel', 'zlib:devel', 'zip:runtime', 'pkgconfig:devel',
        'libX11:devel', 'libXau:devel', 'libXdmcp:devel', 'libXt:devel',
        'libXext:devel', 'libXi:devel', 'libXinerama:devellib', 'libXft:devel',
        'libXrender:devel','libdmx:devel', 'libICE:devel', 'libSM:devel' ]

    def setup(r):
        r.addArchive('ftp://ftp.mozilla.org/pub/mozilla.org/%(name)s/releases/%(version)s/source/%(name)s-%(version)s-source.tar.bz2')
	patches = ('000_flex-configure-LANG.patch',
		'002_firefox-1.5-visibility-check.patch',
		'003_firefox-bus-error.patch',
#		'004_mozilla-hppa.patch',
#		'005_mozilla-firefox-1.5-ia64.patch',
		'006_mozilla-jslibmath-alpha.patch',
		'007_mozilla-firefox-1.5-asneeded.patch',
		'008_xulrunner-gentoo-pkgconfig-1.patch',
		'009_firefox-1.5-no-textrels.patch',
		'021_firefox-1.5-system-nss.patch',
		'022_nss-with-system-nspr.patch',
		'030_pango-cairo-1.patch',
		'031_firefox-1.1-uriloader-1.patch',
		'032_pangoxft.patch',
		'060_embed-typeaheadfind-1.patch',
		'063_mozilla-rpath-3.patch',
#		'064_mozilla-1.7.10-nsplugins-v2.patch',
		'100_native_uconv.patch',
		'101_about:plugins.patch',
		'102_components_no_exec.patch',
		'102_no_examples.patch',
		'103_enable_embedding_tests.patch',
		'104_installer_path_1.patch',
#		'105_enable_js_binary.patch',
		'106_fix_locale.patch',
		'107_no_chrome_list.patch',
		'109_no_sys_profile.patch',
		'110_add_sidebar.patch',
		'111_system_bz2.patch',
		'112_remove_useragent.patch',
		'113_xpcomglue_shared_1.patch',
		'114_xrender_bug.patch',
		'115_xpidl.patch',
		'116_embed_initial_visibility.patch',
#		'117_javaxpcom.patch',
		'118_killall.patch',
		'119_config_install.patch',
		'120_sonames.patch',
		'300_firefox-1.5-makeopts.patch')
	for patch in patches: 
		r.addPatch(patch)

        r.Configure(
		' --disable-accessibility'
	#	' --disable-javaxpcom'   
#		' --disable-xpcom-obsolete'
	#	' --disable-jsloader'
#		' --disable-xpctools'
#		' --disable-xpfe-components'
		' --enable-svg-renderer=cairo'
		' --enable-svg'  
	#	' --enable-libxul'
		'  --disable-xul'
		' --with-system-png' 
		' --enable-system-cairo' 
		' --enable-pango'
		' --with-java-include-path="/usr/lib/jvm/sun-java-1.5.0_07/include/"'
		' --with-java-bin-path="/usr/lib/jvm/sun-java-1.5.0_07/bin/"'
		' --enable-application="xulrunner"'
		' --enable-extensions="default,cookie,permissions"'
		' --enable-image-encoder=all'
		' --enable-canvas'
		#' --enable-js-binary',
		' --with-system-bz2' 
		' --enable-jsd'
		' --enable-xpctools'
		' --enable-oji' 
		' --enable-mathml'
		' --with-system-zlib'  
            	' --with-system-nspr'
		' --with-nspr-prefix=/usr/lib/'
		' --with-nspr-exec-prefix=/usr/bin/'
		' --with-system-nss'
		' --with-system-jpeg'
		' --with-system-png'
		' --enable-default-toolkit=gtk2')
        r.Make()
        r.MakeInstall()

        #r.PackageSpec('seamonkey-nss',
        #    '%(libdir)s/lib(smime|softoken|ssl).*.so','.*nss.*')
        #r.PackageSpec('seamonkey-nspr', '.*nspr.*')


