#
# Copyright (c) 2006-2011 rPath, Inc.
#               2011-2012 The Foresight Linux Project
#
# This file is distributed under the terms of the MIT License.
# A copy is available at http://www.rpath.com/permanent/mit-license.html
#

import datetime
loadSuperClass('python')
class ConaryPolicy(BuildPackageRecipe, Python.VersionMixIn):
    name = 'conary-policy'
    realVersion = '1.2'
    stamp = datetime.date.today().strftime("%Y.%m.%d")
    version =  '%s+%s' % (realVersion,stamp)

    def setup(r):
        r.setDefaultPython()
        r.macros.version = r.realVersion
        # r.addMercurialSnapshot('http://hg.rpath.com/%(name)s')
        r.addArchive('ftp://download.rpath.com/conary/')
        # A policy that enforces that two troves with different
        # names may not provide the same dependency. magic by
        # Michael K. Johnson. 
        r.addSource('group_duplicateprovides.py',
                    dest='%(prefix)s/lib/conary/policy/')
        r.MakeInstall()
        # NOT %(libdir)s
        r.CompilePython('%(prefix)s/lib/conary/policy')
        r.Requires(bootstrapPythonFlags=('%(lib)s', '%(pyver)s'))
